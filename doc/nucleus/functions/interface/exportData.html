<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of exportData</title>
  <meta name="keywords" content="exportData">
  <meta name="description" content=" exports data from both GUIs into various formats">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- menu.html interface -->
<h1>exportData
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> exports data from both GUIs into various formats</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function exportData(fig_tag,format) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">exportData exports data from both GUIs into various formats

 Syntax:
       exportData(fig_tag,format)

 Inputs:
       fig_tag - 'MOD' or 'INV'
       format - 'matS', 'matA', 'excelS', 'LIAG', or 'bgr_repo'

 Outputs:
       none

 Example:
       exportData('INV','matS')

 Other m-files required:
       clearSingleAxis

 Subfunctions:
       checkINV
       checkMOD
       exportINV_EXCEL
       exportINV_CSV
       exportINV_BGR_repos
       exportMOD_EXCEL
       findApproxTlgmAmplitude

 MAT-files required:
       none

 See also: NUCLEUSinv, NUCLEUSmod
 Author: see AUTHORS.md
 email: see AUTHORS.md
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>	 shows status information either in the GUI or on the</li><li><a href="exportGraphics.html" class="code" title="function varargout = exportGraphics(fig_tag,format)">exportGraphics</a>	 exports graphics from both GUIs into various formats</li><li><a href="exportINV.html" class="code" title="function exportINV(format,varargin)">exportINV</a>	 exports NUCLEUSinv GUI data to a mat-file</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/callbacks/contextmenus/onContextSignalList.html" class="code" title="function onContextSignalList(src,~)">onContextSignalList</a>	 handles the calls from the context menu of the data</li><li><a href="../../../nucleus/callbacks/menus/onMenuExportData.html" class="code" title="function onMenuExportData(src,~)">onMenuExportData</a>	 handles the calls from the export menu</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function exportINV_EXCEL(gui,INVdata,id,sfile,spath)</a></li><li><a href="#_sub2" class="code">function exportINV_CSV(INVdata,sfile)</a></li><li><a href="#_sub3" class="code">function exportINV_BGR_repos(INVdata,sfile)</a></li><li><a href="#_sub4" class="code">function exportMOD_EXCEL()</a></li><li><a href="#_sub5" class="code">function doexport = checkINV(INVdata,id)</a></li><li><a href="#_sub6" class="code">function doexport = checkMOD(data)</a></li><li><a href="#_sub7" class="code">function amp = findApproxTlgmAmplitude(t,f,TLGM)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function exportData(fig_tag,format)</a>
0002 <span class="comment">%exportData exports data from both GUIs into various formats</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       exportData(fig_tag,format)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       fig_tag - 'MOD' or 'INV'</span>
0009 <span class="comment">%       format - 'matS', 'matA', 'excelS', 'LIAG', or 'bgr_repo'</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Outputs:</span>
0012 <span class="comment">%       none</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Example:</span>
0015 <span class="comment">%       exportData('INV','matS')</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Other m-files required:</span>
0018 <span class="comment">%       clearSingleAxis</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Subfunctions:</span>
0021 <span class="comment">%       checkINV</span>
0022 <span class="comment">%       checkMOD</span>
0023 <span class="comment">%       exportINV_EXCEL</span>
0024 <span class="comment">%       exportINV_CSV</span>
0025 <span class="comment">%       exportINV_BGR_repos</span>
0026 <span class="comment">%       exportMOD_EXCEL</span>
0027 <span class="comment">%       findApproxTlgmAmplitude</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% MAT-files required:</span>
0030 <span class="comment">%       none</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% See also: NUCLEUSinv, NUCLEUSmod</span>
0033 <span class="comment">% Author: see AUTHORS.md</span>
0034 <span class="comment">% email: see AUTHORS.md</span>
0035 <span class="comment">% License: MIT License (at end)</span>
0036 
0037 <span class="comment">%------------- BEGIN CODE --------------</span>
0038 
0039 <span class="comment">%% get GUI handle and data</span>
0040 fig = findobj(<span class="string">'Tag'</span>,fig_tag);
0041 gui = getappdata(fig,<span class="string">'gui'</span>);
0042 data = getappdata(fig,<span class="string">'data'</span>);
0043 
0044 <span class="keyword">switch</span> fig_tag
0045     <span class="keyword">case</span> <span class="string">'INV'</span>
0046         <span class="comment">% get inversion data</span>
0047         INVdata = getappdata(fig,<span class="string">'INVdata'</span>);
0048         
0049         <span class="comment">% which NMR signal</span>
0050         id = get(gui.listbox_handles.signal,<span class="string">'Value'</span>);
0051         
0052         <span class="comment">% different export formats</span>
0053         <span class="keyword">switch</span> format
0054             
0055             <span class="keyword">case</span> <span class="string">'LIAGcsvT2'</span> <span class="comment">% raw data</span>
0056                 <span class="comment">% check if there is any data at all</span>
0057                 <span class="keyword">if</span> isfield(data.import,<span class="string">'NMR'</span>)
0058                     
0059                     <span class="comment">% display info text</span>
0060                     <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0061                         <span class="string">'Exporting LIAG csv T2 raw data ...'</span>);
0062                     <span class="comment">% which NMR signal</span>
0063                     id = get(gui.listbox_handles.signal,<span class="string">'Value'</span>);
0064                     <span class="comment">% export path</span>
0065                     spath = data.import.path;
0066                     <span class="comment">% export file names</span>
0067                     fname = data.import.NMR.data{id}.datfile;
0068                     fname_org = [fname,<span class="string">'.org'</span>];
0069                     <span class="comment">% ask the user if the imag part should be set to zero</span>
0070                     quest = <span class="string">'Set imaginary part to ZERO?'</span>;
0071                     title = <span class="string">'Saving T2 data'</span>;
0072                     answer = questdlg(quest,title,<span class="string">'Yes'</span>);
0073                     
0074                     <span class="keyword">switch</span> answer
0075                         <span class="keyword">case</span> {<span class="string">'Yes'</span>,<span class="string">'No'</span>}
0076                             <span class="comment">% first copy original file to backup file</span>
0077                             sourcef = fullfile(spath,fname);
0078                             destf = fullfile(spath,fname_org);
0079                             [status,~,~] = copyfile(sourcef,destf);
0080                             <span class="comment">% if the backup was successful save the data</span>
0081                             <span class="keyword">if</span> status == 1
0082                                 t = data.import.NMR.data{id}.time;
0083                                 s = data.import.NMR.data{id}.signal;
0084                                 
0085                                 <span class="keyword">switch</span> answer
0086                                     <span class="keyword">case</span> <span class="string">'Yes'</span>
0087                                         out = [t real(s) zeros(size(t))];
0088                                     <span class="keyword">case</span> <span class="string">'No'</span>
0089                                         out = [t real(s) imag(s)];
0090                                 <span class="keyword">end</span>
0091                                 dlmwrite(sourcef,out,<span class="string">'precision'</span>,<span class="string">'%.6f'</span>);
0092                                 
0093                                 <span class="comment">% display info text</span>
0094                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0095                                     <span class="string">'Exporting LIAG csv T2 raw data ... done'</span>);
0096                             <span class="keyword">else</span>
0097                                 <span class="comment">% display info text</span>
0098                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0099                                     <span class="string">'Exporting LIAG csv T2 raw data ... canceled'</span>);
0100                             <span class="keyword">end</span>
0101                         <span class="keyword">otherwise</span>
0102                             <span class="comment">% display info text</span>
0103                             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0104                                 <span class="string">'Exporting LIAG csv T2 raw data ... canceled'</span>);
0105                     <span class="keyword">end</span>
0106                 <span class="keyword">end</span>
0107                 
0108             <span class="keyword">otherwise</span> <span class="comment">% inv data</span>
0109                 <span class="comment">% check if data can be exported</span>
0110                 doexport_inv = <a href="#_sub5" class="code" title="subfunction doexport = checkINV(INVdata,id)">checkINV</a>(INVdata,id);
0111                 
0112                 <span class="keyword">if</span> doexport_inv
0113                     <span class="comment">% get the new file name</span>
0114                     sfilename = data.import.NMR.filesShort{id};
0115                     ind1 = strfind(sfilename,<span class="string">'.'</span>);
0116                     <span class="keyword">if</span> isempty(ind1)
0117                         sfilename = [sfilename,<span class="string">'_INV'</span>];
0118                     <span class="keyword">else</span>
0119                         sfilename = [sfilename(1:ind1-1),<span class="string">'_INV'</span>];
0120                     <span class="keyword">end</span>
0121                     
0122                     <span class="comment">% different export formats</span>
0123                     <span class="keyword">switch</span> format
0124                         <span class="keyword">case</span> <span class="string">'excelS'</span>
0125                             <span class="comment">% get the file name</span>
0126                             [sfile,spath] = uiputfile(<span class="string">'*.xlsx'</span>,<span class="keyword">...</span>
0127                                 <span class="string">'Save inversion to Excel-file'</span>,<span class="keyword">...</span>
0128                                 fullfile(data.import.path,[sfilename,<span class="string">'.xlsx'</span>]));
0129                             
0130                             <span class="comment">% if user didn't cancel</span>
0131                             <span class="keyword">if</span> sum([sfile spath]) &gt; 0
0132                                 <a href="#_sub1" class="code" title="subfunction exportINV_EXCEL(gui,INVdata,id,sfile,spath)">exportINV_EXCEL</a>(gui,INVdata,id,sfile,spath);
0133                             <span class="keyword">end</span>
0134                         <span class="keyword">case</span> <span class="string">'matS'</span>
0135                             <span class="comment">% get the file name</span>
0136                             [sfile,spath] = uiputfile(<span class="string">'*.mat'</span>,<span class="keyword">...</span>
0137                                 <span class="string">'Save inversion to mat-file'</span>,<span class="keyword">...</span>
0138                                 fullfile(data.import.path,[sfilename,<span class="string">'.mat'</span>]));
0139                             
0140                             <span class="comment">% if user didn't cancel</span>
0141                             <span class="keyword">if</span> sum([sfile spath]) &gt; 0
0142                                 <span class="comment">% display info text</span>
0143                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0144                                     <span class="string">'Exporting inversion data to mat-file ...'</span>);
0145                                 <span class="comment">% gather all data</span>
0146                                 idata.NMRdata = data.import.NMR.data{id};
0147                                 idata.results = INVdata{id}.results;
0148                                 idata.NUCLEUSinv_GUI = INVdata{id};
0149                                 idata.NUCLEUSinv_GUI = rmfield(idata.NUCLEUSinv_GUI,<span class="string">'results'</span>);
0150                                 
0151                                 <span class="comment">% save to file</span>
0152                                 save(fullfile(spath,sfile),<span class="string">'idata'</span>,<span class="string">'-v7.3'</span>);
0153                                 
0154                                 <span class="comment">% display info text</span>
0155                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0156                                     <span class="string">'Exporting inversion data to mat-file ... done'</span>);
0157                             <span class="keyword">else</span>
0158                                 <span class="comment">% display info text</span>
0159                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0160                                     <span class="string">'Exporting inversion data to mat-file ... canceled'</span>);
0161                             <span class="keyword">end</span>
0162                             
0163                         <span class="keyword">case</span> <span class="string">'matA'</span>
0164                             <span class="comment">% get the file name</span>
0165                             [sfile,spath] = uiputfile(<span class="string">'*.mat'</span>,<span class="keyword">...</span>
0166                                 <span class="string">'Save inversion to mat-file'</span>,<span class="keyword">...</span>
0167                                 fullfile(data.import.path,<span class="string">'inversion_set.mat'</span>));
0168                             <span class="comment">% if user didn't cancel</span>
0169                             <span class="keyword">if</span> sum([sfile spath]) &gt; 0
0170                                 <span class="comment">% display info text</span>
0171                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0172                                     <span class="string">'Exporting inversion set to mat-file ...'</span>);
0173                                 idata = struct;
0174                                 <span class="keyword">for</span> id = 1:size(INVdata,1)
0175                                     <span class="keyword">if</span> isstruct(INVdata{id})
0176                                         results = INVdata{id}.results;
0177                                         results = rmfield(results,<span class="string">'nmrraw'</span>);
0178                                         results.nmraw = data.import.NMR.data{id};
0179                                         idata.results(id) = results;
0180                                     <span class="keyword">end</span>
0181                                 <span class="keyword">end</span>
0182                                 idata.NUCLEUSinv_GUI = INVdata{1};
0183                                 idata.NUCLEUSinv_GUI = rmfield(idata.NUCLEUSinv_GUI,<span class="string">'results'</span>);
0184                                 
0185                                 <span class="comment">% save to file</span>
0186                                 save(fullfile(spath,sfile),<span class="string">'idata'</span>,<span class="string">'-v7.3'</span>);
0187                                 
0188                                 <span class="comment">% display info text</span>
0189                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0190                                     <span class="string">'Exporting inversion set to mat-file ... done'</span>);
0191                             <span class="keyword">else</span>
0192                                 <span class="comment">% display info text</span>
0193                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0194                                     <span class="string">'Exporting inversion set to mat-file ... canceled'</span>);
0195                             <span class="keyword">end</span>
0196                             
0197                         <span class="keyword">case</span> <span class="string">'LIAG'</span>
0198                             
0199                             <span class="keyword">if</span> isfield(data.import,<span class="string">'LIAG'</span>)
0200                                 <span class="comment">% display info text</span>
0201                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0202                                     <span class="string">'Exporting LIAG archive data ...'</span>);
0203                                 <span class="comment">% find id of sample</span>
0204                                 id = 1;
0205                                 spath = data.import.LIAG.workpaths{id};
0206                                 sfilename = [<span class="string">'INV_'</span>,data.import.NMR.filesShort{id}];
0207                                 
0208                                 <span class="comment">% session output</span>
0209                                 silent.sname = fullfile(spath,[sfilename,<span class="string">'_session.mat'</span>]);
0210                                 <a href="exportINV.html" class="code" title="function exportINV(format,varargin)">exportINV</a>(<span class="string">'session'</span>,silent);
0211                                 
0212                                 <span class="comment">% csv output</span>
0213                                 csvname = fullfile(spath,[sfilename,<span class="string">'.csv'</span>]);
0214                                 <a href="#_sub2" class="code" title="subfunction exportINV_CSV(INVdata,sfile)">exportINV_CSV</a>(INVdata{id},csvname);
0215                                 
0216                                 <span class="comment">% png graphics</span>
0217                                 pngname = fullfile(spath,[sfilename,<span class="string">'.png'</span>]);
0218                                 [f,ax] = <a href="exportGraphics.html" class="code" title="function varargout = exportGraphics(fig_tag,format)">exportGraphics</a>(<span class="string">'INV'</span>,<span class="string">'fig'</span>);
0219                                 
0220                                 figure(f);
0221                                 por = INVdata{id}.invstd.porosity;
0222                                 tname = [sfilename(5:end),<span class="string">' (water content: '</span>,<span class="keyword">...</span>
0223                                     sprintf(<span class="string">'%2.1f'</span>,por*100),<span class="string">' [vol. %])'</span>];
0224                                 set(get(ax(1),<span class="string">'Title'</span>),<span class="string">'String'</span>,tname,<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0225                                 
0226                                 <span class="comment">% get the cut-offs</span>
0227                                 <span class="keyword">switch</span> INVdata{id}.process.timescale
0228                                     <span class="keyword">case</span> <span class="string">'s'</span>
0229                                         CBW = INVdata{id}.param.CBWcutoff/1000;
0230                                         BVI = INVdata{id}.param.BVIcutoff/1000;
0231                                     <span class="keyword">case</span> <span class="string">'ms'</span>
0232                                         CBW = INVdata{id}.param.CBWcutoff;
0233                                         BVI = INVdata{id}.param.BVIcutoff;
0234                                 <span class="keyword">end</span>
0235                                 <span class="comment">% ylim of relaxation time axis</span>
0236                                 yy = get(ax(2),<span class="string">'YLim'</span>);
0237                                 lgdstr = cell(1,1);
0238                                 <span class="keyword">switch</span> INVdata{id}.invstd.invtype
0239                                     <span class="keyword">case</span> {<span class="string">'LU'</span>,<span class="string">'NNLS'</span>}
0240                                         TLGM = INVdata{id}.results.invstd.Tlgm;
0241                                         T = INVdata{id}.results.invstd.T1T2me;
0242                                         F = INVdata{id}.results.invstd.T1T2f;
0243                                         F = 100.*por.*F./sum(F);
0244                                         amp = <a href="#_sub7" class="code" title="subfunction amp = findApproxTlgmAmplitude(t,f,TLGM)">findApproxTlgmAmplitude</a>(T,F,TLGM);
0245                                         stem(TLGM,amp,<span class="keyword">...</span>
0246                                             <span class="string">'x-'</span>,<span class="string">'Color'</span>,[0.3 0.3 0.3],<span class="string">'LineWidth'</span>,2,<span class="keyword">...</span>
0247                                             <span class="string">'Tag'</span>,<span class="string">'TLGM'</span>,<span class="string">'Parent'</span>,ax(2));
0248                                         lgdstr{1} = <span class="string">'RTD'</span>;
0249                                         lgdstr{2} = <span class="string">'TLGM'</span>;
0250                                         
0251                                         CBWa = abs(sum(F(T&lt;=CBW))/sum(F));
0252                                         BVIa = abs(sum(F(T&gt;CBW &amp; T&lt;=BVI))/sum(F));
0253                                         BVMa = abs(sum(F(T&gt;BVI))/sum(F));
0254                                         tname2 = [<span class="string">'CBW / BVI / BVM: '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*CBWa),<span class="keyword">...</span>
0255                                             <span class="string">' / '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*BVIa),<span class="keyword">...</span>
0256                                             <span class="string">' / '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*BVMa),<span class="keyword">...</span>
0257                                             <span class="string">' [vol. %] | TLGM: '</span>,sprintf(<span class="string">'%5.4f'</span>,TLGM),<span class="string">' [s]'</span>];
0258                                         
0259                                     <span class="keyword">case</span> {<span class="string">'mono'</span>,<span class="string">'free'</span>}
0260                                         F = INVdata{id}.results.invstd.E0(:);
0261                                         <span class="keyword">switch</span> INVdata{id}.results.nmrproc.T1T2
0262                                             <span class="keyword">case</span> <span class="string">'T1'</span>
0263                                                 T = INVdata{id}.results.invstd.T1(:);
0264                                             <span class="keyword">case</span> <span class="string">'T2'</span>
0265                                                 T = INVdata{id}.results.invstd.T2(:);
0266                                         <span class="keyword">end</span>
0267                                         F = 100.*por.*F./sum(F);
0268                                         CBWa = abs(sum(F(T&lt;=CBW))/sum(F));
0269                                         BVIa = abs(sum(F(T&gt;CBW &amp; T&lt;=BVI))/sum(F));
0270                                         BVMa = abs(sum(F(T&gt;BVI))/sum(F));
0271                                         tname2 = [<span class="string">'CBW / BVI / BVM: '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*CBWa),<span class="keyword">...</span>
0272                                             <span class="string">' / '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*BVIa),<span class="keyword">...</span>
0273                                             <span class="string">' / '</span>,sprintf(<span class="string">'%2.1f'</span>,por*100*BVMa),<span class="keyword">...</span>
0274                                             <span class="string">' [vol. %]'</span>];
0275                                         <span class="keyword">for</span> i = 1:numel(T)
0276                                             lgdstr{i} = [<span class="string">'Tx'</span>,num2str(i)];
0277                                         <span class="keyword">end</span>
0278                                 <span class="keyword">end</span>
0279                                 <span class="comment">% print cut-off lines</span>
0280                                 line([CBW CBW],[yy(1) yy(2)],<span class="string">'Color'</span>,[0.3 0.3 0.3],<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="keyword">...</span>
0281                                     <span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,ax(2),<span class="string">'Tag'</span>,<span class="string">'infolines'</span>);
0282                                 line([BVI BVI],[yy(1) yy(2)],<span class="string">'Color'</span>,[0.3 0.3 0.3],<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="keyword">...</span>
0283                                     <span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,ax(2),<span class="string">'Tag'</span>,<span class="string">'infolines'</span>);
0284                                 legend(ax(2),[lgdstr,<span class="string">'cutoffs'</span>]);
0285                                 set(get(ax(2),<span class="string">'Title'</span>),<span class="string">'String'</span>,tname2,<span class="string">'Interpreter'</span>,<span class="string">'none'</span>);
0286                                 
0287                                 set(f,<span class="string">'PaperType'</span>,<span class="string">'A4'</span>,<span class="string">'PaperUnits'</span>,<span class="string">'centimeters'</span>,<span class="keyword">...</span>
0288                                     <span class="string">'PaperOrientation'</span>,<span class="string">'portrait'</span>);
0289                                 set(f,<span class="string">'PaperPositionMode'</span>,<span class="string">'manual'</span>,<span class="keyword">...</span>
0290                                     <span class="string">'PaperPosition'</span>,[0.6 6.2 19.7 17.2]);
0291                                 set(f,<span class="string">'Renderer'</span>,<span class="string">'painter'</span>);
0292                                 print(f,pngname,<span class="string">'-r300'</span>,<span class="string">'-dpng'</span>);
0293                                 close(f);
0294                                 
0295                                 <span class="comment">% display info text</span>
0296                                 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0297                                     <span class="string">'Exporting LIAG archive data ... done'</span>);
0298                                 
0299                             <span class="keyword">else</span>
0300                                 helpdlg({<span class="string">'function: exportData'</span>,<span class="keyword">...</span>
0301                                     <span class="string">'This routine works only on LIAG specific project data.'</span>},<span class="keyword">...</span>
0302                                     <span class="string">'No LIAG data'</span>);
0303                             <span class="keyword">end</span>
0304                         <span class="keyword">case</span> <span class="string">'BGR_repos'</span>
0305                             
0306                             <span class="comment">% get the file name</span>
0307                             [sfile,spath] = uiputfile(<span class="string">'*.csv'</span>,<span class="keyword">...</span>
0308                                 <span class="string">'Save measurement and inversion data and parameters csv-file'</span>,<span class="keyword">...</span>
0309                                 fullfile(data.import.path,[sfilename,<span class="string">'.csv'</span>]));
0310                             <span class="comment">% if user didn't cancel</span>
0311                             <span class="keyword">if</span> sum([sfile spath]) &gt; 0
0312                                 csvname = fullfile(spath,sfile);
0313                                 <a href="#_sub3" class="code" title="subfunction exportINV_BGR_repos(INVdata,sfile)">exportINV_BGR_repos</a>(INVdata{id},csvname);
0314                             <span class="keyword">end</span>
0315                             
0316                                 
0317                     <span class="keyword">end</span>
0318                 <span class="keyword">end</span>
0319         <span class="keyword">end</span>
0320     <span class="keyword">case</span> <span class="string">'MOD'</span>
0321         <span class="comment">% check if data can be exported</span>
0322         doexport_mod = <a href="#_sub6" class="code" title="subfunction doexport = checkMOD(data)">checkMOD</a>(data);
0323         <span class="keyword">if</span> doexport_mod
0324             <span class="comment">% different export formats</span>
0325             <span class="keyword">switch</span> format
0326                 <span class="keyword">case</span> <span class="string">'mat'</span>
0327                     <span class="comment">% gather all relevant data</span>
0328                     out = data.results;
0329                     <span class="keyword">if</span> isfield(out.NMR.raw,<span class="string">'Tb'</span>)
0330                         out.NMR.raw = rmfield(out.NMR.raw,<span class="string">'Tb'</span>);
0331                     <span class="keyword">end</span>
0332                     <span class="keyword">if</span> isfield(out.NMR.raw,<span class="string">'rho'</span>)
0333                         out.NMR.raw = rmfield(out.NMR.raw,<span class="string">'rho'</span>);
0334                     <span class="keyword">end</span>
0335                     out.NMRMOD_GUI.geometry = data.geometry;
0336                     out.NMRMOD_GUI.pressure = data.pressure;
0337                     out.NMRMOD_GUI.nmr = data.nmr;
0338                     out.NMRMOD_GUI.myui = gui.myui;
0339                     
0340                     <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to MAT-file ...'</span>);
0341                     [FileName,PathName,~] = uiputfile({<span class="string">'*.mat'</span>,<span class="string">'Matlab file'</span>},<span class="string">'NUCLEUSmod: Save Data'</span>,fullfile(pwd,<span class="string">'NUCLEUSmod_forward.mat'</span>));
0342                     
0343                     <span class="keyword">if</span> ~isequal(FileName,0) || ~isequal(PathName,0)
0344                         clear data
0345                         data = out; <span class="comment">%#ok&lt;NASGU&gt;</span>
0346                         save(fullfile(PathName,FileName),<span class="string">'data'</span>,<span class="string">'-v7.3'</span>);
0347                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to MAT-file ... done.'</span>);
0348                     <span class="keyword">else</span>
0349                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to MAT-file ... canceled.'</span>);
0350                     <span class="keyword">end</span>
0351                     
0352                 <span class="keyword">case</span> <span class="string">'xls'</span>
0353                     indd = data.pressure.DrainLevels;
0354                     indi = data.pressure.ImbLevels;
0355                     results = data.results;
0356                     
0357                     <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to XLS-file ...'</span>);
0358                     [FileName,PathName,~] = uiputfile({<span class="string">'*.xls'</span>,<span class="string">'XLS file'</span>},<span class="string">'NUCLEUSmod: Save Data'</span>,fullfile(pwd,<span class="string">'NUCLEUSmod_forward.xls'</span>));
0359                     
0360                     <span class="keyword">if</span> ~isequal(FileName,0) || ~isequal(PathName,0)
0361                         <a href="#_sub4" class="code" title="subfunction exportMOD_EXCEL()">exportMOD_EXCEL</a>;
0362                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to XLS-file ... done.'</span>);
0363                     <span class="keyword">else</span>
0364                         <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Saving to XLS-file ... canceled.'</span>);
0365                     <span class="keyword">end</span>
0366                     
0367                 <span class="keyword">otherwise</span>
0368                     helpdlg({<span class="string">'exportData:'</span>,<span class="string">'Not yet implemented.'</span>},<span class="string">'NUCLEUSmod info:'</span>);
0369                     
0370             <span class="keyword">end</span>
0371         <span class="keyword">end</span>
0372 <span class="keyword">end</span>
0373 
0374 <span class="keyword">end</span>
0375 
0376 <span class="comment">%%</span>
0377 <a name="_sub1" href="#_subfunctions" class="code">function exportINV_EXCEL(gui,INVdata,id,sfile,spath)</a>
0378 unit = INVdata{id}.process.timescale;
0379 
0380 <span class="comment">% gather all data</span>
0381 <span class="comment">% raw data</span>
0382 tmp1(:,1) = INVdata{id}.results.nmrraw.t(:);
0383 header1{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0384 <span class="keyword">if</span> isreal(INVdata{id}.results.nmrraw.s(:))
0385     header1{2} = <span class="string">'amplitude [a.u.]'</span>;
0386     tmp1(:,2) = INVdata{id}.results.nmrraw.s(:);
0387     
0388     b1 = {<span class="string">'raw data'</span>,<span class="string">''</span>};
0389     b1(2,:) = header1;
0390     b1(3:2+size(tmp1,1),:) = [num2cell(tmp1(:,1)),num2cell(tmp1(:,2))];
0391 <span class="keyword">else</span>
0392     header1{2} = <span class="string">'real [a.u.]'</span>;
0393     header1{3} = <span class="string">'imag [a.u.]'</span>;
0394     tmp1(:,2) = real(INVdata{id}.results.nmrraw.s(:));
0395     tmp1(:,3) = imag(INVdata{id}.results.nmrraw.s(:));
0396     
0397     b1 = {<span class="string">'raw data'</span>,<span class="string">''</span>,<span class="string">''</span>};
0398     b1(2,:) = header1;
0399     b1(3:2+size(tmp1,1),:) = [num2cell(tmp1(:,1)),num2cell(tmp1(:,2)),<span class="keyword">...</span>
0400         num2cell(tmp1(:,3))];
0401 <span class="keyword">end</span>
0402 
0403 <span class="comment">% proc data</span>
0404 tmp2(:,1) = INVdata{id}.results.nmrproc.t(:);
0405 tmp2(:,2) = INVdata{id}.results.nmrproc.s(:);
0406 header2{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0407 header2{2} = <span class="string">'amplitude [a.u.]'</span>;
0408 
0409 b2 = {<span class="string">'proc data'</span>,<span class="string">''</span>};
0410 b2(2,:) = header2;
0411 b2(3:2+size(tmp2,1),:) = [num2cell(tmp2(:,1)),num2cell(tmp2(:,2))];
0412 
0413 <span class="comment">% fit data (incl. residuals)</span>
0414 tmp3(:,1) = INVdata{id}.results.invstd.fit_t(:);
0415 tmp3(:,2) = INVdata{id}.results.invstd.fit_s(:);
0416 tmp3(:,3) = INVdata{id}.results.invstd.residual(:);
0417 header3{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0418 header3{2} = <span class="string">'amplitude [a.u.]'</span>;
0419 header3{3} = <span class="string">'residual [-]'</span>;
0420 
0421 b3 = {<span class="string">'fit data'</span>,<span class="string">''</span>,<span class="string">''</span>};
0422 b3(2,:) = header3;
0423 b3(3:2+size(tmp3,1),:) = [num2cell(tmp3(:,1)),num2cell(tmp3(:,2)),<span class="keyword">...</span>
0424     num2cell(tmp3(:,3))];
0425 
0426 <span class="comment">% relaxation times</span>
0427 <span class="keyword">switch</span> INVdata{id}.invstd.invtype
0428     <span class="keyword">case</span> {<span class="string">'mono'</span>,<span class="string">'free'</span>}
0429         <span class="keyword">switch</span> INVdata{id}.results.nmrproc.T1T2
0430             <span class="keyword">case</span> <span class="string">'T1'</span>
0431                 tmp4 = [INVdata{id}.results.invstd.T1(:)<span class="keyword">...</span>
0432                     INVdata{id}.results.invstd.E0(:)];
0433                 header4 = {[<span class="string">'T1 ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitude [a.u.]'</span>};
0434             <span class="keyword">case</span> <span class="string">'T2'</span>
0435                 tmp4 = [INVdata{id}.results.invstd.T2(:)<span class="keyword">...</span>
0436                     INVdata{id}.results.invstd.E0(:)];
0437                 header4 = {[<span class="string">'T2 ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitude [a.u.]'</span>};
0438         <span class="keyword">end</span>
0439         
0440     <span class="keyword">case</span> {<span class="string">'LU'</span>,<span class="string">'NNLS'</span>,<span class="string">'MUMO'</span>}
0441         tmp4 = [INVdata{id}.results.invstd.T1T2me(:)<span class="keyword">...</span>
0442             INVdata{id}.results.invstd.T1T2f(:)];
0443         header4 = {[<span class="string">'relaxation times ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitudes [a.u.]'</span>};
0444         
0445     <span class="keyword">otherwise</span>
0446         disp(<span class="string">'Something is utterly wrong.'</span>)
0447 <span class="keyword">end</span>
0448 
0449 b4 = {<span class="string">'relaxation times'</span>,<span class="string">''</span>};
0450 b4(2,:) = header4;
0451 b4(3:2+size(tmp4,1),:) = [num2cell(tmp4(:,1)),num2cell(tmp4(:,2))];
0452 
0453 <span class="comment">% glue together the output matrix</span>
0454 out(1:size(b1,1),1:size(b1,2)) = b1;
0455 yi = size(b1,2)+2;
0456 out(1:size(b2,1),yi:yi-1+size(b2,2)) = b2;
0457 yi = yi + size(b2,2)+1;
0458 out(1:size(b3,1),yi:yi-1+size(b3,2)) = b3;
0459 yi = yi + size(b3,2)+1;
0460 out(1:size(b4,1),yi:yi-1+size(b4,2)) = b4;
0461 
0462 <span class="comment">% check for uncertainty data</span>
0463 hasUncert = false;
0464 <span class="keyword">if</span> isfield(INVdata{id}.results.invstd,<span class="string">'uncert'</span>)
0465     hasUncert = true;
0466     uncert = INVdata{id}.results.invstd.uncert;
0467     stats = uncert.statistics;
0468 
0469     <span class="comment">% first the general statistics</span>
0470     header5a = {<span class="string">'uncertainty statistics'</span>,<span class="string">''</span>,<span class="string">''</span>};
0471     header5b = {<span class="string">'RTD bounds'</span>,<span class="string">''</span>,<span class="string">''</span>};
0472     header5c = {<span class="string">'TLGM (mean)'</span>,<span class="string">'TLGM (std)'</span>,<span class="string">'TLGM (aad,0)'</span>};
0473     header5d = {<span class="string">'TLGM (median)'</span>,<span class="string">'TLGM (aad,1)'</span>,<span class="string">''</span>};
0474     header5e = {<span class="string">'E0 (mean)'</span>,<span class="string">'E0 (std)'</span>,<span class="string">'E0 (aad,0)'</span>};
0475     header5f = {<span class="string">'E0 (median)'</span>,<span class="string">'E0 (aad,1)'</span>,<span class="string">''</span>};
0476 
0477     b5(1,:) = header5a;
0478     b5(3,:) = header5b;
0479     b5(4,:) = [num2cell(stats.RTD_bounds), {<span class="string">''</span>}];
0480     b5(6,:) = header5c;
0481     b5(7,:) = num2cell(stats.Tlgm);
0482     b5(8,:) = header5d;
0483     b5(9,:) = [num2cell(stats.Tlgm_med), {<span class="string">''</span>}];
0484     b5(11,:) = header5e;
0485     b5(12,:) = num2cell(stats.E0);
0486     b5(13,:) = header5f;
0487     b5(14,:) = [num2cell(stats.E0_med), {<span class="string">''</span>}];
0488 
0489     <span class="comment">% now the uncertainty RTDs</span>
0490     header6a = {<span class="string">'uncertainty RTDs'</span>,<span class="string">''</span>};
0491     header6b = {[<span class="string">'relaxation times ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitudes [a.u.]'</span>};
0492     nDist = size(uncert.interp_f,1);
0493     <span class="keyword">for</span> id = 1:nDist-1
0494         header6a(1,2+id) = {<span class="string">''</span>};
0495         header6b(1,2+id) = {<span class="string">'amplitudes [a.u.]'</span>};
0496     <span class="keyword">end</span>
0497     b6(1,:) = header6a;
0498     b6(2,:) = header6b;
0499     b6(3:2+size(tmp4,1),:) = [num2cell(tmp4(:,1)),num2cell(uncert.interp_f')];
0500 
0501     <span class="comment">% glue together the output matrix</span>
0502     out2(1:size(b5,1),1:size(b5,2)) = b5;
0503     yi = size(b5,2)+2;
0504     out2(1:size(b6,1),yi:yi-1+size(b6,2)) = b6;
0505 <span class="keyword">end</span>
0506 
0507 <span class="comment">% display info text</span>
0508 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0509     <span class="string">'Exporting inversion data to Excel-file ...'</span>);
0510 <span class="comment">% save to file</span>
0511 xlswrite(fullfile(spath,sfile),out,<span class="string">'NMRdata'</span>,<span class="string">'A1'</span>);
0512 <span class="keyword">if</span> hasUncert
0513     xlswrite(fullfile(spath,sfile),out2,<span class="string">'NMRuncertainty'</span>,<span class="string">'A1'</span>);
0514 <span class="keyword">end</span>
0515 
0516 <span class="comment">% remove the first standard excel sheet</span>
0517 [~,sheets] = xlsfinfo(fullfile(spath,sfile));
0518 objExcel = actxserver(<span class="string">'Excel.Application'</span>);
0519 objExcel.Workbooks.Open(fullfile(spath,sfile));
0520 objExcel.ActiveWorkbook.Worksheets.Item(sheets{1}).Delete;
0521 objExcel.ActiveWorkbook.Save;
0522 objExcel.ActiveWorkbook.Close;
0523 objExcel.Quit;
0524 objExcel.delete;
0525 <span class="comment">% display info text</span>
0526 <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="keyword">...</span>
0527     <span class="string">'Exporting inversion data to Excel-file ... done'</span>);
0528 <span class="keyword">end</span>
0529 
0530 <span class="comment">%%</span>
0531 <a name="_sub2" href="#_subfunctions" class="code">function exportINV_CSV(INVdata,sfile)</a>
0532 unit = INVdata.process.timescale;
0533 
0534 <span class="comment">% gather all data</span>
0535 <span class="comment">% proc data</span>
0536 tmp2(:,1) = INVdata.results.nmrproc.t(:);
0537 tmp2(:,2) = INVdata.results.nmrproc.s(:);
0538 header2{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0539 header2{2} = <span class="string">'signal [a.u.]'</span>;
0540 
0541 <span class="comment">% fit data (incl. residuals)</span>
0542 tmp3(:,1) = INVdata.results.invstd.fit_t(:);
0543 tmp3(:,2) = INVdata.results.invstd.fit_s(:);
0544 tmp3(:,3) = INVdata.results.invstd.residual(:);
0545 header3{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0546 header3{2} = <span class="string">'fit [a.u.]'</span>;
0547 header3{3} = <span class="string">'residual [-]'</span>;
0548 
0549 <span class="comment">% relaxation times</span>
0550 <span class="keyword">switch</span> INVdata.invstd.invtype
0551     <span class="keyword">case</span> {<span class="string">'LU'</span>,<span class="string">'NNLS'</span>}
0552         por = INVdata.invstd.porosity;
0553         F = INVdata.results.invstd.T1T2f(:);
0554         F = 100*por.*F./sum(F);
0555         tmp4 = [INVdata.results.invstd.T1T2me(:)<span class="keyword">...</span>
0556             INVdata.results.invstd.T1T2f(:) F];
0557         header4 = {[<span class="string">'relaxation times ['</span>,unit,<span class="string">']'</span>],<span class="string">'frequency [-]'</span>,<span class="keyword">...</span>
0558             <span class="string">' water content [vol. %]'</span>};
0559         
0560     <span class="keyword">case</span> {<span class="string">'mono'</span>,<span class="string">'free'</span>}
0561         por = INVdata.invstd.porosity;
0562         F = 100*por.*INVdata.results.invstd.E0./sum(INVdata.results.invstd.E0);
0563         <span class="keyword">switch</span> INVdata.results.nmrproc.T1T2
0564             <span class="keyword">case</span> <span class="string">'T1'</span>
0565                 tmp4 = [INVdata.results.invstd.T1(:)<span class="keyword">...</span>
0566                     INVdata.results.invstd.E0(:) F(:)];
0567                 header4 = {[<span class="string">'relaxation time(s) T1 ['</span>,unit,<span class="string">']'</span>],<span class="keyword">...</span>
0568                     <span class="string">'amplitude [a.u.]'</span>,<span class="string">' water content [vol. %]'</span>};
0569             <span class="keyword">case</span> <span class="string">'T2'</span>
0570                 tmp4 = [INVdata.results.invstd.T2(:)<span class="keyword">...</span>
0571                     INVdata.results.invstd.E0(:) F(:)];
0572                 header4 = {[<span class="string">'relaxation time(s) T2 ['</span>,unit,<span class="string">']'</span>],<span class="keyword">...</span>
0573                     <span class="string">'amplitude [a.u.]'</span>,<span class="string">' water content [vol. %]'</span>};
0574         <span class="keyword">end</span>
0575         
0576     <span class="keyword">otherwise</span>
0577         <span class="comment">% Nothing to do</span>
0578 <span class="keyword">end</span>
0579 
0580 <span class="comment">% glue together headers</span>
0581 cHeader = [header2 header3 header4];
0582 <span class="comment">% insert commas</span>
0583 commaHeader = [cHeader;repmat({<span class="string">','</span>},1,numel(cHeader))];
0584 commaHeader = commaHeader(:)';
0585 <span class="comment">% cHeader as string with commas</span>
0586 textHeader = cell2mat(commaHeader(1:numel(commaHeader)-1));
0587 
0588 maxrows = max([size(tmp2,1) size(tmp3,1) size(tmp4,1)]);
0589 <span class="comment">% glue together data</span>
0590 <span class="keyword">if</span> size(tmp2,1) &lt; maxrows
0591     tmp2(end+1:maxrows,:) = NaN;
0592 <span class="keyword">end</span>
0593 <span class="keyword">if</span> size(tmp3,1) &lt; maxrows
0594     tmp3(end+1:maxrows,:) = NaN;
0595 <span class="keyword">end</span>
0596 <span class="keyword">if</span> size(tmp4,1) &lt; maxrows
0597     tmp4(end+1:maxrows,:) = NaN;
0598 <span class="keyword">end</span>
0599 out(1:maxrows,1:size(tmp2,2)) = tmp2;
0600 yi = size(tmp2,2)+1;
0601 out(1:maxrows,yi:yi-1+size(tmp3,2)) = tmp3;
0602 yi = yi + size(tmp3,2);
0603 out(1:maxrows,yi:yi-1+size(tmp4,2)) = tmp4;
0604 
0605 <span class="comment">% save to file</span>
0606 <span class="comment">%write header to file</span>
0607 fid = fopen(sfile,<span class="string">'w'</span>);
0608 fprintf(fid,<span class="string">'%s\n'</span>,textHeader);
0609 fclose(fid);
0610 <span class="comment">%write data to end of file</span>
0611 dlmwrite(sfile,out,<span class="string">'-append'</span>,<span class="string">'precision'</span>,<span class="string">'%.5f'</span>);
0612 
0613 <span class="keyword">end</span>
0614 <span class="comment">%%</span>
0615 <a name="_sub3" href="#_subfunctions" class="code">function exportINV_BGR_repos(INVdata,sfile)</a>
0616 unit = INVdata.process.timescale;
0617 
0618 <span class="comment">% gather all data</span>
0619 <span class="comment">% raw data</span>
0620 tmp1(:,1) = INVdata.results.nmrraw.t(:);
0621 header1{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0622 <span class="keyword">if</span> isreal(INVdata.results.nmrraw.s(:))
0623     header1{2} = <span class="string">'amplitude [a.u.]'</span>;
0624     tmp1(:,2) = INVdata.results.nmrraw.s(:);
0625     
0626     b1 = {<span class="string">'raw data'</span>,<span class="string">''</span>};
0627     b1(2,:) = header1;
0628     b1(3:2+size(tmp1,1),:) = [num2cell(tmp1(:,1)),num2cell(tmp1(:,2))];
0629 <span class="keyword">else</span>
0630     header1{2} = <span class="string">'real [a.u.]'</span>;
0631     header1{3} = <span class="string">'imag [a.u.]'</span>;
0632     tmp1(:,2) = real(INVdata.results.nmrraw.s(:));
0633     tmp1(:,3) = imag(INVdata.results.nmrraw.s(:));
0634     
0635     b1 = {<span class="string">'raw data'</span>,<span class="string">''</span>,<span class="string">''</span>};
0636     b1(2,:) = header1;
0637     b1(3:2+size(tmp1,1),:) = [num2cell(tmp1(:,1)),num2cell(tmp1(:,2)),<span class="keyword">...</span>
0638         num2cell(tmp1(:,3))];
0639 <span class="keyword">end</span>
0640 <span class="comment">% proc data</span>
0641 tmp2(:,1) = INVdata.results.nmrproc.t(:);
0642 tmp2(:,2) = INVdata.results.nmrproc.s(:);
0643 header2{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0644 header2{2} = <span class="string">'signal [a.u.]'</span>;
0645 
0646 <span class="comment">% fit data (incl. residuals)</span>
0647 tmp3(:,1) = INVdata.results.invstd.fit_t(:);
0648 tmp3(:,2) = INVdata.results.invstd.fit_s(:);
0649 tmp3(:,3) = INVdata.results.invstd.residual(:);
0650 header3{1} = [<span class="string">'time ['</span>,unit,<span class="string">']'</span>];
0651 header3{2} = <span class="string">'fit [a.u.]'</span>;
0652 header3{3} = <span class="string">'residual [-]'</span>;
0653 
0654 <span class="comment">% relaxation times</span>
0655 <span class="keyword">switch</span> INVdata.invstd.invtype
0656     <span class="keyword">case</span> {<span class="string">'LU'</span>,<span class="string">'NNLS'</span>}
0657         por = INVdata.invstd.porosity;
0658         F = INVdata.results.invstd.T1T2f(:);
0659         F = 100*por.*F./sum(F);
0660         tmp4 = [INVdata.results.invstd.T1T2me(:)<span class="keyword">...</span>
0661             INVdata.results.invstd.T1T2f(:) F];
0662         header4 = {[<span class="string">'relaxation times ['</span>,unit,<span class="string">']'</span>],<span class="string">'amplitude [-]'</span>,<span class="keyword">...</span>
0663             <span class="string">'partial water content [vol. %]'</span>};
0664         
0665     <span class="keyword">case</span> {<span class="string">'mono'</span>,<span class="string">'free'</span>}
0666         por = INVdata.invstd.porosity;
0667         F = 100*por.*INVdata.results.invstd.E0./sum(INVdata.results.invstd.E0);
0668         <span class="keyword">switch</span> INVdata.results.nmrproc.T1T2
0669             <span class="keyword">case</span> <span class="string">'T1'</span>
0670                 tmp4 = [INVdata.results.invstd.T1(:)<span class="keyword">...</span>
0671                     INVdata.results.invstd.E0(:) F(:)];
0672                 header4 = {[<span class="string">'relaxation time(s) T1 ['</span>,unit,<span class="string">']'</span>],<span class="keyword">...</span>
0673                     <span class="string">'amplitude [a.u.]'</span>,<span class="string">'partial water content [vol. %]'</span>};
0674             <span class="keyword">case</span> <span class="string">'T2'</span>
0675                 tmp4 = [INVdata.results.invstd.T2(:)<span class="keyword">...</span>
0676                     INVdata.results.invstd.E0(:) F(:)];
0677                 header4 = {[<span class="string">'relaxation time(s) T2 ['</span>,unit,<span class="string">']'</span>],<span class="keyword">...</span>
0678                     <span class="string">'amplitude [a.u.]'</span>,<span class="string">'partial water content [vol. %]'</span>};
0679         <span class="keyword">end</span>
0680         
0681     <span class="keyword">otherwise</span>
0682         <span class="comment">% Nothing to do</span>
0683 <span class="keyword">end</span>
0684 
0685 <span class="comment">% glue together headers</span>
0686 cHeader = [header1 header2 header3 header4];
0687 <span class="comment">% insert commas</span>
0688 commaHeader = [cHeader;repmat({<span class="string">','</span>},1,numel(cHeader))];
0689 commaHeader = commaHeader(:)';
0690 <span class="comment">% cHeader as string with commas</span>
0691 textHeader = cell2mat(commaHeader(1:numel(commaHeader)-1));
0692 
0693 maxrows = max([size(tmp1,1) size(tmp2,1) size(tmp3,1) size(tmp4,1)]);
0694 <span class="comment">% glue together data</span>
0695 <span class="keyword">if</span> size(tmp1,1) &lt; maxrows
0696     tmp1(end+1:maxrows,:) = NaN;
0697 <span class="keyword">end</span>
0698 <span class="keyword">if</span> size(tmp2,1) &lt; maxrows
0699     tmp2(end+1:maxrows,:) = NaN;
0700 <span class="keyword">end</span>
0701 <span class="keyword">if</span> size(tmp3,1) &lt; maxrows
0702     tmp3(end+1:maxrows,:) = NaN;
0703 <span class="keyword">end</span>
0704 <span class="keyword">if</span> size(tmp4,1) &lt; maxrows
0705     tmp4(end+1:maxrows,:) = NaN;
0706 <span class="keyword">end</span>
0707 out(1:maxrows,1:size(tmp1,2)) = tmp1;
0708 yi = size(tmp1,2)+1;
0709 out(1:maxrows,yi:yi-1+size(tmp2,2)) = tmp2;
0710 yi = yi + size(tmp2,2);
0711 out(1:maxrows,yi:yi-1+size(tmp3,2)) = tmp3;
0712 yi = yi + size(tmp3,2);
0713 out(1:maxrows,yi:yi-1+size(tmp4,2)) = tmp4;
0714 
0715 <span class="comment">% save data to file</span>
0716 <span class="comment">%write header to file</span>
0717 fid = fopen(sfile,<span class="string">'w'</span>);
0718 fprintf(fid,<span class="string">'%s\n'</span>,textHeader);
0719 fclose(fid);
0720 <span class="comment">%write data to end of file</span>
0721 dlmwrite(sfile,out,<span class="string">'-append'</span>,<span class="string">'precision'</span>,<span class="string">'%.5f'</span>);
0722 
0723 <span class="keyword">end</span>
0724 
0725 <span class="comment">%%</span>
0726 <a name="_sub4" href="#_subfunctions" class="code">function exportMOD_EXCEL()</a>
0727 xlswrite(fullfile(PathName,FileName),{<span class="string">'pressure [Pa]'</span>,<span class="string">'saturation (drain)'</span>,<span class="string">'saturation (imb)'</span>},<span class="string">'CPS'</span>,<span class="string">'A1'</span>);
0728 xlswrite(fullfile(PathName,FileName),[results.SAT.pressure(:) results.SAT.Sdfull(:) results.SAT.Sifull(:)],<span class="string">'CPS'</span>,<span class="string">'A2'</span>);
0729 
0730 out = zeros(numel(results.NMR.t),numel(indd)+1);
0731 out(:,1) = results.NMR.t(:);
0732 header = cell(1,1);
0733 header{1} = <span class="string">'time [s]'</span>;
0734 <span class="keyword">for</span> i = 1:numel(indd)
0735     out(:,i+1) = results.NMR.EdT1(indd(i),:)';
0736     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0737 <span class="keyword">end</span>
0738 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T1_drain'</span>,<span class="string">'A1'</span>);
0739 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T1_drain'</span>,<span class="string">'A2'</span>);
0740 out = zeros(numel(results.NMR.t),numel(indd)+1);
0741 out(:,1) = results.NMR.t(:);
0742 header = cell(1,1);
0743 header{1} = <span class="string">'time [s]'</span>;
0744 <span class="keyword">for</span> i = 1:numel(indd)
0745     out(:,i+1) = results.NMR.EdT2(indd(i),:)';
0746     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0747 <span class="keyword">end</span>
0748 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T2_drain'</span>,<span class="string">'A1'</span>);
0749 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T2_drain'</span>,<span class="string">'A2'</span>);
0750 
0751 out = zeros(numel(results.NMR.t),numel(indi)+1);
0752 out(:,1) = results.NMR.t(:);
0753 header = cell(1,1);
0754 header{1} = <span class="string">'time [s]'</span>;
0755 <span class="keyword">for</span> i = 1:numel(indi)
0756     out(:,i+1) = results.NMR.EiT1(indi(i),:)';
0757     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0758 <span class="keyword">end</span>
0759 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T1_imb'</span>,<span class="string">'A1'</span>);
0760 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T1_imb'</span>,<span class="string">'A2'</span>);
0761 
0762 out = zeros(numel(results.NMR.t),numel(indi)+1);
0763 out(:,1) = results.NMR.t(:);
0764 header = cell(1,1);
0765 header{1} = <span class="string">'time [s]'</span>;
0766 <span class="keyword">for</span> i = 1:numel(indi)
0767     out(:,i+1) = results.NMR.EiT2(indi(i),:)';
0768     header{i+1} = [<span class="string">'S'</span>,num2str(i)];
0769 <span class="keyword">end</span>
0770 xlswrite(fullfile(PathName,FileName),header,<span class="string">'NMR_T2_imb'</span>,<span class="string">'A1'</span>);
0771 xlswrite(fullfile(PathName,FileName),out,<span class="string">'NMR_T2_imb'</span>,<span class="string">'A2'</span>);
0772 
0773 <span class="comment">% remove the first standard excel sheet</span>
0774 [~,sheets] = xlsfinfo(fullfile(PathName,FileName));
0775 objExcel = actxserver(<span class="string">'Excel.Application'</span>);
0776 objExcel.Workbooks.Open(fullfile(PathName,FileName));
0777 objExcel.ActiveWorkbook.Worksheets.Item(sheets{1}).Delete;
0778 objExcel.ActiveWorkbook.Save;
0779 objExcel.ActiveWorkbook.Close;
0780 objExcel.Quit;
0781 objExcel.delete;
0782 <span class="keyword">end</span>
0783 
0784 <span class="comment">%%</span>
0785 <a name="_sub5" href="#_subfunctions" class="code">function doexport = checkINV(INVdata,id)</a>
0786 
0787 doexport = false;
0788 <span class="keyword">if</span> ~isempty(INVdata) &amp;&amp; ~isempty(id)
0789     <span class="keyword">if</span> isstruct(INVdata{id})
0790         doexport = true;
0791     <span class="keyword">else</span>
0792         helpdlg({<span class="string">'exportData:'</span>,<span class="string">'No inversion data to save'</span>},<span class="keyword">...</span>
0793             <span class="string">'Nothing to save'</span>);
0794     <span class="keyword">end</span>
0795 <span class="keyword">else</span>
0796     helpdlg({<span class="string">'exportData:'</span>,<span class="string">'No inversion data to save'</span>},<span class="keyword">...</span>
0797         <span class="string">'Nothing to save'</span>);
0798 <span class="keyword">end</span>
0799 
0800 <span class="keyword">end</span>
0801 
0802 <span class="comment">%%</span>
0803 <a name="_sub6" href="#_subfunctions" class="code">function doexport = checkMOD(data)</a>
0804 
0805 doexport = false;
0806 <span class="keyword">if</span> isfield(data,<span class="string">'results'</span>)
0807     <span class="keyword">if</span> isfield(data.results,<span class="string">'NMR'</span>)
0808         doexport = true;
0809     <span class="keyword">else</span>
0810         helpdlg({<span class="string">'exportData:'</span>,<span class="keyword">...</span>
0811             <span class="string">'No data to save. Generate some data first.'</span>},<span class="string">'NUCLEUSmod info:'</span>);
0812     <span class="keyword">end</span>
0813 <span class="keyword">else</span>
0814     helpdlg({<span class="string">'exportData:'</span>,<span class="keyword">...</span>
0815         <span class="string">'No data to save. Generate some data first.'</span>},<span class="string">'NUCLEUSmod info:'</span>);
0816 <span class="keyword">end</span>
0817 
0818 <span class="keyword">end</span>
0819 
0820 <span class="comment">%%</span>
0821 <a name="_sub7" href="#_subfunctions" class="code">function amp = findApproxTlgmAmplitude(t,f,TLGM)</a>
0822 index = find(abs(t-TLGM)==min(abs(t-TLGM)));
0823 amp = interp1(t(index-1:index+1),f(index-1:index+1),TLGM);
0824 <span class="keyword">end</span>
0825 
0826 <span class="comment">%------------- END OF CODE --------------</span>
0827 
0828 <span class="comment">%% License:</span>
0829 <span class="comment">% MIT License</span>
0830 <span class="comment">%</span>
0831 <span class="comment">% Copyright (c) 2018 Thomas Hiller</span>
0832 <span class="comment">%</span>
0833 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
0834 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
0835 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
0836 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
0837 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
0838 <span class="comment">% furnished to do so, subject to the following conditions:</span>
0839 <span class="comment">%</span>
0840 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
0841 <span class="comment">% copies or substantial portions of the Software.</span>
0842 <span class="comment">%</span>
0843 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
0844 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
0845 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
0846 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
0847 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
0848 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
0849 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>