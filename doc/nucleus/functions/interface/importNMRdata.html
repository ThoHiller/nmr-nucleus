<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of importNMRdata</title>
  <meta name="keywords" content="importNMRdata">
  <meta name="description" content=" is the general import routine for NMR data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- menu.html interface -->
<h1>importNMRdata
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> is the general import routine for NMR data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function importNMRdata(src) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">importNMRdata is the general import routine for NMR data

 Syntax:
       importNMRdata(src)

 Inputs:
       src - handle of the calling menu

 Outputs:
       none

 Example:
       importNMRdata(src)

 Other m-files required:
       cleanupGUIData
       clearAllAxes
       displayStatusText
       enableGUIelements('NMR');
       LoadNMRData_driver
       NUCLEUSinv_updateInterface

 Subfunctions:
       getNMRPathFile
       importDataBGR
       importDataBGRmat
       importDataDart
       importDataGeneral
       importDataLIAG
       importDataLIAGproject
       importDataMouse
       importDataHelios 
       loadGUIParameters
       loadGUIrawdata

 MAT-files required:
       none

 See also: NUCLEUSinv, NUCLEUSmod
 Author: see AUTHORS.md
 email: see AUTHORS.md
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/NUCLEUSinv/NUCLEUSinv_updateInterface.html" class="code" title="function NUCLEUSinv_updateInterface">NUCLEUSinv_updateInterface</a>	 updates all GUI elements</li><li><a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>	 loads NMR raw data from different file formats</li><li><a href="../../../nucleus/functions/import/fixParameterString.html" class="code" title="function str = fixParameterString(str)">fixParameterString</a>	 cleans parameter file lines when the properties have a</li><li><a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>	 rotateT2phase rotates the complex NMR T2 signal so that the imaginary</li><li><a href="cleanupGUIData.html" class="code" title="function data = cleanupGUIData(data)">cleanupGUIData</a>	 removes unnecessary fields from the global "data" struct</li><li><a href="clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>	 clears all axes of a given figure</li><li><a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>	 shows status information either in the GUI or on the</li><li><a href="enableGUIelements.html" class="code" title="function enableGUIelements(importtype)">enableGUIelements</a>	 activates all necessary GUI elements after successful</li><li><a href="makeINIfile.html" class="code" title="function gui = makeINIfile(gui,method)">makeINIfile</a>	 creates or updates the ini-File</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/callbacks/menus/onMenuImport.html" class="code" title="function onMenuImport(src,~)">onMenuImport</a>	 handles the import menu entries</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [NMRpath,NMRfile] = getNMRPathFile(label,import)</a></li><li><a href="#_sub2" class="code">function [data,gui] = importDataMouseCPMG(data,gui)</a></li><li><a href="#_sub3" class="code">function [data,gui] = importDataBGRmat(data,gui)</a></li><li><a href="#_sub4" class="code">function [data,gui] = importDataBGRliftSingle(data,gui)</a></li><li><a href="#_sub5" class="code">function [data,gui] = importDataBGRliftAll(data,gui)</a></li><li><a href="#_sub6" class="code">function [data,gui] = importDataHelios(data,gui)</a></li><li><a href="#_sub7" class="code">function [data,gui] = importDataDart(data,gui)</a></li><li><a href="#_sub8" class="code">function [data,gui] = importDataGeneral(data,gui)</a></li><li><a href="#_sub9" class="code">function [data,gui] = importDataLIAG(data,gui)</a></li><li><a href="#_sub10" class="code">function [data,gui] = importDataLIAGproject(data,gui)</a></li><li><a href="#_sub11" class="code">function [data,gui] = importDataMouse(data,gui)</a></li><li><a href="#_sub12" class="code">function [data,gui] = importDataIBAC(data,gui)</a></li><li><a href="#_sub13" class="code">function data = loadGUIParameters(datapath,fname)</a></li><li><a href="#_sub14" class="code">function data = loadGUIrawdata(data,NMRpath,NMRfile)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function importNMRdata(src)</a>
0002 <span class="comment">%importNMRdata is the general import routine for NMR data</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       importNMRdata(src)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       src - handle of the calling menu</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Outputs:</span>
0011 <span class="comment">%       none</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Example:</span>
0014 <span class="comment">%       importNMRdata(src)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Other m-files required:</span>
0017 <span class="comment">%       cleanupGUIData</span>
0018 <span class="comment">%       clearAllAxes</span>
0019 <span class="comment">%       displayStatusText</span>
0020 <span class="comment">%       enableGUIelements('NMR');</span>
0021 <span class="comment">%       LoadNMRData_driver</span>
0022 <span class="comment">%       NUCLEUSinv_updateInterface</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% Subfunctions:</span>
0025 <span class="comment">%       getNMRPathFile</span>
0026 <span class="comment">%       importDataBGR</span>
0027 <span class="comment">%       importDataBGRmat</span>
0028 <span class="comment">%       importDataDart</span>
0029 <span class="comment">%       importDataGeneral</span>
0030 <span class="comment">%       importDataLIAG</span>
0031 <span class="comment">%       importDataLIAGproject</span>
0032 <span class="comment">%       importDataMouse</span>
0033 <span class="comment">%       importDataHelios</span>
0034 <span class="comment">%       loadGUIParameters</span>
0035 <span class="comment">%       loadGUIrawdata</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% MAT-files required:</span>
0038 <span class="comment">%       none</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% See also: NUCLEUSinv, NUCLEUSmod</span>
0041 <span class="comment">% Author: see AUTHORS.md</span>
0042 <span class="comment">% email: see AUTHORS.md</span>
0043 <span class="comment">% License: MIT License (at end)</span>
0044 
0045 <span class="comment">%------------- BEGIN CODE --------------</span>
0046 
0047 <span class="comment">%% get GUI handle and data</span>
0048 fig = findobj(<span class="string">'Tag'</span>,<span class="string">'INV'</span>);
0049 gui = getappdata(fig,<span class="string">'gui'</span>);
0050 data = getappdata(fig,<span class="string">'data'</span>);
0051 
0052 <span class="comment">% try is used to catch any import error</span>
0053 <span class="comment">% often the wrong input file format is the case</span>
0054 <span class="keyword">try</span>
0055     <span class="comment">% check what import format is chosen</span>
0056     label = get(src,<span class="string">'Label'</span>);
0057     
0058     <span class="comment">% set file format for later use</span>
0059     <span class="keyword">if</span> strcmp(label,<span class="string">'GGE ascii'</span>)
0060         data.import.fileformat = <span class="string">'rwth'</span>;
0061     <span class="keyword">elseif</span> strcmp(label,<span class="string">'GGE field'</span>)
0062         data.import.fileformat = <span class="string">'field'</span>;
0063     <span class="keyword">elseif</span> strcmp(label,<span class="string">'GGE Dart'</span>)
0064         data.import.fileformat = <span class="string">'dart'</span>;
0065     <span class="keyword">elseif</span> strcmp(label,<span class="string">'CoreLab ascii'</span>)
0066         data.import.fileformat = <span class="string">'corelab'</span>;
0067     <span class="keyword">elseif</span> strcmp(label,<span class="string">'DART'</span>)
0068         data.import.fileformat = <span class="string">'dart'</span>;    
0069     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MOUSE'</span>)
0070         data.import.fileformat = <span class="string">'mouse'</span>;
0071     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG single'</span>)
0072         data.import.fileformat = <span class="string">'liag'</span>;
0073     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG from project'</span>)
0074         data.import.fileformat = <span class="string">'liag'</span>;
0075     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG last project'</span>)
0076         data.import.fileformat = <span class="string">'liag'</span>;
0077     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BGR std'</span>)
0078         data.import.fileformat = <span class="string">'bgr'</span>;
0079     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseCPMG'</span>)
0080         data.import.fileformat = <span class="string">'MouseCPMG'</span>;
0081     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BGR mat'</span>)
0082         data.import.fileformat = <span class="string">'bgrmat'</span>;
0083     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseLiftSingle'</span>)
0084         data.import.fileformat = <span class="string">'MouseLiftSingle'</span>;
0085     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseLiftAll'</span>)
0086         data.import.fileformat = <span class="string">'MouseLiftAll'</span>;
0087     <span class="keyword">elseif</span> strcmp(label,<span class="string">'Helios'</span>)
0088         data.import.fileformat = <span class="string">'helios'</span>;
0089     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BAM TOM'</span>)
0090         data.import.fileformat = <span class="string">'bamtom'</span>;
0091     <span class="keyword">elseif</span> strcmp(label,<span class="string">'PM5'</span>)
0092         data.import.fileformat = <span class="string">'pm5'</span>;
0093     <span class="keyword">elseif</span> strcmp(label,<span class="string">'PM25'</span>)
0094         data.import.fileformat = <span class="string">'pm25'</span>;
0095     <span class="keyword">else</span>
0096         helpdlg(<span class="string">'Something is utterly wrong.'</span>,<span class="string">'onMenuImport: Choose again.'</span>);
0097     <span class="keyword">end</span>
0098     
0099     <span class="comment">% remove info field if any</span>
0100     ih = findobj(<span class="string">'Tag'</span>,<span class="string">'inv_info'</span>);
0101     <span class="keyword">if</span> ~isempty(ih); delete(ih); <span class="keyword">end</span>
0102     
0103     <span class="comment">% depending on the import format get the corresponding path / file</span>
0104     [NMRpath,NMRfile] = <a href="#_sub1" class="code" title="subfunction [NMRpath,NMRfile] = getNMRPathFile(label,import)">getNMRPathFile</a>(label,data.import);
0105     
0106     <span class="comment">% only continue if user didn't cancel</span>
0107     <span class="keyword">if</span> sum([NMRpath NMRfile]) &gt; 0
0108         <span class="comment">%  remove old fields and data</span>
0109         data = <a href="cleanupGUIData.html" class="code" title="function data = cleanupGUIData(data)">cleanupGUIData</a>(data);
0110         
0111         <span class="comment">% check for mat-file with GUI rawdata and import data</span>
0112         isfile = dir(fullfile(NMRpath,<span class="string">'NUCLEUSinv_raw.mat'</span>));
0113         
0114         <span class="comment">% if there is no raw-file import from folder/file</span>
0115         <span class="keyword">if</span> isempty(isfile)
0116             <span class="comment">% import data</span>
0117             data.import.path = NMRpath;
0118             data.import.file = -1;
0119             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Reading NMR Data ...'</span>);
0120             <span class="comment">% call the corresponding subroutines</span>
0121             <span class="keyword">switch</span> label
0122                 <span class="keyword">case</span> {<span class="string">'GGE ascii'</span>,<span class="string">'GGE field'</span>,<span class="string">'CoreLab ascii'</span>,<span class="string">'BGR std'</span>,<span class="keyword">...</span>
0123                         <span class="string">'BAM TOM'</span>}
0124                     [data,gui] = <a href="#_sub8" class="code" title="subfunction [data,gui] = importDataGeneral(data,gui)">importDataGeneral</a>(data,gui);
0125                 <span class="keyword">case</span> <span class="string">'GGE Dart'</span>
0126                     data.import.file = NMRfile;
0127                     <span class="comment">% the data in the example folder is an older type</span>
0128                     <span class="keyword">if</span> contains(NMRpath,<span class="string">'nucleus\example_data\dart'</span>)
0129                         data.import.version = 1;
0130                     <span class="keyword">else</span>
0131                         data.import.version = 2;
0132                     <span class="keyword">end</span>
0133                     [data,gui] = <a href="#_sub7" class="code" title="subfunction [data,gui] = importDataDart(data,gui)">importDataDart</a>(data,gui);
0134                 <span class="keyword">case</span> <span class="string">'DART'</span>
0135                     data.import.file = NMRfile;
0136                     data.import.version = 3;
0137                     [data,gui] = <a href="#_sub7" class="code" title="subfunction [data,gui] = importDataDart(data,gui)">importDataDart</a>(data,gui);    
0138                 <span class="keyword">case</span> <span class="string">'MOUSE'</span>
0139                     [data,gui] = <a href="#_sub11" class="code" title="subfunction [data,gui] = importDataMouse(data,gui)">importDataMouse</a>(data,gui);
0140                 <span class="keyword">case</span> <span class="string">'LIAG single'</span>
0141                     [data,gui] = <a href="#_sub9" class="code" title="subfunction [data,gui] = importDataLIAG(data,gui)">importDataLIAG</a>(data,gui);
0142                 <span class="keyword">case</span> {<span class="string">'LIAG from project'</span>,<span class="string">'LIAG last project'</span>}
0143                     [data,gui] = <a href="#_sub10" class="code" title="subfunction [data,gui] = importDataLIAGproject(data,gui)">importDataLIAGproject</a>(data,gui);
0144                     <span class="comment">% make the Petro Panel visible as default</span>
0145                     tmp_h = gui.myui.heights(2,:);
0146                     tmp_h(3) = gui.myui.heights(2,3);
0147                     <span class="comment">% but the CPS panel stays minimized</span>
0148                     tmp_h(5) = gui.myui.heights(1,3);
0149                     set(gui.panels.main,<span class="string">'Heights'</span>,tmp_h);
0150                     set(gui.panels.petro.main,<span class="string">'Minimized'</span>,false);
0151                 <span class="keyword">case</span> <span class="string">'BGR mat'</span>
0152                     data.import.file = NMRfile;
0153                     [data,gui] = <a href="#_sub3" class="code" title="subfunction [data,gui] = importDataBGRmat(data,gui)">importDataBGRmat</a>(data,gui);
0154                 <span class="keyword">case</span> <span class="string">'MouseCPMG'</span>
0155                     [data,gui] = <a href="#_sub2" class="code" title="subfunction [data,gui] = importDataMouseCPMG(data,gui)">importDataMouseCPMG</a>(data,gui);
0156                 <span class="keyword">case</span> <span class="string">'MouseLiftSingle'</span>
0157                     [data,gui] = <a href="#_sub4" class="code" title="subfunction [data,gui] = importDataBGRliftSingle(data,gui)">importDataBGRliftSingle</a>(data,gui);
0158                 <span class="keyword">case</span> <span class="string">'MouseLiftAll'</span>
0159                     [data,gui] = <a href="#_sub5" class="code" title="subfunction [data,gui] = importDataBGRliftAll(data,gui)">importDataBGRliftAll</a>(data,gui);
0160                 <span class="keyword">case</span> <span class="string">'Helios'</span>
0161                     data.import.file = NMRfile;
0162                     [data,gui] = <a href="#_sub6" class="code" title="subfunction [data,gui] = importDataHelios(data,gui)">importDataHelios</a>(data,gui);
0163                 <span class="keyword">case</span> {<span class="string">'PM5'</span>,<span class="string">'PM25'</span>}
0164                     data.import.file = NMRfile;
0165                     [data,gui] = <a href="#_sub12" class="code" title="subfunction [data,gui] = importDataIBAC(data,gui)">importDataIBAC</a>(data,gui);
0166             <span class="keyword">end</span>
0167             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Reading NMR Data ... done'</span>);
0168         <span class="keyword">else</span>
0169             <span class="comment">% import from mat-file</span>
0170             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Importing NMR raw data from mat-file ...'</span>);
0171             data = <a href="#_sub14" class="code" title="subfunction data = loadGUIrawdata(data,NMRpath,NMRfile)">loadGUIrawdata</a>(data,NMRpath,NMRfile);
0172             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Importing NMR raw data from mat-file ... done'</span>);
0173         <span class="keyword">end</span>
0174         
0175         <span class="comment">% update the path info field with &quot;NMRpath&quot; (&quot;NMRfile&quot;)</span>
0176         <span class="keyword">if</span> NMRfile &gt; 0
0177             tmpstr = fullfile(NMRpath,NMRfile);
0178         <span class="keyword">else</span>
0179             tmpstr = NMRpath;
0180         <span class="keyword">end</span>
0181         <span class="keyword">if</span> length(tmpstr)&gt;50
0182             set(gui.text_handles.data_path,<span class="string">'String'</span>,[<span class="string">'...'</span>,tmpstr(end-50:end)],<span class="keyword">...</span>
0183                 <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0184         <span class="keyword">else</span>
0185             set(gui.text_handles.data_path,<span class="string">'String'</span>,tmpstr,<span class="keyword">...</span>
0186                 <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0187         <span class="keyword">end</span>
0188         set(gui.text_handles.data_path,<span class="string">'TooltipString'</span>,tmpstr);
0189         
0190         <span class="comment">% update the ini-file</span>
0191         gui.myui.inidata.importpath = data.import.path;
0192         gui = <a href="makeINIfile.html" class="code" title="function gui = makeINIfile(gui,method)">makeINIfile</a>(gui,<span class="string">'update'</span>);
0193         
0194         <span class="comment">% update the list of file names</span>
0195         set(gui.listbox_handles.signal,<span class="string">'String'</span>,data.import.NMR.filesShort);
0196         set(gui.listbox_handles.signal,<span class="string">'Value'</span>,[],<span class="string">'Max'</span>,2,<span class="string">'Min'</span>,0);
0197         
0198         <span class="comment">% create a global INVdata struct for every file in the list</span>
0199         <span class="keyword">if</span> isstruct(getappdata(fig,<span class="string">'INVdata'</span>))
0200             setappdata(fig,<span class="string">'INVdata'</span>,[]);
0201         <span class="keyword">end</span>
0202         INVdata = cell(length(data.import.NMR.filesShort),1);
0203         setappdata(fig,<span class="string">'INVdata'</span>,INVdata);
0204         
0205         <span class="comment">% clear all axes</span>
0206         <a href="clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(gui.figh);
0207         
0208         <span class="comment">% update GUI data and interface</span>
0209         setappdata(fig,<span class="string">'data'</span>,data);
0210         setappdata(fig,<span class="string">'gui'</span>,gui);
0211         <a href="enableGUIelements.html" class="code" title="function enableGUIelements(importtype)">enableGUIelements</a>(<span class="string">'NMR'</span>);
0212         
0213         <span class="comment">% special treatment of LIAG projects</span>
0214         <span class="keyword">switch</span> label
0215             <span class="keyword">case</span> {<span class="string">'LIAG from project'</span>,<span class="string">'LIAG last project'</span>}
0216                 cpath = data.import.LIAG.calibrationpath;
0217                 <span class="comment">% check if this calibration file was already used</span>
0218                 isfile = dir(fullfile(cpath,<span class="string">'NUCLEUS_calibData.mat'</span>));
0219                 <span class="keyword">if</span> ~isempty(isfile)
0220                     id = 2;
0221                     <span class="comment">% if data is there reuse it</span>
0222                     calib = load(fullfile(cpath,isfile.name),<span class="string">'calib'</span>);
0223                     INVdata{id} = calib.calib;
0224                     data.calib = INVdata{id}.calib;
0225                     data.import.LIAG.Tbulk = INVdata{id}.results.invstd.T2;
0226                     setappdata(fig,<span class="string">'INVdata'</span>,INVdata);
0227                     setappdata(fig,<span class="string">'data'</span>,data);
0228                     <span class="comment">% color the list entry</span>
0229                     strL = get(gui.listbox_handles.signal,<span class="string">'String'</span>);
0230                     str1 = strL{id};
0231                     str2 = [<span class="string">'&lt;HTML&gt;&lt;BODY bgcolor=&quot;rgb('</span>,<span class="keyword">...</span>
0232                         sprintf(<span class="string">'%d,%d,%d'</span>,gui.myui.colors.listINV.*255),<span class="string">')&quot;&gt;'</span>,<span class="keyword">...</span>
0233                         str1,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;'</span>];
0234                     strL{id} = str2;
0235                     set(gui.listbox_handles.signal,<span class="string">'String'</span>,strL);
0236                 <span class="keyword">end</span>
0237             <span class="keyword">otherwise</span>
0238         <span class="keyword">end</span>
0239         <span class="comment">% update GUI interface</span>
0240         <a href="../../../nucleus/NUCLEUSinv/NUCLEUSinv_updateInterface.html" class="code" title="function NUCLEUSinv_updateInterface">NUCLEUSinv_updateInterface</a>;
0241     <span class="keyword">end</span>
0242     
0243 <span class="keyword">catch</span> ME
0244     <span class="comment">% show error message in case import fails</span>
0245     errmsg = {ME.message;[ME.stack(1).name,<span class="string">' Line: '</span>,num2str(ME.stack(1).line)];<span class="keyword">...</span>
0246         <span class="string">'Check File Format settings.'</span>};
0247     errordlg(errmsg,<span class="string">'importNMRdata: Error!'</span>);
0248     
0249 <span class="keyword">end</span>
0250 
0251 <span class="keyword">end</span>
0252 
0253 <span class="comment">%%</span>
0254 <a name="_sub1" href="#_subfunctions" class="code">function [NMRpath,NMRfile] = getNMRPathFile(label,import)</a>
0255 
0256 NMRpath = -1;
0257 NMRfile = -1;
0258 <span class="comment">% for almost all import cases we load a folder ... but not for all</span>
0259 <span class="keyword">switch</span> label
0260     <span class="keyword">case</span> {<span class="string">'GGE ascii'</span>,<span class="string">'GGE field'</span>,<span class="string">'CoreLab ascii'</span>,<span class="string">'MOUSE'</span>,<span class="string">'LIAG single'</span>,<span class="keyword">...</span>
0261             <span class="string">'BGR std'</span>,<span class="string">'MouseCPMG'</span>,<span class="string">'MouseLiftSingle'</span>,<span class="string">'MouseLiftAll'</span>,<span class="string">'Helios'</span>,<span class="string">'BAM TOM'</span>,<span class="string">'PM25'</span>}
0262         <span class="comment">% if there is already a data folder present we start from here</span>
0263         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0264             NMRpath = uigetdir(import.path,<span class="string">'Choose Data Path'</span>);
0265         <span class="keyword">else</span>
0266             <span class="comment">% otherwise we start at the current working dircetory</span>
0267             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0268             here = mfilename(<span class="string">'fullpath'</span>);
0269             [pathstr,~,~] = fileparts(here);
0270             NMRpath = uigetdir(pathstr,<span class="string">'Choose Data Path'</span>);
0271         <span class="keyword">end</span>
0272     <span class="keyword">case</span> <span class="string">'LIAG from project'</span>
0273         <span class="comment">% if there is already a data folder present we start from here</span>
0274         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0275             NMRpath = uigetdir(import.path,<span class="string">'Choose Project Path'</span>);
0276         <span class="keyword">else</span>
0277             <span class="comment">% otherwise we start at the current working dircetory</span>
0278             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0279             here = mfilename(<span class="string">'fullpath'</span>);
0280             [pathstr,~,~] = fileparts(here);
0281             NMRpath = uigetdir(pathstr,<span class="string">'Choose Project Path'</span>);
0282         <span class="keyword">end</span>
0283     <span class="keyword">case</span> <span class="string">'LIAG last project'</span>
0284         <span class="comment">% there is already a data folder and we use this one</span>
0285         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0286             NMRpath = import.path;
0287         <span class="keyword">else</span>
0288             <span class="comment">% otherwise we start at the current working dircetory</span>
0289             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0290             here = mfilename(<span class="string">'fullpath'</span>);
0291             [pathstr,~,~] = fileparts(here);
0292             NMRpath = uigetdir(pathstr,<span class="string">'Choose Project Path'</span>);
0293         <span class="keyword">end</span>
0294     <span class="keyword">case</span> {<span class="string">'GGE Dart'</span>,<span class="string">'DART'</span>,<span class="string">'BGR mat'</span>,<span class="string">'NMR mat'</span>}
0295         <span class="comment">% if there is already a data folder present we start from here</span>
0296         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0297             [NMRfile,NMRpath] = uigetfile(import.path,<span class="string">'Choose Data file'</span>);
0298         <span class="keyword">else</span>
0299             <span class="comment">% otherwise we start at the current working dircetory</span>
0300             <span class="comment">% 'foldername' hold s the name of the choosen data path</span>
0301             here = mfilename(<span class="string">'fullpath'</span>);
0302             [pathstr,~,~] = fileparts(here);
0303             [NMRfile,NMRpath] = uigetfile(pathstr,<span class="string">'Choose Data file'</span>);
0304         <span class="keyword">end</span>
0305     <span class="keyword">case</span> <span class="string">'PM5'</span>
0306         <span class="comment">% if there is already a data folder present we start from here</span>
0307         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0308             NMRpath = uigetdir(import.path,<span class="string">'Choose PM5 Data Path'</span>);
0309         <span class="keyword">else</span>
0310             <span class="comment">% otherwise we start at the current working dircetory</span>
0311             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0312             here = mfilename(<span class="string">'fullpath'</span>);
0313             [pathstr,~,~] = fileparts(here);
0314             NMRpath = uigetdir(pathstr,<span class="string">'Choose PM5 Data Path'</span>);
0315         <span class="keyword">end</span>
0316         
0317         <span class="comment">% check if there are multiple inf-files available</span>
0318         <span class="comment">% if yes -&gt; choose one</span>
0319         inffiles = dir(fullfile(NMRpath,<span class="string">'*.inf'</span>));
0320         <span class="keyword">if</span> numel(inffiles) &gt; 1
0321             [NMRfile,NMRpath] = uigetfile(fullfile(NMRpath,<span class="string">'*.inf'</span>),<span class="keyword">...</span>
0322                 <span class="string">'Choose INF file'</span>);
0323         <span class="keyword">elseif</span> numel(inffiles) == 1
0324             NMRfile = inffiles.name;            
0325         <span class="keyword">end</span>
0326 <span class="keyword">end</span>
0327 
0328 <span class="keyword">end</span>
0329 
0330 <span class="comment">%%</span>
0331 <a name="_sub2" href="#_subfunctions" class="code">function [data,gui] = importDataMouseCPMG(data,gui)</a>
0332 
0333 csv_t2path = dir(fullfile(data.import.path,<span class="string">'CPMG'</span>));
0334 csv_t2path = csv_t2path(~ismember({csv_t2path.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0335 
0336 fnames = struct;
0337 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0338 <span class="comment">% will be shown in the listbox</span>
0339 shownames = cell(1,1);
0340 
0341 c = 0;
0342 <span class="keyword">if</span> ~isempty(csv_t2path)
0343     <span class="keyword">for</span> i = 1:size(csv_t2path,1)
0344         in.T1T2 = <span class="string">'T2'</span>;
0345         in.path = fullfile(data.import.path,<span class="string">'CPMG'</span>,csv_t2path(i).name);
0346         in.fileformat = data.import.fileformat;
0347         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0348         
0349         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0350             <span class="comment">% the individual file names</span>
0351             c = c + 1;
0352             fnames(c).parfile = <span class="string">'acqu.par'</span>;
0353             fnames(c).datafile = out.nmrData{j}.datfile;
0354             fnames(c).T2specfile = <span class="string">''</span>;
0355             
0356             shownames{c} = [<span class="string">'T2_'</span>,csv_t2path(i).name,<span class="string">'_'</span>,fnames(c).datafile];
0357             
0358             <span class="comment">% the NMR data</span>
0359             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0360             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0361                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0362                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0363             <span class="keyword">end</span>
0364             data.import.NMR.data{c} = out.nmrData{j};
0365             data.import.NMR.para{c} = out.parData;
0366         <span class="keyword">end</span>
0367     <span class="keyword">end</span>
0368 <span class="keyword">end</span>
0369 
0370 <span class="keyword">if</span> isempty(csv_t2path)
0371     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0372 <span class="keyword">else</span>
0373     <span class="comment">% update the global data structure</span>
0374     data.import.NMR.files = fnames;
0375     data.import.NMR.filesShort = shownames;
0376 <span class="keyword">end</span>
0377 
0378 <span class="keyword">end</span>
0379 
0380 <span class="comment">%%</span>
0381 <a name="_sub3" href="#_subfunctions" class="code">function [data,gui] = importDataBGRmat(data,gui)</a>
0382 
0383 in.path = fullfile(data.import.path);
0384 in.name = data.import.file;
0385 in.fileformat = data.import.fileformat;
0386 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0387 
0388 fnames = struct;
0389 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0390 <span class="comment">% will be shown in the listbox</span>
0391 shownames = cell(1,1);
0392 
0393 c = 0;
0394 table = {true,0,1,<span class="string">'D'</span>};
0395 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0396     <span class="comment">% the individual file names</span>
0397     c = c + 1;
0398     fnames(c).parfile = <span class="string">''</span>;
0399     fnames(c).datafile = data.import.file;
0400     fnames(c).T2specfile = <span class="string">''</span>;
0401     
0402     shownames{c} = out.parData{j}.file;
0403     
0404     data.import.NMR.data{c} = out.nmrData{j};
0405     data.import.NMR.para{c} = out.parData{j};
0406     
0407     <span class="keyword">if</span> isfield(out,<span class="string">'pressData'</span>)
0408         <span class="comment">% convert hPa to Pa</span>
0409         table{c,1} = true;
0410         table{c,2} = out.pressData.p(j)*1e2;
0411         table{c,3} = out.pressData.S(j);
0412         table{c,4} = <span class="string">'D'</span>;
0413     <span class="keyword">end</span>
0414 <span class="keyword">end</span>
0415 
0416 <span class="comment">% global Tbulk</span>
0417 data.invstd.Tbulk = out.parData{1}.Tbulk;
0418 <span class="comment">% global porosity</span>
0419 data.import.BGR.porosity = out.parData{1}.porosity;
0420 
0421 data.import.NMR.files = fnames;
0422 data.import.NMR.filesShort = shownames;
0423 
0424 <span class="comment">% import pressure / saturation data</span>
0425 <span class="keyword">if</span> isfield(out,<span class="string">'pressData'</span>)
0426     data.pressure.unit = <span class="string">'kPa'</span>;
0427     data.pressure.unitfac = 1e-3;
0428     data.pressure.table = table;
0429 <span class="keyword">end</span>
0430 
0431 <span class="keyword">end</span>
0432 
0433 <span class="comment">%%</span>
0434 <a name="_sub4" href="#_subfunctions" class="code">function [data,gui] = importDataBGRliftSingle(data,gui)</a>
0435 
0436 <span class="comment">% first check whether T1 or T2 was measured...</span>
0437 <span class="comment">% by analyzing the name of data folder</span>
0438 indiz = find(data.import.path == filesep);
0439 checkT1T2 = data.import.path(indiz(end-1)+1:indiz(end)-1);
0440 <span class="keyword">if</span> strcmp(checkT1T2,<span class="string">'t1test'</span>)
0441     in.T1T2 = <span class="string">'T1'</span>;
0442 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastautotest'</span>)
0443     in.T1T2 = <span class="string">'T2'</span>; 
0444 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastauto'</span>)
0445     in.T1T2 = <span class="string">'T2'</span>; 
0446 <span class="keyword">else</span>
0447     disp(<span class="string">'Please chose an original Prospa folder for Mouse Lift data!'</span>);
0448 <span class="keyword">end</span>
0449 
0450 <span class="comment">% % there should be folders with integer values in their names</span>
0451 <span class="comment">% t1t2path = data.import.path;</span>
0452 
0453 fnames = struct;
0454 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0455 <span class="comment">% will be shown in the listbox</span>
0456 shownames = cell(1,1);
0457 
0458 c = 0;
0459 <span class="keyword">if</span> ~isempty(data.import.path)
0460 <span class="comment">%    for i = 1:size(t1t2path,1)</span>
0461         in.path = data.import.path;
0462         in.fileformat = data.import.fileformat;
0463         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0464         
0465         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0466             <span class="comment">% the individual file names</span>
0467             c = c + 1;
0468             fnames(c).parfile = <span class="string">'acq.par'</span>;
0469             fnames(c).datafile = out.nmrData{j}.datfile;
0470             
0471             shownames{c} = [in.T1T2,<span class="string">'_'</span>,fnames(c).datafile];
0472             
0473             <span class="comment">% the NMR data</span>
0474             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0475             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0476                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0477                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0478             <span class="keyword">end</span>
0479             data.import.NMR.data{c} = out.nmrData{j};
0480             data.import.NMR.para{c} = out.parData;
0481         <span class="keyword">end</span>
0482 <span class="keyword">else</span>
0483     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0484 <span class="keyword">end</span>
0485 
0486 
0487     <span class="comment">% update the global data structure</span>
0488     data.import.NMR.files = fnames;
0489     data.import.NMR.filesShort = shownames;
0490 
0491 <span class="keyword">end</span>
0492 <span class="comment">%%</span>
0493 <a name="_sub5" href="#_subfunctions" class="code">function [data,gui] = importDataBGRliftAll(data,gui)</a>
0494 
0495 <span class="comment">% first check whether T1 or T2 was measured</span>
0496 indiz = find(data.import.path == filesep);
0497 checkT1T2 = data.import.path(indiz(end)+1:end);
0498 <span class="keyword">if</span> strcmp(checkT1T2,<span class="string">'t1test'</span>)
0499     in.T1T2 = <span class="string">'T1'</span>;
0500 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastautotest'</span>)
0501     in.T1T2 = <span class="string">'T2'</span>; 
0502 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastauto'</span>)
0503     in.T1T2 = <span class="string">'T2'</span>; 
0504 <span class="keyword">else</span>
0505     helpdlg(<span class="string">'No original data folder'</span>,<span class="string">'onMenuImport: No data.'</span>);
0506 <span class="keyword">end</span>
0507 
0508 <span class="comment">% there should be folders with integer values in their names</span>
0509 t1t2path = dir(data.import.path);
0510 t1t2path = t1t2path(~ismember({t1t2path.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0511 
0512 fnames = struct;
0513 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0514 <span class="comment">% will be shown in the listbox</span>
0515 shownames = cell(1,1);
0516 
0517 c = 0;
0518 <span class="keyword">if</span> ~isempty(t1t2path)
0519     <span class="keyword">for</span> i = 1:size(t1t2path,1)
0520         in.path = fullfile(data.import.path,t1t2path(i).name);
0521         in.fileformat = data.import.fileformat;
0522         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0523         
0524         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0525             <span class="comment">% the individual file names</span>
0526             c = c + 1;
0527             fnames(c).parfile = <span class="string">'acq.par'</span>;
0528             fnames(c).datafile = out.nmrData{j}.datfile;
0529             
0530             shownames{c} = [in.T1T2,<span class="string">'_'</span>,t1t2path(i).name,<span class="string">'_'</span>,fnames(c).datafile];
0531             
0532             <span class="comment">% the NMR data</span>
0533             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0534             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0535                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0536                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0537             <span class="keyword">end</span>
0538             data.import.NMR.data{c} = out.nmrData{j};
0539             data.import.NMR.para{c} = out.parData;
0540         <span class="keyword">end</span>
0541     <span class="keyword">end</span>
0542 <span class="keyword">else</span>
0543     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0544 <span class="keyword">end</span>
0545     <span class="comment">% update the global data structure</span>
0546     data.import.NMR.files = fnames;
0547     data.import.NMR.filesShort = shownames;
0548 
0549 <span class="keyword">end</span>
0550 
0551 <span class="comment">%%</span>
0552 <a name="_sub6" href="#_subfunctions" class="code">function [data,gui] = importDataHelios(data,gui)</a>
0553 
0554 <span class="comment">% first check the subpaths</span>
0555 <span class="comment">% there should be some folders with names ...</span>
0556 <span class="comment">% ... similar to the data filenames inside them</span>
0557 datpath = dir(data.import.path);
0558 datpath = datpath(~ismember({datpath.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0559 
0560 fnames = struct;
0561 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0562 <span class="comment">% will be shown in the listbox</span>
0563 shownames = cell(1,1);
0564 
0565 c = 0;
0566 <span class="keyword">if</span> ~isempty(datpath)
0567     <span class="keyword">for</span> i = 1:size(datpath,1)
0568         <span class="comment">% does datpath.name points to a folder?</span>
0569         <span class="keyword">if</span> datpath(i).isdir    
0570             <span class="comment">% check if datpath.name includes regular Helios data files</span>
0571             content = dir([data.import.path,filesep,datpath(i).name]);
0572             content = content(~ismember({content.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0573             <span class="keyword">for</span> j = 1:size(content,1)
0574                 <span class="keyword">if</span> strcmp(content(j).name,[datpath(i).name,<span class="string">'_1.hrd'</span>])
0575                     in.T1T2 = <span class="string">'T2'</span>;
0576                     in.name = content(j).name;
0577                     in.path = fullfile(data.import.path,filesep,datpath(i).name);
0578                     in.fileformat = data.import.fileformat;
0579                     out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0580                     
0581                     <span class="comment">% the individual file names</span>
0582                     c = c + 1;
0583                     fnames(c).parfile = <span class="string">''</span>;
0584                     fnames(c).datafile = out.nmrData.datfile;
0585                     fnames(c).T2specfile = <span class="string">''</span>;
0586                     shownames{c} = [<span class="string">'T2_'</span>,datpath(i).name];
0587             
0588                     data.import.NMR.data{c} = out.nmrData;
0589                     data.import.NMR.para{c} = out.parData;
0590                 <span class="keyword">end</span>
0591             <span class="keyword">end</span>
0592         <span class="keyword">end</span>
0593     <span class="keyword">end</span>
0594 <span class="keyword">end</span>
0595 
0596 data.import.NMR.files = fnames;
0597 data.import.NMR.filesShort = shownames;
0598 
0599 <span class="keyword">end</span>
0600 
0601 <span class="comment">%%</span>
0602 <a name="_sub7" href="#_subfunctions" class="code">function [data,gui] = importDataDart(data,gui)</a>
0603 
0604 in.path = fullfile(data.import.path);
0605 in.name = data.import.file;
0606 in.fileformat = data.import.fileformat;
0607 in.version = data.import.version;
0608 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0609 
0610 fnames = struct;
0611 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0612 <span class="comment">% will be shown in the listbox</span>
0613 shownames = cell(1,1);
0614 
0615 c = 0;
0616 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0617     <span class="comment">% the individual file names</span>
0618     c = c + 1;
0619     fnames(c).parfile = <span class="string">''</span>;
0620     fnames(c).datafile = data.import.file;
0621     fnames(c).T2specfile = <span class="string">''</span>;
0622     
0623     shownames{c} = [<span class="string">'depth_'</span>,sprintf(<span class="string">'%04.3f'</span>,out.parData{j}.depth)];
0624     
0625     <span class="comment">% the NMR data</span>
0626     <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0627     <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0628         out.nmrData{j}.time = out.nmrData{j}.time/1000;
0629         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0630     <span class="keyword">end</span>
0631     data.import.NMR.data{c} = out.nmrData{j};
0632     data.import.NMR.para{c} = out.parData{j};
0633 <span class="keyword">end</span>
0634 
0635 data.import.NMR.files = fnames;
0636 data.import.NMR.filesShort = shownames;
0637 
0638 <span class="keyword">end</span>
0639 
0640 <span class="comment">%%</span>
0641 <a name="_sub8" href="#_subfunctions" class="code">function [data,gui] = importDataGeneral(data,gui)</a>
0642 
0643 <span class="comment">% look for all files ending with '.par'</span>
0644 <span class="comment">% should exist for T1 and T2 measurements</span>
0645 filenames = dir(fullfile(data.import.path,<span class="string">'*.par'</span>));
0646 
0647 fnames = struct;
0648 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0649 <span class="comment">% will be shown in the listbox</span>
0650 shownames = cell(1,1);
0651 
0652 <span class="comment">% loop over all found files and import the data</span>
0653 c = 0;
0654 in.path = data.import.path;
0655 <span class="keyword">for</span> i = 1:size(filenames,1)
0656     ind = strfind(filenames(i).name,<span class="string">'.'</span>);
0657     ind = max(ind);
0658     in.name = filenames(i).name(1:ind-1);
0659     in.fileformat = data.import.fileformat;
0660     out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0661     
0662     <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0663         <span class="comment">% the individual file names</span>
0664         c = c + 1;
0665         fnames(c).parfile = filenames(i).name;
0666         fnames(c).datafile = out.nmrData{j}.datfile;
0667         <span class="keyword">if</span> strcmp(out.nmrData{j}.flag,<span class="string">'T2'</span>) &amp;&amp; isfield(out.nmrData{j},<span class="string">'specfile'</span>)
0668             fnames(c).T2specfile = out.nmrData{j}.specfile;
0669         <span class="keyword">else</span>
0670             fnames(c).T2specfile = <span class="string">''</span>;
0671         <span class="keyword">end</span>
0672         shownames{c} = fnames(c).datafile;
0673         
0674         <span class="comment">% the NMR data</span>
0675         <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0676         <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0677             out.nmrData{j}.time = out.nmrData{j}.time/1000;
0678             out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0679         <span class="keyword">end</span>
0680         data.import.NMR.data{c} = out.nmrData{j};
0681         data.import.NMR.para{c} = out.parData;
0682     <span class="keyword">end</span>
0683 <span class="keyword">end</span>
0684 
0685 <span class="keyword">switch</span> data.import.fileformat
0686     <span class="keyword">case</span> <span class="string">'bamtom'</span>
0687         nslices = out.parData.nSlices;
0688         ncsvfiles = numel(fnames);
0689         
0690         <span class="comment">% check for background file (&quot;Leermessung&quot;)</span>
0691         has_bg = false;
0692         <span class="keyword">for</span> i = 1:numel(fnames)
0693             <span class="keyword">if</span> ~isempty(strfind(fnames(i).datafile,<span class="string">'000'</span>))
0694                 has_bg = true;
0695                 index_bg = i;
0696                 <span class="keyword">break</span>;
0697             <span class="keyword">end</span>
0698         <span class="keyword">end</span>
0699         
0700         <span class="keyword">if</span> has_bg
0701             <span class="comment">% background data set</span>
0702             bg = data.import.NMR.data{index_bg};
0703             
0704             <span class="comment">% vector of indices of the files that get corrected</span>
0705             ind_files = 1:1:ncsvfiles;
0706             ind_files(ind_files==index_bg) = [];
0707             
0708             <span class="keyword">for</span> i = ind_files                
0709                 <span class="comment">% subtract the background signal</span>
0710                 s = data.import.NMR.data{i}.signal;
0711                 s_bg = bg.signal;
0712                 <span class="comment">% if the background signal is longer than the signal cut it</span>
0713                 <span class="keyword">if</span> numel(s_bg) &gt; numel(s)
0714                     tmp_s = s_bg(1:numel(s));
0715                 <span class="keyword">else</span> <span class="comment">% if not pad it with zeros</span>
0716                     tmp_s = zeros(size(s));
0717                     tmp_s(1:numel(s_bg)) = s_bg;
0718                 <span class="keyword">end</span>
0719                 s = complex(real(s)-real(tmp_s),imag(s)-imag(tmp_s));
0720                 <span class="comment">% update original data set</span>
0721                 data.import.NMR.data{i}.signal = s;                
0722             <span class="keyword">end</span>
0723             
0724             <span class="comment">% check if the number of slices is equal to the number of files</span>
0725             <span class="comment">% (excluding the background file)</span>
0726             <span class="keyword">if</span> nslices == numel(ind_files)
0727                 <span class="comment">% create z-vector</span>
0728                 p = out.parData;
0729                 zslice = linspace(p.startPos,p.endPos,p.nSlices)';
0730                 data.import.BAM.use_z = true;
0731                 data.import.BAM.zslice = zslice;
0732                 <span class="keyword">if</span> numel(zslice) &gt; 1
0733                     c = 0;
0734                     <span class="keyword">for</span> i = ind_files
0735                         c = c + 1;
0736                         tmp = shownames{i};
0737                         shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%5.4f'</span>,zslice(c))];
0738                     <span class="keyword">end</span>
0739                 <span class="keyword">end</span>
0740             <span class="keyword">else</span>
0741                 data.import.BAM.use_z = false;
0742                 data.import.BAM.zslice = 1:1:max([numel(ind_files) 1]);
0743             <span class="keyword">end</span>
0744             
0745         <span class="keyword">else</span>
0746             <span class="keyword">if</span> nslices == ncsvfiles
0747                 <span class="comment">% create z-vector</span>
0748                 p = out.parData;
0749                 zslice = linspace(p.startPos,p.endPos,p.nSlices)';
0750                 data.import.BAM.use_z = true;
0751                 data.import.BAM.zslice = zslice;
0752                 <span class="keyword">if</span> numel(zslice) &gt; 1
0753                     <span class="keyword">for</span> i = 1:numel(zslice)
0754                         tmp = shownames{i};
0755                         shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%5.4f'</span>,zslice(i))];
0756                     <span class="keyword">end</span>
0757                 <span class="keyword">end</span>
0758             <span class="keyword">else</span>
0759                 data.import.BAM.use_z = false;
0760                 data.import.BAM.zslice = 1:1:ncsvfiles;
0761             <span class="keyword">end</span>
0762         <span class="keyword">end</span>    
0763 <span class="keyword">end</span>
0764 
0765 <span class="comment">% update the global data structure</span>
0766 data.import.NMR.files = fnames;
0767 data.import.NMR.filesShort = shownames;
0768 
0769 <span class="keyword">end</span>
0770 
0771 <span class="comment">%%</span>
0772 <a name="_sub9" href="#_subfunctions" class="code">function [data,gui] = importDataLIAG(data,gui)</a>
0773 
0774 in.path = fullfile(data.import.path);
0775 in.fileformat = data.import.fileformat;
0776 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0777 
0778 fnames = struct;
0779 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0780 <span class="comment">% will be shown in the listbox</span>
0781 shownames = cell(1,1);
0782 
0783 c = 0;
0784 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0785     <span class="comment">% the individual file names</span>
0786     c = c + 1;
0787     fnames(c).parfile = <span class="string">'acqu.par'</span>;
0788     fnames(c).datafile = out.nmrData{j}.datfile;
0789     fnames(c).T2specfile = <span class="string">''</span>;
0790     
0791     shownames{c} = fnames(c).datafile;
0792     
0793     <span class="comment">% the NMR data</span>
0794     <span class="comment">% here we fix the time scale to [s] if neccessary</span>
0795     TE = out.parData.echoTime; <span class="comment">% [s]</span>
0796     <span class="keyword">if</span> out.nmrData{j}.time(1)== TE/1e3
0797         <span class="comment">% change [ms] to [s]</span>
0798         out.nmrData{j}.time = out.nmrData{j}.time/1e3;
0799         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1e3;
0800     <span class="keyword">elseif</span> out.nmrData{j}.time(1)== TE
0801         <span class="comment">% change [s] to [s] -&gt; very unlikely</span>
0802         out.nmrData{j}.time = out.nmrData{j}.time/1e6;
0803         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1e6;
0804     <span class="keyword">end</span>
0805     data.import.NMR.data{c} = out.nmrData{j};
0806     data.import.NMR.para{c} = out.parData;
0807 <span class="keyword">end</span>
0808 
0809 <span class="comment">% update the global data structure</span>
0810 data.import.NMR.files = fnames;
0811 data.import.NMR.filesShort = shownames;
0812 
0813 <span class="keyword">end</span>
0814 
0815 <span class="comment">%%</span>
0816 <a name="_sub10" href="#_subfunctions" class="code">function [data,gui] = importDataLIAGproject(data,gui)</a>
0817 
0818 <span class="comment">% 1) show all folders and ask for sample</span>
0819 subdirs = dir(data.import.path);
0820 <span class="comment">% remove the dot-dirs</span>
0821 subdirs = subdirs(~ismember({subdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0822 
0823 fnames = {subdirs.name};
0824 [indx,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Sample:'</span>,<span class="keyword">...</span>
0825     <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0826     <span class="string">'ListString'</span>,fnames);
0827 
0828 <span class="keyword">if</span> ~isempty(indx)
0829     <span class="comment">% 2) check corresponding SampleParameter.par file for reference and</span>
0830     <span class="comment">% calibration sample and other parameters</span>
0831     datapath = fullfile(data.import.path,fnames{indx});
0832     <span class="comment">% load SampleParameter file for sample</span>
0833     [SampleParameter] = <a href="#_sub13" class="code" title="subfunction data = loadGUIParameters(datapath,fname)">loadGUIParameters</a>(datapath,<span class="string">'SampleParameters.par'</span>);
0834     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'sampleVolume'</span>)
0835         dataVol = SampleParameter.sampleVolume;
0836     <span class="keyword">else</span>
0837         dataVol = 1;
0838     <span class="keyword">end</span>
0839     
0840     <span class="comment">% 2a) background file #1</span>
0841     backgroundFile1 = SampleParameter.backgroundFile;
0842     <span class="keyword">if</span> isempty(backgroundFile1)
0843         bnames = {subdirs.name};
0844         bnames(indx) = [];
0845         [indb,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Background File:'</span>,<span class="keyword">...</span>
0846             <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0847             <span class="string">'ListString'</span>,bnames);
0848         <span class="keyword">if</span> ~isempty(indb)
0849             backgroundFile1 = bnames{indb};
0850         <span class="keyword">else</span>
0851             backgroundFile1 = <span class="string">''</span>;
0852         <span class="keyword">end</span>
0853     <span class="keyword">end</span>
0854     <span class="keyword">if</span> ~isempty(backgroundFile1)
0855         ind = strfind(backgroundFile1,filesep);
0856         <span class="keyword">if</span> ~isempty(ind)
0857             backgroundFile1 = backgroundFile1(ind(end)+1:end);
0858         <span class="keyword">end</span>
0859         fileInList = ismember(fnames,{backgroundFile1});
0860         <span class="keyword">if</span> any(fileInList)
0861             backgroundpath1 = fullfile(data.import.path,fnames{fileInList});
0862         <span class="keyword">end</span>
0863     <span class="keyword">else</span>
0864         backgroundpath1 = <span class="string">''</span>;
0865         backgroundFile1 = <span class="string">''</span>;
0866     <span class="keyword">end</span>
0867     backVol = 1;
0868     
0869     <span class="comment">% 2b) calibration file</span>
0870     c = 0;
0871     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile0'</span>)
0872         c = c + 1;
0873         calibrationFiles{c} = SampleParameter.calibrationFile0;
0874     <span class="keyword">end</span>
0875     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile1'</span>)
0876         c = c + 1;
0877         calibrationFiles{c} = SampleParameter.calibrationFile1;
0878     <span class="keyword">end</span>
0879     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile2'</span>)
0880         c = c + 1;
0881         calibrationFiles{c} = SampleParameter.calibrationFile2;
0882     <span class="keyword">end</span>
0883     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile3'</span>)
0884         c = c + 1;
0885         calibrationFiles{c} = SampleParameter.calibrationFile3;
0886     <span class="keyword">end</span>
0887     
0888     <span class="comment">% find the non-empty one</span>
0889     ind = ismember(calibrationFiles,{<span class="string">''</span>});
0890     <span class="comment">% there are three possibilities: 0, 1 and more than 1 calib. files</span>
0891     calibrationFiles(ind) = [];
0892     <span class="keyword">if</span> isempty(calibrationFiles)
0893         cnames = {subdirs.name};
0894         cnames(indx) = [];
0895         [indc,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Calibration File:'</span>,<span class="keyword">...</span>
0896             <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0897             <span class="string">'ListString'</span>,cnames);
0898         <span class="keyword">if</span> ~isempty(indc)
0899             calibrationFiles = cnames{indc};
0900         <span class="keyword">else</span>
0901             calibrationFiles = <span class="string">''</span>;
0902         <span class="keyword">end</span>        
0903     <span class="keyword">else</span>
0904         <span class="comment">% if there are more than one let the user select the correct one</span>
0905         <span class="keyword">if</span> numel(calibrationFiles) &gt; 1
0906             [ind,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Calibration File:'</span>,<span class="keyword">...</span>
0907                 <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0908                 <span class="string">'ListString'</span>,calibrationFiles);
0909             calibrationFiles = calibrationFiles{ind};
0910         <span class="keyword">else</span>
0911             calibrationFiles = calibrationFiles{1};
0912         <span class="keyword">end</span>
0913     <span class="keyword">end</span>
0914     <span class="keyword">if</span> ~isempty(calibrationFiles)
0915         ind = strfind(calibrationFiles,filesep);
0916         <span class="keyword">if</span> ~isempty(ind)
0917             calibrationFiles = calibrationFiles(ind(end)+1:end);
0918         <span class="keyword">end</span>
0919         fileInList = ismember(fnames,{calibrationFiles});
0920         <span class="keyword">if</span> any(fileInList)
0921             calibrationpath = fullfile(data.import.path,fnames{fileInList});
0922         <span class="keyword">end</span>
0923     <span class="keyword">else</span>
0924         calibrationpath = <span class="string">''</span>;
0925         calibrationFiles = <span class="string">''</span>;
0926     <span class="keyword">end</span>
0927     
0928     <span class="keyword">if</span> ~isempty(calibrationpath)
0929         [SampleParameterC] = <a href="#_sub13" class="code" title="subfunction data = loadGUIParameters(datapath,fname)">loadGUIParameters</a>(calibrationpath,<span class="string">'SampleParameters.par'</span>);
0930         <span class="keyword">if</span> isfield(SampleParameterC,<span class="string">'sampleVolume'</span>)
0931             calibVol = SampleParameterC.sampleVolume;
0932         <span class="keyword">else</span>
0933             calibVol = 1;
0934         <span class="keyword">end</span>
0935         
0936         <span class="comment">% 2a) background file #2</span>
0937         backgroundFile2 = SampleParameterC.backgroundFile;
0938         <span class="keyword">if</span> isempty(backgroundFile2)
0939             bnames = {subdirs.name};
0940             bnames(indx) = [];
0941             [indb,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Background File for Calibration:'</span>,<span class="keyword">...</span>
0942                 <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0943                 <span class="string">'ListString'</span>,bnames);
0944             <span class="keyword">if</span> ~isempty(indb)
0945                 backgroundFile2 = bnames{indb};
0946             <span class="keyword">else</span>
0947                 backgroundFile2 = <span class="string">''</span>;
0948             <span class="keyword">end</span>  
0949         <span class="keyword">end</span>
0950         <span class="keyword">if</span> ~isempty(backgroundFile2)
0951             ind = strfind(backgroundFile2,filesep);
0952             <span class="keyword">if</span> ~isempty(ind)
0953                 backgroundFile2 = backgroundFile2(ind(end)+1:end);
0954             <span class="keyword">end</span>
0955             fileInList = ismember(fnames,{backgroundFile2});
0956             <span class="keyword">if</span> any(fileInList)
0957                 backgroundpath2 = fullfile(data.import.path,fnames{fileInList});
0958             <span class="keyword">end</span>
0959         <span class="keyword">else</span>
0960             backgroundpath2 = <span class="string">''</span>;
0961             backgroundFile2 = <span class="string">''</span>;
0962         <span class="keyword">end</span>
0963     <span class="keyword">else</span>
0964         calibVol = 1;
0965         backgroundpath2 = <span class="string">''</span>;
0966         backgroundFile2 = <span class="string">''</span>;
0967     <span class="keyword">end</span>
0968     
0969     <span class="comment">% 3) now load the data</span>
0970     workpaths = {datapath,calibrationpath,backgroundpath1,backgroundpath2};
0971     workfiles = {fnames{indx},[calibrationFiles,<span class="string">' - calibration'</span>],<span class="keyword">...</span>
0972         [backgroundFile1,<span class="string">' - backgroundS'</span>],[backgroundFile2,<span class="string">' - backgroundC'</span>]};
0973     out = cell(size(workpaths));
0974     count = 0;
0975     keep = false(size(workpaths));
0976     <span class="keyword">for</span> i = 1:numel(workpaths)
0977         <span class="keyword">if</span> ~isempty(workpaths{i})
0978             workdirs = dir(workpaths{i});
0979             workdirs = workdirs(~ismember({workdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0980             isT2 = ismember({workdirs.name},{<span class="string">'T2CPMG'</span>});
0981             <span class="keyword">if</span> any(isT2)
0982                 keep(i) = true;
0983                 count = count + 1;
0984                 T2path = fullfile(workdirs(isT2).folder,workdirs(isT2).name);
0985                 in.path = T2path;
0986                 in.fileformat = data.import.fileformat;
0987                 out{i} = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0988             <span class="keyword">end</span>
0989         <span class="keyword">end</span>
0990     <span class="keyword">end</span>    
0991     
0992     <span class="keyword">if</span> isempty(backgroundpath1)
0993         ref1 = struct;
0994     <span class="keyword">else</span>
0995         background1 = out{3};
0996         <span class="comment">% get the background data 1</span>
0997         ref1.t = background1.nmrData{1}.time;
0998         ref1.s = background1.nmrData{1}.signal;
0999         [ref1.s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(ref1.s);
1000     <span class="keyword">end</span>
1001     
1002     <span class="keyword">if</span> isempty(backgroundpath2)
1003         ref2 = struct;
1004     <span class="keyword">else</span>
1005         background2 = out{4};
1006         <span class="comment">% get the background data 2</span>
1007         ref2.t = background2.nmrData{1}.time;
1008         ref2.s = background2.nmrData{1}.signal;
1009         [ref2.s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(ref2.s);
1010     <span class="keyword">end</span>
1011     
1012     workpaths = workpaths(keep);
1013     workfiles = workfiles(keep);
1014     out = out(keep);
1015     
1016     ffnames = struct;
1017     <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1018     <span class="comment">% will be shown in the listbox</span>
1019     shownames = cell(1,1);
1020     
1021     <span class="keyword">for</span> i = 1:count
1022         ffnames(i).parfile = <span class="string">'acqu.par'</span>;
1023         ffnames(i).datafile = workfiles{i};
1024         ffnames(i).T2specfile = <span class="string">''</span>;
1025         
1026         shownames{i} = ffnames(i).datafile;
1027         
1028         <span class="comment">% the NMR data</span>
1029         <span class="comment">% here we fix the time scale to [s] if neccessary</span>
1030         TE = out{i}.parData.echoTime; <span class="comment">% [s]</span>
1031         <span class="keyword">if</span> out{i}.nmrData{1}.time(1)== TE/1e3
1032             <span class="comment">% change [ms] to [s]</span>
1033             out{i}.nmrData{1}.time = out{i}.nmrData{1}.time/1e3;
1034             out{i}.nmrData{1}.raw.time = out{i}.nmrData{1}.raw.time/1e3;
1035         <span class="keyword">elseif</span> out{i}.nmrData{1}.time(1)== TE
1036             <span class="comment">% change [s] to [s] -&gt; very unlikely</span>
1037             out{i}.nmrData{1}.time = out{i}.nmrData{1}.time/1e6;
1038         out{i}.nmrData{1}.raw.time = out{i}.nmrData{1}.raw.time/1e6;
1039         <span class="keyword">end</span>
1040         
1041         data.import.NMR.data{i} = out{i}.nmrData{1};
1042         data.import.NMR.para{i} = out{i}.parData;
1043         data.import.NMR.para{i}.SampleParameter = SampleParameter;
1044         
1045         <span class="comment">% subtract the background signal</span>
1046         s = data.import.NMR.data{i}.signal;
1047         <span class="keyword">if</span> i==1 &amp;&amp; isfield(ref1,<span class="string">'s'</span>)
1048             <span class="comment">% if the background signal is longer than the signal cut it, if</span>
1049             <span class="comment">% not extend it with zeros</span>
1050             <span class="keyword">if</span> numel(ref1.s) &gt; numel(s)
1051                 tmp_r = ref1.s(1:numel(s));
1052             <span class="keyword">else</span>
1053                 tmp_r = zeros(size(s));
1054                 tmp_r(1:numel(ref1.s)) = ref1.s;
1055             <span class="keyword">end</span>
1056             s = complex(real(s)-real(tmp_r),imag(s)-imag(tmp_r));
1057         <span class="keyword">elseif</span> i==2 &amp;&amp; isfield(ref2,<span class="string">'s'</span>)
1058             <span class="comment">% if the background signal is longer than the signal cut it, if</span>
1059             <span class="comment">% not extend it with zeros</span>
1060             <span class="keyword">if</span> numel(ref2.s) &gt; numel(s)
1061                 tmp_r = ref2.s(1:numel(s));
1062             <span class="keyword">else</span>
1063                 tmp_r = zeros(size(s));
1064                 tmp_r(1:numel(ref2.s)) = ref2.s;
1065             <span class="keyword">end</span>
1066             s = complex(real(s)-real(tmp_r),imag(s)-imag(tmp_r));
1067         <span class="keyword">end</span>        
1068         data.import.NMR.data{i}.signal = s;
1069         data.import.NMR.data{i}.raw.signal = s;
1070         
1071         <span class="keyword">if</span> ~isempty(strfind(workfiles{i},<span class="string">' - background'</span>))
1072             data.import.LIAG.sampleVol(i) = backVol;
1073         <span class="keyword">elseif</span> ~isempty(strfind(workfiles{i},<span class="string">' - calibration'</span>))
1074             data.import.LIAG.sampleVol(i) = calibVol;
1075         <span class="keyword">elseif</span> isempty(strfind(workfiles{i},<span class="string">' - background'</span>)) &amp;&amp;<span class="keyword">...</span>
1076                 isempty(strfind(workfiles{i},<span class="string">' - calibration'</span>))
1077             data.import.LIAG.sampleVol(i) = dataVol;
1078         <span class="keyword">end</span>
1079     <span class="keyword">end</span>
1080     data.import.LIAG.Tbulk = 1e6;
1081     data.import.LIAG.workpaths = workpaths;
1082     data.import.LIAG.datapath = datapath;
1083     data.import.LIAG.calibrationpath = calibrationpath;
1084     data.import.LIAG.backgroundpath1 = backgroundpath1;
1085     data.import.LIAG.backgroundpath2 = backgroundpath2;
1086     
1087     <span class="comment">% update the global data structure</span>
1088     data.import.NMR.files = ffnames;
1089     data.import.NMR.filesShort = shownames;
1090     
1091 <span class="keyword">end</span>
1092 
1093 <span class="keyword">end</span>
1094 
1095 <span class="comment">%%</span>
1096 <a name="_sub11" href="#_subfunctions" class="code">function [data,gui] = importDataMouse(data,gui)</a>
1097 
1098 in.path = fullfile(data.import.path);
1099 in.fileformat = data.import.fileformat;
1100 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1101 
1102 fnames = struct;
1103 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1104 <span class="comment">% will be shown in the listbox</span>
1105 shownames = cell(1,1);
1106 
1107 c = 0;
1108 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
1109     <span class="comment">% the individual file names</span>
1110     c = c + 1;
1111     fnames(c).parfile = <span class="string">'acq.par'</span>;
1112     fnames(c).datafile = out.nmrData{j}.datfile;
1113     fnames(c).T2specfile = <span class="string">''</span>;
1114     
1115     shownames{c} = [<span class="string">'T2_'</span>,fnames(c).datafile];
1116     
1117     <span class="comment">% the NMR data</span>
1118     <span class="comment">% here we fix the time scale from [ms] to [s]</span>
1119     <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
1120         out.nmrData{j}.time = out.nmrData{j}.time/1000;
1121         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
1122     <span class="keyword">end</span>
1123     data.import.NMR.data{c} = out.nmrData{j};
1124     data.import.NMR.para{c} = out.parData;
1125 <span class="keyword">end</span>
1126 
1127 <span class="comment">% update the global data structure</span>
1128 data.import.NMR.files = fnames;
1129 data.import.NMR.filesShort = shownames;
1130 
1131 <span class="keyword">end</span>
1132 
1133 <span class="comment">%%</span>
1134 <a name="_sub12" href="#_subfunctions" class="code">function [data,gui] = importDataIBAC(data,gui)</a>
1135 
1136 in.path = fullfile(data.import.path);
1137 in.name = data.import.file;
1138 in.fileformat = data.import.fileformat;
1139 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1140 
1141 nslices = out.parData.depths;
1142 nfiles = size(out.nmrData,2);
1143 
1144 fnames = struct;
1145 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1146 <span class="comment">% will be shown in the listbox</span>
1147 shownames = cell(1,1);
1148 
1149 c = 0;
1150 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
1151     <span class="comment">% the individual file names</span>
1152     c = c + 1;
1153     fnames(c).parfile = out.parData.parfile;
1154     fnames(c).datafile = out.nmrData{j}.datfile;
1155     fnames(c).T2specfile = <span class="string">''</span>;
1156     
1157     shownames{c} = [fnames(c).datafile];
1158 
1159     data.import.NMR.data{c} = out.nmrData{j};
1160     data.import.NMR.para{c} = out.parData;
1161 <span class="keyword">end</span>
1162 
1163 <span class="comment">% check if the number of depth levels is equal to the number of</span>
1164 <span class="comment">% measurements</span>
1165 <span class="keyword">if</span> nslices == nfiles
1166     <span class="comment">% create z-vector</span>
1167     p = out.parData;
1168     zslice = linspace(p.initialdepth,p.finaldepth,p.depths)';
1169     data.import.IBAC.use_z = true;
1170     data.import.IBAC.zslice = zslice;
1171     <span class="keyword">if</span> numel(zslice) &gt; 1
1172         c = 0;
1173         <span class="keyword">for</span> i = 1:nfiles
1174             c = c + 1;
1175             tmp = shownames{i};
1176             shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%05d'</span>,zslice(c))];
1177         <span class="keyword">end</span>
1178     <span class="keyword">end</span>
1179 <span class="keyword">else</span>
1180     data.import.IBAC.use_z = false;
1181     data.import.IBAC.zslice = 1:1:max([nfiles 1]);
1182 <span class="keyword">end</span>
1183 
1184 <span class="comment">% update the global data structure</span>
1185 data.import.NMR.files = fnames;
1186 data.import.NMR.filesShort = shownames;
1187 
1188 <span class="keyword">end</span>
1189 
1190 <span class="comment">%%</span>
1191 <a name="_sub13" href="#_subfunctions" class="code">function data = loadGUIParameters(datapath,fname)</a>
1192 fid = fopen(fullfile(datapath,fname));
1193 d = textscan(fid,<span class="string">'%s'</span>,<span class="string">'Delimiter'</span>,<span class="string">'\n'</span>);
1194 fclose(fid);
1195 data = struct;
1196 <span class="keyword">for</span> i = 1:size(d{1},1)
1197     str = char(d{1}(i));
1198     str = <a href="../../../nucleus/functions/import/fixParameterString.html" class="code" title="function str = fixParameterString(str)">fixParameterString</a>(str);
1199     eval([<span class="string">'data.'</span>,str,<span class="string">';'</span>]);
1200 <span class="keyword">end</span>
1201 
1202 <span class="keyword">end</span>
1203 
1204 <span class="comment">%%</span>
1205 <a name="_sub14" href="#_subfunctions" class="code">function data = loadGUIrawdata(data,NMRpath,NMRfile)</a>
1206 
1207 load(fullfile(NMRpath,<span class="string">'NUCLEUSinv_raw.mat'</span>),<span class="string">'savedata'</span>);
1208 
1209 data.import.file = NMRfile;
1210 data.import.path = NMRpath;
1211 data.import.NMR = savedata;
1212 
1213 <span class="keyword">end</span>
1214 
1215 <span class="comment">%------------- END OF CODE --------------</span>
1216 
1217 <span class="comment">%% License:</span>
1218 <span class="comment">% MIT License</span>
1219 <span class="comment">%</span>
1220 <span class="comment">% Copyright (c) 2018 Thomas Hiller</span>
1221 <span class="comment">%</span>
1222 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
1223 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
1224 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
1225 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
1226 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
1227 <span class="comment">% furnished to do so, subject to the following conditions:</span>
1228 <span class="comment">%</span>
1229 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
1230 <span class="comment">% copies or substantial portions of the Software.</span>
1231 <span class="comment">%</span>
1232 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
1233 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
1234 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
1235 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
1236 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
1237 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
1238 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>