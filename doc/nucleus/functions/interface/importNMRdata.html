<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of importNMRdata</title>
  <meta name="keywords" content="importNMRdata">
  <meta name="description" content=" is the general import routine for NMR data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- menu.html interface -->
<h1>importNMRdata
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> is the general import routine for NMR data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function importNMRdata(src) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">importNMRdata is the general import routine for NMR data

 Syntax:
       importNMRdata(src)

 Inputs:
       src - handle of the calling menu

 Outputs:
       none

 Example:
       importNMRdata(src)

 Other m-files required:
       cleanupGUIData
       clearAllAxes
       displayStatusText
       enableGUIelements('NMR');
       LoadNMRData_driver
       NUCLEUSinv_updateInterface

 Subfunctions:
       getNMRPathFile
       importDataBGR
       importDataBGRmat
       importDataDart
       importDataGeneral
       importDataLIAG
       importDataLIAGproject
       importDataMouse
       importDataHelios 
       loadGUIParameters
       loadGUIrawdata

 MAT-files required:
       none

 See also: NUCLEUSinv, NUCLEUSmod
 Author: see AUTHORS.md
 email: see AUTHORS.md
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/NUCLEUSinv/NUCLEUSinv_updateInterface.html" class="code" title="function NUCLEUSinv_updateInterface">NUCLEUSinv_updateInterface</a>	 updates all GUI elements</li><li><a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>	 loads NMR raw data from different file formats</li><li><a href="../../../nucleus/functions/import/fixParameterString.html" class="code" title="function str = fixParameterString(str)">fixParameterString</a>	 cleans parameter file lines when the properties have a</li><li><a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>	 rotateT2phase rotates the complex NMR T2 signal so that the imaginary</li><li><a href="cleanupGUIData.html" class="code" title="function data = cleanupGUIData(data)">cleanupGUIData</a>	 removes unnecessary fields from the global "data" struct</li><li><a href="clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>	 clears all axes of a given figure</li><li><a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>	 shows status information either in the GUI or on the</li><li><a href="enableGUIelements.html" class="code" title="function enableGUIelements(importtype)">enableGUIelements</a>	 activates all necessary GUI elements after successful</li><li><a href="makeINIfile.html" class="code" title="function gui = makeINIfile(gui,method)">makeINIfile</a>	 creates or updates the ini-File</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/callbacks/menus/onMenuImport.html" class="code" title="function onMenuImport(src,~)">onMenuImport</a>	 handles the import menu entries</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [NMRpath,NMRfile] = getNMRPathFile(label,import)</a></li><li><a href="#_sub2" class="code">function [data,gui] = importDataMouseCPMG(data,gui)</a></li><li><a href="#_sub3" class="code">function [data,gui] = importDataBGRmat(data,gui)</a></li><li><a href="#_sub4" class="code">function [data,gui] = importDataBGRliftSingle(data,gui)</a></li><li><a href="#_sub5" class="code">function [data,gui] = importDataBGRliftAll(data,gui)</a></li><li><a href="#_sub6" class="code">function [data,gui] = importDataHelios(data,gui)</a></li><li><a href="#_sub7" class="code">function [data,gui] = importDataDart(data,gui)</a></li><li><a href="#_sub8" class="code">function [data,gui] = importDataGeneral(data,gui)</a></li><li><a href="#_sub9" class="code">function [data,gui] = importDataLIAG(data,gui)</a></li><li><a href="#_sub10" class="code">function [data,gui] = importDataLIAGproject(data,gui)</a></li><li><a href="#_sub11" class="code">function [data,gui] = importDataMouse(data,gui)</a></li><li><a href="#_sub12" class="code">function [data,gui] = importDataIBAC(data,gui)</a></li><li><a href="#_sub13" class="code">function data = loadGUIParameters(datapath,fname)</a></li><li><a href="#_sub14" class="code">function data = loadGUIrawdata(data,NMRpath,NMRfile)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function importNMRdata(src)</a>
0002 <span class="comment">%importNMRdata is the general import routine for NMR data</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       importNMRdata(src)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       src - handle of the calling menu</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Outputs:</span>
0011 <span class="comment">%       none</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Example:</span>
0014 <span class="comment">%       importNMRdata(src)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Other m-files required:</span>
0017 <span class="comment">%       cleanupGUIData</span>
0018 <span class="comment">%       clearAllAxes</span>
0019 <span class="comment">%       displayStatusText</span>
0020 <span class="comment">%       enableGUIelements('NMR');</span>
0021 <span class="comment">%       LoadNMRData_driver</span>
0022 <span class="comment">%       NUCLEUSinv_updateInterface</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% Subfunctions:</span>
0025 <span class="comment">%       getNMRPathFile</span>
0026 <span class="comment">%       importDataBGR</span>
0027 <span class="comment">%       importDataBGRmat</span>
0028 <span class="comment">%       importDataDart</span>
0029 <span class="comment">%       importDataGeneral</span>
0030 <span class="comment">%       importDataLIAG</span>
0031 <span class="comment">%       importDataLIAGproject</span>
0032 <span class="comment">%       importDataMouse</span>
0033 <span class="comment">%       importDataHelios</span>
0034 <span class="comment">%       loadGUIParameters</span>
0035 <span class="comment">%       loadGUIrawdata</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% MAT-files required:</span>
0038 <span class="comment">%       none</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% See also: NUCLEUSinv, NUCLEUSmod</span>
0041 <span class="comment">% Author: see AUTHORS.md</span>
0042 <span class="comment">% email: see AUTHORS.md</span>
0043 <span class="comment">% License: MIT License (at end)</span>
0044 
0045 <span class="comment">%------------- BEGIN CODE --------------</span>
0046 
0047 <span class="comment">%% get GUI handle and data</span>
0048 fig = findobj(<span class="string">'Tag'</span>,<span class="string">'INV'</span>);
0049 gui = getappdata(fig,<span class="string">'gui'</span>);
0050 data = getappdata(fig,<span class="string">'data'</span>);
0051 
0052 <span class="comment">% try is used to catch any import error</span>
0053 <span class="comment">% often the wrong input file format is the case</span>
0054 <span class="keyword">try</span>
0055     <span class="comment">% check what import format is chosen</span>
0056     label = get(src,<span class="string">'Label'</span>);
0057     
0058     <span class="comment">% set file format for later use</span>
0059     <span class="keyword">if</span> strcmp(label,<span class="string">'GGE ascii'</span>)
0060         data.import.fileformat = <span class="string">'rwth'</span>;
0061     <span class="keyword">elseif</span> strcmp(label,<span class="string">'GGE field'</span>)
0062         data.import.fileformat = <span class="string">'field'</span>;
0063     <span class="keyword">elseif</span> strcmp(label,<span class="string">'GGE Dart'</span>)
0064         data.import.fileformat = <span class="string">'dart'</span>;
0065     <span class="keyword">elseif</span> strcmp(label,<span class="string">'CoreLab ascii'</span>)
0066         data.import.fileformat = <span class="string">'corelab'</span>;
0067     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MOUSE'</span>)
0068         data.import.fileformat = <span class="string">'mouse'</span>;
0069     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG single'</span>)
0070         data.import.fileformat = <span class="string">'liag'</span>;
0071     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG from project'</span>)
0072         data.import.fileformat = <span class="string">'liag'</span>;
0073     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG last project'</span>)
0074         data.import.fileformat = <span class="string">'liag'</span>;
0075     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BGR std'</span>)
0076         data.import.fileformat = <span class="string">'bgr'</span>;
0077     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseCPMG'</span>)
0078         data.import.fileformat = <span class="string">'MouseCPMG'</span>;
0079     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BGR mat'</span>)
0080         data.import.fileformat = <span class="string">'bgrmat'</span>;
0081     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseLiftSingle'</span>)
0082         data.import.fileformat = <span class="string">'MouseLiftSingle'</span>;
0083     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseLiftAll'</span>)
0084         data.import.fileformat = <span class="string">'MouseLiftAll'</span>;
0085     <span class="keyword">elseif</span> strcmp(label,<span class="string">'Helios'</span>)
0086         data.import.fileformat = <span class="string">'helios'</span>;
0087     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BAM TOM'</span>)
0088         data.import.fileformat = <span class="string">'bamtom'</span>;
0089     <span class="keyword">elseif</span> strcmp(label,<span class="string">'PM5'</span>)
0090         data.import.fileformat = <span class="string">'pm5'</span>;
0091     <span class="keyword">elseif</span> strcmp(label,<span class="string">'PM25'</span>)
0092         data.import.fileformat = <span class="string">'pm25'</span>;
0093     <span class="keyword">else</span>
0094         helpdlg(<span class="string">'Something is utterly wrong.'</span>,<span class="string">'onMenuImport: Choose again.'</span>);
0095     <span class="keyword">end</span>
0096     
0097     <span class="comment">% remove info field if any</span>
0098     ih = findobj(<span class="string">'Tag'</span>,<span class="string">'inv_info'</span>);
0099     <span class="keyword">if</span> ~isempty(ih); delete(ih); <span class="keyword">end</span>
0100     
0101     <span class="comment">% depending on the import format get the corresponding path / file</span>
0102     [NMRpath,NMRfile] = <a href="#_sub1" class="code" title="subfunction [NMRpath,NMRfile] = getNMRPathFile(label,import)">getNMRPathFile</a>(label,data.import);
0103     
0104     <span class="comment">% only continue if user didn't cancel</span>
0105     <span class="keyword">if</span> sum([NMRpath NMRfile]) &gt; 0
0106         <span class="comment">%  remove old fields and data</span>
0107         data = <a href="cleanupGUIData.html" class="code" title="function data = cleanupGUIData(data)">cleanupGUIData</a>(data);
0108         
0109         <span class="comment">% check for mat-file with GUI rawdata and import data</span>
0110         isfile = dir(fullfile(NMRpath,<span class="string">'NUCLEUSinv_raw.mat'</span>));
0111         
0112         <span class="comment">% if there is no raw-file import from folder/file</span>
0113         <span class="keyword">if</span> isempty(isfile)
0114             <span class="comment">% import data</span>
0115             data.import.path = NMRpath;
0116             data.import.file = -1;
0117             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Reading NMR Data ...'</span>);
0118             <span class="comment">% call the corresponding subroutines</span>
0119             <span class="keyword">switch</span> label
0120                 <span class="keyword">case</span> {<span class="string">'GGE ascii'</span>,<span class="string">'GGE field'</span>,<span class="string">'CoreLab ascii'</span>,<span class="string">'BGR std'</span>,<span class="keyword">...</span>
0121                         <span class="string">'BAM TOM'</span>}
0122                     [data,gui] = <a href="#_sub8" class="code" title="subfunction [data,gui] = importDataGeneral(data,gui)">importDataGeneral</a>(data,gui);
0123                 <span class="keyword">case</span> <span class="string">'Dart'</span>
0124                     data.import.file = NMRfile;
0125                     [data,gui] = <a href="#_sub7" class="code" title="subfunction [data,gui] = importDataDart(data,gui)">importDataDart</a>(data,gui);
0126                 <span class="keyword">case</span> <span class="string">'MOUSE'</span>
0127                     [data,gui] = <a href="#_sub11" class="code" title="subfunction [data,gui] = importDataMouse(data,gui)">importDataMouse</a>(data,gui);
0128                 <span class="keyword">case</span> <span class="string">'LIAG single'</span>
0129                     [data,gui] = <a href="#_sub9" class="code" title="subfunction [data,gui] = importDataLIAG(data,gui)">importDataLIAG</a>(data,gui);
0130                 <span class="keyword">case</span> {<span class="string">'LIAG from project'</span>,<span class="string">'LIAG last project'</span>}
0131                     [data,gui] = <a href="#_sub10" class="code" title="subfunction [data,gui] = importDataLIAGproject(data,gui)">importDataLIAGproject</a>(data,gui);
0132                     <span class="comment">% make the Petro Panel visible as default</span>
0133                     tmp_h = gui.myui.heights(2,:);
0134                     tmp_h(3) = gui.myui.heights(2,3);
0135                     <span class="comment">% but the CPS panel stays minimized</span>
0136                     tmp_h(5) = gui.myui.heights(1,3);
0137                     set(gui.panels.main,<span class="string">'Heights'</span>,tmp_h);
0138                     set(gui.panels.petro.main,<span class="string">'Minimized'</span>,false);
0139                 <span class="keyword">case</span> <span class="string">'BGR mat'</span>
0140                     data.import.file = NMRfile;
0141                     [data,gui] = <a href="#_sub3" class="code" title="subfunction [data,gui] = importDataBGRmat(data,gui)">importDataBGRmat</a>(data,gui);
0142                 <span class="keyword">case</span> <span class="string">'MouseCPMG'</span>
0143                     [data,gui] = <a href="#_sub2" class="code" title="subfunction [data,gui] = importDataMouseCPMG(data,gui)">importDataMouseCPMG</a>(data,gui);
0144                 <span class="keyword">case</span> <span class="string">'MouseLiftSingle'</span>
0145                     [data,gui] = <a href="#_sub4" class="code" title="subfunction [data,gui] = importDataBGRliftSingle(data,gui)">importDataBGRliftSingle</a>(data,gui);
0146                 <span class="keyword">case</span> <span class="string">'MouseLiftAll'</span>
0147                     [data,gui] = <a href="#_sub5" class="code" title="subfunction [data,gui] = importDataBGRliftAll(data,gui)">importDataBGRliftAll</a>(data,gui);
0148                 <span class="keyword">case</span> <span class="string">'Helios'</span>
0149                     data.import.file = NMRfile;
0150                     [data,gui] = <a href="#_sub6" class="code" title="subfunction [data,gui] = importDataHelios(data,gui)">importDataHelios</a>(data,gui);
0151                 <span class="keyword">case</span> {<span class="string">'PM5'</span>,<span class="string">'PM25'</span>}
0152                     data.import.file = NMRfile;
0153                     [data,gui] = <a href="#_sub12" class="code" title="subfunction [data,gui] = importDataIBAC(data,gui)">importDataIBAC</a>(data,gui);
0154             <span class="keyword">end</span>
0155             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Reading NMR Data ... done'</span>);
0156         <span class="keyword">else</span>
0157             <span class="comment">% import from mat-file</span>
0158             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Importing NMR raw data from mat-file ...'</span>);
0159             data = <a href="#_sub14" class="code" title="subfunction data = loadGUIrawdata(data,NMRpath,NMRfile)">loadGUIrawdata</a>(data,NMRpath,NMRfile);
0160             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Importing NMR raw data from mat-file ... done'</span>);
0161         <span class="keyword">end</span>
0162         
0163         <span class="comment">% update the path info field with &quot;NMRpath&quot; (&quot;NMRfile&quot;)</span>
0164         <span class="keyword">if</span> NMRfile &gt; 0
0165             tmpstr = fullfile(NMRpath,NMRfile);
0166         <span class="keyword">else</span>
0167             tmpstr = NMRpath;
0168         <span class="keyword">end</span>
0169         <span class="keyword">if</span> length(tmpstr)&gt;50
0170             set(gui.text_handles.data_path,<span class="string">'String'</span>,[<span class="string">'...'</span>,tmpstr(end-50:end)],<span class="keyword">...</span>
0171                 <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0172         <span class="keyword">else</span>
0173             set(gui.text_handles.data_path,<span class="string">'String'</span>,tmpstr,<span class="keyword">...</span>
0174                 <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0175         <span class="keyword">end</span>
0176         set(gui.text_handles.data_path,<span class="string">'TooltipString'</span>,tmpstr);
0177         
0178         <span class="comment">% update the ini-file</span>
0179         gui.myui.inidata.importpath = data.import.path;
0180         gui = <a href="makeINIfile.html" class="code" title="function gui = makeINIfile(gui,method)">makeINIfile</a>(gui,<span class="string">'update'</span>);
0181         
0182         <span class="comment">% update the list of file names</span>
0183         set(gui.listbox_handles.signal,<span class="string">'String'</span>,data.import.NMR.filesShort);
0184         set(gui.listbox_handles.signal,<span class="string">'Value'</span>,[],<span class="string">'Max'</span>,2,<span class="string">'Min'</span>,0);
0185         
0186         <span class="comment">% create a global INVdata struct for every file in the list</span>
0187         <span class="keyword">if</span> isstruct(getappdata(fig,<span class="string">'INVdata'</span>))
0188             setappdata(fig,<span class="string">'INVdata'</span>,[]);
0189         <span class="keyword">end</span>
0190         INVdata = cell(length(data.import.NMR.filesShort),1);
0191         setappdata(fig,<span class="string">'INVdata'</span>,INVdata);
0192         
0193         <span class="comment">% clear all axes</span>
0194         <a href="clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(gui.figh);
0195         
0196         <span class="comment">% update GUI data and interface</span>
0197         setappdata(fig,<span class="string">'data'</span>,data);
0198         setappdata(fig,<span class="string">'gui'</span>,gui);
0199         <a href="enableGUIelements.html" class="code" title="function enableGUIelements(importtype)">enableGUIelements</a>(<span class="string">'NMR'</span>);
0200         
0201         <span class="comment">% special treatment of LIAG projects</span>
0202         <span class="keyword">switch</span> label
0203             <span class="keyword">case</span> {<span class="string">'LIAG from project'</span>,<span class="string">'LIAG last project'</span>}
0204                 cpath = data.import.LIAG.calibrationpath;
0205                 <span class="comment">% check if this calibration file was already used</span>
0206                 isfile = dir(fullfile(cpath,<span class="string">'NUCLEUS_calibData.mat'</span>));
0207                 <span class="keyword">if</span> ~isempty(isfile)
0208                     id = 2;
0209                     <span class="comment">% if data is there reuse it</span>
0210                     calib = load(fullfile(cpath,isfile.name),<span class="string">'calib'</span>);
0211                     INVdata{id} = calib.calib;
0212                     data.calib = INVdata{id}.calib;
0213                     data.import.LIAG.Tbulk = INVdata{id}.results.invstd.T2;
0214                     setappdata(fig,<span class="string">'INVdata'</span>,INVdata);
0215                     setappdata(fig,<span class="string">'data'</span>,data);
0216                     <span class="comment">% color the list entry</span>
0217                     strL = get(gui.listbox_handles.signal,<span class="string">'String'</span>);
0218                     str1 = strL{id};
0219                     str2 = [<span class="string">'&lt;HTML&gt;&lt;BODY bgcolor=&quot;rgb('</span>,<span class="keyword">...</span>
0220                         sprintf(<span class="string">'%d,%d,%d'</span>,gui.myui.colors.listINV.*255),<span class="string">')&quot;&gt;'</span>,<span class="keyword">...</span>
0221                         str1,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;'</span>];
0222                     strL{id} = str2;
0223                     set(gui.listbox_handles.signal,<span class="string">'String'</span>,strL);
0224                 <span class="keyword">end</span>
0225             <span class="keyword">otherwise</span>
0226         <span class="keyword">end</span>
0227         <span class="comment">% update GUI interface</span>
0228         <a href="../../../nucleus/NUCLEUSinv/NUCLEUSinv_updateInterface.html" class="code" title="function NUCLEUSinv_updateInterface">NUCLEUSinv_updateInterface</a>;
0229     <span class="keyword">end</span>
0230     
0231 <span class="keyword">catch</span> ME
0232     <span class="comment">% show error message in case import fails</span>
0233     errmsg = {ME.message;[ME.stack(1).name,<span class="string">' Line: '</span>,num2str(ME.stack(1).line)];<span class="keyword">...</span>
0234         <span class="string">'Check File Format settings.'</span>};
0235     errordlg(errmsg,<span class="string">'importNMRdata: Error!'</span>);
0236     
0237 <span class="keyword">end</span>
0238 
0239 <span class="keyword">end</span>
0240 
0241 <span class="comment">%%</span>
0242 <a name="_sub1" href="#_subfunctions" class="code">function [NMRpath,NMRfile] = getNMRPathFile(label,import)</a>
0243 
0244 NMRpath = -1;
0245 NMRfile = -1;
0246 <span class="comment">% for almost all import cases we load a folder ... but not for all</span>
0247 <span class="keyword">switch</span> label
0248     <span class="keyword">case</span> {<span class="string">'GGE ascii'</span>,<span class="string">'GGE field'</span>,<span class="string">'CoreLab ascii'</span>,<span class="string">'MOUSE'</span>,<span class="string">'LIAG single'</span>,<span class="keyword">...</span>
0249             <span class="string">'BGR std'</span>,<span class="string">'MouseCPMG'</span>,<span class="string">'MouseLiftSingle'</span>,<span class="string">'MouseLiftAll'</span>,<span class="string">'Helios'</span>,<span class="string">'BAM TOM'</span>,<span class="string">'PM25'</span>}
0250         <span class="comment">% if there is already a data folder present we start from here</span>
0251         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0252             NMRpath = uigetdir(import.path,<span class="string">'Choose Data Path'</span>);
0253         <span class="keyword">else</span>
0254             <span class="comment">% otherwise we start at the current working dircetory</span>
0255             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0256             here = mfilename(<span class="string">'fullpath'</span>);
0257             [pathstr,~,~] = fileparts(here);
0258             NMRpath = uigetdir(pathstr,<span class="string">'Choose Data Path'</span>);
0259         <span class="keyword">end</span>
0260     <span class="keyword">case</span> <span class="string">'LIAG from project'</span>
0261         <span class="comment">% if there is already a data folder present we start from here</span>
0262         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0263             NMRpath = uigetdir(import.path,<span class="string">'Choose Project Path'</span>);
0264         <span class="keyword">else</span>
0265             <span class="comment">% otherwise we start at the current working dircetory</span>
0266             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0267             here = mfilename(<span class="string">'fullpath'</span>);
0268             [pathstr,~,~] = fileparts(here);
0269             NMRpath = uigetdir(pathstr,<span class="string">'Choose Project Path'</span>);
0270         <span class="keyword">end</span>
0271     <span class="keyword">case</span> <span class="string">'LIAG last project'</span>
0272         <span class="comment">% there is already a data folder and we use this one</span>
0273         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0274             NMRpath = import.path;
0275         <span class="keyword">else</span>
0276             <span class="comment">% otherwise we start at the current working dircetory</span>
0277             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0278             here = mfilename(<span class="string">'fullpath'</span>);
0279             [pathstr,~,~] = fileparts(here);
0280             NMRpath = uigetdir(pathstr,<span class="string">'Choose Project Path'</span>);
0281         <span class="keyword">end</span>
0282     <span class="keyword">case</span> {<span class="string">'GGE Dart'</span>,<span class="string">'BGR mat'</span>,<span class="string">'NMR mat'</span>}
0283         <span class="comment">% if there is already a data folder present we start from here</span>
0284         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0285             [NMRfile,NMRpath] = uigetfile(import.path,<span class="string">'Choose Data file'</span>);
0286         <span class="keyword">else</span>
0287             <span class="comment">% otherwise we start at the current working dircetory</span>
0288             <span class="comment">% 'foldername' hold s the name of the choosen data path</span>
0289             here = mfilename(<span class="string">'fullpath'</span>);
0290             [pathstr,~,~] = fileparts(here);
0291             [NMRfile,NMRpath] = uigetfile(pathstr,<span class="string">'Choose Data file'</span>);
0292         <span class="keyword">end</span>
0293     <span class="keyword">case</span> <span class="string">'PM5'</span>
0294         <span class="comment">% if there is already a data folder present we start from here</span>
0295         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0296             NMRpath = uigetdir(import.path,<span class="string">'Choose PM5 Data Path'</span>);
0297         <span class="keyword">else</span>
0298             <span class="comment">% otherwise we start at the current working dircetory</span>
0299             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0300             here = mfilename(<span class="string">'fullpath'</span>);
0301             [pathstr,~,~] = fileparts(here);
0302             NMRpath = uigetdir(pathstr,<span class="string">'Choose PM5 Data Path'</span>);
0303         <span class="keyword">end</span>
0304         
0305         <span class="comment">% check if there are multiple inf-files available</span>
0306         <span class="comment">% if yes -&gt; choose one</span>
0307         inffiles = dir(fullfile(NMRpath,<span class="string">'*.inf'</span>));
0308         <span class="keyword">if</span> numel(inffiles) &gt; 1
0309             [NMRfile,NMRpath] = uigetfile(fullfile(NMRpath,<span class="string">'*.inf'</span>),<span class="keyword">...</span>
0310                 <span class="string">'Choose INF file'</span>);
0311         <span class="keyword">elseif</span> numel(inffiles) == 1
0312             NMRfile = inffiles.name;            
0313         <span class="keyword">end</span>
0314 <span class="keyword">end</span>
0315 
0316 <span class="keyword">end</span>
0317 
0318 <span class="comment">%%</span>
0319 <a name="_sub2" href="#_subfunctions" class="code">function [data,gui] = importDataMouseCPMG(data,gui)</a>
0320 
0321 csv_t2path = dir(fullfile(data.import.path,<span class="string">'CPMG'</span>));
0322 csv_t2path = csv_t2path(~ismember({csv_t2path.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0323 
0324 fnames = struct;
0325 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0326 <span class="comment">% will be shown in the listbox</span>
0327 shownames = cell(1,1);
0328 
0329 c = 0;
0330 <span class="keyword">if</span> ~isempty(csv_t2path)
0331     <span class="keyword">for</span> i = 1:size(csv_t2path,1)
0332         in.T1T2 = <span class="string">'T2'</span>;
0333         in.path = fullfile(data.import.path,<span class="string">'CPMG'</span>,csv_t2path(i).name);
0334         in.fileformat = data.import.fileformat;
0335         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0336         
0337         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0338             <span class="comment">% the individual file names</span>
0339             c = c + 1;
0340             fnames(c).parfile = <span class="string">'acqu.par'</span>;
0341             fnames(c).datafile = out.nmrData{j}.datfile;
0342             fnames(c).T2specfile = <span class="string">''</span>;
0343             
0344             shownames{c} = [<span class="string">'T2_'</span>,csv_t2path(i).name,<span class="string">'_'</span>,fnames(c).datafile];
0345             
0346             <span class="comment">% the NMR data</span>
0347             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0348             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0349                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0350                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0351             <span class="keyword">end</span>
0352             data.import.NMR.data{c} = out.nmrData{j};
0353             data.import.NMR.para{c} = out.parData;
0354         <span class="keyword">end</span>
0355     <span class="keyword">end</span>
0356 <span class="keyword">end</span>
0357 
0358 <span class="keyword">if</span> isempty(csv_t2path)
0359     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0360 <span class="keyword">else</span>
0361     <span class="comment">% update the global data structure</span>
0362     data.import.NMR.files = fnames;
0363     data.import.NMR.filesShort = shownames;
0364 <span class="keyword">end</span>
0365 
0366 <span class="keyword">end</span>
0367 
0368 <span class="comment">%%</span>
0369 <a name="_sub3" href="#_subfunctions" class="code">function [data,gui] = importDataBGRmat(data,gui)</a>
0370 
0371 in.path = fullfile(data.import.path);
0372 in.name = data.import.file;
0373 in.fileformat = data.import.fileformat;
0374 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0375 
0376 fnames = struct;
0377 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0378 <span class="comment">% will be shown in the listbox</span>
0379 shownames = cell(1,1);
0380 
0381 c = 0;
0382 table = {true,0,1,<span class="string">'D'</span>};
0383 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0384     <span class="comment">% the individual file names</span>
0385     c = c + 1;
0386     fnames(c).parfile = <span class="string">''</span>;
0387     fnames(c).datafile = data.import.file;
0388     fnames(c).T2specfile = <span class="string">''</span>;
0389     
0390     shownames{c} = out.parData{j}.file;
0391     
0392     data.import.NMR.data{c} = out.nmrData{j};
0393     data.import.NMR.para{c} = out.parData{j};
0394     
0395     <span class="keyword">if</span> isfield(out,<span class="string">'pressData'</span>)
0396         <span class="comment">% convert hPa to Pa</span>
0397         table{c,1} = true;
0398         table{c,2} = out.pressData.p(j)*1e2;
0399         table{c,3} = out.pressData.S(j);
0400         table{c,4} = <span class="string">'D'</span>;
0401     <span class="keyword">end</span>
0402 <span class="keyword">end</span>
0403 
0404 <span class="comment">% global Tbulk</span>
0405 data.invstd.Tbulk = out.parData{1}.Tbulk;
0406 <span class="comment">% global porosity</span>
0407 data.import.BGR.porosity = out.parData{1}.porosity;
0408 
0409 data.import.NMR.files = fnames;
0410 data.import.NMR.filesShort = shownames;
0411 
0412 <span class="comment">% import pressure / saturation data</span>
0413 <span class="keyword">if</span> isfield(out,<span class="string">'pressData'</span>)
0414     data.pressure.unit = <span class="string">'kPa'</span>;
0415     data.pressure.unitfac = 1e-3;
0416     data.pressure.table = table;
0417 <span class="keyword">end</span>
0418 
0419 <span class="keyword">end</span>
0420 
0421 <span class="comment">%%</span>
0422 <a name="_sub4" href="#_subfunctions" class="code">function [data,gui] = importDataBGRliftSingle(data,gui)</a>
0423 
0424 <span class="comment">% first check whether T1 or T2 was measured...</span>
0425 <span class="comment">% by analyzing the name of data folder</span>
0426 indiz = find(data.import.path == filesep);
0427 checkT1T2 = data.import.path(indiz(end-1)+1:indiz(end)-1);
0428 <span class="keyword">if</span> strcmp(checkT1T2,<span class="string">'t1test'</span>)
0429     in.T1T2 = <span class="string">'T1'</span>;
0430 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastautotest'</span>)
0431     in.T1T2 = <span class="string">'T2'</span>; 
0432 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastauto'</span>)
0433     in.T1T2 = <span class="string">'T2'</span>; 
0434 <span class="keyword">else</span>
0435     disp(<span class="string">'Please chose an original Prospa folder for Mouse Lift data!'</span>);
0436 <span class="keyword">end</span>
0437 
0438 <span class="comment">% % there should be folders with integer values in their names</span>
0439 <span class="comment">% t1t2path = data.import.path;</span>
0440 
0441 fnames = struct;
0442 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0443 <span class="comment">% will be shown in the listbox</span>
0444 shownames = cell(1,1);
0445 
0446 c = 0;
0447 <span class="keyword">if</span> ~isempty(data.import.path)
0448 <span class="comment">%    for i = 1:size(t1t2path,1)</span>
0449         in.path = data.import.path;
0450         in.fileformat = data.import.fileformat;
0451         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0452         
0453         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0454             <span class="comment">% the individual file names</span>
0455             c = c + 1;
0456             fnames(c).parfile = <span class="string">'acq.par'</span>;
0457             fnames(c).datafile = out.nmrData{j}.datfile;
0458             
0459             shownames{c} = [in.T1T2,<span class="string">'_'</span>,fnames(c).datafile];
0460             
0461             <span class="comment">% the NMR data</span>
0462             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0463             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0464                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0465                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0466             <span class="keyword">end</span>
0467             data.import.NMR.data{c} = out.nmrData{j};
0468             data.import.NMR.para{c} = out.parData;
0469         <span class="keyword">end</span>
0470 <span class="keyword">else</span>
0471     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0472 <span class="keyword">end</span>
0473 
0474 
0475     <span class="comment">% update the global data structure</span>
0476     data.import.NMR.files = fnames;
0477     data.import.NMR.filesShort = shownames;
0478 
0479 <span class="keyword">end</span>
0480 <span class="comment">%%</span>
0481 <a name="_sub5" href="#_subfunctions" class="code">function [data,gui] = importDataBGRliftAll(data,gui)</a>
0482 
0483 <span class="comment">% first check whether T1 or T2 was measured</span>
0484 indiz = find(data.import.path == filesep);
0485 checkT1T2 = data.import.path(indiz(end)+1:end);
0486 <span class="keyword">if</span> strcmp(checkT1T2,<span class="string">'t1test'</span>)
0487     in.T1T2 = <span class="string">'T1'</span>;
0488 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastautotest'</span>)
0489     in.T1T2 = <span class="string">'T2'</span>; 
0490 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastauto'</span>)
0491     in.T1T2 = <span class="string">'T2'</span>; 
0492 <span class="keyword">else</span>
0493     helpdlg(<span class="string">'No original data folder'</span>,<span class="string">'onMenuImport: No data.'</span>);
0494 <span class="keyword">end</span>
0495 
0496 <span class="comment">% there should be folders with integer values in their names</span>
0497 t1t2path = dir(data.import.path);
0498 t1t2path = t1t2path(~ismember({t1t2path.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0499 
0500 fnames = struct;
0501 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0502 <span class="comment">% will be shown in the listbox</span>
0503 shownames = cell(1,1);
0504 
0505 c = 0;
0506 <span class="keyword">if</span> ~isempty(t1t2path)
0507     <span class="keyword">for</span> i = 1:size(t1t2path,1)
0508         in.path = fullfile(data.import.path,t1t2path(i).name);
0509         in.fileformat = data.import.fileformat;
0510         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0511         
0512         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0513             <span class="comment">% the individual file names</span>
0514             c = c + 1;
0515             fnames(c).parfile = <span class="string">'acq.par'</span>;
0516             fnames(c).datafile = out.nmrData{j}.datfile;
0517             
0518             shownames{c} = [in.T1T2,<span class="string">'_'</span>,t1t2path(i).name,<span class="string">'_'</span>,fnames(c).datafile];
0519             
0520             <span class="comment">% the NMR data</span>
0521             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0522             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0523                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0524                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0525             <span class="keyword">end</span>
0526             data.import.NMR.data{c} = out.nmrData{j};
0527             data.import.NMR.para{c} = out.parData;
0528         <span class="keyword">end</span>
0529     <span class="keyword">end</span>
0530 <span class="keyword">else</span>
0531     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0532 <span class="keyword">end</span>
0533     <span class="comment">% update the global data structure</span>
0534     data.import.NMR.files = fnames;
0535     data.import.NMR.filesShort = shownames;
0536 
0537 <span class="keyword">end</span>
0538 
0539 <span class="comment">%%</span>
0540 <a name="_sub6" href="#_subfunctions" class="code">function [data,gui] = importDataHelios(data,gui)</a>
0541 
0542 <span class="comment">% first check the subpaths</span>
0543 <span class="comment">% there should be some folders with names ...</span>
0544 <span class="comment">% ... similar to the data filenames inside them</span>
0545 datpath = dir(data.import.path);
0546 datpath = datpath(~ismember({datpath.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0547 
0548 fnames = struct;
0549 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0550 <span class="comment">% will be shown in the listbox</span>
0551 shownames = cell(1,1);
0552 
0553 c = 0;
0554 <span class="keyword">if</span> ~isempty(datpath)
0555     <span class="keyword">for</span> i = 1:size(datpath,1)
0556         <span class="comment">% does datpath.name points to a folder?</span>
0557         <span class="keyword">if</span> datpath(i).isdir    
0558             <span class="comment">% check if datpath.name includes regular Helios data files</span>
0559             content = dir([data.import.path,filesep,datpath(i).name]);
0560             content = content(~ismember({content.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0561             <span class="keyword">for</span> j = 1:size(content,1)
0562                 <span class="keyword">if</span> strcmp(content(j).name,[datpath(i).name,<span class="string">'_1.hrd'</span>])
0563                     in.T1T2 = <span class="string">'T2'</span>;
0564                     in.name = content(j).name;
0565                     in.path = fullfile(data.import.path,filesep,datpath(i).name);
0566                     in.fileformat = data.import.fileformat;
0567                     out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0568                     
0569                     <span class="comment">% the individual file names</span>
0570                     c = c + 1;
0571                     fnames(c).parfile = <span class="string">''</span>;
0572                     fnames(c).datafile = out.nmrData.datfile;
0573                     fnames(c).T2specfile = <span class="string">''</span>;
0574                     shownames{c} = [<span class="string">'T2_'</span>,datpath(i).name];
0575             
0576                     data.import.NMR.data{c} = out.nmrData;
0577                     data.import.NMR.para{c} = out.parData;
0578                 <span class="keyword">end</span>
0579             <span class="keyword">end</span>
0580         <span class="keyword">end</span>
0581     <span class="keyword">end</span>
0582 <span class="keyword">end</span>
0583 
0584 data.import.NMR.files = fnames;
0585 data.import.NMR.filesShort = shownames;
0586 
0587 <span class="keyword">end</span>
0588 
0589 <span class="comment">%%</span>
0590 <a name="_sub7" href="#_subfunctions" class="code">function [data,gui] = importDataDart(data,gui)</a>
0591 
0592 in.path = fullfile(data.import.path);
0593 in.name = data.import.file;
0594 in.fileformat = data.import.fileformat;
0595 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0596 
0597 fnames = struct;
0598 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0599 <span class="comment">% will be shown in the listbox</span>
0600 shownames = cell(1,1);
0601 
0602 c = 0;
0603 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0604     <span class="comment">% the individual file names</span>
0605     c = c + 1;
0606     fnames(c).parfile = <span class="string">''</span>;
0607     fnames(c).datafile = data.import.file;
0608     fnames(c).T2specfile = <span class="string">''</span>;
0609     
0610     shownames{c} = [<span class="string">'depth_'</span>,sprintf(<span class="string">'%04.3f'</span>,out.parData{j}.depth)];
0611     
0612     <span class="comment">% the NMR data</span>
0613     <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0614     <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0615         out.nmrData{j}.time = out.nmrData{j}.time/1000;
0616         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0617     <span class="keyword">end</span>
0618     data.import.NMR.data{c} = out.nmrData{j};
0619     data.import.NMR.para{c} = out.parData{j};
0620 <span class="keyword">end</span>
0621 
0622 data.import.NMR.files = fnames;
0623 data.import.NMR.filesShort = shownames;
0624 
0625 <span class="keyword">end</span>
0626 
0627 <span class="comment">%%</span>
0628 <a name="_sub8" href="#_subfunctions" class="code">function [data,gui] = importDataGeneral(data,gui)</a>
0629 
0630 <span class="comment">% look for all files ending with '.par'</span>
0631 <span class="comment">% should exist for T1 and T2 measurements</span>
0632 filenames = dir(fullfile(data.import.path,<span class="string">'*.par'</span>));
0633 
0634 fnames = struct;
0635 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0636 <span class="comment">% will be shown in the listbox</span>
0637 shownames = cell(1,1);
0638 
0639 <span class="comment">% loop over all found files and import the data</span>
0640 c = 0;
0641 in.path = data.import.path;
0642 <span class="keyword">for</span> i = 1:size(filenames,1)
0643     ind = strfind(filenames(i).name,<span class="string">'.'</span>);
0644     ind = max(ind);
0645     in.name = filenames(i).name(1:ind-1);
0646     in.fileformat = data.import.fileformat;
0647     out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0648     
0649     <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0650         <span class="comment">% the individual file names</span>
0651         c = c + 1;
0652         fnames(c).parfile = filenames(i).name;
0653         fnames(c).datafile = out.nmrData{j}.datfile;
0654         <span class="keyword">if</span> strcmp(out.nmrData{j}.flag,<span class="string">'T2'</span>) &amp;&amp; isfield(out.nmrData{j},<span class="string">'specfile'</span>)
0655             fnames(c).T2specfile = out.nmrData{j}.specfile;
0656         <span class="keyword">else</span>
0657             fnames(c).T2specfile = <span class="string">''</span>;
0658         <span class="keyword">end</span>
0659         shownames{c} = fnames(c).datafile;
0660         
0661         <span class="comment">% the NMR data</span>
0662         <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0663         <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0664             out.nmrData{j}.time = out.nmrData{j}.time/1000;
0665             out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0666         <span class="keyword">end</span>
0667         data.import.NMR.data{c} = out.nmrData{j};
0668         data.import.NMR.para{c} = out.parData;
0669     <span class="keyword">end</span>
0670 <span class="keyword">end</span>
0671 
0672 <span class="keyword">switch</span> data.import.fileformat
0673     <span class="keyword">case</span> <span class="string">'bamtom'</span>
0674         nslices = out.parData.nSlices;
0675         ncsvfiles = numel(fnames);
0676         
0677         <span class="comment">% check for background file (&quot;Leermessung&quot;)</span>
0678         has_bg = false;
0679         <span class="keyword">for</span> i = 1:numel(fnames)
0680             <span class="keyword">if</span> ~isempty(strfind(fnames(i).datafile,<span class="string">'000'</span>))
0681                 has_bg = true;
0682                 index_bg = i;
0683                 <span class="keyword">break</span>;
0684             <span class="keyword">end</span>
0685         <span class="keyword">end</span>
0686         
0687         <span class="keyword">if</span> has_bg
0688             <span class="comment">% background data set</span>
0689             bg = data.import.NMR.data{index_bg};
0690             
0691             <span class="comment">% vector of indices of the files that get corrected</span>
0692             ind_files = 1:1:ncsvfiles;
0693             ind_files(ind_files==index_bg) = [];
0694             
0695             <span class="keyword">for</span> i = ind_files                
0696                 <span class="comment">% subtract the background signal</span>
0697                 s = data.import.NMR.data{i}.signal;
0698                 s_bg = bg.signal;
0699                 <span class="comment">% if the background signal is longer than the signal cut it</span>
0700                 <span class="keyword">if</span> numel(s_bg) &gt; numel(s)
0701                     tmp_s = s_bg(1:numel(s));
0702                 <span class="keyword">else</span> <span class="comment">% if not pad it with zeros</span>
0703                     tmp_s = zeros(size(s));
0704                     tmp_s(1:numel(s_bg)) = s_bg;
0705                 <span class="keyword">end</span>
0706                 s = complex(real(s)-real(tmp_s),imag(s)-imag(tmp_s));
0707                 <span class="comment">% update original data set</span>
0708                 data.import.NMR.data{i}.signal = s;                
0709             <span class="keyword">end</span>
0710             
0711             <span class="comment">% check if the number of slices is equal to the number of files</span>
0712             <span class="comment">% (excluding the background file)</span>
0713             <span class="keyword">if</span> nslices == numel(ind_files)
0714                 <span class="comment">% create z-vector</span>
0715                 p = out.parData;
0716                 zslice = linspace(p.startPos,p.endPos,p.nSlices)';
0717                 data.import.BAM.use_z = true;
0718                 data.import.BAM.zslice = zslice;
0719                 <span class="keyword">if</span> numel(zslice) &gt; 1
0720                     c = 0;
0721                     <span class="keyword">for</span> i = ind_files
0722                         c = c + 1;
0723                         tmp = shownames{i};
0724                         shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%5.4f'</span>,zslice(c))];
0725                     <span class="keyword">end</span>
0726                 <span class="keyword">end</span>
0727             <span class="keyword">else</span>
0728                 data.import.BAM.use_z = false;
0729                 data.import.BAM.zslice = 1:1:max([numel(ind_files) 1]);
0730             <span class="keyword">end</span>
0731             
0732         <span class="keyword">else</span>
0733             <span class="keyword">if</span> nslices == ncsvfiles
0734                 <span class="comment">% create z-vector</span>
0735                 p = out.parData;
0736                 zslice = linspace(p.startPos,p.endPos,p.nSlices)';
0737                 data.import.BAM.use_z = true;
0738                 data.import.BAM.zslice = zslice;
0739                 <span class="keyword">if</span> numel(zslice) &gt; 1
0740                     <span class="keyword">for</span> i = 1:numel(zslice)
0741                         tmp = shownames{i};
0742                         shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%5.4f'</span>,zslice(i))];
0743                     <span class="keyword">end</span>
0744                 <span class="keyword">end</span>
0745             <span class="keyword">else</span>
0746                 data.import.BAM.use_z = false;
0747                 data.import.BAM.zslice = 1:1:ncsvfiles;
0748             <span class="keyword">end</span>
0749         <span class="keyword">end</span>    
0750 <span class="keyword">end</span>
0751 
0752 <span class="comment">% update the global data structure</span>
0753 data.import.NMR.files = fnames;
0754 data.import.NMR.filesShort = shownames;
0755 
0756 <span class="keyword">end</span>
0757 
0758 <span class="comment">%%</span>
0759 <a name="_sub9" href="#_subfunctions" class="code">function [data,gui] = importDataLIAG(data,gui)</a>
0760 
0761 in.path = fullfile(data.import.path);
0762 in.fileformat = data.import.fileformat;
0763 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0764 
0765 fnames = struct;
0766 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0767 <span class="comment">% will be shown in the listbox</span>
0768 shownames = cell(1,1);
0769 
0770 c = 0;
0771 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0772     <span class="comment">% the individual file names</span>
0773     c = c + 1;
0774     fnames(c).parfile = <span class="string">'acqu.par'</span>;
0775     fnames(c).datafile = out.nmrData{j}.datfile;
0776     fnames(c).T2specfile = <span class="string">''</span>;
0777     
0778     shownames{c} = fnames(c).datafile;
0779     
0780     <span class="comment">% the NMR data</span>
0781     <span class="comment">% here we fix the time scale to [s] if neccessary</span>
0782     TE = out.parData.echoTime; <span class="comment">% [s]</span>
0783     <span class="keyword">if</span> out.nmrData{j}.time(1)== TE/1e3
0784         <span class="comment">% change [ms] to [s]</span>
0785         out.nmrData{j}.time = out.nmrData{j}.time/1e3;
0786         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1e3;
0787     <span class="keyword">elseif</span> out.nmrData{j}.time(1)== TE
0788         <span class="comment">% change [s] to [s] -&gt; very unlikely</span>
0789         out.nmrData{j}.time = out.nmrData{j}.time/1e6;
0790         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1e6;
0791     <span class="keyword">end</span>
0792     data.import.NMR.data{c} = out.nmrData{j};
0793     data.import.NMR.para{c} = out.parData;
0794 <span class="keyword">end</span>
0795 
0796 <span class="comment">% update the global data structure</span>
0797 data.import.NMR.files = fnames;
0798 data.import.NMR.filesShort = shownames;
0799 
0800 <span class="keyword">end</span>
0801 
0802 <span class="comment">%%</span>
0803 <a name="_sub10" href="#_subfunctions" class="code">function [data,gui] = importDataLIAGproject(data,gui)</a>
0804 
0805 <span class="comment">% 1) show all folders and ask for sample</span>
0806 subdirs = dir(data.import.path);
0807 <span class="comment">% remove the dot-dirs</span>
0808 subdirs = subdirs(~ismember({subdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0809 
0810 fnames = {subdirs.name};
0811 [indx,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Sample:'</span>,<span class="keyword">...</span>
0812     <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0813     <span class="string">'ListString'</span>,fnames);
0814 
0815 <span class="keyword">if</span> ~isempty(indx)
0816     <span class="comment">% 2) check corresponding SampleParameter.par file for reference and</span>
0817     <span class="comment">% calibration sample and other parameters</span>
0818     datapath = fullfile(data.import.path,fnames{indx});
0819     <span class="comment">% load SampleParameter file for sample</span>
0820     [SampleParameter] = <a href="#_sub13" class="code" title="subfunction data = loadGUIParameters(datapath,fname)">loadGUIParameters</a>(datapath,<span class="string">'SampleParameters.par'</span>);
0821     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'sampleVolume'</span>)
0822         dataVol = SampleParameter.sampleVolume;
0823     <span class="keyword">else</span>
0824         dataVol = 1;
0825     <span class="keyword">end</span>
0826     
0827     <span class="comment">% 2a) background file #1</span>
0828     backgroundFile1 = SampleParameter.backgroundFile;
0829     <span class="keyword">if</span> isempty(backgroundFile1)
0830         bnames = {subdirs.name};
0831         bnames(indx) = [];
0832         [indb,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Background File:'</span>,<span class="keyword">...</span>
0833             <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0834             <span class="string">'ListString'</span>,bnames);
0835         <span class="keyword">if</span> ~isempty(indb)
0836             backgroundFile1 = bnames{indb};
0837         <span class="keyword">else</span>
0838             backgroundFile1 = <span class="string">''</span>;
0839         <span class="keyword">end</span>
0840     <span class="keyword">end</span>
0841     <span class="keyword">if</span> ~isempty(backgroundFile1)
0842         ind = strfind(backgroundFile1,filesep);
0843         <span class="keyword">if</span> ~isempty(ind)
0844             backgroundFile1 = backgroundFile1(ind(end)+1:end);
0845         <span class="keyword">end</span>
0846         fileInList = ismember(fnames,{backgroundFile1});
0847         <span class="keyword">if</span> any(fileInList)
0848             backgroundpath1 = fullfile(data.import.path,fnames{fileInList});
0849         <span class="keyword">end</span>
0850     <span class="keyword">else</span>
0851         backgroundpath1 = <span class="string">''</span>;
0852         backgroundFile1 = <span class="string">''</span>;
0853     <span class="keyword">end</span>
0854     backVol = 1;
0855     
0856     <span class="comment">% 2b) calibration file</span>
0857     c = 0;
0858     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile0'</span>)
0859         c = c + 1;
0860         calibrationFiles{c} = SampleParameter.calibrationFile0;
0861     <span class="keyword">end</span>
0862     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile1'</span>)
0863         c = c + 1;
0864         calibrationFiles{c} = SampleParameter.calibrationFile1;
0865     <span class="keyword">end</span>
0866     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile2'</span>)
0867         c = c + 1;
0868         calibrationFiles{c} = SampleParameter.calibrationFile2;
0869     <span class="keyword">end</span>
0870     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile3'</span>)
0871         c = c + 1;
0872         calibrationFiles{c} = SampleParameter.calibrationFile3;
0873     <span class="keyword">end</span>
0874     
0875     <span class="comment">% find the non-empty one</span>
0876     ind = ismember(calibrationFiles,{<span class="string">''</span>});
0877     <span class="comment">% there are three possibilities: 0, 1 and more than 1 calib. files</span>
0878     calibrationFiles(ind) = [];
0879     <span class="keyword">if</span> isempty(calibrationFiles)
0880         cnames = {subdirs.name};
0881         cnames(indx) = [];
0882         [indc,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Calibration File:'</span>,<span class="keyword">...</span>
0883             <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0884             <span class="string">'ListString'</span>,cnames);
0885         <span class="keyword">if</span> ~isempty(indc)
0886             calibrationFiles = cnames{indc};
0887         <span class="keyword">else</span>
0888             calibrationFiles = <span class="string">''</span>;
0889         <span class="keyword">end</span>        
0890     <span class="keyword">else</span>
0891         <span class="comment">% if there are more than one let the user select the correct one</span>
0892         <span class="keyword">if</span> numel(calibrationFiles) &gt; 1
0893             [ind,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Calibration File:'</span>,<span class="keyword">...</span>
0894                 <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0895                 <span class="string">'ListString'</span>,calibrationFiles);
0896             calibrationFiles = calibrationFiles{ind};
0897         <span class="keyword">else</span>
0898             calibrationFiles = calibrationFiles{1};
0899         <span class="keyword">end</span>
0900     <span class="keyword">end</span>
0901     <span class="keyword">if</span> ~isempty(calibrationFiles)
0902         ind = strfind(calibrationFiles,filesep);
0903         <span class="keyword">if</span> ~isempty(ind)
0904             calibrationFiles = calibrationFiles(ind(end)+1:end);
0905         <span class="keyword">end</span>
0906         fileInList = ismember(fnames,{calibrationFiles});
0907         <span class="keyword">if</span> any(fileInList)
0908             calibrationpath = fullfile(data.import.path,fnames{fileInList});
0909         <span class="keyword">end</span>
0910     <span class="keyword">else</span>
0911         calibrationpath = <span class="string">''</span>;
0912         calibrationFiles = <span class="string">''</span>;
0913     <span class="keyword">end</span>
0914     
0915     <span class="keyword">if</span> ~isempty(calibrationpath)
0916         [SampleParameterC] = <a href="#_sub13" class="code" title="subfunction data = loadGUIParameters(datapath,fname)">loadGUIParameters</a>(calibrationpath,<span class="string">'SampleParameters.par'</span>);
0917         <span class="keyword">if</span> isfield(SampleParameterC,<span class="string">'sampleVolume'</span>)
0918             calibVol = SampleParameterC.sampleVolume;
0919         <span class="keyword">else</span>
0920             calibVol = 1;
0921         <span class="keyword">end</span>
0922         
0923         <span class="comment">% 2a) background file #2</span>
0924         backgroundFile2 = SampleParameterC.backgroundFile;
0925         <span class="keyword">if</span> isempty(backgroundFile2)
0926             bnames = {subdirs.name};
0927             bnames(indx) = [];
0928             [indb,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Background File for Calibration:'</span>,<span class="keyword">...</span>
0929                 <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0930                 <span class="string">'ListString'</span>,bnames);
0931             <span class="keyword">if</span> ~isempty(indb)
0932                 backgroundFile2 = bnames{indb};
0933             <span class="keyword">else</span>
0934                 backgroundFile2 = <span class="string">''</span>;
0935             <span class="keyword">end</span>  
0936         <span class="keyword">end</span>
0937         <span class="keyword">if</span> ~isempty(backgroundFile2)
0938             ind = strfind(backgroundFile2,filesep);
0939             <span class="keyword">if</span> ~isempty(ind)
0940                 backgroundFile2 = backgroundFile2(ind(end)+1:end);
0941             <span class="keyword">end</span>
0942             fileInList = ismember(fnames,{backgroundFile2});
0943             <span class="keyword">if</span> any(fileInList)
0944                 backgroundpath2 = fullfile(data.import.path,fnames{fileInList});
0945             <span class="keyword">end</span>
0946         <span class="keyword">else</span>
0947             backgroundpath2 = <span class="string">''</span>;
0948             backgroundFile2 = <span class="string">''</span>;
0949         <span class="keyword">end</span>
0950     <span class="keyword">else</span>
0951         calibVol = 1;
0952         backgroundpath2 = <span class="string">''</span>;
0953         backgroundFile2 = <span class="string">''</span>;
0954     <span class="keyword">end</span>
0955     
0956     <span class="comment">% 3) now load the data</span>
0957     workpaths = {datapath,calibrationpath,backgroundpath1,backgroundpath2};
0958     workfiles = {fnames{indx},[calibrationFiles,<span class="string">' - calibration'</span>],<span class="keyword">...</span>
0959         [backgroundFile1,<span class="string">' - backgroundS'</span>],[backgroundFile2,<span class="string">' - backgroundC'</span>]};
0960     out = cell(size(workpaths));
0961     count = 0;
0962     keep = false(size(workpaths));
0963     <span class="keyword">for</span> i = 1:numel(workpaths)
0964         <span class="keyword">if</span> ~isempty(workpaths{i})
0965             workdirs = dir(workpaths{i});
0966             workdirs = workdirs(~ismember({workdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0967             isT2 = ismember({workdirs.name},{<span class="string">'T2CPMG'</span>});
0968             <span class="keyword">if</span> any(isT2)
0969                 keep(i) = true;
0970                 count = count + 1;
0971                 T2path = fullfile(workdirs(isT2).folder,workdirs(isT2).name);
0972                 in.path = T2path;
0973                 in.fileformat = data.import.fileformat;
0974                 out{i} = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0975             <span class="keyword">end</span>
0976         <span class="keyword">end</span>
0977     <span class="keyword">end</span>    
0978     
0979     <span class="keyword">if</span> isempty(backgroundpath1)
0980         ref1 = struct;
0981     <span class="keyword">else</span>
0982         background1 = out{3};
0983         <span class="comment">% get the background data 1</span>
0984         ref1.t = background1.nmrData{1}.time;
0985         ref1.s = background1.nmrData{1}.signal;
0986         [ref1.s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(ref1.s);
0987     <span class="keyword">end</span>
0988     
0989     <span class="keyword">if</span> isempty(backgroundpath2)
0990         ref2 = struct;
0991     <span class="keyword">else</span>
0992         background2 = out{4};
0993         <span class="comment">% get the background data 2</span>
0994         ref2.t = background2.nmrData{1}.time;
0995         ref2.s = background2.nmrData{1}.signal;
0996         [ref2.s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(ref2.s);
0997     <span class="keyword">end</span>
0998     
0999     workpaths = workpaths(keep);
1000     workfiles = workfiles(keep);
1001     out = out(keep);
1002     
1003     ffnames = struct;
1004     <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1005     <span class="comment">% will be shown in the listbox</span>
1006     shownames = cell(1,1);
1007     
1008     <span class="keyword">for</span> i = 1:count
1009         ffnames(i).parfile = <span class="string">'acqu.par'</span>;
1010         ffnames(i).datafile = workfiles{i};
1011         ffnames(i).T2specfile = <span class="string">''</span>;
1012         
1013         shownames{i} = ffnames(i).datafile;
1014         
1015         <span class="comment">% the NMR data</span>
1016         <span class="comment">% here we fix the time scale to [s] if neccessary</span>
1017         TE = out{i}.parData.echoTime; <span class="comment">% [s]</span>
1018         <span class="keyword">if</span> out{i}.nmrData{1}.time(1)== TE/1e3
1019             <span class="comment">% change [ms] to [s]</span>
1020             out{i}.nmrData{1}.time = out{i}.nmrData{1}.time/1e3;
1021             out{i}.nmrData{1}.raw.time = out{i}.nmrData{1}.raw.time/1e3;
1022         <span class="keyword">elseif</span> out{i}.nmrData{1}.time(1)== TE
1023             <span class="comment">% change [s] to [s] -&gt; very unlikely</span>
1024             out{i}.nmrData{1}.time = out{i}.nmrData{1}.time/1e6;
1025         out{i}.nmrData{1}.raw.time = out{i}.nmrData{1}.raw.time/1e6;
1026         <span class="keyword">end</span>
1027         
1028         data.import.NMR.data{i} = out{i}.nmrData{1};
1029         data.import.NMR.para{i} = out{i}.parData;
1030         data.import.NMR.para{i}.SampleParameter = SampleParameter;
1031         
1032         <span class="comment">% subtract the background signal</span>
1033         s = data.import.NMR.data{i}.signal;
1034         <span class="keyword">if</span> i==1 &amp;&amp; isfield(ref1,<span class="string">'s'</span>)
1035             <span class="comment">% if the background signal is longer than the signal cut it, if</span>
1036             <span class="comment">% not extend it with zeros</span>
1037             <span class="keyword">if</span> numel(ref1.s) &gt; numel(s)
1038                 tmp_r = ref1.s(1:numel(s));
1039             <span class="keyword">else</span>
1040                 tmp_r = zeros(size(s));
1041                 tmp_r(1:numel(ref1.s)) = ref1.s;
1042             <span class="keyword">end</span>
1043             s = complex(real(s)-real(tmp_r),imag(s)-imag(tmp_r));
1044         <span class="keyword">elseif</span> i==2 &amp;&amp; isfield(ref2,<span class="string">'s'</span>)
1045             <span class="comment">% if the background signal is longer than the signal cut it, if</span>
1046             <span class="comment">% not extend it with zeros</span>
1047             <span class="keyword">if</span> numel(ref2.s) &gt; numel(s)
1048                 tmp_r = ref2.s(1:numel(s));
1049             <span class="keyword">else</span>
1050                 tmp_r = zeros(size(s));
1051                 tmp_r(1:numel(ref2.s)) = ref2.s;
1052             <span class="keyword">end</span>
1053             s = complex(real(s)-real(tmp_r),imag(s)-imag(tmp_r));
1054         <span class="keyword">end</span>        
1055         data.import.NMR.data{i}.signal = s;
1056         data.import.NMR.data{i}.raw.signal = s;
1057         
1058         <span class="keyword">if</span> ~isempty(strfind(workfiles{i},<span class="string">' - background'</span>))
1059             data.import.LIAG.sampleVol(i) = backVol;
1060         <span class="keyword">elseif</span> ~isempty(strfind(workfiles{i},<span class="string">' - calibration'</span>))
1061             data.import.LIAG.sampleVol(i) = calibVol;
1062         <span class="keyword">elseif</span> isempty(strfind(workfiles{i},<span class="string">' - background'</span>)) &amp;&amp;<span class="keyword">...</span>
1063                 isempty(strfind(workfiles{i},<span class="string">' - calibration'</span>))
1064             data.import.LIAG.sampleVol(i) = dataVol;
1065         <span class="keyword">end</span>
1066     <span class="keyword">end</span>
1067     data.import.LIAG.Tbulk = 1e6;
1068     data.import.LIAG.workpaths = workpaths;
1069     data.import.LIAG.datapath = datapath;
1070     data.import.LIAG.calibrationpath = calibrationpath;
1071     data.import.LIAG.backgroundpath1 = backgroundpath1;
1072     data.import.LIAG.backgroundpath2 = backgroundpath2;
1073     
1074     <span class="comment">% update the global data structure</span>
1075     data.import.NMR.files = ffnames;
1076     data.import.NMR.filesShort = shownames;
1077     
1078 <span class="keyword">end</span>
1079 
1080 <span class="keyword">end</span>
1081 
1082 <span class="comment">%%</span>
1083 <a name="_sub11" href="#_subfunctions" class="code">function [data,gui] = importDataMouse(data,gui)</a>
1084 
1085 in.path = fullfile(data.import.path);
1086 in.fileformat = data.import.fileformat;
1087 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1088 
1089 fnames = struct;
1090 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1091 <span class="comment">% will be shown in the listbox</span>
1092 shownames = cell(1,1);
1093 
1094 c = 0;
1095 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
1096     <span class="comment">% the individual file names</span>
1097     c = c + 1;
1098     fnames(c).parfile = <span class="string">'acq.par'</span>;
1099     fnames(c).datafile = out.nmrData{j}.datfile;
1100     fnames(c).T2specfile = <span class="string">''</span>;
1101     
1102     shownames{c} = [<span class="string">'T2_'</span>,fnames(c).datafile];
1103     
1104     <span class="comment">% the NMR data</span>
1105     <span class="comment">% here we fix the time scale from [ms] to [s]</span>
1106     <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
1107         out.nmrData{j}.time = out.nmrData{j}.time/1000;
1108         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
1109     <span class="keyword">end</span>
1110     data.import.NMR.data{c} = out.nmrData{j};
1111     data.import.NMR.para{c} = out.parData;
1112 <span class="keyword">end</span>
1113 
1114 <span class="comment">% update the global data structure</span>
1115 data.import.NMR.files = fnames;
1116 data.import.NMR.filesShort = shownames;
1117 
1118 <span class="keyword">end</span>
1119 
1120 <span class="comment">%%</span>
1121 <a name="_sub12" href="#_subfunctions" class="code">function [data,gui] = importDataIBAC(data,gui)</a>
1122 
1123 in.path = fullfile(data.import.path);
1124 in.name = data.import.file;
1125 in.fileformat = data.import.fileformat;
1126 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1127 
1128 nslices = out.parData.depths;
1129 nfiles = size(out.nmrData,2);
1130 
1131 fnames = struct;
1132 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1133 <span class="comment">% will be shown in the listbox</span>
1134 shownames = cell(1,1);
1135 
1136 c = 0;
1137 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
1138     <span class="comment">% the individual file names</span>
1139     c = c + 1;
1140     fnames(c).parfile = out.parData.parfile;
1141     fnames(c).datafile = out.nmrData{j}.datfile;
1142     fnames(c).T2specfile = <span class="string">''</span>;
1143     
1144     shownames{c} = [fnames(c).datafile];
1145 
1146     data.import.NMR.data{c} = out.nmrData{j};
1147     data.import.NMR.para{c} = out.parData;
1148 <span class="keyword">end</span>
1149 
1150 <span class="comment">% check if the number of depth levels is equal to the number of</span>
1151 <span class="comment">% measurements</span>
1152 <span class="keyword">if</span> nslices == nfiles
1153     <span class="comment">% create z-vector</span>
1154     p = out.parData;
1155     zslice = linspace(p.initialdepth,p.finaldepth,p.depths)';
1156     data.import.IBAC.use_z = true;
1157     data.import.IBAC.zslice = zslice;
1158     <span class="keyword">if</span> numel(zslice) &gt; 1
1159         c = 0;
1160         <span class="keyword">for</span> i = 1:nfiles
1161             c = c + 1;
1162             tmp = shownames{i};
1163             shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%05d'</span>,zslice(c))];
1164         <span class="keyword">end</span>
1165     <span class="keyword">end</span>
1166 <span class="keyword">else</span>
1167     data.import.IBAC.use_z = false;
1168     data.import.IBAC.zslice = 1:1:max([nfiles 1]);
1169 <span class="keyword">end</span>
1170 
1171 <span class="comment">% update the global data structure</span>
1172 data.import.NMR.files = fnames;
1173 data.import.NMR.filesShort = shownames;
1174 
1175 <span class="keyword">end</span>
1176 
1177 <span class="comment">%%</span>
1178 <a name="_sub13" href="#_subfunctions" class="code">function data = loadGUIParameters(datapath,fname)</a>
1179 fid = fopen(fullfile(datapath,fname));
1180 d = textscan(fid,<span class="string">'%s'</span>,<span class="string">'Delimiter'</span>,<span class="string">'\n'</span>);
1181 fclose(fid);
1182 data = struct;
1183 <span class="keyword">for</span> i = 1:size(d{1},1)
1184     str = char(d{1}(i));
1185     str = <a href="../../../nucleus/functions/import/fixParameterString.html" class="code" title="function str = fixParameterString(str)">fixParameterString</a>(str);
1186     eval([<span class="string">'data.'</span>,str,<span class="string">';'</span>]);
1187 <span class="keyword">end</span>
1188 
1189 <span class="keyword">end</span>
1190 
1191 <span class="comment">%%</span>
1192 <a name="_sub14" href="#_subfunctions" class="code">function data = loadGUIrawdata(data,NMRpath,NMRfile)</a>
1193 
1194 load(fullfile(NMRpath,<span class="string">'NUCLEUSinv_raw.mat'</span>),<span class="string">'savedata'</span>);
1195 
1196 data.import.file = NMRfile;
1197 data.import.path = NMRpath;
1198 data.import.NMR = savedata;
1199 
1200 <span class="keyword">end</span>
1201 
1202 <span class="comment">%------------- END OF CODE --------------</span>
1203 
1204 <span class="comment">%% License:</span>
1205 <span class="comment">% MIT License</span>
1206 <span class="comment">%</span>
1207 <span class="comment">% Copyright (c) 2018 Thomas Hiller</span>
1208 <span class="comment">%</span>
1209 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
1210 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
1211 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
1212 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
1213 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
1214 <span class="comment">% furnished to do so, subject to the following conditions:</span>
1215 <span class="comment">%</span>
1216 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
1217 <span class="comment">% copies or substantial portions of the Software.</span>
1218 <span class="comment">%</span>
1219 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
1220 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
1221 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
1222 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
1223 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
1224 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
1225 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>