<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of importNMRdata</title>
  <meta name="keywords" content="importNMRdata">
  <meta name="description" content=" is the general import routine for NMR data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- menu.html interface -->
<h1>importNMRdata
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> is the general import routine for NMR data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function importNMRdata(src) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">importNMRdata is the general import routine for NMR data

 Syntax:
       importNMRdata(src)

 Inputs:
       src - handle of the calling menu

 Outputs:
       none

 Example:
       importNMRdata(src)

 Other m-files required:
       cleanupGUIData
       clearAllAxes
       displayStatusText
       enableGUIelements('NMR');
       LoadNMRData_driver
       NUCLEUSinv_updateInterface

 Subfunctions:
       getNMRPathFile
       importDataBGR
       importDataBGRmat
       importDataDart
       importDataGeneral
       importDataLIAG
       importDataLIAGproject
       importDataMouse
       importDataHelios 
       loadGUIParameters
       loadGUIrawdata

 MAT-files required:
       none

 See also: NUCLEUSinv, NUCLEUSmod
 Author: see AUTHORS.md
 email: see AUTHORS.md
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/NUCLEUSinv/NUCLEUSinv_updateInterface.html" class="code" title="function NUCLEUSinv_updateInterface">NUCLEUSinv_updateInterface</a>	 updates all GUI elements</li><li><a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>	 loads NMR raw data from different file formats</li><li><a href="../../../nucleus/functions/import/fixParameterString.html" class="code" title="function str = fixParameterString(str)">fixParameterString</a>	 cleans parameter file lines when the properties have a</li><li><a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>	 rotateT2phase rotates the complex NMR T2 signal so that the imaginary</li><li><a href="cleanupGUIData.html" class="code" title="function data = cleanupGUIData(data)">cleanupGUIData</a>	 removes unnecessary fields from the global "data" struct</li><li><a href="clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>	 clears all axes of a given figure</li><li><a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>	 shows status information either in the GUI or on the</li><li><a href="enableGUIelements.html" class="code" title="function enableGUIelements(importtype)">enableGUIelements</a>	 activates all necessary GUI elements after successful</li><li><a href="makeINIfile.html" class="code" title="function gui = makeINIfile(gui,method)">makeINIfile</a>	 creates or updates the ini-File</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/callbacks/menus/onMenuImport.html" class="code" title="function onMenuImport(src,~)">onMenuImport</a>	 handles the import menu entries</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [NMRpath,NMRfile] = getNMRPathFile(label,import)</a></li><li><a href="#_sub2" class="code">function [data,gui] = importDataMouseCPMG(data,gui)</a></li><li><a href="#_sub3" class="code">function [data,gui] = importDataBGRmat(data,gui)</a></li><li><a href="#_sub4" class="code">function [data,gui] = importDataBGRliftSingle(data,gui)</a></li><li><a href="#_sub5" class="code">function [data,gui] = importDataBGRlift(data,gui)</a></li><li><a href="#_sub6" class="code">function [data,gui] = importDataHeliosCPMG(data,gui)</a></li><li><a href="#_sub7" class="code">function [data,gui] = importDataHeliosSeries(data,gui)</a></li><li><a href="#_sub8" class="code">function [data,gui] = importDataDart(data,gui)</a></li><li><a href="#_sub9" class="code">function [data,gui] = importDataGeneral(data,gui)</a></li><li><a href="#_sub10" class="code">function [data,gui] = importDataLIAG(data,gui)</a></li><li><a href="#_sub11" class="code">function [data,gui] = importDataLIAGcore(data,gui)</a></li><li><a href="#_sub12" class="code">function [data,gui] = importDataLIAGproject(data,gui)</a></li><li><a href="#_sub13" class="code">function [data,gui] = importDataMouse(data,gui)</a></li><li><a href="#_sub14" class="code">function [data,gui] = importDataIBAC(data,gui)</a></li><li><a href="#_sub15" class="code">function data = loadGUIParameters(datapath,fname)</a></li><li><a href="#_sub16" class="code">function data = loadGUIrawdata(data,NMRpath,NMRfile)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function importNMRdata(src)</a>
0002 <span class="comment">%importNMRdata is the general import routine for NMR data</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       importNMRdata(src)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       src - handle of the calling menu</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Outputs:</span>
0011 <span class="comment">%       none</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Example:</span>
0014 <span class="comment">%       importNMRdata(src)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Other m-files required:</span>
0017 <span class="comment">%       cleanupGUIData</span>
0018 <span class="comment">%       clearAllAxes</span>
0019 <span class="comment">%       displayStatusText</span>
0020 <span class="comment">%       enableGUIelements('NMR');</span>
0021 <span class="comment">%       LoadNMRData_driver</span>
0022 <span class="comment">%       NUCLEUSinv_updateInterface</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% Subfunctions:</span>
0025 <span class="comment">%       getNMRPathFile</span>
0026 <span class="comment">%       importDataBGR</span>
0027 <span class="comment">%       importDataBGRmat</span>
0028 <span class="comment">%       importDataDart</span>
0029 <span class="comment">%       importDataGeneral</span>
0030 <span class="comment">%       importDataLIAG</span>
0031 <span class="comment">%       importDataLIAGproject</span>
0032 <span class="comment">%       importDataMouse</span>
0033 <span class="comment">%       importDataHelios</span>
0034 <span class="comment">%       loadGUIParameters</span>
0035 <span class="comment">%       loadGUIrawdata</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% MAT-files required:</span>
0038 <span class="comment">%       none</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% See also: NUCLEUSinv, NUCLEUSmod</span>
0041 <span class="comment">% Author: see AUTHORS.md</span>
0042 <span class="comment">% email: see AUTHORS.md</span>
0043 <span class="comment">% License: MIT License (at end)</span>
0044 
0045 <span class="comment">%------------- BEGIN CODE --------------</span>
0046 
0047 <span class="comment">%% get GUI handle and data</span>
0048 fig = findobj(<span class="string">'Tag'</span>,<span class="string">'INV'</span>);
0049 gui = getappdata(fig,<span class="string">'gui'</span>);
0050 data = getappdata(fig,<span class="string">'data'</span>);
0051 
0052 <span class="comment">% try is used to catch any import error</span>
0053 <span class="comment">% often the wrong input file format is the case</span>
0054 <span class="keyword">try</span>
0055     <span class="comment">% check what import format is chosen</span>
0056     label = get(src,<span class="string">'Label'</span>);
0057     
0058     <span class="comment">% set file format for later use</span>
0059     <span class="keyword">if</span> strcmp(label,<span class="string">'BAM TOM'</span>)
0060         data.import.fileformat = <span class="string">'bamtom'</span>;
0061     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BGR mat'</span>)
0062         data.import.fileformat = <span class="string">'bgrmat'</span>;
0063     <span class="keyword">elseif</span> strcmp(label,<span class="string">'BGR std'</span>)
0064         data.import.fileformat = <span class="string">'bgr'</span>;
0065     <span class="keyword">elseif</span> strcmp(label,<span class="string">'CoreLab ascii'</span>)
0066         data.import.fileformat = <span class="string">'corelab'</span>;
0067     <span class="keyword">elseif</span> strcmp(label,<span class="string">'DART'</span>)
0068         data.import.fileformat = <span class="string">'dart'</span>;    
0069     <span class="keyword">elseif</span> strcmp(label,<span class="string">'GGE ascii'</span>)
0070         data.import.fileformat = <span class="string">'rwth'</span>;
0071     <span class="keyword">elseif</span> strcmp(label,<span class="string">'GGE field'</span>)
0072         data.import.fileformat = <span class="string">'field'</span>;
0073     <span class="keyword">elseif</span> strcmp(label,<span class="string">'GGE Dart'</span>)
0074         data.import.fileformat = <span class="string">'dart'</span>;
0075     <span class="keyword">elseif</span> strcmp(label,<span class="string">'HeliosCPMG'</span>)
0076         data.import.fileformat = <span class="string">'heliosCPMG'</span>;
0077     <span class="keyword">elseif</span> strcmp(label,<span class="string">'HeliosSeries'</span>)
0078         data.import.fileformat = <span class="string">'heliosSeries'</span>;    
0079     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG core'</span>)
0080         data.import.fileformat = <span class="string">'liag'</span>;
0081     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG from project'</span>)
0082         data.import.fileformat = <span class="string">'liag'</span>;
0083     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG last project'</span>)
0084         data.import.fileformat = <span class="string">'liag'</span>;
0085     <span class="keyword">elseif</span> strcmp(label,<span class="string">'LIAG single'</span>)
0086         data.import.fileformat = <span class="string">'liag'</span>;
0087     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MOUSE'</span>)
0088         data.import.fileformat = <span class="string">'mouse'</span>;
0089     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseCPMG'</span>)
0090         data.import.fileformat = <span class="string">'MouseCPMG'</span>;
0091     <span class="keyword">elseif</span> strcmp(label,<span class="string">'MouseLift'</span>)
0092         data.import.fileformat = <span class="string">'MouseLift'</span>;
0093     <span class="keyword">elseif</span> strcmp(label,<span class="string">'PM5'</span>)
0094         data.import.fileformat = <span class="string">'pm5'</span>;
0095     <span class="keyword">elseif</span> strcmp(label,<span class="string">'PM25'</span>)
0096         data.import.fileformat = <span class="string">'pm25'</span>;
0097     <span class="keyword">else</span>
0098         helpdlg(<span class="string">'Something is utterly wrong.'</span>,<span class="string">'onMenuImport: Choose again.'</span>);
0099     <span class="keyword">end</span>
0100     
0101     <span class="comment">% remove info field if any</span>
0102     ih = findobj(<span class="string">'Tag'</span>,<span class="string">'inv_info'</span>);
0103     <span class="keyword">if</span> ~isempty(ih); delete(ih); <span class="keyword">end</span>
0104     
0105     <span class="comment">% depending on the import format get the corresponding path / file</span>
0106     [NMRpath,NMRfile] = <a href="#_sub1" class="code" title="subfunction [NMRpath,NMRfile] = getNMRPathFile(label,import)">getNMRPathFile</a>(label,data.import);
0107     
0108     <span class="comment">% only continue if user didn't cancel</span>
0109     <span class="keyword">if</span> sum([NMRpath NMRfile]) &gt; 0
0110         <span class="comment">%  remove old fields and data</span>
0111         data = <a href="cleanupGUIData.html" class="code" title="function data = cleanupGUIData(data)">cleanupGUIData</a>(data);
0112         
0113         <span class="comment">% check for mat-file with GUI rawdata and import data</span>
0114         isfile = dir(fullfile(NMRpath,<span class="string">'NUCLEUSinv_raw.mat'</span>));
0115         
0116         <span class="comment">% if there is no raw-file import from folder/file</span>
0117         <span class="keyword">if</span> isempty(isfile)
0118             <span class="comment">% import data</span>
0119             data.import.path = NMRpath;
0120             data.import.file = -1;
0121             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Reading NMR Data ...'</span>);
0122             <span class="comment">% call the corresponding subroutines</span>
0123             <span class="keyword">switch</span> label
0124                 <span class="keyword">case</span> {<span class="string">'BAM TOM'</span>,<span class="string">'BGR std'</span>,<span class="string">'CoreLab ascii'</span>,<span class="string">'GGE ascii'</span>,<span class="keyword">...</span>
0125                         <span class="string">'GGE field'</span>}
0126                     [data,gui] = <a href="#_sub9" class="code" title="subfunction [data,gui] = importDataGeneral(data,gui)">importDataGeneral</a>(data,gui);
0127                 <span class="keyword">case</span> <span class="string">'GGE Dart'</span>
0128                     data.import.file = NMRfile;
0129                     <span class="comment">% the data in the example folder is an older type</span>
0130                     <span class="keyword">if</span> contains(NMRpath,<span class="string">'nucleus\example_data\dart'</span>)
0131                         data.import.version = 1;
0132                     <span class="keyword">else</span>
0133                         data.import.version = 2;
0134                     <span class="keyword">end</span>
0135                     [data,gui] = <a href="#_sub8" class="code" title="subfunction [data,gui] = importDataDart(data,gui)">importDataDart</a>(data,gui);
0136                 <span class="keyword">case</span> <span class="string">'DART'</span>
0137                     data.import.file = NMRfile;
0138                     data.import.version = 3;
0139                     [data,gui] = <a href="#_sub8" class="code" title="subfunction [data,gui] = importDataDart(data,gui)">importDataDart</a>(data,gui);    
0140                 <span class="keyword">case</span> <span class="string">'MOUSE'</span>
0141                     [data,gui] = <a href="#_sub13" class="code" title="subfunction [data,gui] = importDataMouse(data,gui)">importDataMouse</a>(data,gui);
0142                 <span class="keyword">case</span> <span class="string">'LIAG single'</span>
0143                     [data,gui] = <a href="#_sub10" class="code" title="subfunction [data,gui] = importDataLIAG(data,gui)">importDataLIAG</a>(data,gui);
0144                 <span class="keyword">case</span> <span class="string">'LIAG core'</span>
0145                     [data,gui] = <a href="#_sub11" class="code" title="subfunction [data,gui] = importDataLIAGcore(data,gui)">importDataLIAGcore</a>(data,gui);    
0146                 <span class="keyword">case</span> {<span class="string">'LIAG from project'</span>,<span class="string">'LIAG last project'</span>}
0147                     [data,gui] = <a href="#_sub12" class="code" title="subfunction [data,gui] = importDataLIAGproject(data,gui)">importDataLIAGproject</a>(data,gui);
0148                     <span class="comment">% make the Petro Panel visible as default</span>
0149                     tmp_h = gui.myui.heights(2,:);
0150                     tmp_h(3) = gui.myui.heights(2,3);
0151                     <span class="comment">% but the CPS panel stays minimized</span>
0152                     tmp_h(5) = gui.myui.heights(1,3);
0153                     set(gui.panels.main,<span class="string">'Heights'</span>,tmp_h);
0154                     set(gui.panels.petro.main,<span class="string">'Minimized'</span>,false);
0155                 <span class="keyword">case</span> <span class="string">'BGR mat'</span>
0156                     data.import.file = NMRfile;
0157                     [data,gui] = <a href="#_sub3" class="code" title="subfunction [data,gui] = importDataBGRmat(data,gui)">importDataBGRmat</a>(data,gui);
0158                 <span class="keyword">case</span> <span class="string">'MouseCPMG'</span>
0159                     [data,gui] = <a href="#_sub2" class="code" title="subfunction [data,gui] = importDataMouseCPMG(data,gui)">importDataMouseCPMG</a>(data,gui);
0160                 <span class="keyword">case</span> <span class="string">'MouseLift'</span>
0161                     [data,gui] = <a href="#_sub5" class="code" title="subfunction [data,gui] = importDataBGRlift(data,gui)">importDataBGRlift</a>(data,gui);
0162                 <span class="keyword">case</span> <span class="string">'HeliosCPMG'</span>
0163                     data.import.file = NMRfile;
0164                     [data,gui] = <a href="#_sub6" class="code" title="subfunction [data,gui] = importDataHeliosCPMG(data,gui)">importDataHeliosCPMG</a>(data,gui);
0165                 <span class="keyword">case</span> <span class="string">'HeliosSeries'</span>
0166                     data.import.file = NMRfile;
0167                     [data,gui] = <a href="#_sub7" class="code" title="subfunction [data,gui] = importDataHeliosSeries(data,gui)">importDataHeliosSeries</a>(data,gui);
0168                 <span class="keyword">case</span> {<span class="string">'PM5'</span>,<span class="string">'PM25'</span>}
0169                     data.import.file = NMRfile;
0170                     [data,gui] = <a href="#_sub14" class="code" title="subfunction [data,gui] = importDataIBAC(data,gui)">importDataIBAC</a>(data,gui);
0171             <span class="keyword">end</span>
0172             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Reading NMR Data ... done'</span>);
0173         <span class="keyword">else</span>
0174             <span class="comment">% import from mat-file</span>
0175             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Importing NMR raw data from mat-file ...'</span>);
0176             data = <a href="#_sub16" class="code" title="subfunction data = loadGUIrawdata(data,NMRpath,NMRfile)">loadGUIrawdata</a>(data,NMRpath,NMRfile);
0177             <a href="displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(gui,<span class="string">'Importing NMR raw data from mat-file ... done'</span>);
0178         <span class="keyword">end</span>
0179         
0180         <span class="comment">% update the path info field with &quot;NMRpath&quot; (&quot;NMRfile&quot;)</span>
0181         <span class="keyword">if</span> NMRfile &gt; 0
0182             tmpstr = fullfile(NMRpath,NMRfile);
0183         <span class="keyword">else</span>
0184             tmpstr = NMRpath;
0185         <span class="keyword">end</span>
0186         <span class="keyword">if</span> length(tmpstr)&gt;50
0187             set(gui.text_handles.data_path,<span class="string">'String'</span>,[<span class="string">'...'</span>,tmpstr(end-50:end)],<span class="keyword">...</span>
0188                 <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0189         <span class="keyword">else</span>
0190             set(gui.text_handles.data_path,<span class="string">'String'</span>,tmpstr,<span class="keyword">...</span>
0191                 <span class="string">'HorizontalAlignment'</span>,<span class="string">'left'</span>);
0192         <span class="keyword">end</span>
0193         set(gui.text_handles.data_path,<span class="string">'TooltipString'</span>,tmpstr);
0194         
0195         <span class="comment">% update the ini-file</span>
0196         gui.myui.inidata.importpath = data.import.path;
0197         gui = <a href="makeINIfile.html" class="code" title="function gui = makeINIfile(gui,method)">makeINIfile</a>(gui,<span class="string">'update'</span>);
0198         
0199         <span class="comment">% update the list of file names</span>
0200         set(gui.listbox_handles.signal,<span class="string">'String'</span>,data.import.NMR.filesShort);
0201         set(gui.listbox_handles.signal,<span class="string">'Value'</span>,[],<span class="string">'Max'</span>,2,<span class="string">'Min'</span>,0);
0202         
0203         <span class="comment">% create a global INVdata struct for every file in the list</span>
0204         <span class="keyword">if</span> isstruct(getappdata(fig,<span class="string">'INVdata'</span>))
0205             setappdata(fig,<span class="string">'INVdata'</span>,[]);
0206         <span class="keyword">end</span>
0207         INVdata = cell(length(data.import.NMR.filesShort),1);
0208         setappdata(fig,<span class="string">'INVdata'</span>,INVdata);
0209         
0210         <span class="comment">% clear all axes</span>
0211         <a href="clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(gui.figh);
0212         
0213         <span class="comment">% update GUI data and interface</span>
0214         setappdata(fig,<span class="string">'data'</span>,data);
0215         setappdata(fig,<span class="string">'gui'</span>,gui);
0216         <a href="enableGUIelements.html" class="code" title="function enableGUIelements(importtype)">enableGUIelements</a>(<span class="string">'NMR'</span>);
0217         
0218         <span class="comment">% special treatment of LIAG projects</span>
0219         <span class="keyword">switch</span> label
0220             <span class="keyword">case</span> {<span class="string">'LIAG from project'</span>,<span class="string">'LIAG last project'</span>}
0221                 cpath = data.import.LIAG.calibrationpath;
0222                 <span class="comment">% check if this calibration file was already used</span>
0223                 isfile = dir(fullfile(cpath,<span class="string">'NUCLEUS_calibData.mat'</span>));
0224                 <span class="keyword">if</span> ~isempty(isfile)
0225                     id = 2;
0226                     <span class="comment">% if data is there reuse it</span>
0227                     calib = load(fullfile(cpath,isfile.name),<span class="string">'calib'</span>);
0228                     INVdata{id} = calib.calib;
0229                     data.calib = INVdata{id}.calib;
0230                     data.import.LIAG.Tbulk = INVdata{id}.results.invstd.T2;
0231                     setappdata(fig,<span class="string">'INVdata'</span>,INVdata);
0232                     setappdata(fig,<span class="string">'data'</span>,data);
0233                     <span class="comment">% color the list entry</span>
0234                     strL = get(gui.listbox_handles.signal,<span class="string">'String'</span>);
0235                     str1 = strL{id};
0236                     str2 = [<span class="string">'&lt;HTML&gt;&lt;BODY bgcolor=&quot;rgb('</span>,<span class="keyword">...</span>
0237                         sprintf(<span class="string">'%d,%d,%d'</span>,gui.myui.colors.listINV.*255),<span class="string">')&quot;&gt;'</span>,<span class="keyword">...</span>
0238                         str1,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;'</span>];
0239                     strL{id} = str2;
0240                     set(gui.listbox_handles.signal,<span class="string">'String'</span>,strL);
0241                 <span class="keyword">end</span>
0242             <span class="keyword">otherwise</span>
0243         <span class="keyword">end</span>
0244         <span class="comment">% update GUI interface</span>
0245         <a href="../../../nucleus/NUCLEUSinv/NUCLEUSinv_updateInterface.html" class="code" title="function NUCLEUSinv_updateInterface">NUCLEUSinv_updateInterface</a>;
0246     <span class="keyword">end</span>
0247     
0248 <span class="keyword">catch</span> ME
0249     <span class="comment">% show error message in case import fails</span>
0250     errmsg = {ME.message;[ME.stack(1).name,<span class="string">' Line: '</span>,num2str(ME.stack(1).line)];<span class="keyword">...</span>
0251         <span class="string">'Check File Format settings.'</span>};
0252     errordlg(errmsg,<span class="string">'importNMRdata: Error!'</span>);    
0253 <span class="keyword">end</span>
0254 
0255 <span class="keyword">end</span>
0256 
0257 <span class="comment">%%</span>
0258 <a name="_sub1" href="#_subfunctions" class="code">function [NMRpath,NMRfile] = getNMRPathFile(label,import)</a>
0259 
0260 NMRpath = -1;
0261 NMRfile = -1;
0262 <span class="comment">% for almost all import cases we load a folder ... but not for all</span>
0263 <span class="keyword">switch</span> label
0264     <span class="keyword">case</span> {<span class="string">'BAM TOM'</span>,<span class="string">'BGR std'</span>,<span class="string">'CoreLab ascii'</span>,<span class="string">'GGE ascii'</span>,<span class="string">'GGE field'</span>,<span class="keyword">...</span>
0265             <span class="string">'HeliosCPMG'</span>,<span class="string">'HeliosSeries'</span>,<span class="string">'LIAG core'</span>,<span class="string">'LIAG single'</span>,<span class="keyword">...</span>
0266             <span class="string">'MOUSE'</span>,<span class="string">'MouseCPMG'</span>,<span class="string">'MouseLift'</span>,<span class="string">'PM25'</span>}
0267         <span class="comment">% if there is already a data folder present we start from here</span>
0268         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0269             NMRpath = uigetdir(import.path,<span class="string">'Choose Data Path'</span>);
0270         <span class="keyword">else</span>
0271             <span class="comment">% otherwise we start at the current working dircetory</span>
0272             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0273             here = mfilename(<span class="string">'fullpath'</span>);
0274             [pathstr,~,~] = fileparts(here);
0275             NMRpath = uigetdir(pathstr,<span class="string">'Choose Data Path'</span>);
0276         <span class="keyword">end</span>
0277     <span class="keyword">case</span> <span class="string">'LIAG from project'</span>
0278         <span class="comment">% if there is already a data folder present we start from here</span>
0279         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0280             NMRpath = uigetdir(import.path,<span class="string">'Choose Project Path'</span>);
0281         <span class="keyword">else</span>
0282             <span class="comment">% otherwise we start at the current working dircetory</span>
0283             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0284             here = mfilename(<span class="string">'fullpath'</span>);
0285             [pathstr,~,~] = fileparts(here);
0286             NMRpath = uigetdir(pathstr,<span class="string">'Choose Project Path'</span>);
0287         <span class="keyword">end</span>
0288     <span class="keyword">case</span> <span class="string">'LIAG last project'</span>
0289         <span class="comment">% there is already a data folder and we use this one</span>
0290         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0291             NMRpath = import.path;
0292         <span class="keyword">else</span>
0293             <span class="comment">% otherwise we start at the current working dircetory</span>
0294             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0295             here = mfilename(<span class="string">'fullpath'</span>);
0296             [pathstr,~,~] = fileparts(here);
0297             NMRpath = uigetdir(pathstr,<span class="string">'Choose Project Path'</span>);
0298         <span class="keyword">end</span>
0299     <span class="keyword">case</span> {<span class="string">'GGE Dart'</span>,<span class="string">'DART'</span>,<span class="string">'BGR mat'</span>,<span class="string">'NMR mat'</span>}
0300         <span class="comment">% if there is already a data folder present we start from here</span>
0301         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0302             [NMRfile,NMRpath] = uigetfile(import.path,<span class="string">'Choose Data file'</span>);
0303         <span class="keyword">else</span>
0304             <span class="comment">% otherwise we start at the current working dircetory</span>
0305             <span class="comment">% 'foldername' hold s the name of the choosen data path</span>
0306             here = mfilename(<span class="string">'fullpath'</span>);
0307             [pathstr,~,~] = fileparts(here);
0308             [NMRfile,NMRpath] = uigetfile(pathstr,<span class="string">'Choose Data file'</span>);
0309         <span class="keyword">end</span>
0310     <span class="keyword">case</span> <span class="string">'PM5'</span>
0311         <span class="comment">% if there is already a data folder present we start from here</span>
0312         <span class="keyword">if</span> isfield(import,<span class="string">'path'</span>)
0313             NMRpath = uigetdir(import.path,<span class="string">'Choose PM5 Data Path'</span>);
0314         <span class="keyword">else</span>
0315             <span class="comment">% otherwise we start at the current working dircetory</span>
0316             <span class="comment">% 'NMRpath' holds the name of the choosen data path</span>
0317             here = mfilename(<span class="string">'fullpath'</span>);
0318             [pathstr,~,~] = fileparts(here);
0319             NMRpath = uigetdir(pathstr,<span class="string">'Choose PM5 Data Path'</span>);
0320         <span class="keyword">end</span>
0321         
0322         <span class="comment">% check if there are multiple inf-files available</span>
0323         <span class="comment">% if yes -&gt; choose one</span>
0324         inffiles = dir(fullfile(NMRpath,<span class="string">'*.inf'</span>));
0325         <span class="keyword">if</span> numel(inffiles) &gt; 1
0326             [NMRfile,NMRpath] = uigetfile(fullfile(NMRpath,<span class="string">'*.inf'</span>),<span class="keyword">...</span>
0327                 <span class="string">'Choose INF file'</span>);
0328         <span class="keyword">elseif</span> numel(inffiles) == 1
0329             NMRfile = inffiles.name;            
0330         <span class="keyword">end</span>
0331 <span class="keyword">end</span>
0332 
0333 <span class="keyword">end</span>
0334 
0335 <span class="comment">%%</span>
0336 <a name="_sub2" href="#_subfunctions" class="code">function [data,gui] = importDataMouseCPMG(data,gui)</a>
0337 
0338 csv_t2path = dir(fullfile(data.import.path,<span class="string">'CPMG'</span>));
0339 csv_t2path = csv_t2path(~ismember({csv_t2path.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0340 
0341 fnames = struct;
0342 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0343 <span class="comment">% will be shown in the listbox</span>
0344 shownames = cell(1,1);
0345 
0346 c = 0;
0347 <span class="keyword">if</span> ~isempty(csv_t2path)
0348     <span class="keyword">for</span> i = 1:size(csv_t2path,1)
0349         in.T1T2 = <span class="string">'T2'</span>;
0350         in.path = fullfile(data.import.path,<span class="string">'CPMG'</span>,csv_t2path(i).name);
0351         in.fileformat = data.import.fileformat;
0352         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0353         
0354         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0355             <span class="comment">% the individual file names</span>
0356             c = c + 1;
0357             fnames(c).parfile = <span class="string">'acqu.par'</span>;
0358             fnames(c).datafile = out.nmrData{j}.datfile;
0359             fnames(c).T2specfile = <span class="string">''</span>;
0360             
0361             shownames{c} = [<span class="string">'T2_'</span>,csv_t2path(i).name,<span class="string">'_'</span>,fnames(c).datafile];
0362             
0363             <span class="comment">% the NMR data</span>
0364             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0365             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0366                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0367                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0368             <span class="keyword">end</span>
0369             data.import.NMR.data{c} = out.nmrData{j};
0370             data.import.NMR.para{c} = out.parData;
0371         <span class="keyword">end</span>
0372     <span class="keyword">end</span>
0373 <span class="keyword">end</span>
0374 
0375 <span class="keyword">if</span> isempty(csv_t2path)
0376     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0377 <span class="keyword">else</span>
0378     <span class="comment">% update the global data structure</span>
0379     data.import.NMR.files = fnames;
0380     data.import.NMR.filesShort = shownames;
0381 <span class="keyword">end</span>
0382 
0383 <span class="keyword">end</span>
0384 
0385 <span class="comment">%%</span>
0386 <a name="_sub3" href="#_subfunctions" class="code">function [data,gui] = importDataBGRmat(data,gui)</a>
0387 
0388 in.path = fullfile(data.import.path);
0389 in.name = data.import.file;
0390 in.fileformat = data.import.fileformat;
0391 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0392 
0393 fnames = struct;
0394 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0395 <span class="comment">% will be shown in the listbox</span>
0396 shownames = cell(1,1);
0397 
0398 c = 0;
0399 table = {true,0,1,<span class="string">'D'</span>};
0400 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0401     <span class="comment">% the individual file names</span>
0402     c = c + 1;
0403     fnames(c).parfile = <span class="string">''</span>;
0404     fnames(c).datafile = data.import.file;
0405     fnames(c).T2specfile = <span class="string">''</span>;
0406     
0407     shownames{c} = out.parData{j}.file;
0408     
0409     data.import.NMR.data{c} = out.nmrData{j};
0410     data.import.NMR.para{c} = out.parData{j};
0411     
0412     <span class="keyword">if</span> isfield(out,<span class="string">'pressData'</span>)
0413         <span class="comment">% convert hPa to Pa</span>
0414         table{c,1} = true;
0415         table{c,2} = out.pressData.p(j)*1e2;
0416         table{c,3} = out.pressData.S(j);
0417         table{c,4} = <span class="string">'D'</span>;
0418     <span class="keyword">end</span>
0419 <span class="keyword">end</span>
0420 
0421 <span class="comment">% global Tbulk</span>
0422 data.invstd.Tbulk = out.parData{1}.Tbulk;
0423 <span class="comment">% global porosity</span>
0424 data.import.BGR.porosity = out.parData{1}.porosity;
0425 
0426 data.import.NMR.files = fnames;
0427 data.import.NMR.filesShort = shownames;
0428 
0429 <span class="comment">% import pressure / saturation data</span>
0430 <span class="keyword">if</span> isfield(out,<span class="string">'pressData'</span>)
0431     data.pressure.unit = <span class="string">'kPa'</span>;
0432     data.pressure.unitfac = 1e-3;
0433     data.pressure.table = table;
0434 <span class="keyword">end</span>
0435 
0436 <span class="keyword">end</span>
0437 
0438 <span class="comment">%%</span>
0439 <a name="_sub4" href="#_subfunctions" class="code">function [data,gui] = importDataBGRliftSingle(data,gui)</a>
0440 
0441 <span class="comment">% first check whether T1 or T2 was measured...</span>
0442 <span class="comment">% by analyzing the name of data folder</span>
0443 ind = find(data.import.path == filesep);
0444 checkT1T2 = data.import.path(ind(end-1)+1:ind(end)-1);
0445 <span class="keyword">if</span> strcmp(checkT1T2,<span class="string">'t1test'</span>)
0446     in.T1T2 = <span class="string">'T1'</span>;
0447 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'T1auto'</span>)
0448     in.T1T2 = <span class="string">'T1'</span>; 
0449 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastautotest'</span>)
0450     in.T1T2 = <span class="string">'T2'</span>; 
0451 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastauto'</span>)
0452     in.T1T2 = <span class="string">'T2'</span>; 
0453 <span class="keyword">else</span>
0454     disp(<span class="string">'Please chose an original Prospa folder for Mouse Lift data!'</span>);
0455 <span class="keyword">end</span>
0456 
0457 <span class="comment">% % there should be folders with integer values in their names</span>
0458 <span class="comment">% t1t2path = data.import.path;</span>
0459 
0460 fnames = struct;
0461 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0462 <span class="comment">% will be shown in the listbox</span>
0463 shownames = cell(1,1);
0464 
0465 c = 0;
0466 <span class="keyword">if</span> ~isempty(data.import.path)
0467 <span class="comment">%    for i = 1:size(t1t2path,1)</span>
0468         in.path = data.import.path;
0469         in.fileformat = data.import.fileformat;
0470         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0471         
0472         <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0473             <span class="comment">% the individual file names</span>
0474             c = c + 1;
0475             fnames(c).parfile = <span class="string">'acq.par'</span>;
0476             fnames(c).datafile = out.nmrData{j}.datfile;
0477             
0478             shownames{c} = [in.T1T2,<span class="string">'_'</span>,fnames(c).datafile];
0479             
0480             <span class="comment">% the NMR data</span>
0481             <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0482             <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0483                 out.nmrData{j}.time = out.nmrData{j}.time/1000;
0484                 out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0485             <span class="keyword">end</span>
0486             data.import.NMR.data{c} = out.nmrData{j};
0487             data.import.NMR.para{c} = out.parData;
0488         <span class="keyword">end</span>
0489 <span class="keyword">else</span>
0490     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0491 <span class="keyword">end</span>
0492 
0493 <span class="comment">% update the global data structure</span>
0494 data.import.NMR.files = fnames;
0495 data.import.NMR.filesShort = shownames;
0496 
0497 <span class="keyword">end</span>
0498 <span class="comment">%%</span>
0499 <a name="_sub5" href="#_subfunctions" class="code">function [data,gui] = importDataBGRlift(data,gui)</a>
0500 
0501 <span class="comment">% 1) show all folders and ask for sample</span>
0502 subdirs = dir(data.import.path);
0503 <span class="comment">% remove the dot-dirs</span>
0504 subdirs = subdirs(~ismember({subdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0505 
0506 fnames = {subdirs.name};
0507 [indx,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Choose data set:'</span>,<span class="keyword">...</span>
0508     <span class="string">'SelectionMode'</span>,<span class="string">'multiple'</span>,<span class="keyword">...</span>
0509     <span class="string">'ListString'</span>,fnames);
0510 
0511 <span class="comment">% first check whether T1 or T2 was measured</span>
0512 ind = find(data.import.path == filesep);
0513 checkT1T2 = data.import.path(ind(end)+1:end);
0514 <span class="keyword">if</span> strcmp(checkT1T2,<span class="string">'t1test'</span>)
0515     in.T1T2 = <span class="string">'T1'</span>;
0516 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'T1auto'</span>)
0517     in.T1T2 = <span class="string">'T1'</span>; 
0518 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastautotest'</span>)
0519     in.T1T2 = <span class="string">'T2'</span>; 
0520 <span class="keyword">elseif</span> strcmp(checkT1T2,<span class="string">'cpmgfastauto'</span>)
0521     in.T1T2 = <span class="string">'T2'</span>; 
0522 <span class="keyword">else</span>
0523     helpdlg(<span class="string">'No original data folder'</span>,<span class="string">'onMenuImport: No data.'</span>);
0524 <span class="keyword">end</span>
0525 
0526 <span class="comment">% now ask for stacking</span>
0527 answer = questdlg(<span class="string">'Do you want to stack the slices?'</span>);
0528 <span class="keyword">switch</span> answer
0529     <span class="keyword">case</span> <span class="string">'Yes'</span>
0530         doSliceStack = true;
0531         <span class="comment">% if stacking ask for stack-rotate-order</span>
0532         answer = questdlg(<span class="string">'Select stack-rotate-order:'</span>,<span class="keyword">...</span>
0533             <span class="string">'Select order'</span>, <span class="keyword">...</span>
0534             <span class="string">'stack-rotate (default)'</span>,<span class="string">'rotate-stack'</span>,<span class="string">'Cancel'</span>,<span class="string">'stack-rotate (default)'</span>);
0535         <span class="keyword">switch</span> answer
0536             <span class="keyword">case</span> <span class="string">'stack-rotate'</span>
0537                 StackFirst = true;
0538             <span class="keyword">case</span> <span class="string">'rotate-stack'</span>
0539                 StackFirst = false;
0540             <span class="keyword">otherwise</span>
0541                 StackFirst = true;
0542         <span class="keyword">end</span>
0543     <span class="keyword">otherwise</span>
0544         doSliceStack = false;
0545 <span class="keyword">end</span>
0546 
0547 fnames = struct;
0548 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0549 <span class="comment">% will be shown in the listbox</span>
0550 shownames = cell(1,1);
0551 
0552 c = 0;
0553 <span class="keyword">if</span> ~isempty(indx)
0554     <span class="keyword">for</span> i = indx
0555         in.path = fullfile(data.import.path,subdirs(i).name);
0556         in.fileformat = data.import.fileformat;
0557         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0558 
0559         <span class="keyword">if</span> doSliceStack
0560             <span class="comment">% the individual file names</span>
0561             c = c + 1;
0562             fnames(c).parfile = <span class="string">'acq.par'</span>;
0563             fnames(c).datafile = out.nmrData{1}.datfile;
0564 
0565             shownames{c} = [in.T1T2,<span class="string">'_'</span>,subdirs(i).name];
0566 
0567             <span class="comment">% use the meta data from the first slice</span>
0568             <span class="comment">% fix the time scale from [ms] to [s]</span>
0569             <span class="keyword">if</span> max(out.nmrData{1}.time) &gt; 100
0570                 out.nmrData{1}.time = out.nmrData{1}.time/1000;
0571                 out.nmrData{1}.raw.time = out.nmrData{1}.raw.time/1000;
0572             <span class="keyword">end</span>
0573             <span class="comment">% import into GUI data struct</span>
0574             data.import.NMR.data{c} = out.nmrData{1};
0575 
0576             <span class="comment">% stacking</span>
0577             <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0578                 <span class="keyword">if</span> j == 1
0579                     signal = out.nmrData{j}.signal;
0580                 <span class="keyword">else</span>
0581                     signal = signal + out.nmrData{j}.signal;
0582                 <span class="keyword">end</span>
0583             <span class="keyword">end</span>
0584             signal = signal./size(out.nmrData,2);
0585 
0586             <span class="comment">% now rotate after the stacking</span>
0587             <span class="keyword">if</span> StackFirst
0588                 [signal,phase] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(signal);
0589                 data.import.NMR.data{c}.phase = phase;
0590                 data.import.NMR.data{c}.signal = signal;
0591                 data.import.NMR.data{c}.raw.signal = signal;
0592             <span class="keyword">else</span>
0593                 <span class="comment">% no rotation after stacking</span>
0594                 data.import.NMR.data{c}.signal = signal;
0595                 data.import.NMR.data{c}.raw.signal = signal;
0596             <span class="keyword">end</span>
0597             
0598             <span class="comment">% parameter data</span>
0599             data.import.NMR.para{c} = out.parData;
0600         <span class="keyword">else</span>
0601 
0602             <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0603                 <span class="comment">% the individual file names</span>
0604                 c = c + 1;
0605                 fnames(c).parfile = <span class="string">'acq.par'</span>;
0606                 fnames(c).datafile = out.nmrData{j}.datfile;
0607 
0608                 shownames{c} = [in.T1T2,<span class="string">'_'</span>,subdirs(i).name,<span class="string">'_'</span>,fnames(c).datafile];
0609 
0610                 <span class="comment">% the NMR data</span>
0611                 <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0612                 <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0613                     out.nmrData{j}.time = out.nmrData{j}.time/1000;
0614                     out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0615                 <span class="keyword">end</span>
0616                 data.import.NMR.data{c} = out.nmrData{j};
0617                 data.import.NMR.para{c} = out.parData;
0618             <span class="keyword">end</span>
0619         <span class="keyword">end</span>
0620     <span class="keyword">end</span>
0621 <span class="keyword">else</span>
0622     helpdlg(<span class="string">'No data folders in the given directory.'</span>,<span class="string">'onMenuImport: No data.'</span>);
0623 <span class="keyword">end</span>
0624 
0625 <span class="comment">% update the global data structure</span>
0626 data.import.NMR.files = fnames;
0627 data.import.NMR.filesShort = shownames;
0628 
0629 <span class="keyword">end</span>
0630 
0631 <span class="comment">%%</span>
0632 <a name="_sub6" href="#_subfunctions" class="code">function [data,gui] = importDataHeliosCPMG(data,gui)</a>
0633 
0634 <span class="comment">% first check the subpaths</span>
0635 <span class="comment">% there should be some folders with names ...</span>
0636 <span class="comment">% ... similar to the data filenames inside them</span>
0637 datpath = dir(data.import.path);
0638 datpath = datpath(~ismember({datpath.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0639 
0640 fnames = struct;
0641 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0642 <span class="comment">% will be shown in the listbox</span>
0643 shownames = cell(1,1);
0644 
0645 c = 0;
0646 <span class="keyword">if</span> ~isempty(datpath)
0647     <span class="keyword">for</span> i = 1:size(datpath,1)
0648         <span class="comment">% does datpath.name points to a folder?</span>
0649         <span class="keyword">if</span> datpath(i).isdir    
0650             <span class="comment">% check if datpath.name includes regular Helios data files</span>
0651             content = dir([data.import.path,filesep,datpath(i).name]);
0652             content = content(~ismember({content.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0653             <span class="keyword">for</span> j = 1:size(content,1)
0654                 <span class="keyword">if</span> strcmp(content(j).name,[datpath(i).name,<span class="string">'.hrd'</span>])
0655                     <span class="keyword">if</span> ~strcmp(content(j).name,[datpath(i).name,<span class="string">'_ref'</span>])
0656                         in.T1T2 = <span class="string">'T2'</span>;
0657                         in.name = content(j).name;
0658                         in.path = fullfile(data.import.path,filesep,datpath(i).name);
0659                         in.fileformat = data.import.fileformat;
0660                         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0661                         
0662                         <span class="comment">% the individual file names</span>
0663                         c = c + 1;
0664                         fnames(c).parfile = <span class="string">''</span>;
0665                         fnames(c).datafile = out.nmrData.datfile;
0666                         fnames(c).T2specfile = <span class="string">''</span>;
0667                         shownames{c} = [<span class="string">'T2_'</span>,datpath(i).name];
0668                         
0669                         data.import.NMR.data{c} = out.nmrData;
0670                         data.import.NMR.para{c} = out.parData;
0671                     <span class="keyword">end</span>
0672                 <span class="keyword">end</span>
0673             <span class="keyword">end</span>
0674         <span class="keyword">end</span>
0675     <span class="keyword">end</span>
0676 <span class="keyword">end</span>
0677 
0678 <span class="comment">% update the global data structure</span>
0679 data.import.NMR.files = fnames;
0680 data.import.NMR.filesShort = shownames;
0681 
0682 <span class="keyword">end</span>
0683 
0684 <span class="comment">%%</span>
0685 <a name="_sub7" href="#_subfunctions" class="code">function [data,gui] = importDataHeliosSeries(data,gui)</a>
0686 
0687 <span class="comment">% first check the subpaths</span>
0688 <span class="comment">% there should be some folders with names ...</span>
0689 <span class="comment">% ... similar to the data filenames inside them</span>
0690 datpath = dir(data.import.path);
0691 datpath = datpath(~ismember({datpath.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0692 
0693 fnames = struct;
0694 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0695 <span class="comment">% will be shown in the listbox</span>
0696 shownames = cell(1,1);
0697 
0698 c = 0;
0699 <span class="keyword">if</span> ~isempty(datpath)
0700     content = datpath;
0701     <span class="keyword">for</span> j = 1:size(content,1)
0702         <span class="keyword">if</span> ~strcmp(content(j).name(end-7:end),<span class="string">'_ref.hrd'</span>)
0703             in.T1T2 = <span class="string">'T2'</span>;
0704             in.name = content(j).name;
0705             in.path = fullfile(data.import.path);
0706             in.fileformat = data.import.fileformat;
0707             out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0708             <span class="comment">% the individual file names</span>
0709             c = c + 1;
0710             fnames(c).parfile = <span class="string">''</span>;
0711             fnames(c).datafile = out.nmrData.datfile;
0712             fnames(c).T2specfile = <span class="string">''</span>;
0713             shownames{c} = [<span class="string">'T2_'</span>,content(j).name];
0714             
0715             data.import.NMR.data{c} = out.nmrData;
0716             data.import.NMR.para{c} = out.parData;
0717         <span class="keyword">end</span>
0718         
0719     <span class="keyword">end</span>
0720 <span class="keyword">end</span>
0721 
0722 <span class="comment">% update the global data structure</span>
0723 data.import.NMR.files = fnames;
0724 data.import.NMR.filesShort = shownames;
0725 
0726 <span class="keyword">end</span>
0727 
0728 <span class="comment">%%</span>
0729 <a name="_sub8" href="#_subfunctions" class="code">function [data,gui] = importDataDart(data,gui)</a>
0730 
0731 in.path = fullfile(data.import.path);
0732 in.name = data.import.file;
0733 in.fileformat = data.import.fileformat;
0734 in.version = data.import.version;
0735 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0736 
0737 fnames = struct;
0738 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0739 <span class="comment">% will be shown in the listbox</span>
0740 shownames = cell(1,1);
0741 
0742 c = 0;
0743 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0744     <span class="comment">% the individual file names</span>
0745     c = c + 1;
0746     fnames(c).parfile = <span class="string">''</span>;
0747     fnames(c).datafile = data.import.file;
0748     fnames(c).T2specfile = <span class="string">''</span>;
0749     
0750     shownames{c} = [<span class="string">'depth_'</span>,sprintf(<span class="string">'%04.3f'</span>,out.parData{j}.depth)];
0751     
0752     <span class="comment">% the NMR data</span>
0753     <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0754     <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0755         out.nmrData{j}.time = out.nmrData{j}.time/1000;
0756         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0757     <span class="keyword">end</span>
0758     data.import.NMR.data{c} = out.nmrData{j};
0759     data.import.NMR.para{c} = out.parData{j};
0760 <span class="keyword">end</span>
0761 
0762 <span class="comment">% update the global data structure</span>
0763 data.import.NMR.files = fnames;
0764 data.import.NMR.filesShort = shownames;
0765 
0766 <span class="keyword">end</span>
0767 
0768 <span class="comment">%%</span>
0769 <a name="_sub9" href="#_subfunctions" class="code">function [data,gui] = importDataGeneral(data,gui)</a>
0770 
0771 <span class="comment">% look for all files ending with '.par'</span>
0772 <span class="comment">% should exist for T1 and T2 measurements</span>
0773 filenames = dir(fullfile(data.import.path,<span class="string">'*.par'</span>));
0774 
0775 fnames = struct;
0776 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0777 <span class="comment">% will be shown in the listbox</span>
0778 shownames = cell(1,1);
0779 
0780 <span class="comment">% loop over all found files and import the data</span>
0781 c = 0;
0782 in.path = data.import.path;
0783 <span class="keyword">for</span> i = 1:size(filenames,1)
0784     ind = strfind(filenames(i).name,<span class="string">'.'</span>);
0785     ind = max(ind);
0786     in.name = filenames(i).name(1:ind-1);
0787     in.fileformat = data.import.fileformat;
0788     out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0789     
0790     <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0791         <span class="comment">% the individual file names</span>
0792         c = c + 1;
0793         fnames(c).parfile = filenames(i).name;
0794         fnames(c).datafile = out.nmrData{j}.datfile;
0795         <span class="keyword">if</span> strcmp(out.nmrData{j}.flag,<span class="string">'T2'</span>) &amp;&amp; isfield(out.nmrData{j},<span class="string">'specfile'</span>)
0796             fnames(c).T2specfile = out.nmrData{j}.specfile;
0797         <span class="keyword">else</span>
0798             fnames(c).T2specfile = <span class="string">''</span>;
0799         <span class="keyword">end</span>
0800         shownames{c} = fnames(c).datafile;
0801         
0802         <span class="comment">% the NMR data</span>
0803         <span class="comment">% here we fix the time scale from [ms] to [s]</span>
0804         <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
0805             out.nmrData{j}.time = out.nmrData{j}.time/1000;
0806             out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
0807         <span class="keyword">end</span>
0808         data.import.NMR.data{c} = out.nmrData{j};
0809         data.import.NMR.para{c} = out.parData;
0810     <span class="keyword">end</span>
0811 <span class="keyword">end</span>
0812 
0813 <span class="keyword">switch</span> data.import.fileformat
0814     <span class="keyword">case</span> <span class="string">'bamtom'</span>
0815         nslices = out.parData.nSlices;
0816         ncsvfiles = numel(fnames);
0817         
0818         <span class="comment">% check for background file (&quot;Leermessung&quot;)</span>
0819         has_bg = false;
0820         <span class="keyword">for</span> i = 1:numel(fnames)
0821             <span class="keyword">if</span> ~isempty(strfind(fnames(i).datafile,<span class="string">'000'</span>))
0822                 has_bg = true;
0823                 index_bg = i;
0824                 <span class="keyword">break</span>;
0825             <span class="keyword">end</span>
0826         <span class="keyword">end</span>
0827         
0828         <span class="keyword">if</span> has_bg
0829             <span class="comment">% background data set</span>
0830             bg = data.import.NMR.data{index_bg};
0831             
0832             <span class="comment">% vector of indices of the files that get corrected</span>
0833             ind_files = 1:1:ncsvfiles;
0834             ind_files(ind_files==index_bg) = [];
0835             
0836             <span class="keyword">for</span> i = ind_files                
0837                 <span class="comment">% subtract the background signal</span>
0838                 s = data.import.NMR.data{i}.signal;
0839                 s_bg = bg.signal;
0840                 <span class="comment">% if the background signal is longer than the signal cut it</span>
0841                 <span class="keyword">if</span> numel(s_bg) &gt; numel(s)
0842                     tmp_s = s_bg(1:numel(s));
0843                 <span class="keyword">else</span> <span class="comment">% if not pad it with zeros</span>
0844                     tmp_s = zeros(size(s));
0845                     tmp_s(1:numel(s_bg)) = s_bg;
0846                 <span class="keyword">end</span>
0847                 s = complex(real(s)-real(tmp_s),imag(s)-imag(tmp_s));
0848                 <span class="comment">% update original data set</span>
0849                 data.import.NMR.data{i}.signal = s;                
0850             <span class="keyword">end</span>
0851             
0852             <span class="comment">% check if the number of slices is equal to the number of files</span>
0853             <span class="comment">% (excluding the background file)</span>
0854             <span class="keyword">if</span> nslices == numel(ind_files)
0855                 <span class="comment">% create z-vector</span>
0856                 p = out.parData;
0857                 zslice = linspace(p.startPos,p.endPos,p.nSlices)';
0858                 data.import.BAM.use_z = true;
0859                 data.import.BAM.zslice = zslice;
0860                 <span class="keyword">if</span> numel(zslice) &gt; 1
0861                     c = 0;
0862                     <span class="keyword">for</span> i = ind_files
0863                         c = c + 1;
0864                         tmp = shownames{i};
0865                         shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%5.4f'</span>,zslice(c))];
0866                     <span class="keyword">end</span>
0867                 <span class="keyword">end</span>
0868             <span class="keyword">else</span>
0869                 data.import.BAM.use_z = false;
0870                 data.import.BAM.zslice = 1:1:max([numel(ind_files) 1]);
0871             <span class="keyword">end</span>
0872             
0873         <span class="keyword">else</span>
0874             <span class="keyword">if</span> nslices == ncsvfiles
0875                 <span class="comment">% create z-vector</span>
0876                 p = out.parData;
0877                 zslice = linspace(p.startPos,p.endPos,p.nSlices)';
0878                 data.import.BAM.use_z = true;
0879                 data.import.BAM.zslice = zslice;
0880                 <span class="keyword">if</span> numel(zslice) &gt; 1
0881                     <span class="keyword">for</span> i = 1:numel(zslice)
0882                         tmp = shownames{i};
0883                         shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%5.4f'</span>,zslice(i))];
0884                     <span class="keyword">end</span>
0885                 <span class="keyword">end</span>
0886             <span class="keyword">else</span>
0887                 data.import.BAM.use_z = false;
0888                 data.import.BAM.zslice = 1:1:ncsvfiles;
0889             <span class="keyword">end</span>
0890         <span class="keyword">end</span>    
0891 <span class="keyword">end</span>
0892 
0893 <span class="comment">% update the global data structure</span>
0894 data.import.NMR.files = fnames;
0895 data.import.NMR.filesShort = shownames;
0896 
0897 <span class="keyword">end</span>
0898 
0899 <span class="comment">%%</span>
0900 <a name="_sub10" href="#_subfunctions" class="code">function [data,gui] = importDataLIAG(data,gui)</a>
0901 
0902 in.path = fullfile(data.import.path);
0903 in.fileformat = data.import.fileformat;
0904 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0905 
0906 fnames = struct;
0907 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
0908 <span class="comment">% will be shown in the listbox</span>
0909 shownames = cell(1,1);
0910 
0911 c = 0;
0912 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
0913     <span class="comment">% the individual file names</span>
0914     c = c + 1;
0915     fnames(c).parfile = <span class="string">'acqu.par'</span>;
0916     fnames(c).datafile = out.nmrData{j}.datfile;
0917     fnames(c).T2specfile = <span class="string">''</span>;
0918     
0919     shownames{c} = fnames(c).datafile;
0920     
0921     <span class="comment">% the NMR data</span>
0922     <span class="comment">% here we fix the time scale to [s] if neccessary</span>
0923     TE = out.parData.echoTime; <span class="comment">% [s]</span>
0924     <span class="keyword">if</span> out.nmrData{j}.time(1)== TE/1e3
0925         <span class="comment">% change [ms] to [s]</span>
0926         out.nmrData{j}.time = out.nmrData{j}.time/1e3;
0927         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1e3;
0928     <span class="keyword">elseif</span> out.nmrData{j}.time(1)== TE
0929         <span class="comment">% change [s] to [s] -&gt; very unlikely</span>
0930         out.nmrData{j}.time = out.nmrData{j}.time/1e6;
0931         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1e6;
0932     <span class="keyword">end</span>
0933     data.import.NMR.data{c} = out.nmrData{j};
0934     data.import.NMR.para{c} = out.parData;
0935 <span class="keyword">end</span>
0936 
0937 <span class="comment">% update the global data structure</span>
0938 data.import.NMR.files = fnames;
0939 data.import.NMR.filesShort = shownames;
0940 
0941 <span class="keyword">end</span>
0942 
0943 <span class="comment">%%</span>
0944 <a name="_sub11" href="#_subfunctions" class="code">function [data,gui] = importDataLIAGcore(data,gui)</a>
0945 
0946 <span class="comment">% get all subfolders containing a measurement at a certain heigth</span>
0947 subdirs = dir(data.import.path);
0948 <span class="comment">% remove the dot-dirs</span>
0949 subdirs = subdirs(~ismember({subdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
0950 
0951 <span class="comment">% now get the background data (&quot;Leermessung&quot;)</span>
0952 bgPath = uigetdir(data.import.path,<span class="string">'Choose Background Data Path'</span>);
0953 isbgPath = false;
0954 <span class="keyword">if</span> bgPath == 0
0955     disp(<span class="string">'NUCLEUSinv: LIAG core import: No background file provided.'</span>);
0956 <span class="keyword">else</span>
0957     isbgPath = true;
0958     in.path = fullfile(bgPath);
0959     in.fileformat = data.import.fileformat;
0960     bgout = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
0961     ref1.t = bgout.nmrData{1}.time;
0962     ref1.s = bgout.nmrData{1}.signal;
0963     [ref1.s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(ref1.s);
0964 <span class="keyword">end</span>
0965 
0966 <span class="comment">% get the Position file</span>
0967 [posFile,posFilePath] = uigetfile(<span class="string">'*.*'</span>,<span class="string">'Choose Lift Position File'</span>,data.import.path);
0968 isposFile = false;
0969 <span class="keyword">if</span> posFilePath == 0
0970     disp(<span class="string">'NUCLEUSinv: LIAG core import: No position file provided.'</span>);
0971 <span class="keyword">else</span>
0972     isposFile = true;
0973     <span class="comment">% import LIAG lift file</span>
0974     buffer = fileread(fullfile(posFilePath,posFile));
0975 
0976     <span class="comment">% get the time stamps of the lift positions</span>
0977     substr = <span class="string">'Zeit:'</span> ;
0978     loc = strfind(buffer, substr);
0979     timepoint = cell(1,1);
0980     <span class="keyword">for</span> i = 1:length(loc)
0981         timestr = strtrim(buffer(loc(i)+numel(substr):loc(i)+numel(substr)+19));
0982         timepoint{i} = datetime(timestr,<span class="string">'InputFormat'</span>,<span class="string">'dd.MM.yyyy HH:mm:ss'</span>);
0983     <span class="keyword">end</span>
0984     <span class="comment">% ignore the first time stamp</span>
0985     t_range = [datenum(timepoint{2}), datenum(timepoint{3})];
0986     <span class="comment">% get the z coords</span>
0987     substr = <span class="string">'Z1='</span>;
0988     loc = strfind(buffer, substr) ;
0989     z_range(1) = sscanf(buffer(loc+numel(substr):loc+numel(substr)+10),<span class="string">'%f'</span>,1);
0990     substr = <span class="string">'Z2='</span>;
0991     loc = strfind(buffer, substr) ;
0992     z_range(2) =  sscanf(buffer(loc+numel(substr):loc+numel(substr)+10),<span class="string">'%f'</span>,1);
0993 <span class="keyword">end</span>
0994 
0995 <span class="comment">% import the NMR data</span>
0996 count = 0;
0997 levels = zeros(size(subdirs));
0998 nmrDataTMP = cell(1,1);
0999 <span class="keyword">for</span> i = 1:numel(subdirs)
1000     <span class="keyword">if</span> ~isnan(str2double(subdirs(i).name))
1001 
1002         <span class="comment">% import the NMR file</span>
1003         in.path = fullfile(data.import.path,subdirs(i).name,<span class="string">'T2CPMG'</span>);
1004         in.fileformat = data.import.fileformat;
1005         out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1006 
1007         <span class="comment">% if there is a position file</span>
1008         <span class="keyword">if</span> isposFile
1009             <span class="comment">% keep only files within the correct time range</span>
1010             <span class="keyword">if</span> out.nmrData{1}.datenum &gt; t_range(1) &amp;&amp; out.nmrData{1}.datenum &lt; t_range(2)
1011                 count = count + 1;
1012                 <span class="comment">% interpolate the z position via the time stamp of the NMR file</span>
1013                 levels(count) = interp1(t_range,z_range,out.nmrData{1}.datenum,<span class="string">'linear'</span>);
1014                 nmrDataTMP{count} = out;
1015             <span class="keyword">end</span>
1016         <span class="keyword">else</span> <span class="comment">% just read everything</span>
1017             count = count + 1;
1018             levels(count) = str2double(subdirs(i).name);
1019             nmrDataTMP{count} = out;
1020         <span class="keyword">end</span>
1021     <span class="keyword">end</span>
1022 <span class="keyword">end</span>
1023 <span class="comment">% cut off data that is not part of the scan</span>
1024 levels = levels(1:count);
1025 <span class="comment">% sort in ascending order</span>
1026 [levels,idx] = sort(levels);
1027 
1028 <span class="comment">% sort the NMR data accordingly</span>
1029 fnames = struct;
1030 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1031 <span class="comment">% will be shown in the listbox</span>
1032 shownames = cell(1,1);
1033 <span class="keyword">for</span> c = 1:numel(levels)
1034     <span class="comment">% the individual file names</span>
1035     fnames(c).parfile = <span class="string">'acqu.par'</span>;
1036     fnames(c).datafile = nmrDataTMP{idx(c)}.nmrData{1}.datfile;
1037     fnames(c).T2specfile = <span class="string">''</span>;
1038     
1039     shownames{c} = fnames(c).datafile;
1040     tmp = shownames{c};
1041     <span class="keyword">if</span> isposFile
1042         shownames{c} = [tmp,<span class="string">': '</span>,sprintf(<span class="string">'%4d'</span>,floor(levels(c))),<span class="string">'mm'</span>];
1043     <span class="keyword">else</span>
1044         shownames{c} = [tmp,<span class="string">' level:'</span>,sprintf(<span class="string">'%d'</span>,levels(c))];
1045     <span class="keyword">end</span>
1046     out = nmrDataTMP{idx(c)};
1047     
1048     <span class="comment">% the NMR data</span>
1049     <span class="comment">% here we fix the time scale to [s] if neccessary</span>
1050     TE = out.parData.echoTime; <span class="comment">% [s]</span>
1051     <span class="keyword">if</span> out.nmrData{1}.time(1) == TE/1e3
1052         <span class="comment">% change [ms] to [s]</span>
1053         out.nmrData{1}.time = out.nmrData{1}.time/1e3;
1054         out.nmrData{1}.raw.time = out.nmrData{1}.raw.time/1e3;
1055     <span class="keyword">elseif</span> out.nmrData{1}.time(1) == TE
1056         <span class="comment">% change [s] to [s] -&gt; very unlikely</span>
1057         out.nmrData{1}.time = out.nmrData{1}.time/1e6;
1058         out.nmrData{1}.raw.time = out.nmrData{1}.raw.time/1e6;
1059     <span class="keyword">end</span>
1060     data.import.NMR.data{c} = out.nmrData{1};
1061     data.import.NMR.para{c} = out.parData;
1062 
1063     <span class="comment">% subtract the background signal is one is available</span>
1064     <span class="keyword">if</span> isbgPath
1065         <span class="comment">% get the original signal</span>
1066         s = data.import.NMR.data{c}.signal;
1067         <span class="comment">% if the background signal is longer than the signal cut it, if</span>
1068         <span class="comment">% not extend it with zeros</span>
1069         <span class="keyword">if</span> numel(ref1.s) &gt; numel(s)
1070             tmp_r = ref1.s(1:numel(s));
1071         <span class="keyword">else</span>
1072             tmp_r = zeros(size(s));
1073             tmp_r(1:numel(ref1.s)) = ref1.s;
1074         <span class="keyword">end</span>
1075         s = complex(real(s)-real(tmp_r),imag(s)-imag(tmp_r));
1076 
1077         <span class="comment">% sign check</span>
1078         <span class="keyword">if</span> real(s(1:3))&lt;0
1079             s = s*-1;
1080         <span class="keyword">end</span>
1081 
1082         <span class="comment">% rotate phase again - TEST</span>
1083         [s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(s);
1084 
1085         <span class="comment">% update signal</span>
1086         data.import.NMR.data{c}.signal = s;
1087         data.import.NMR.data{c}.raw.signal = s;
1088     <span class="keyword">end</span>
1089 <span class="keyword">end</span>
1090 <span class="keyword">if</span> isposFile
1091     data.import.LIAGCORE.use_z = true;
1092 <span class="keyword">else</span>
1093     data.import.LIAGCORE.use_z = false;
1094 <span class="keyword">end</span>
1095 data.import.LIAGCORE.zslice = levels;
1096 
1097 <span class="comment">% update the global data structure</span>
1098 data.import.NMR.files = fnames;
1099 data.import.NMR.filesShort = shownames;
1100 
1101 <span class="keyword">end</span>
1102 
1103 <span class="comment">%%</span>
1104 <a name="_sub12" href="#_subfunctions" class="code">function [data,gui] = importDataLIAGproject(data,gui)</a>
1105 
1106 <span class="comment">% 1) show all folders and ask for sample</span>
1107 subdirs = dir(data.import.path);
1108 <span class="comment">% remove the dot-dirs</span>
1109 subdirs = subdirs(~ismember({subdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
1110 
1111 fnames = {subdirs.name};
1112 [indx,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Sample:'</span>,<span class="keyword">...</span>
1113     <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
1114     <span class="string">'ListString'</span>,fnames);
1115 
1116 <span class="keyword">if</span> ~isempty(indx)
1117     <span class="comment">% 2) check corresponding SampleParameter.par file for reference and</span>
1118     <span class="comment">% calibration sample and other parameters</span>
1119     datapath = fullfile(data.import.path,fnames{indx});
1120     <span class="comment">% load SampleParameter file for sample</span>
1121     [SampleParameter] = <a href="#_sub15" class="code" title="subfunction data = loadGUIParameters(datapath,fname)">loadGUIParameters</a>(datapath,<span class="string">'SampleParameters.par'</span>);
1122     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'sampleVolume'</span>)
1123         dataVol = SampleParameter.sampleVolume;
1124     <span class="keyword">else</span>
1125         dataVol = 1;
1126     <span class="keyword">end</span>
1127     
1128     <span class="comment">% 2a) background file #1</span>
1129     backgroundFile1 = SampleParameter.backgroundFile;
1130     <span class="keyword">if</span> isempty(backgroundFile1)
1131         bnames = {subdirs.name};
1132         bnames(indx) = [];
1133         [indb,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Background File:'</span>,<span class="keyword">...</span>
1134             <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
1135             <span class="string">'ListString'</span>,bnames);
1136         <span class="keyword">if</span> ~isempty(indb)
1137             backgroundFile1 = bnames{indb};
1138         <span class="keyword">else</span>
1139             backgroundFile1 = <span class="string">''</span>;
1140         <span class="keyword">end</span>
1141     <span class="keyword">end</span>
1142     <span class="keyword">if</span> ~isempty(backgroundFile1)
1143         ind = strfind(backgroundFile1,filesep);
1144         <span class="keyword">if</span> ~isempty(ind)
1145             backgroundFile1 = backgroundFile1(ind(end)+1:end);
1146         <span class="keyword">end</span>
1147         fileInList = ismember(fnames,{backgroundFile1});
1148         <span class="keyword">if</span> any(fileInList)
1149             backgroundpath1 = fullfile(data.import.path,fnames{fileInList});
1150         <span class="keyword">end</span>
1151     <span class="keyword">else</span>
1152         backgroundpath1 = <span class="string">''</span>;
1153         backgroundFile1 = <span class="string">''</span>;
1154     <span class="keyword">end</span>
1155     backVol = 1;
1156     
1157     <span class="comment">% 2b) calibration file</span>
1158     c = 0;
1159     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile0'</span>)
1160         c = c + 1;
1161         calibrationFiles{c} = SampleParameter.calibrationFile0;
1162     <span class="keyword">end</span>
1163     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile1'</span>)
1164         c = c + 1;
1165         calibrationFiles{c} = SampleParameter.calibrationFile1;
1166     <span class="keyword">end</span>
1167     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile2'</span>)
1168         c = c + 1;
1169         calibrationFiles{c} = SampleParameter.calibrationFile2;
1170     <span class="keyword">end</span>
1171     <span class="keyword">if</span> isfield(SampleParameter,<span class="string">'calibrationFile3'</span>)
1172         c = c + 1;
1173         calibrationFiles{c} = SampleParameter.calibrationFile3;
1174     <span class="keyword">end</span>
1175     
1176     <span class="comment">% find the non-empty one</span>
1177     ind = ismember(calibrationFiles,{<span class="string">''</span>});
1178     <span class="comment">% there are three possibilities: 0, 1 and more than 1 calib. files</span>
1179     calibrationFiles(ind) = [];
1180     <span class="keyword">if</span> isempty(calibrationFiles)
1181         cnames = {subdirs.name};
1182         cnames(indx) = [];
1183         [indc,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Calibration File:'</span>,<span class="keyword">...</span>
1184             <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
1185             <span class="string">'ListString'</span>,cnames);
1186         <span class="keyword">if</span> ~isempty(indc)
1187             calibrationFiles = cnames{indc};
1188         <span class="keyword">else</span>
1189             calibrationFiles = <span class="string">''</span>;
1190         <span class="keyword">end</span>        
1191     <span class="keyword">else</span>
1192         <span class="comment">% if there are more than one let the user select the correct one</span>
1193         <span class="keyword">if</span> numel(calibrationFiles) &gt; 1
1194             [ind,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Calibration File:'</span>,<span class="keyword">...</span>
1195                 <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
1196                 <span class="string">'ListString'</span>,calibrationFiles);
1197             calibrationFiles = calibrationFiles{ind};
1198         <span class="keyword">else</span>
1199             calibrationFiles = calibrationFiles{1};
1200         <span class="keyword">end</span>
1201     <span class="keyword">end</span>
1202     <span class="keyword">if</span> ~isempty(calibrationFiles)
1203         ind = strfind(calibrationFiles,filesep);
1204         <span class="keyword">if</span> ~isempty(ind)
1205             calibrationFiles = calibrationFiles(ind(end)+1:end);
1206         <span class="keyword">end</span>
1207         fileInList = ismember(fnames,{calibrationFiles});
1208         <span class="keyword">if</span> any(fileInList)
1209             calibrationpath = fullfile(data.import.path,fnames{fileInList});
1210         <span class="keyword">end</span>
1211     <span class="keyword">else</span>
1212         calibrationpath = <span class="string">''</span>;
1213         calibrationFiles = <span class="string">''</span>;
1214     <span class="keyword">end</span>
1215     
1216     <span class="keyword">if</span> ~isempty(calibrationpath)
1217         [SampleParameterC] = <a href="#_sub15" class="code" title="subfunction data = loadGUIParameters(datapath,fname)">loadGUIParameters</a>(calibrationpath,<span class="string">'SampleParameters.par'</span>);
1218         <span class="keyword">if</span> isfield(SampleParameterC,<span class="string">'sampleVolume'</span>)
1219             calibVol = SampleParameterC.sampleVolume;
1220         <span class="keyword">else</span>
1221             calibVol = 1;
1222         <span class="keyword">end</span>
1223         
1224         <span class="comment">% 2a) background file #2</span>
1225         backgroundFile2 = SampleParameterC.backgroundFile;
1226         <span class="keyword">if</span> isempty(backgroundFile2)
1227             bnames = {subdirs.name};
1228             bnames(indx) = [];
1229             [indb,~] = listdlg(<span class="string">'PromptString'</span>,<span class="string">'Select Background File for Calibration:'</span>,<span class="keyword">...</span>
1230                 <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
1231                 <span class="string">'ListString'</span>,bnames);
1232             <span class="keyword">if</span> ~isempty(indb)
1233                 backgroundFile2 = bnames{indb};
1234             <span class="keyword">else</span>
1235                 backgroundFile2 = <span class="string">''</span>;
1236             <span class="keyword">end</span>  
1237         <span class="keyword">end</span>
1238         <span class="keyword">if</span> ~isempty(backgroundFile2)
1239             ind = strfind(backgroundFile2,filesep);
1240             <span class="keyword">if</span> ~isempty(ind)
1241                 backgroundFile2 = backgroundFile2(ind(end)+1:end);
1242             <span class="keyword">end</span>
1243             fileInList = ismember(fnames,{backgroundFile2});
1244             <span class="keyword">if</span> any(fileInList)
1245                 backgroundpath2 = fullfile(data.import.path,fnames{fileInList});
1246             <span class="keyword">end</span>
1247         <span class="keyword">else</span>
1248             backgroundpath2 = <span class="string">''</span>;
1249             backgroundFile2 = <span class="string">''</span>;
1250         <span class="keyword">end</span>
1251     <span class="keyword">else</span>
1252         calibVol = 1;
1253         backgroundpath2 = <span class="string">''</span>;
1254         backgroundFile2 = <span class="string">''</span>;
1255     <span class="keyword">end</span>
1256     
1257     <span class="comment">% 3) now load the data</span>
1258     workpaths = {datapath,calibrationpath,backgroundpath1,backgroundpath2};
1259     workfiles = {fnames{indx},[calibrationFiles,<span class="string">' - calibration'</span>],<span class="keyword">...</span>
1260         [backgroundFile1,<span class="string">' - backgroundS'</span>],[backgroundFile2,<span class="string">' - backgroundC'</span>]};
1261     out = cell(size(workpaths));
1262     count = 0;
1263     keep = false(size(workpaths));
1264     <span class="keyword">for</span> i = 1:numel(workpaths)
1265         <span class="keyword">if</span> ~isempty(workpaths{i})
1266             workdirs = dir(workpaths{i});
1267             workdirs = workdirs(~ismember({workdirs.name},{<span class="string">'.'</span>,<span class="string">'..'</span>}));
1268             isT2 = ismember({workdirs.name},{<span class="string">'T2CPMG'</span>});
1269             <span class="keyword">if</span> any(isT2)
1270                 keep(i) = true;
1271                 count = count + 1;
1272                 T2path = fullfile(workdirs(isT2).folder,workdirs(isT2).name);
1273                 in.path = T2path;
1274                 in.fileformat = data.import.fileformat;
1275                 out{i} = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1276             <span class="keyword">end</span>
1277         <span class="keyword">end</span>
1278     <span class="keyword">end</span>    
1279     
1280     <span class="keyword">if</span> isempty(backgroundpath1)
1281         ref1 = struct;
1282     <span class="keyword">else</span>
1283         background1 = out{3};
1284         <span class="comment">% get the background data 1</span>
1285         ref1.t = background1.nmrData{1}.time;
1286         ref1.s = background1.nmrData{1}.signal;
1287         [ref1.s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(ref1.s);
1288     <span class="keyword">end</span>
1289     
1290     <span class="keyword">if</span> isempty(backgroundpath2)
1291         ref2 = struct;
1292     <span class="keyword">else</span>
1293         background2 = out{4};
1294         <span class="comment">% get the background data 2</span>
1295         ref2.t = background2.nmrData{1}.time;
1296         ref2.s = background2.nmrData{1}.signal;
1297         [ref2.s,~] = <a href="../../../nucleus/functions/import/rotateT2phase.html" class="code" title="function [s_rot,alpha] = rotateT2phase(s)">rotateT2phase</a>(ref2.s);
1298     <span class="keyword">end</span>
1299     
1300     workpaths = workpaths(keep);
1301     workfiles = workfiles(keep);
1302     out = out(keep);
1303     
1304     ffnames = struct;
1305     <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1306     <span class="comment">% will be shown in the listbox</span>
1307     shownames = cell(1,1);
1308     
1309     <span class="keyword">for</span> i = 1:count
1310         ffnames(i).parfile = <span class="string">'acqu.par'</span>;
1311         ffnames(i).datafile = workfiles{i};
1312         ffnames(i).T2specfile = <span class="string">''</span>;
1313         
1314         shownames{i} = ffnames(i).datafile;
1315         
1316         <span class="comment">% the NMR data</span>
1317         <span class="comment">% here we fix the time scale to [s] if neccessary</span>
1318         TE = out{i}.parData.echoTime; <span class="comment">% [s]</span>
1319         <span class="keyword">if</span> out{i}.nmrData{1}.time(1)== TE/1e3
1320             <span class="comment">% change [ms] to [s]</span>
1321             out{i}.nmrData{1}.time = out{i}.nmrData{1}.time/1e3;
1322             out{i}.nmrData{1}.raw.time = out{i}.nmrData{1}.raw.time/1e3;
1323         <span class="keyword">elseif</span> out{i}.nmrData{1}.time(1)== TE
1324             <span class="comment">% change [s] to [s] -&gt; very unlikely</span>
1325             out{i}.nmrData{1}.time = out{i}.nmrData{1}.time/1e6;
1326         out{i}.nmrData{1}.raw.time = out{i}.nmrData{1}.raw.time/1e6;
1327         <span class="keyword">end</span>
1328         
1329         data.import.NMR.data{i} = out{i}.nmrData{1};
1330         data.import.NMR.para{i} = out{i}.parData;
1331         data.import.NMR.para{i}.SampleParameter = SampleParameter;
1332         
1333         <span class="comment">% subtract the background signal</span>
1334         s = data.import.NMR.data{i}.signal;
1335         <span class="keyword">if</span> i==1 &amp;&amp; isfield(ref1,<span class="string">'s'</span>)
1336             <span class="comment">% if the background signal is longer than the signal cut it, if</span>
1337             <span class="comment">% not extend it with zeros</span>
1338             <span class="keyword">if</span> numel(ref1.s) &gt; numel(s)
1339                 tmp_r = ref1.s(1:numel(s));
1340             <span class="keyword">else</span>
1341                 tmp_r = zeros(size(s));
1342                 tmp_r(1:numel(ref1.s)) = ref1.s;
1343             <span class="keyword">end</span>
1344             s = complex(real(s)-real(tmp_r),imag(s)-imag(tmp_r));
1345         <span class="keyword">elseif</span> i==2 &amp;&amp; isfield(ref2,<span class="string">'s'</span>)
1346             <span class="comment">% if the background signal is longer than the signal cut it, if</span>
1347             <span class="comment">% not extend it with zeros</span>
1348             <span class="keyword">if</span> numel(ref2.s) &gt; numel(s)
1349                 tmp_r = ref2.s(1:numel(s));
1350             <span class="keyword">else</span>
1351                 tmp_r = zeros(size(s));
1352                 tmp_r(1:numel(ref2.s)) = ref2.s;
1353             <span class="keyword">end</span>
1354             s = complex(real(s)-real(tmp_r),imag(s)-imag(tmp_r));
1355         <span class="keyword">end</span>        
1356         data.import.NMR.data{i}.signal = s;
1357         data.import.NMR.data{i}.raw.signal = s;
1358         
1359         <span class="keyword">if</span> ~isempty(strfind(workfiles{i},<span class="string">' - background'</span>))
1360             data.import.LIAG.sampleVol(i) = backVol;
1361         <span class="keyword">elseif</span> ~isempty(strfind(workfiles{i},<span class="string">' - calibration'</span>))
1362             data.import.LIAG.sampleVol(i) = calibVol;
1363         <span class="keyword">elseif</span> isempty(strfind(workfiles{i},<span class="string">' - background'</span>)) &amp;&amp;<span class="keyword">...</span>
1364                 isempty(strfind(workfiles{i},<span class="string">' - calibration'</span>))
1365             data.import.LIAG.sampleVol(i) = dataVol;
1366         <span class="keyword">end</span>
1367     <span class="keyword">end</span>
1368     data.import.LIAG.Tbulk = 1e6;
1369     data.import.LIAG.workpaths = workpaths;
1370     data.import.LIAG.datapath = datapath;
1371     data.import.LIAG.calibrationpath = calibrationpath;
1372     data.import.LIAG.backgroundpath1 = backgroundpath1;
1373     data.import.LIAG.backgroundpath2 = backgroundpath2;
1374     
1375     <span class="comment">% update the global data structure</span>
1376     data.import.NMR.files = ffnames;
1377     data.import.NMR.filesShort = shownames;
1378 <span class="keyword">end</span>
1379 
1380 <span class="keyword">end</span>
1381 
1382 <span class="comment">%%</span>
1383 <a name="_sub13" href="#_subfunctions" class="code">function [data,gui] = importDataMouse(data,gui)</a>
1384 
1385 in.path = fullfile(data.import.path);
1386 in.fileformat = data.import.fileformat;
1387 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1388 
1389 fnames = struct;
1390 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1391 <span class="comment">% will be shown in the listbox</span>
1392 shownames = cell(1,1);
1393 
1394 c = 0;
1395 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
1396     <span class="comment">% the individual file names</span>
1397     c = c + 1;
1398     fnames(c).parfile = <span class="string">'acq.par'</span>;
1399     fnames(c).datafile = out.nmrData{j}.datfile;
1400     fnames(c).T2specfile = <span class="string">''</span>;
1401     
1402     shownames{c} = [<span class="string">'T2_'</span>,fnames(c).datafile];
1403     
1404     <span class="comment">% the NMR data</span>
1405     <span class="comment">% here we fix the time scale from [ms] to [s]</span>
1406     <span class="keyword">if</span> max(out.nmrData{j}.time) &gt; 100
1407         out.nmrData{j}.time = out.nmrData{j}.time/1000;
1408         out.nmrData{j}.raw.time = out.nmrData{j}.raw.time/1000;
1409     <span class="keyword">end</span>
1410     data.import.NMR.data{c} = out.nmrData{j};
1411     data.import.NMR.para{c} = out.parData;
1412 <span class="keyword">end</span>
1413 
1414 <span class="comment">% update the global data structure</span>
1415 data.import.NMR.files = fnames;
1416 data.import.NMR.filesShort = shownames;
1417 
1418 <span class="keyword">end</span>
1419 
1420 <span class="comment">%%</span>
1421 <a name="_sub14" href="#_subfunctions" class="code">function [data,gui] = importDataIBAC(data,gui)</a>
1422 
1423 in.path = fullfile(data.import.path);
1424 in.name = data.import.file;
1425 in.fileformat = data.import.fileformat;
1426 out = <a href="../../../nucleus/functions/import/LoadNMRData_driver.html" class="code" title="function out = LoadNMRData_driver(in)">LoadNMRData_driver</a>(in);
1427 
1428 nslices = out.parData.depths;
1429 nfiles = size(out.nmrData,2);
1430 
1431 fnames = struct;
1432 <span class="comment">% shownames is just a dummy to hold all data file names that</span>
1433 <span class="comment">% will be shown in the listbox</span>
1434 shownames = cell(1,1);
1435 
1436 c = 0;
1437 <span class="keyword">for</span> j = 1:size(out.nmrData,2)
1438     <span class="comment">% the individual file names</span>
1439     c = c + 1;
1440     fnames(c).parfile = out.parData.parfile;
1441     fnames(c).datafile = out.nmrData{j}.datfile;
1442     fnames(c).T2specfile = <span class="string">''</span>;
1443     
1444     shownames{c} = [fnames(c).datafile];
1445 
1446     data.import.NMR.data{c} = out.nmrData{j};
1447     data.import.NMR.para{c} = out.parData;
1448 <span class="keyword">end</span>
1449 
1450 <span class="comment">% check if the number of depth levels is equal to the number of</span>
1451 <span class="comment">% measurements</span>
1452 <span class="keyword">if</span> nslices == nfiles
1453     <span class="comment">% create z-vector</span>
1454     p = out.parData;
1455     zslice = linspace(p.initialdepth,p.finaldepth,p.depths)';
1456     data.import.IBAC.use_z = true;
1457     data.import.IBAC.zslice = zslice;
1458     <span class="keyword">if</span> numel(zslice) &gt; 1
1459         c = 0;
1460         <span class="keyword">for</span> i = 1:nfiles
1461             c = c + 1;
1462             tmp = shownames{i};
1463             shownames{i} = [tmp,<span class="string">' z:'</span>,sprintf(<span class="string">'%05d'</span>,zslice(c))];
1464         <span class="keyword">end</span>
1465     <span class="keyword">end</span>
1466 <span class="keyword">else</span>
1467     data.import.IBAC.use_z = false;
1468     data.import.IBAC.zslice = 1:1:max([nfiles 1]);
1469 <span class="keyword">end</span>
1470 
1471 <span class="comment">% update the global data structure</span>
1472 data.import.NMR.files = fnames;
1473 data.import.NMR.filesShort = shownames;
1474 
1475 <span class="keyword">end</span>
1476 
1477 <span class="comment">%%</span>
1478 <a name="_sub15" href="#_subfunctions" class="code">function data = loadGUIParameters(datapath,fname)</a>
1479 fid = fopen(fullfile(datapath,fname));
1480 d = textscan(fid,<span class="string">'%s'</span>,<span class="string">'Delimiter'</span>,<span class="string">'\n'</span>);
1481 fclose(fid);
1482 data = struct;
1483 <span class="keyword">for</span> i = 1:size(d{1},1)
1484     str = char(d{1}(i));
1485     str = <a href="../../../nucleus/functions/import/fixParameterString.html" class="code" title="function str = fixParameterString(str)">fixParameterString</a>(str);
1486     eval([<span class="string">'data.'</span>,str,<span class="string">';'</span>]); <span class="comment">%#ok&lt;EVLDOT&gt;</span>
1487 <span class="keyword">end</span>
1488 
1489 <span class="keyword">end</span>
1490 
1491 <span class="comment">%%</span>
1492 <a name="_sub16" href="#_subfunctions" class="code">function data = loadGUIrawdata(data,NMRpath,NMRfile)</a>
1493 
1494 load(fullfile(NMRpath,<span class="string">'NUCLEUSinv_raw.mat'</span>),<span class="string">'savedata'</span>);
1495 
1496 data.import.file = NMRfile;
1497 data.import.path = NMRpath;
1498 data.import.NMR = savedata;
1499 
1500 <span class="keyword">end</span>
1501 
1502 <span class="comment">%------------- END OF CODE --------------</span>
1503 
1504 <span class="comment">%% License:</span>
1505 <span class="comment">% MIT License</span>
1506 <span class="comment">%</span>
1507 <span class="comment">% Copyright (c) 2018 Thomas Hiller</span>
1508 <span class="comment">%</span>
1509 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
1510 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
1511 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
1512 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
1513 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
1514 <span class="comment">% furnished to do so, subject to the following conditions:</span>
1515 <span class="comment">%</span>
1516 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
1517 <span class="comment">% copies or substantial portions of the Software.</span>
1518 <span class="comment">%</span>
1519 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
1520 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
1521 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
1522 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
1523 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
1524 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
1525 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>