<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Mod2DView</title>
  <meta name="keywords" content="Mod2DView">
  <meta name="description" content=" is an extra subGUI to calculate 2D forward T1-T2 data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- ../menu.html interface --><!-- menu.html subGUIs -->
<h1>Mod2DView
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong> is an extra subGUI to calculate 2D forward T1-T2 data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function Mod2DView(src,~) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">Mod2DView is an extra subGUI to calculate 2D forward T1-T2 data

 Syntax:
       Mod2DView

 Inputs:
       src - handle of the calling object

 Outputs:
       none

 Example:
       Mod2DView(src,~)

 Other m-files required:
       beautifyAxes
       clearAllAxes
       displayStatusText
       fitData2D_T1T2
       imagescnan

 Subfunctions:

 MAT-files required:
       none

 See also: NUCLEUSmod
 Author: see AUTHORS.md
 email: see AUTHORS.md
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../nucleus/callbacks/listboxes/onListboxData.html" class="code" title="function onListboxData(src,~)">onListboxData</a>	 handles the calls from the context menu of the data</li><li><a href="../../../../nucleus/callbacks/menus/onMenuView.html" class="code" title="function onMenuView(src,~)">onMenuView</a>	 handles the view menu entries</li><li><a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>	 can be used to globally change the general appearance of axes</li><li><a href="../../../../nucleus/functions/interface/changeColorTheme.html" class="code" title="function changeColorTheme(fig_tag,th)">changeColorTheme</a>	 changes the color theme of the calling figure</li><li><a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>	 clears an individual axis</li><li><a href="../../../../nucleus/functions/interface/fixVerticalTextAlignment.html" class="code" title="function fixVerticalTextAlignment(fig)">fixVerticalTextAlignment</a>	 fixes the vertical positioning of all text</li><li><a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>	 handles the minimization/maximization of all box-panels for</li><li><a href="../../../../nucleus/functions/interface/onFigureSizeChange.html" class="code" title="function onFigureSizeChange(fig,~)">onFigureSizeChange</a>	 fixes an ugly Matlab bug when resizing a box-panel</li><li><a href="../../../../nucleus/functions/inversion/createKernelMatrix2D.html" class="code" title="function [K,indices] = createKernelMatrix2D(dat,T1vec,T2vec,p)">createKernelMatrix2D</a>	 creates a Kernel matrix from signals time vectors "t"</li><li><a href="../../../../nucleus/functions/inversion/getFitErrors.html" class="code" title="function out = getFitErrors(s,sfit,noise,varargin)">getFitErrors</a>	 calculates all relevant fitting errors for the NMR inversion</li><li><a href="../../../../nucleus/functions/modeling/addNoiseToSignal.html" class="code" title="function [signalN,noise] = addNoiseToSignal(signal,mu,sigma)">addNoiseToSignal</a>	 adds noise with mean 'mu' and standard deviation 'sigma' to</li><li><a href="../../../../nucleus/functions/modeling/getMultivariateGaussian.html" class="code" title="function pdf = getMultivariateGaussian(X,mu,sigma)">getMultivariateGaussian</a>	</li><li><a href="../../../../nucleus/functions/modeling/getNMRTimeVector.html" class="code" title="function t = getNMRTimeVector(TE,TEunit,varargin)">getNMRTimeVector</a>	 Creates a NMR time vector depending on the given echo</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../nucleus/callbacks/menus/onMenuSubGUIs.html" class="code" title="function onMenuSubGUIs(src,~)">onMenuSubGUIs</a>	 handles the extra menu entries to open NUCLEUS sub GUIs</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function fv_onEditTable(src,~)</a></li><li><a href="#_sub2" class="code">function fv_onEditValue(src,~)</a></li><li><a href="#_sub3" class="code">function fv_onPopupT1Type(src,~)</a></li><li><a href="#_sub4" class="code">function fv_onPopupNoiseType(src,~)</a></li><li><a href="#_sub5" class="code">function fv_addNoise(figh)</a></li><li><a href="#_sub6" class="code">function fv_getModel(figh)</a></li><li><a href="#_sub7" class="code">function fv_getNMR(src,~)</a></li><li><a href="#_sub8" class="code">function fv_onPushSave(src,~)</a></li><li><a href="#_sub9" class="code">function fv_onPushView(src,~)</a></li><li><a href="#_sub10" class="code">function fv_onPushUpdate(src,~)</a></li><li><a href="#_sub11" class="code">function fv_plotSignals(figh)</a></li><li><a href="#_sub12" class="code">function fv_plotModel(figh)</a></li><li><a href="#_sub13" class="code">function fv_onRadioLogLin(src,~)</a></li><li><a href="#_sub14" class="code">function fv_setAxesScaling(figh)</a></li><li><a href="#_sub15" class="code">function fv_closeme(src,~)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function Mod2DView(src,~)</a>
0002 <span class="comment">%Mod2DView is an extra subGUI to calculate 2D forward T1-T2 data</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       Mod2DView</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       src - handle of the calling object</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Outputs:</span>
0011 <span class="comment">%       none</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Example:</span>
0014 <span class="comment">%       Mod2DView(src,~)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Other m-files required:</span>
0017 <span class="comment">%       beautifyAxes</span>
0018 <span class="comment">%       clearAllAxes</span>
0019 <span class="comment">%       displayStatusText</span>
0020 <span class="comment">%       fitData2D_T1T2</span>
0021 <span class="comment">%       imagescnan</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Subfunctions:</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% MAT-files required:</span>
0026 <span class="comment">%       none</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% See also: NUCLEUSmod</span>
0029 <span class="comment">% Author: see AUTHORS.md</span>
0030 <span class="comment">% email: see AUTHORS.md</span>
0031 <span class="comment">% License: MIT License (at end)</span>
0032 
0033 <span class="comment">%------------- BEGIN CODE --------------</span>
0034 
0035 <span class="comment">%% get GUI handle and data</span>
0036 figh_nucleus = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0037 nucleus.data = getappdata(figh_nucleus,<span class="string">'data'</span>);
0038 nucleus.gui = getappdata(figh_nucleus,<span class="string">'gui'</span>);
0039 myui = nucleus.gui.myui;
0040 colors = myui.colors;
0041 
0042 <span class="comment">%% get GUI data from NUCLEUS</span>
0043 data = nucleus.data.mod2D;
0044 
0045 <span class="comment">% check if the figure is already open</span>
0046 fig_2Dmod = findobj(<span class="string">'Tag'</span>,<span class="string">'2DMOD'</span>);
0047 <span class="comment">% if not, create it</span>
0048 <span class="keyword">if</span> isempty(fig_2Dmod)
0049     <span class="comment">% draw the figure on top of NUCLEUSinv</span>
0050     fig_2Dmod = figure(<span class="string">'Name'</span>,<span class="string">'NUCLEUSmod - 2D Modeling'</span>,<span class="keyword">...</span>
0051         <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'Resize'</span>,<span class="string">'on'</span>,<span class="string">'ToolBar'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0052         <span class="string">'Tag'</span>,<span class="string">'2DMOD'</span>,<span class="string">'CloseRequestFcn'</span>,@<a href="#_sub15" class="code" title="subfunction fv_closeme(src,~)">fv_closeme</a>,<span class="keyword">...</span>
0053         <span class="string">'SizeChangedFcn'</span>,@<a href="../../../../nucleus/functions/interface/onFigureSizeChange.html" class="code" title="function onFigureSizeChange(fig,~)">onFigureSizeChange</a>,<span class="string">'MenuBar'</span>,<span class="string">'none'</span>);
0054     pos0 = get(figh_nucleus,<span class="string">'Position'</span>);
0055     cent(1) = (pos0(1)+pos0(3)/2);
0056     cent(2) = (pos0(2)+pos0(4)/2);
0057     posf = [cent(1)-pos0(3)/2.5 pos0(2)+22 pos0(3)/1.25 pos0(4)-22];
0058     <span class="comment">% posf = pos0;</span>
0059     set(fig_2Dmod,<span class="string">'Position'</span>,posf);
0060 
0061     gui.menu.view = uimenu(fig_2Dmod,<span class="string">'Label'</span>,<span class="string">'View'</span>);
0062     gui.menu.view_toolbar = uimenu(gui.menu.view,<span class="string">'Label'</span>,<span class="string">'Figure Toolbar'</span>,<span class="keyword">...</span>
0063         <span class="string">'Callback'</span>,@<a href="../../../../nucleus/callbacks/menus/onMenuView.html" class="code" title="function onMenuView(src,~)">onMenuView</a>);
0064 
0065     cpanel_w = 190;
0066 
0067     <span class="comment">% create the main layout</span>
0068     gui.main = uix.HBox(<span class="string">'Parent'</span>,fig_2Dmod,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0069         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,5,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0070     gui.left = uix.ScrollingPanel(<span class="string">'Parent'</span>,gui.main);
0071     gui.panels.main = uix.VBox(<span class="string">'Parent'</span>,gui.left,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0072         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,0); <span class="comment">% controls</span>
0073     gui.right = uix.VBox(<span class="string">'Parent'</span>,gui.main,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0074         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,0); <span class="comment">% plots</span>
0075 
0076     set(gui.main,<span class="string">'Widths'</span>,[400 -1 ]);
0077 
0078     <span class="comment">% waitbar indicating the loading of the GUI</span>
0079     steps = 5;
0080     hwb = waitbar(0,<span class="string">'loading ...'</span>,<span class="string">'Name'</span>,<span class="string">'2DMod GUI initialization'</span>,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0081     set(hwb,<span class="string">'Units'</span>,<span class="string">'Pixel'</span>)
0082     posw = get(hwb,<span class="string">'Position'</span>);
0083     set(hwb,<span class="string">'Position'</span>,[posf(1)+posf(3)/2-posw(3)/2 posf(2)+posf(4)/2-posw(4)/2 posw(3:4)]);
0084     set(hwb,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0085 
0086     <span class="comment">% --- modelling panel ---</span>
0087     waitbar(1/steps,hwb,<span class="string">'loading GUI elements - 2D modelling'</span>);
0088     gui.panels.mod.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0089         <span class="string">'Title'</span>,<span class="string">'2D modelling settings'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0090         <span class="string">'TitleColor'</span>,colors.GEO,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0091     gui.panels.mod.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.mod.main,<span class="keyword">...</span>
0092         <span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0093 
0094     <span class="comment">% RTD T1</span>
0095     gui.panels.mod.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.mod.VBox,<span class="keyword">...</span>
0096         <span class="string">'Spacing'</span>,3);
0097     gui.text_handles.rtdT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0098         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0099         <span class="string">'String'</span>,<span class="string">'RTD T1 -  min [s] | max [s] | #'</span>);
0100     tstr = &quot;&quot;;
0101     gui.edit_handles.rtdT1min = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0102         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.mod.T1min),<span class="keyword">...</span>
0103         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1min'</span>,<span class="keyword">...</span>
0104         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0105         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0106     tstr = &quot;&quot;;
0107     gui.edit_handles.rtdT1max = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0108         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T1max),<span class="keyword">...</span>
0109         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1max'</span>,<span class="keyword">...</span>
0110         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0111         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0112     tstr = &quot;&quot;;
0113     gui.edit_handles.rtdT1N = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0114         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T1N),<span class="keyword">...</span>
0115         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1N'</span>,<span class="keyword">...</span>
0116         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0117         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0118     set(gui.panels.mod.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0119 
0120     <span class="comment">% RTD T2</span>
0121     gui.panels.mod.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.mod.VBox,<span class="keyword">...</span>
0122         <span class="string">'Spacing'</span>,3);
0123     gui.text_handles.rtdT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0124         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0125         <span class="string">'String'</span>,<span class="string">'RTD T2 - min [s] | max [s] | #'</span>);
0126     tstr = &quot;&quot;;
0127     gui.edit_handles.rtdT2min = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0128         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.mod.T2min),<span class="keyword">...</span>
0129         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2min'</span>,<span class="keyword">...</span>
0130         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0131         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0132     tstr = &quot;&quot;;
0133     gui.edit_handles.rtdT2max = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0134         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T2max),<span class="keyword">...</span>
0135         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2max'</span>,<span class="keyword">...</span>
0136         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0137         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0138     tstr = &quot;&quot;;
0139     gui.edit_handles.rtdT2N = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0140         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T2N),<span class="keyword">...</span>
0141         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2N'</span>,<span class="keyword">...</span>
0142         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0143         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0144     set(gui.panels.mod.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0145 
0146     uix.Empty(<span class="string">'Parent'</span>,gui.panels.mod.VBox);
0147     <span class="comment">% table</span>
0148     gui.panels.mod.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.mod.VBox,<span class="keyword">...</span>
0149         <span class="string">'Spacing'</span>,3);
0150     m = data.mod.mu;
0151     s = data.mod.sigma;
0152     a = data.mod.amp;
0153     table = cell(1,1);
0154     <span class="keyword">for</span> i = 1:data.mod.Ndist
0155         table{i,1} = false;
0156         table{i,2} = m(i,1);
0157         table{i,3} = m(i,2);
0158         table{i,4} = s{i}(1,1);
0159         table{i,5} = s{i}(2,2);
0160         table{i,6} = s{i}(1,2);
0161         table{i,7} = s{i}(2,1);
0162         table{i,8} = a(i);
0163     <span class="keyword">end</span>
0164     table{1,1} = true;
0165     data.results.mod2D.table = table;
0166     gui.table_handles.mod = uitable(<span class="string">'Parent'</span>,gui.panels.mod.HBox3,<span class="keyword">...</span>
0167     <span class="string">'Data'</span>,table,<span class="keyword">...</span>
0168     <span class="string">'ColumnFormat'</span>,({<span class="string">'logical'</span> <span class="string">'short'</span> <span class="string">'short'</span> <span class="string">'short'</span> <span class="string">'short'</span> <span class="string">'bank'</span> <span class="string">'bank'</span> <span class="string">'bank'</span>}),<span class="keyword">...</span>
0169     <span class="string">'ColumnEditable'</span>,[true true true true true true true true],<span class="keyword">...</span>
0170     <span class="string">'ColumnWidth'</span>,{35 65 65 45 45 33 33 33},<span class="keyword">...</span>
0171     <span class="string">'RowName'</span>,<span class="string">'numbered'</span>,<span class="keyword">...</span>
0172     <span class="string">'ColumnName'</span>,{<span class="string">'use'</span> <span class="string">'mX'</span>,<span class="string">'mY'</span>,<span class="string">'xx'</span>,<span class="string">'yy'</span>,<span class="string">'xy'</span>,<span class="string">'yx'</span>,<span class="string">'A'</span>},<span class="keyword">...</span>
0173     <span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0174     <span class="string">'CellEditCallback'</span>,@<a href="#_sub1" class="code" title="subfunction fv_onEditTable(src,~)">fv_onEditTable</a>,<span class="keyword">...</span>
0175     <span class="string">'FontSize'</span>,myui.fontsize);
0176     
0177     <span class="comment">% UPDATE button</span>
0178     <span class="comment">% gui.panels.mod.HBox5 = uix.HBox('Parent',gui.panels.mod.VBox,...</span>
0179     <span class="comment">%     'Spacing',3);</span>
0180     <span class="comment">% uix.Empty('Parent',gui.panels.mod.HBox5);</span>
0181     <span class="comment">% tstr = 'Update model';</span>
0182     <span class="comment">% gui.push_handles.model = uicontrol('Parent',gui.panels.mod.HBox5,...</span>
0183     <span class="comment">%     'String','UPDATE MODEL','FontSize',myui.fontsize,'Tag','rtd',...</span>
0184     <span class="comment">%     'ToolTipString',tstr,'UserData',struct('Tooltipstr',tstr),...</span>
0185     <span class="comment">%     'BackGroundColor','g','Callback',@fv_getModel);</span>
0186     <span class="comment">% set(gui.panels.mod.HBox5,'Widths',[cpanel_w -1]);</span>
0187 
0188     <span class="comment">% adjust heights</span>
0189     set(gui.panels.mod.VBox,<span class="string">'Heights'</span>,[25 25 25 -1]);
0190 
0191     <span class="comment">%% --- properties panel ---</span>
0192     waitbar(2/steps,hwb,<span class="string">'loading GUI elements - properties'</span>);
0193     gui.panels.prop.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0194         <span class="string">'Title'</span>,<span class="string">'Properties'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0195         <span class="string">'TitleColor'</span>,colors.GEO,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0196     gui.panels.prop.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.prop.main,<span class="keyword">...</span>
0197         <span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0198 
0199     <span class="comment">% D coeff.</span>
0200     gui.panels.prop.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0201         <span class="string">'Spacing'</span>,3);
0202     gui.text_handles.diff = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox1,<span class="keyword">...</span>
0203         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0204         <span class="string">'String'</span>,[<span class="string">'Diffusion coeff. [10'</span>,char(hex2dec(<span class="string">'207B'</span>)),<span class="keyword">...</span>
0205         char(hex2dec(<span class="string">'2079'</span>)),<span class="string">' m'</span>,char(hex2dec(<span class="string">'00B2'</span>)),<span class="string">'/s]'</span>]);
0206     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox1);
0207     tstr = <span class="string">'Set diffusion coefficient.'</span>;
0208     gui.edit_handles.diff = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox1,<span class="keyword">...</span>
0209         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.prop.D*1e9),<span class="keyword">...</span>
0210         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'diff'</span>,<span class="keyword">...</span>
0211         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0212         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0213     set(gui.panels.prop.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0214 
0215     <span class="comment">% Gradient</span>
0216     gui.panels.prop.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0217         <span class="string">'Spacing'</span>,3);
0218     gui.text_handles.gradient = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox2,<span class="keyword">...</span>
0219         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0220         <span class="string">'String'</span>,&quot;Gradient [T/m]&quot;);
0221     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox2);
0222     tstr = <span class="string">'Set device gradient.'</span>;
0223     gui.edit_handles.gradient = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox2,<span class="keyword">...</span>
0224         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.G0),<span class="keyword">...</span>
0225         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'gradient'</span>,<span class="keyword">...</span>
0226         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0227         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0228     set(gui.panels.prop.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0229 
0230     <span class="comment">% echo time</span>
0231     gui.panels.prop.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0232         <span class="string">'Spacing'</span>,3);
0233     gui.text_handles.echo_time = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox3,<span class="keyword">...</span>
0234         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0235         <span class="string">'String'</span>,&quot;Echo time TE [µs]&quot;);
0236     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox3);
0237     tstr = <span class="string">'Set echo time tE.'</span>;
0238     gui.edit_handles.echo_time = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox3,<span class="keyword">...</span>
0239         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T2te*1e6),<span class="keyword">...</span>
0240         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'echo_time'</span>,<span class="keyword">...</span>
0241         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0242         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0243         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0244     set(gui.panels.prop.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0245 
0246     <span class="comment">% Tbulk</span>
0247     gui.panels.prop.HBox4 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0248         <span class="string">'Spacing'</span>,3);
0249     gui.text_handles.Tbulk = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox4,<span class="keyword">...</span>
0250         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0251         <span class="string">'String'</span>,&quot;Bulk relaxation [s]&quot;);
0252     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox4);
0253     tstr = <span class="string">'Set Tbulk value.'</span>;
0254     gui.edit_handles.Tbulk = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox4,<span class="keyword">...</span>
0255         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.Tbulk),<span class="keyword">...</span>
0256         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'Tbulk'</span>,<span class="keyword">...</span>
0257         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0258         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0259     set(gui.panels.prop.HBox4,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0260 
0261     <span class="comment">%% --- NMR signal panel ---</span>
0262     waitbar(3/steps,hwb,<span class="string">'loading GUI elements - Signal panel'</span>);
0263     gui.panels.nmr.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0264         <span class="string">'Title'</span>,<span class="string">'NMR signals'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0265         <span class="string">'TitleColor'</span>,colors.NMR,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0266     gui.panels.nmr.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.nmr.main,<span class="keyword">...</span>
0267         <span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0268 
0269     <span class="comment">% T1type</span>
0270     gui.panels.nmr.HBox0 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0271         <span class="string">'Spacing'</span>,3);
0272     gui.text_handles.T1type = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox0,<span class="keyword">...</span>
0273         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0274         <span class="string">'String'</span>,<span class="string">'T1 type (SR / IR)'</span>);
0275     tstr = <span class="string">'Choose between Saturation and Inversion Recovery.'</span>;
0276     gui.popup_handles.T1type = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox0,<span class="keyword">...</span>
0277         <span class="string">'Style'</span>,<span class="string">'popup'</span>,<span class="string">'String'</span>,{<span class="string">'Saturation Recovery'</span>,<span class="string">'Inversion Recovery'</span>},<span class="keyword">...</span>
0278         <span class="string">'Value'</span>,data.nmr.T1IRfac,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0279         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction fv_onPopupT1Type(src,~)">fv_onPopupT1Type</a>);
0280     set(gui.panels.nmr.HBox0,<span class="string">'Widths'</span>,[cpanel_w -1]);
0281 
0282     <span class="comment">% T1 timings</span>
0283     gui.panels.nmr.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0284         <span class="string">'Spacing'</span>,3);
0285     gui.text_handles.timeT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0286         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0287         <span class="string">'String'</span>,<span class="string">'T1 recov [s] -  min | max | #'</span>);
0288     tstr = &quot;&quot;;
0289     gui.edit_handles.T1trmin = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0290         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.nmr.T1trmin),<span class="keyword">...</span>
0291         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1trmin'</span>,<span class="keyword">...</span>
0292         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0293         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0294     tstr = &quot;&quot;;
0295     gui.edit_handles.T1trmax = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0296         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T1trmax),<span class="keyword">...</span>
0297         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1trmax'</span>,<span class="keyword">...</span>
0298         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0299         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0300     tstr = &quot;&quot;;
0301     gui.edit_handles.T1trN = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0302         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T1trN),<span class="keyword">...</span>
0303         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1trN'</span>,<span class="keyword">...</span>
0304         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0305         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0306     set(gui.panels.nmr.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0307 
0308     <span class="comment">% T2 timings</span>
0309     gui.panels.nmr.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0310         <span class="string">'Spacing'</span>,3);
0311     gui.text_handles.timeT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox2,<span class="keyword">...</span>
0312         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0313         <span class="string">'String'</span>,<span class="string">'T2 echo time [µs] | # echos'</span>);
0314     tstr = &quot;&quot;;
0315     gui.edit_handles.T2te = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox2,<span class="keyword">...</span>
0316         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.2f'</span>,data.nmr.T2te*1e6),<span class="keyword">...</span>
0317         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2te'</span>,<span class="keyword">...</span>
0318         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0319         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0320     tstr = &quot;&quot;;
0321     gui.edit_handles.T2teN = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox2,<span class="keyword">...</span>
0322         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T2teN),<span class="keyword">...</span>
0323         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2teN'</span>,<span class="keyword">...</span>
0324         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0325         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0326     set(gui.panels.nmr.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0327     
0328     <span class="comment">% noise</span>
0329     gui.panels.nmr.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0330         <span class="string">'Spacing'</span>,3);
0331     gui.text_handles.noise = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox3,<span class="keyword">...</span>
0332         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0333         <span class="string">'String'</span>,<span class="string">'Noise settings'</span>);
0334     tstr = [<span class="string">'&lt;HTML&gt;NMR data noise method.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0335         <span class="string">'A noise level will be used globally for all NMR signals.&lt;br&gt;'</span>,<span class="keyword">...</span>
0336         <span class="string">'A signal-to-ratio will be used individually on every single NMR signal.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0337         <span class="string">'&lt;u&gt;Available options:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0338         <span class="string">'&lt;b&gt;noise level&lt;/b&gt; or &lt;b&gt;SNR&lt;/b&gt; &lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0339         <span class="string">'&lt;u&gt;Default value:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0340         <span class="string">'&lt;b&gt;noise level&lt;/b&gt; &lt;br&gt;'</span>];
0341     gui.popup_handles.noisetype = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox3,<span class="keyword">...</span>
0342         <span class="string">'Style'</span>,<span class="string">'popup'</span>,<span class="string">'String'</span>,{<span class="string">'noise level'</span>,<span class="string">'SNR'</span>},<span class="keyword">...</span>
0343         <span class="string">'Value'</span>,1,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0344         <span class="string">'Callback'</span>,@<a href="#_sub4" class="code" title="subfunction fv_onPopupNoiseType(src,~)">fv_onPopupNoiseType</a>);
0345     tstr = [<span class="string">'&lt;HTML&gt;NMR data noise.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0346         <span class="string">'&lt;u&gt;Hint:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0347         <span class="string">'You do not need to press RUN to add noise to the NMR signals.&lt;br&gt;'</span>,<span class="keyword">...</span>
0348         <span class="string">'The raw NMR signals are stored internally and the noise is&lt;br&gt;'</span>,<span class="keyword">...</span>
0349         <span class="string">'applied instantaneously.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0350         <span class="string">'&lt;u&gt;Default value:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0351         <span class="string">'&lt;b&gt;0&lt;/b&gt;&lt;br&gt;'</span>];
0352     gui.edit_handles.noise = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox3,<span class="keyword">...</span>
0353         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,num2str(data.nmr.noise),<span class="string">'FontSize'</span>,myui.fontsize,<span class="keyword">...</span>
0354         <span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr,<span class="string">'defaults'</span>,[data.nmr.noise 1 1]),<span class="keyword">...</span>
0355         <span class="string">'Tag'</span>,<span class="string">'nmr_noise'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0356     set(gui.panels.nmr.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0357 
0358     <span class="comment">% Calc button</span>
0359     gui.panels.nmr.HBox4 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0360         <span class="string">'Spacing'</span>,3);
0361     uix.Empty(<span class="string">'Parent'</span>,gui.panels.nmr.HBox4);
0362     tstr = <span class="string">'Get NMR signals'</span>;
0363     gui.push_handles.nmr = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox4,<span class="keyword">...</span>
0364         <span class="string">'String'</span>,<span class="string">'GET NMR SIGNALS'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'2dmod'</span>,<span class="keyword">...</span>
0365         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0366         <span class="string">'BackGroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction fv_getNMR(src,~)">fv_getNMR</a>);
0367     set(gui.panels.nmr.HBox4,<span class="string">'Widths'</span>,[cpanel_w -1]);
0368 
0369     <span class="comment">% log/lin axes</span>
0370     gui.panels.nmr.HBox5 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0371         <span class="string">'Spacing'</span>,3);
0372     gui.text_handles.loglin_axes = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox5,<span class="keyword">...</span>
0373         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0374         <span class="string">'String'</span>,<span class="string">'Echo time axes'</span>);
0375     tstr = &quot;&quot;;
0376     gui.radio_handles.log = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox5,<span class="keyword">...</span>
0377         <span class="string">'Style'</span>,<span class="string">'radiobutton'</span>,<span class="string">'String'</span>,<span class="string">'log'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'log'</span>,<span class="keyword">...</span>
0378         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0379         <span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Value'</span>,1,<span class="string">'Callback'</span>,@<a href="#_sub13" class="code" title="subfunction fv_onRadioLogLin(src,~)">fv_onRadioLogLin</a>);
0380     gui.radio_handles.lin = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox5,<span class="keyword">...</span>
0381         <span class="string">'Style'</span>,<span class="string">'radiobutton'</span>,<span class="string">'String'</span>,<span class="string">'lin'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lin'</span>,<span class="keyword">...</span>
0382         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0383         <span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Value'</span>,0,<span class="string">'Callback'</span>,@<a href="#_sub13" class="code" title="subfunction fv_onRadioLogLin(src,~)">fv_onRadioLogLin</a>);
0384     set(gui.panels.nmr.HBox5,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0385 
0386     <span class="comment">%% --- update MAIN GUI button ---</span>
0387     gui.panels.save.HBox1 = uix.VBox(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0388         <span class="string">'Spacing'</span>,3);   
0389     tstr = <span class="string">'UPDATE 2D inversion data in main NUCLEUSinv GUI.'</span>;
0390     gui.push_handles.update = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0391         <span class="string">'String'</span>,<span class="string">'UPDATE MAIN GUI'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'update'</span>,<span class="keyword">...</span>
0392         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0393         <span class="string">'Callback'</span>,@<a href="#_sub10" class="code" title="subfunction fv_onPushUpdate(src,~)">fv_onPushUpdate</a>,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0394     tstr = <span class="string">'SAVE 2D inversion data to external file.'</span>;
0395     gui.push_handles.save = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0396         <span class="string">'String'</span>,<span class="string">'SAVE RESULT'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'save'</span>,<span class="keyword">...</span>
0397         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0398         <span class="string">'Callback'</span>,@<a href="#_sub8" class="code" title="subfunction fv_onPushSave(src,~)">fv_onPushSave</a>);
0399     tstr = <span class="string">'Export current graphics view to Figure.'</span>;
0400     gui.push_handles.view = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0401         <span class="string">'String'</span>,<span class="string">'VIEW2FIG'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'view'</span>,<span class="keyword">...</span>
0402         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0403         <span class="string">'Callback'</span>,@<a href="#_sub9" class="code" title="subfunction fv_onPushView(src,~)">fv_onPushView</a>);
0404     <span class="comment">% set(gui.panels.save.HBox1,'Widths',[-1 -1]);</span>
0405 
0406     <span class="comment">% empty space at bottom of left side</span>
0407     uix.Empty(<span class="string">'Parent'</span>,gui.panels.main);
0408     <span class="comment">% adjust the heights of all left-column-panels</span>
0409     heights = [22 22 22 28 -1; 22+2*24+3*4+115 22+4*24+6*3 22+6*24+8*3 28*3 -1];
0410     <span class="comment">% panel header is always 22 high</span>
0411     set(gui.panels.main,<span class="string">'Heights'</span>,heights(2,:),<span class="keyword">...</span>
0412         <span class="string">'MinimumHeights'</span>,[22 22 22 28 0]);
0413     set(gui.left,<span class="string">'Heights'</span>,-1,<span class="string">'MinimumHeights'</span>,197+136+190+28*3);
0414 
0415     <span class="comment">%% --- plot boxes ---</span>
0416     waitbar(4/steps,hwb,<span class="string">'loading GUI elements - graphics'</span>);
0417     gui.rightPanel = uix.TabPanel(<span class="string">'Parent'</span>,gui.right,<span class="keyword">...</span>
0418         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0419 
0420     <span class="comment">% -- tab2</span>
0421     gui.tab2 = uix.GridFlex(<span class="string">'Parent'</span>,gui.rightPanel,<span class="keyword">...</span>
0422         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,5);
0423 
0424     gui.pbox21 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0425         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0426     gui.pbox22 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0427         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0428 
0429     gui.pbox23 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0430         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0431     gui.pbox24 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0432         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0433 
0434     set(gui.tab2,<span class="string">'Widths'</span>,[-6 -1],<span class="string">'Heights'</span>,[-1 -6]);
0435 
0436     <span class="comment">% -- tab3</span>
0437     gui.tab3 = uix.VBoxFlex(<span class="string">'Parent'</span>,gui.rightPanel,<span class="keyword">...</span>
0438         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,5);
0439     gui.pbox31 = uicontainer(<span class="string">'Parent'</span>,gui.tab3,<span class="keyword">...</span>
0440         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0441     gui.pbox32 = uicontainer(<span class="string">'Parent'</span>,gui.tab3,<span class="keyword">...</span>
0442         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0443     set(gui.tab3,<span class="string">'Heights'</span>,[-1 -2]);
0444 
0445     gui.rightPanel.TabTitles = {<span class="string">'MODEL'</span>,<span class="string">'SIGNALS'</span>};
0446     gui.rightPanel.TabWidth = 75;
0447     gui.rightPanel.TabEnables = {<span class="string">'on'</span>,<span class="string">'on'</span>};
0448 
0449     <span class="comment">% -- plot axes --</span>
0450     gui.axes2 = axes(<span class="string">'Parent'</span>,gui.pbox22,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0451     gui.axes21 = axes(<span class="string">'Parent'</span>,gui.pbox21,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0452     gui.axes24 = axes(<span class="string">'Parent'</span>,gui.pbox24,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0453     gui.axes31 = axes(<span class="string">'Parent'</span>,gui.pbox31,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0454     gui.axes32 = axes(<span class="string">'Parent'</span>,gui.pbox32,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0455 
0456     <span class="comment">% --- store main GUI settings ---</span>
0457     waitbar(5/steps,hwb,<span class="string">'loading GUI elements - finalizing'</span>);
0458     gui.myui = nucleus.gui.myui;
0459     gui.myui.heights = heights;
0460     gui.figh_nucleus = figh_nucleus;
0461 
0462     <span class="comment">% --- save gui data to GUI ---</span>
0463     setappdata(fig_2Dmod,<span class="string">'gui'</span>,gui);
0464     setappdata(fig_2Dmod,<span class="string">'data'</span>,data);
0465     
0466     <a href="../../../../nucleus/functions/interface/fixVerticalTextAlignment.html" class="code" title="function fixVerticalTextAlignment(fig)">fixVerticalTextAlignment</a>(fig_2Dmod);
0467     <a href="../../../../nucleus/functions/interface/changeColorTheme.html" class="code" title="function changeColorTheme(fig_tag,th)">changeColorTheme</a>(<span class="string">'2DMOD'</span>,myui.colors.theme);
0468     <span class="comment">% make GUI visible</span>
0469     delete(hwb);
0470     set(gui.main,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0471 <span class="keyword">else</span>
0472     <span class="comment">% if the figure is already open bring t to the front</span>
0473     figure(fig_2Dmod);
0474 <span class="keyword">end</span>
0475 
0476 <span class="comment">% trigger the model update pushbutton for the initial view</span>
0477 <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(fig_2Dmod);
0478 <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(fig_2Dmod);
0479 <span class="keyword">end</span>
0480 
0481 <span class="comment">%% subfunction to update the table entries</span>
0482 <a name="_sub1" href="#_subfunctions" class="code">function fv_onEditTable(src,~)</a>
0483 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0484 <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(figh)
0485 
0486 <span class="keyword">end</span>
0487 
0488 <span class="comment">%% subfunction to update the edit fields</span>
0489 <a name="_sub2" href="#_subfunctions" class="code">function fv_onEditValue(src,~)</a>
0490 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0491 gui = getappdata(figh,<span class="string">'gui'</span>);
0492 data = getappdata(figh,<span class="string">'data'</span>);
0493 
0494 <span class="keyword">switch</span> get(src,<span class="string">'Tag'</span>)
0495     <span class="keyword">case</span> {<span class="string">'diff'</span>,<span class="string">'gradient'</span>,<span class="string">'Tbulk'</span>}
0496         data.prop.D = str2double(get(gui.edit_handles.diff,<span class="string">'String'</span>))/1e9;
0497         data.prop.G0 = str2double(get(gui.edit_handles.gradient,<span class="string">'String'</span>));        
0498         data.prop.Tbulk = str2double(get(gui.edit_handles.Tbulk,<span class="string">'String'</span>));
0499     <span class="keyword">case</span> {<span class="string">'rtdT1min'</span>,<span class="string">'rtdT1max'</span>,<span class="string">'rtdT1N'</span>}
0500         data.mod.T1min = str2double(get(gui.edit_handles.rtdT1min,<span class="string">'String'</span>));
0501         data.mod.T1max = str2double(get(gui.edit_handles.rtdT1max,<span class="string">'String'</span>));
0502         data.mod.T1N = str2double(get(gui.edit_handles.rtdT1N,<span class="string">'String'</span>));
0503         setappdata(figh,<span class="string">'data'</span>,data);
0504         <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(figh);
0505         data = getappdata(figh,<span class="string">'data'</span>);
0506     <span class="keyword">case</span> {<span class="string">'rtdT2min'</span>,<span class="string">'rtdT2max'</span>,<span class="string">'rtdT2N'</span>}
0507         data.mod.T2min = str2double(get(gui.edit_handles.rtdT2min,<span class="string">'String'</span>));
0508         data.mod.T2max = str2double(get(gui.edit_handles.rtdT2max,<span class="string">'String'</span>));
0509         data.mod.T2N = str2double(get(gui.edit_handles.rtdT2N,<span class="string">'String'</span>));
0510         setappdata(figh,<span class="string">'data'</span>,data);
0511         <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(figh);
0512         data = getappdata(figh,<span class="string">'data'</span>);
0513      <span class="keyword">case</span> {<span class="string">'T1trmin'</span>,<span class="string">'T1trmax'</span>,<span class="string">'T1trN'</span>}
0514         data.nmr.T1trmin = str2double(get(gui.edit_handles.T1trmin,<span class="string">'String'</span>));
0515         data.nmr.T1trmax = str2double(get(gui.edit_handles.T1trmax,<span class="string">'String'</span>));
0516         data.nmr.T1trN = str2double(get(gui.edit_handles.T1trN,<span class="string">'String'</span>));
0517     <span class="keyword">case</span> {<span class="string">'T2te'</span>,<span class="string">'T2teN'</span>}
0518         data.nmr.T2te = str2double(get(gui.edit_handles.T2te,<span class="string">'String'</span>))/1e6;
0519         data.nmr.T2teN = str2double(get(gui.edit_handles.T2teN,<span class="string">'String'</span>));
0520 
0521         data.prop.te = data.nmr.T2te;
0522         set(gui.edit_handles.echo_time,<span class="string">'String'</span>,data.prop.te*1e6);
0523     <span class="keyword">case</span> {<span class="string">'nmr_noise'</span>}
0524         data.nmr.noise = str2double(get(gui.edit_handles.noise,<span class="string">'String'</span>));
0525         <span class="keyword">switch</span> data.nmr.noisetype
0526             <span class="keyword">case</span> <span class="string">'level'</span>
0527             <span class="keyword">case</span> <span class="string">'SNR'</span>
0528                 <span class="keyword">if</span> data.nmr.noise == 0
0529                     data.nmr.noise = Inf;
0530                     set(src,<span class="string">'String'</span>,num2str(data.nmr.noise));
0531                 <span class="keyword">end</span>
0532         <span class="keyword">end</span>
0533         setappdata(figh,<span class="string">'data'</span>,data);
0534         <span class="keyword">if</span> isfield(data.results.mod2D,<span class="string">'data'</span>)
0535             <a href="#_sub5" class="code" title="subfunction fv_addNoise(figh)">fv_addNoise</a>(figh)
0536             data = getappdata(figh,<span class="string">'data'</span>);
0537         <span class="keyword">end</span>        
0538 <span class="keyword">end</span>
0539 
0540 <span class="comment">% update GUI data</span>
0541 setappdata(figh,<span class="string">'data'</span>,data);
0542 <span class="comment">% in case an error occurred, reset the RUN buttons</span>
0543 set(gui.push_handles.nmr,<span class="string">'String'</span>,<span class="string">'GET NMR SIGNALS'</span>,<span class="keyword">...</span>
0544     <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction fv_getNMR(src,~)">fv_getNMR</a>);
0545 <span class="keyword">end</span>
0546 
0547 <span class="comment">%% subfunction to set the T1 type</span>
0548 <a name="_sub3" href="#_subfunctions" class="code">function fv_onPopupT1Type(src,~)</a>
0549 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0550 data = getappdata(figh,<span class="string">'data'</span>);
0551 
0552 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
0553     <span class="keyword">case</span> 1 <span class="comment">% Saturation Recovery</span>
0554         data.nmr.T1IRfac = 1;
0555     <span class="keyword">case</span> 2 <span class="comment">% Inversion Recovery</span>
0556         data.nmr.T1IRfac = 2;
0557 <span class="keyword">end</span>
0558 
0559 <span class="comment">% update GUI data</span>
0560 setappdata(figh,<span class="string">'data'</span>,data);
0561 <span class="keyword">end</span>
0562 
0563 <span class="comment">%% subfunction to set the NMR data noise type</span>
0564 <a name="_sub4" href="#_subfunctions" class="code">function fv_onPopupNoiseType(src,~)</a>
0565 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0566 gui = getappdata(figh,<span class="string">'gui'</span>);
0567 data = getappdata(figh,<span class="string">'data'</span>);
0568 
0569 <span class="comment">% change settings accordingly</span>
0570 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
0571     <span class="keyword">case</span> 1 <span class="comment">% noise level</span>
0572         data.nmr.noisetype = <span class="string">'level'</span>;
0573         <span class="keyword">if</span> data.nmr.noise &gt; 0
0574             data.nmr.noise = 1/data.nmr.noise;
0575         <span class="keyword">end</span>        
0576     <span class="keyword">case</span> 2 <span class="comment">% signal-to-noise ratio (SNR)</span>
0577         data.nmr.noisetype = <span class="string">'SNR'</span>;
0578         <span class="keyword">if</span> data.nmr.noise == 0
0579             data.nmr.noise = inf;
0580         <span class="keyword">else</span>
0581             data.nmr.noise = 1/data.nmr.noise;
0582         <span class="keyword">end</span>        
0583 <span class="keyword">end</span>
0584 <span class="comment">% update the corresponding edit field</span>
0585 set(gui.edit_handles.noise,<span class="string">'String'</span>,num2str(data.nmr.noise));
0586 
0587 <span class="comment">% update GUI data</span>
0588 setappdata(figh,<span class="string">'data'</span>,data);
0589 <span class="comment">% update NMR data (if available)</span>
0590 <span class="keyword">if</span> isfield(data.results.mod2D,<span class="string">'data'</span>)
0591     <a href="#_sub5" class="code" title="subfunction fv_addNoise(figh)">fv_addNoise</a>(figh);
0592 <span class="keyword">end</span>
0593 
0594 <span class="keyword">end</span>
0595 
0596 <span class="comment">%% subfunction to set the T1 t&lt;pe</span>
0597 <a name="_sub5" href="#_subfunctions" class="code">function fv_addNoise(figh)</a>
0598 data = getappdata(figh,<span class="string">'data'</span>);
0599 mod2D = data.results.mod2D;
0600 
0601 <span class="comment">% first check what is the noise type</span>
0602 <span class="keyword">switch</span> data.nmr.noisetype
0603     <span class="keyword">case</span> <span class="string">'level'</span>
0604         noise = data.nmr.noise;
0605     <span class="keyword">case</span> <span class="string">'SNR'</span>
0606         SNR = data.nmr.noise;
0607         noise = 1./SNR;
0608 <span class="keyword">end</span>
0609 
0610 <span class="keyword">if</span> noise &gt; 0
0611     <span class="keyword">for</span> n = 1:numel(mod2D.data)
0612         mod2D.data(n).noise = noise;
0613         [re,~] = <a href="../../../../nucleus/functions/modeling/addNoiseToSignal.html" class="code" title="function [signalN,noise] = addNoiseToSignal(signal,mu,sigma)">addNoiseToSignal</a>(mod2D.data(n).s_raw,0,noise);
0614         [~,im] = <a href="../../../../nucleus/functions/modeling/addNoiseToSignal.html" class="code" title="function [signalN,noise] = addNoiseToSignal(signal,mu,sigma)">addNoiseToSignal</a>(mod2D.data(n).s_raw,0,noise);
0615         mod2D.data(n).s = complex(re,im);
0616     <span class="keyword">end</span>
0617 <span class="keyword">else</span>
0618     <span class="comment">% reset the NMR signals with the raw data (without noise)</span>
0619     <span class="keyword">for</span> n = 1:numel(mod2D.data)
0620         mod2D.data(n).noise = 0;
0621         mod2D.data(n).s = complex(mod2D.data(n).s_raw,zeros(size(mod2D.data(n).s_raw)));
0622     <span class="keyword">end</span>
0623 <span class="keyword">end</span>
0624 
0625 <span class="comment">% update the GUI data</span>
0626 data.results.mod2D = mod2D;
0627 setappdata(figh,<span class="string">'data'</span>,data);
0628 <span class="comment">% plot all signals</span>
0629 <a href="#_sub11" class="code" title="subfunction fv_plotSignals(figh)">fv_plotSignals</a>(figh);
0630 <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
0631 <span class="keyword">end</span>
0632 
0633 <span class="comment">%% subfunction to get the 2D model</span>
0634 <a name="_sub6" href="#_subfunctions" class="code">function fv_getModel(figh)</a>
0635 <span class="comment">% figh = ancestor(src,'figure','toplevel');</span>
0636 gui = getappdata(figh,<span class="string">'gui'</span>);
0637 data = getappdata(figh,<span class="string">'data'</span>);
0638 
0639 <span class="comment">% create model space from relaxation time T vectors</span>
0640 T1min = data.mod.T1min;
0641 T1max = data.mod.T1max;
0642 T1N = data.mod.T1N;
0643 T2min = data.mod.T2min;
0644 T2max = data.mod.T2max;
0645 T2N = data.mod.T2N;
0646 
0647 T1vec = logspace(log10(T1min),log10(T1max),T1N);
0648 T2vec = logspace(log10(T2min),log10(T2max),T2N);
0649 MOD = zeros(numel(T1vec),numel(T2vec));
0650 
0651 [X1,X2] = meshgrid(T2vec,T1vec);
0652 X = [X1(:) X2(:)];
0653 
0654 <span class="comment">% get table with model parameters</span>
0655 table = get(gui.table_handles.mod,<span class="string">'Data'</span>);
0656 data.results.mod2D.table = table;
0657 <span class="comment">% create distributions</span>
0658 <span class="keyword">for</span> nn = 1:size(table,1)
0659     <span class="keyword">if</span> table{nn,1}
0660         <span class="comment">% muX muY</span>
0661         mu = [table{nn,2} table{nn,3}];
0662         <span class="comment">% sigma = [xx xy; yx yy]</span>
0663         Sigma = [table{nn,4} table{nn,6}; table{nn,7} table{nn,5}];
0664         <span class="comment">% get multivariate distribution of linearized data</span>
0665         p = <a href="../../../../nucleus/functions/modeling/getMultivariateGaussian.html" class="code" title="function pdf = getMultivariateGaussian(X,mu,sigma)">getMultivariateGaussian</a>(log10(X), log10(mu), Sigma);
0666         p = reshape(p,T1N,T2N);
0667         Amp = table{nn,8};
0668         MOD = MOD + Amp*p./max(p(:));
0669     <span class="keyword">end</span>
0670 <span class="keyword">end</span>
0671 
0672 <span class="keyword">if</span> any(isnan(MOD))
0673     MOD = ones(size(MOD));
0674 <span class="keyword">end</span>
0675 
0676 <span class="comment">% normalize to 1</span>
0677 MOD = MOD./sum(MOD(:));
0678 
0679 data.results.mod2D.T1vec = T1vec;
0680 data.results.mod2D.T2vec = T2vec;
0681 data.results.mod2D.MOD = MOD;
0682 <span class="comment">% update GUI data</span>
0683 setappdata(figh,<span class="string">'data'</span>,data);
0684 <span class="comment">% update plot</span>
0685 <a href="#_sub12" class="code" title="subfunction fv_plotModel(figh)">fv_plotModel</a>(figh);
0686 <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
0687 <span class="keyword">end</span>
0688 
0689 <span class="comment">%% subfunction to calculate the NMR signals</span>
0690 <a name="_sub7" href="#_subfunctions" class="code">function fv_getNMR(src,~)</a>
0691 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0692 gui = getappdata(figh,<span class="string">'gui'</span>);
0693 data = getappdata(figh,<span class="string">'data'</span>);
0694 mod2D = data.results.mod2D;
0695 
0696 <span class="comment">% prepare parameters</span>
0697 <span class="comment">% IR / SR factor</span>
0698 T1IRfac = data.nmr.T1IRfac;
0699 IRtype = data.nmr.IRtype;
0700 
0701 <span class="comment">% get system properties</span>
0702 D = data.prop.D;
0703 G0 = data.prop.G0;
0704 te = data.prop.te;
0705 Tbulk = data.prop.Tbulk;
0706 
0707 T1vec = mod2D.T1vec;
0708 T2vec = mod2D.T2vec;
0709 
0710 <span class="comment">% disable the RUN button to indicate a running inversion</span>
0711 set(gui.push_handles.nmr,<span class="string">'String'</span>,<span class="string">'RUNNING ...'</span>,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0712 pause(0.01);
0713 
0714 <span class="comment">% prepare data</span>
0715 <span class="comment">% T2 time vector</span>
0716 t2 = <a href="../../../../nucleus/functions/modeling/getNMRTimeVector.html" class="code" title="function t = getNMRTimeVector(TE,TEunit,varargin)">getNMRTimeVector</a>(data.nmr.T2te,<span class="string">'s'</span>,<span class="string">'N'</span>,data.nmr.T2teN);
0717 T1 = logspace(log10(data.nmr.T1trmin),log10(data.nmr.T1trmax),data.nmr.T1trN);
0718 dat = struct;
0719 <span class="keyword">for</span> n = 1:numel(T1)
0720     dat(n).t = t2;
0721     dat(n).s = zeros(size(t2));
0722     dat(n).T1 = T1(n);
0723 <span class="keyword">end</span>
0724 
0725 <span class="comment">% create the Kernel matrix for inversion</span>
0726 p.G0 = G0;
0727 p.D = D;
0728 p.te = te;
0729 p.Tbulk = Tbulk;
0730 p.T1IRfac = T1IRfac;
0731 p.IRtype = IRtype;
0732 [K,indices] = <a href="../../../../nucleus/functions/inversion/createKernelMatrix2D.html" class="code" title="function [K,indices] = createKernelMatrix2D(dat,T1vec,T2vec,p)">createKernelMatrix2D</a>(dat,T1vec,T2vec,p);
0733 
0734 MODvec = reshape(mod2D.MOD',size(mod2D.MOD,1)*size(mod2D.MOD,2),1);
0735 RESvec = K*MODvec;
0736 
0737 <span class="keyword">for</span> n = 1:numel(T1)
0738     dat(n).s = RESvec(indices.lin_1(n):indices.lin_end(n));
0739     dat(n).s_raw = RESvec(indices.lin_1(n):indices.lin_end(n));
0740 <span class="keyword">end</span>
0741 
0742 <span class="comment">% enable the RN button</span>
0743 set(gui.push_handles.nmr,<span class="string">'String'</span>,<span class="string">'GET NMR SIGNALS'</span>,<span class="keyword">...</span>
0744     <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction fv_getNMR(src,~)">fv_getNMR</a>);
0745 setappdata(figh,<span class="string">'gui'</span>,gui);
0746 
0747 <span class="comment">% save results</span>
0748 data.results.mod2D.t2 = t2;
0749 data.results.mod2D.t_recov = T1;
0750 data.results.mod2D.data = dat;
0751 
0752 <span class="comment">% update data</span>
0753 setappdata(figh,<span class="string">'data'</span>,data);
0754 <a href="#_sub5" class="code" title="subfunction fv_addNoise(figh)">fv_addNoise</a>(figh)
0755 
0756 <span class="comment">% plot all signals</span>
0757 <a href="#_sub11" class="code" title="subfunction fv_plotSignals(figh)">fv_plotSignals</a>(figh);
0758 <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
0759 gui.rightPanel.Selection = 2;
0760 <span class="keyword">end</span>
0761 
0762 <span class="comment">%% subfunction to export the 2D inversion data</span>
0763 <a name="_sub8" href="#_subfunctions" class="code">function fv_onPushSave(src,~)</a>
0764 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0765 <span class="comment">% local GUI data</span>
0766 data = getappdata(figh,<span class="string">'data'</span>);
0767 
0768 <span class="comment">% get data path to save inversion results</span>
0769 [sfile,spath] = uiputfile(<span class="string">'*.mat'</span>,<span class="string">'Select File for Save'</span>,<span class="keyword">...</span>
0770     fullfile(pwd,<span class="string">'2Dmoddata.mat'</span>));
0771 <span class="comment">% if user did not cancel, procceed</span>
0772 <span class="keyword">if</span> sfile &gt; 0
0773     moddata = data;
0774     save(fullfile(spath,sfile),<span class="string">'moddata'</span>);
0775     disp(<span class="string">'2D Modeling data saved to: '</span>);
0776     disp(fullfile(spath,sfile));
0777 <span class="keyword">else</span>
0778     disp(<span class="string">'Save cancelled.'</span>);
0779 <span class="keyword">end</span>
0780 
0781 <span class="keyword">end</span>
0782 
0783 <span class="comment">%% subfunction to export the current view to a figure</span>
0784 <a name="_sub9" href="#_subfunctions" class="code">function fv_onPushView(src,~)</a>
0785 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0786 <span class="comment">% local GUI data</span>
0787 gui = getappdata(figh,<span class="string">'gui'</span>);
0788 
0789 <span class="comment">% opening the export figure</span>
0790 expfig = figure(<span class="string">'Color'</span>,gui.myui.colors.panelBG);
0791 
0792 <span class="comment">% create axes layout depending on view</span>
0793 <span class="keyword">switch</span> get(gui.rightPanel,<span class="string">'Selection'</span>)
0794     <span class="keyword">case</span> 1
0795         <span class="comment">% create layout</span>
0796         ax1 = subplot(5,5,[1 2 3 4],<span class="string">'Parent'</span>,expfig);
0797         ax2 = subplot(5,5,[6:9 11:14 16:19 21:24],<span class="string">'Parent'</span>,expfig);
0798         ax3 = subplot(5,5,[10 15 20 25],<span class="string">'Parent'</span>,expfig);
0799         <span class="comment">% get positions</span>
0800         pos1 = get(ax1,<span class="string">'Position'</span>);
0801         pos2 = get(ax2,<span class="string">'Position'</span>);
0802         pos3 = get(ax3,<span class="string">'Position'</span>);
0803         <span class="comment">% delete axes</span>
0804         delete(ax1);delete(ax2);delete(ax3);
0805         <span class="comment">% copy GUI axes</span>
0806         ax1 = copyobj(gui.axes21,expfig);
0807         ax2 = copyobj(gui.axes2,expfig);
0808         ax3 = copyobj(gui.axes24,expfig);
0809         <span class="comment">% adjust positions</span>
0810         set(ax1,<span class="string">'Position'</span>,pos1);
0811         set(ax2,<span class="string">'Position'</span>,pos2);
0812         set(ax3,<span class="string">'Position'</span>,pos3);
0813     <span class="keyword">case</span> 2
0814         <span class="comment">% create layout</span>
0815         ax1 = subplot(7,1,[1 2],<span class="string">'Parent'</span>,expfig);
0816         ax2 = subplot(7,1,[4 5 6 7],<span class="string">'Parent'</span>,expfig);
0817         <span class="comment">% get positions</span>
0818         pos1 = get(ax1,<span class="string">'Position'</span>);
0819         pos2 = get(ax2,<span class="string">'Position'</span>);
0820         <span class="comment">% delete axes</span>
0821         delete(ax1);delete(ax2);
0822         <span class="comment">% copy GUI axes</span>
0823         ax1 = copyobj(gui.axes31,expfig);
0824         ax2 = copyobj(gui.axes32,expfig);
0825         <span class="comment">% adjust positions</span>
0826         set(ax1,<span class="string">'Position'</span>,pos1);
0827         set(ax2,<span class="string">'Position'</span>,pos2);
0828 <span class="keyword">end</span>
0829 
0830 <span class="keyword">end</span>
0831 
0832 <span class="comment">%% subfunction to update the main NUCLEUSinv GUI</span>
0833 <a name="_sub10" href="#_subfunctions" class="code">function fv_onPushUpdate(src,~)</a>
0834 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0835 <span class="comment">% local GUI data</span>
0836 uvgui = getappdata(figh,<span class="string">'gui'</span>);
0837 uvdata = getappdata(figh,<span class="string">'data'</span>);
0838 <span class="comment">% NUCLEUSinv data</span>
0839 gui = getappdata(uvgui.figh_nucleus,<span class="string">'gui'</span>);
0840 INVdata = getappdata(uvgui.figh_nucleus,<span class="string">'INVdata'</span>);
0841 data = getappdata(uvgui.figh_nucleus,<span class="string">'data'</span>);
0842 
0843 <span class="comment">% loop over all signals</span>
0844 E_inv = zeros(size(uvdata.results.T1T2map.t_recov));
0845 <span class="keyword">for</span> id = 1:numel(INVdata)
0846     <span class="comment">% the standard INVdata struct</span>
0847     INVdata{id} = [];
0848     
0849     <span class="comment">% old, slow but consistent way</span>
0850     <span class="comment">% trigger the listbox entry</span>
0851     <span class="comment">% set(gui.listbox_handles.signal,'Value',id);</span>
0852     <span class="comment">% onListboxData(gui.listbox_handles.signal);</span>
0853     <span class="comment">% no gating</span>
0854     <span class="comment">% which radiobutton ('log', 'lin' or 'none')</span>
0855     <span class="comment">% onRadioGates(gui.radio_handles.process_gates_none);</span>
0856     <span class="comment">% get the fresh data</span>
0857     <span class="comment">% data = getappdata(uvgui.figh_nucleus,'data');</span>
0858     
0859     <span class="comment">% new, fast and hopefully consistent :-) way</span>
0860     data.process.start = 1;
0861     data.process.end = numel(uvdata.results.T1T2map.import{id}.time);
0862     data.process.gatetype = <span class="string">'raw'</span>;
0863     <span class="comment">% update 2Dinv GUI settings</span>
0864     data.inv2D.prop = uvdata.prop;
0865     data.inv2D.inv = uvdata.inv;
0866     data.inv2D.info = uvdata.info;
0867     <span class="comment">% create raw data struct</span>
0868     data.results.nmrraw.t = uvdata.results.T1T2map.import{id}.time;
0869     data.results.nmrraw.s = uvdata.results.T1T2map.import{id}.signal;
0870     <span class="keyword">if</span> id == numel(INVdata)
0871         data.results.nmrraw.noise = uvdata.results.T1T2map.import{id}.noise;
0872         data.results.nmrproc.T1T2 = <span class="string">'T1'</span>;
0873         data.results.nmrproc.T1IRfac = 2;
0874     <span class="keyword">else</span>
0875         data.results.nmrraw.phase = uvdata.results.T1T2map.import{id}.phase;
0876     <span class="keyword">end</span>
0877     <span class="comment">% create proc data struct</span>
0878     data.results.nmrproc.start = 1;
0879     data.results.nmrproc.end = numel(uvdata.results.T1T2map.import{id}.time);
0880     data.results.nmrproc.gatetype = <span class="string">'raw'</span>;
0881     data.results.nmrproc.t = uvdata.results.T1T2map.import{id}.time;
0882     data.results.nmrproc.s = real(uvdata.results.T1T2map.import{id}.signal);
0883     data.results.nmrproc.N = ones(size(data.results.nmrproc.s));
0884     <span class="keyword">if</span> isfield(uvdata.results.T1T2map.import{id},<span class="string">'noise'</span>)
0885         data.results.nmrproc.noise = uvdata.results.T1T2map.import{id}.noise;
0886     <span class="keyword">else</span>
0887         range = floor(numel(data.results.nmrproc.s)/2):numel(data.results.nmrproc.s);
0888         data.results.nmrproc.noise = std(imag(uvdata.results.T1T2map.import{id}.signal(range)));
0889     <span class="keyword">end</span>
0890     data.results.nmrproc.e = data.results.nmrproc.noise*ones(size(data.results.nmrproc.s));
0891     <span class="keyword">if</span> isfield(data.results.nmrproc,<span class="string">'W'</span>)
0892         data.results.nmrproc = rmfield(data.results.nmrproc,<span class="string">'W'</span>);
0893     <span class="keyword">end</span>
0894 
0895     <span class="comment">% and use it for the INVdata</span>
0896     INVdata{id} = data;
0897     INVdata{id} = rmfield(INVdata{id},<span class="string">'import'</span>);
0898     INVdata{id} = rmfield(INVdata{id},<span class="string">'info'</span>);
0899     INVdata{id} = rmfield(INVdata{id},<span class="string">'calib'</span>);
0900     INVdata{id} = rmfield(INVdata{id},<span class="string">'pressure'</span>);
0901 
0902     <span class="comment">% now add a dummy &quot;invstd&quot; field</span>
0903     <span class="keyword">if</span> id == numel(INVdata)
0904         <span class="comment">% for the final merged T1</span>
0905         INVdata{id}.results.invstd.fit_t = uvdata.results.T1T2map.t_recov;
0906         INVdata{id}.results.invstd.fit_s = E_inv;
0907         INVdata{id}.results.invstd.E0 = uvdata.results.inv2D.E0;
0908         INVdata{id}.results.invstd.ciE0 = NaN;
0909         out = <a href="../../../../nucleus/functions/inversion/getFitErrors.html" class="code" title="function out = getFitErrors(s,sfit,noise,varargin)">getFitErrors</a>(uvdata.results.T1T2map.E_raw(:,1),E_inv,data.results.nmrproc.noise);
0910         INVdata{id}.results.invstd.resnorm = out.resnorm;
0911         INVdata{id}.results.invstd.residual = out.residual;
0912         INVdata{id}.results.invstd.chi2 = out.chi2;
0913         INVdata{id}.results.invstd.rms = out.rms;
0914     <span class="keyword">else</span>
0915         <span class="comment">% for the individual signals</span>
0916         INVdata{id}.results.invstd.fit_t = uvdata.results.inv2D.data(id).t;
0917         INVdata{id}.results.invstd.fit_s = uvdata.results.inv2D.data(id).s_fit;
0918         E_inv(id,1) = uvdata.results.inv2D.data(id).s_fit(1);
0919         INVdata{id}.results.invstd.E0 = uvdata.results.inv2D.data(id).s_fit(1);
0920         INVdata{id}.results.invstd.ciE0 = NaN;
0921         INVdata{id}.results.invstd.resnorm = uvdata.results.inv2D.data(id).resnorm;
0922         INVdata{id}.results.invstd.residual = uvdata.results.inv2D.data(id).residual;
0923         INVdata{id}.results.invstd.chi2 = uvdata.results.inv2D.data(id).chi2;
0924         INVdata{id}.results.invstd.rms = uvdata.results.inv2D.data(id).rms;
0925     <span class="keyword">end</span>
0926     INVdata{id}.results.invstd.lambda_out = 1;
0927     INVdata{id}.results.invstd.xn = 0;
0928     INVdata{id}.results.invstd.rn = 0;
0929     INVdata{id}.results.invstd.invtype = data.invstd.invtype;
0930     INVdata{id}.results.invstd.invparams = NaN;
0931     <span class="keyword">if</span> id == numel(INVdata)
0932         INVdata{id}.results.inv2D = uvdata.results.inv2D;
0933     <span class="keyword">else</span>
0934         INVdata{id}.results.inv2D = true;
0935     <span class="keyword">end</span>
0936 
0937     <span class="comment">% color the corresponding list entries in the main GUI</span>
0938     strL = get(gui.listbox_handles.signal,<span class="string">'String'</span>);
0939     str1 = strL{id};
0940     str2 = [<span class="string">'&lt;HTML&gt;&lt;BODY bgcolor=&quot;rgb('</span>,<span class="keyword">...</span>
0941         sprintf(<span class="string">'%d,%d,%d'</span>,gui.myui.colors.listINV.*255),<span class="string">')&quot;&gt;'</span>,str1,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;'</span>];
0942     strL{id} = str2;
0943     set(gui.listbox_handles.signal,<span class="string">'String'</span>,strL);
0944 <span class="keyword">end</span>
0945 
0946 <span class="comment">% update GUI INVdata</span>
0947 setappdata(uvgui.figh_nucleus,<span class="string">'INVdata'</span>,INVdata);
0948 
0949 <span class="comment">% set focus on first signal</span>
0950 set(gui.listbox_handles.signal,<span class="string">'Value'</span>,1);
0951 <a href="../../../../nucleus/callbacks/listboxes/onListboxData.html" class="code" title="function onListboxData(src,~)">onListboxData</a>(gui.listbox_handles.signal);
0952 <span class="keyword">end</span>
0953 
0954 <span class="comment">%% subfunction to update all plots</span>
0955 <a name="_sub11" href="#_subfunctions" class="code">function fv_plotSignals(figh)</a>
0956 gui = getappdata(figh,<span class="string">'gui'</span>);
0957 data = getappdata(figh,<span class="string">'data'</span>);
0958 mod2D = data.results.mod2D;
0959 data_mod = mod2D.data;
0960 col = gui.myui.colors;
0961 
0962 <span class="comment">% clear axes</span>
0963 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes31);
0964 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes32);
0965 hold(gui.axes31,<span class="string">'on'</span>);
0966 hold(gui.axes32,<span class="string">'on'</span>);
0967 
0968 <span class="comment">% define some axes settings</span>
0969 log_t_ticks = logspace(-5,2,8);
0970 t_recov_lims = [min(mod2D.t_recov)/2 max(mod2D.t_recov)*2];
0971 
0972 <span class="comment">% prepare the data for the combined T1 curve</span>
0973 E_mod = zeros(size(mod2D.t_recov));
0974 <span class="keyword">for</span> nn = 1:numel(data_mod)
0975     E_mod(nn,1) = data_mod(nn).s(1);
0976     <span class="comment">% plot individual T2 signals and fits</span>
0977     plot3(data_mod(nn).t,data_mod(nn).T1*ones(size(data_mod(nn).s)),<span class="keyword">...</span>
0978         data_mod(nn).s,<span class="string">'Color'</span>,col.axisL,<span class="string">'DisplayName'</span>,<span class="string">'T2 signals'</span>,<span class="keyword">...</span>
0979         <span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,gui.axes32);
0980 <span class="keyword">end</span>
0981 view(gui.axes32,[30 20]);
0982 set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks);
0983 set(gui.axes32,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>,<span class="string">'YTick'</span>,log_t_ticks,<span class="string">'YLim'</span>,t_recov_lims);
0984 set(get(gui.axes32,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
0985 set(get(gui.axes32,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
0986 set(get(gui.axes32,<span class="string">'ZLabel'</span>),<span class="string">'String'</span>,<span class="string">'amplitude [a.u.]'</span>);
0987 <span class="comment">% fv_fixLabel3DAxes(gui.axes32)</span>
0988 
0989 <span class="comment">% tab 3 - combined T1 curve and fit</span>
0990 plot(mod2D.t_recov,E_mod(:,1),<span class="string">'o-'</span>,<span class="string">'Color'</span>,col.axisL,<span class="keyword">...</span>
0991     <span class="string">'LineWidth'</span>,1,<span class="string">'DisplayName'</span>,<span class="string">'T1 curve'</span>,<span class="string">'Parent'</span>,gui.axes31);
0992 set(gui.axes31,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XLim'</span>,t_recov_lims);
0993 set(gui.axes31,<span class="string">'YScale'</span>,<span class="string">'lin'</span>);
0994 set(get(gui.axes31,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
0995 set(get(gui.axes31,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'mean(E(1:3)) [a.u.]'</span>);
0996 legend(gui.axes31,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
0997 
0998 <span class="comment">% hold off all axes</span>
0999 hold(gui.axes31,<span class="string">'off'</span>);
1000 hold(gui.axes32,<span class="string">'off'</span>);
1001 
1002 <span class="comment">% call function to adapt the axes scaling</span>
1003 <a href="#_sub14" class="code" title="subfunction fv_setAxesScaling(figh)">fv_setAxesScaling</a>(figh);
1004 <span class="keyword">end</span>
1005 
1006 <span class="comment">%%  subfunction to plot the raw data</span>
1007 <a name="_sub12" href="#_subfunctions" class="code">function fv_plotModel(figh)</a>
1008 gui = getappdata(figh,<span class="string">'gui'</span>);
1009 data = getappdata(figh,<span class="string">'data'</span>);
1010 col = gui.myui.colors;
1011 mod2D = data.results.mod2D;
1012 
1013 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes2);
1014 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes21);
1015 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes24);
1016 hold(gui.axes2,<span class="string">'on'</span>);
1017 hold(gui.axes21,<span class="string">'on'</span>);
1018 hold(gui.axes24,<span class="string">'on'</span>);
1019 
1020 log_t_ticks = logspace(-5,2,8);
1021 
1022 <span class="comment">% tab 2 - 2D inversion model</span>
1023 [X,Y] = meshgrid(mod2D.T2vec,mod2D.T1vec);
1024 imagescnan(X,Y,mod2D.MOD,<span class="string">'Parent'</span>,gui.axes2);
1025 plot([1e-5 100],[1e-5 100],<span class="keyword">...</span>
1026     <span class="string">'--'</span>,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'LineWidth'</span>,1,<span class="string">'Tag'</span>,<span class="string">'one2one'</span>,<span class="string">'Parent'</span>,gui.axes2);
1027 view(gui.axes2,[0 90]);
1028 set(gui.axes2,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks,<span class="keyword">...</span>
1029     <span class="string">'XLim'</span>,[min(mod2D.T2vec) max(mod2D.T2vec)]);
1030 set(gui.axes2,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks,<span class="keyword">...</span>
1031     <span class="string">'YLim'</span>,[min(mod2D.T1vec) max(mod2D.T1vec)],<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
1032 set(get(gui.axes2,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'relaxation time T2 [s]'</span>);
1033 set(get(gui.axes2,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'relaxation time T1 [s]'</span>);
1034 set(gui.axes2,<span class="string">'Layer'</span>,<span class="string">'top'</span>,<span class="string">'XGrid'</span>,<span class="string">'off'</span>,<span class="string">'YGrid'</span>,<span class="string">'off'</span>);
1035 
1036 <span class="comment">% sum along each dimension to get both RTDs</span>
1037 T1rtd = sum(mod2D.MOD,2);
1038 T2rtd = sum(mod2D.MOD,1);
1039 <span class="comment">% find common maximum for y-axis setting</span>
1040 ymax = max([max(T1rtd) max(T2rtd)])*1.1;
1041 <span class="comment">% T1 RTD</span>
1042 plot(T1rtd,mod2D.T1vec,<span class="string">'Color'</span>,col.axisL,<span class="string">'Parent'</span>,gui.axes24);
1043 set(gui.axes24,<span class="string">'XScale'</span>,<span class="string">'lin'</span>,<span class="string">'XLim'</span>,[0 ymax]);
1044 set(gui.axes24,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YTickLabel'</span>,<span class="string">''</span>);
1045 
1046 <span class="comment">% T2 RTD</span>
1047 plot(mod2D.T2vec,T2rtd,<span class="string">'Color'</span>,col.axisL,<span class="string">'DisplayName'</span>,<span class="string">'RTD'</span>,<span class="string">'Parent'</span>,gui.axes21);
1048 set(gui.axes21,<span class="string">'YScale'</span>,<span class="string">'lin'</span>,<span class="string">'YLim'</span>,[0 ymax]);
1049 set(gui.axes21,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTickLabel'</span>,<span class="string">''</span>);
1050 
1051 hold(gui.axes2,<span class="string">'off'</span>);
1052 hold(gui.axes21,<span class="string">'off'</span>);
1053 hold(gui.axes24,<span class="string">'off'</span>);
1054 <span class="keyword">end</span>
1055 
1056 <span class="comment">%% subfunction zo switch x-axis scaling</span>
1057 <a name="_sub13" href="#_subfunctions" class="code">function fv_onRadioLogLin(src,~)</a>
1058 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1059 gui = getappdata(figh,<span class="string">'gui'</span>);
1060 <span class="comment">% get tag of the radio menu</span>
1061 tag = get(src,<span class="string">'Tag'</span>);
1062 val = get(src,<span class="string">'Value'</span>);
1063 
1064 <span class="keyword">switch</span> tag
1065     <span class="keyword">case</span> <span class="string">'log'</span>
1066         <span class="keyword">switch</span> val
1067             <span class="keyword">case</span> 1 <span class="comment">% log should be used</span>
1068                 set(gui.radio_handles.lin,<span class="string">'Value'</span>,0);
1069             <span class="keyword">case</span> 0 <span class="comment">% lin should be used</span>
1070                 set(gui.radio_handles.lin,<span class="string">'Value'</span>,1);
1071         <span class="keyword">end</span>
1072     <span class="keyword">case</span> <span class="string">'lin'</span>
1073         <span class="keyword">switch</span> val
1074             <span class="keyword">case</span> 1 <span class="comment">% lin should be used</span>
1075                 set(gui.radio_handles.log,<span class="string">'Value'</span>,0);
1076             <span class="keyword">case</span> 0 <span class="comment">% log should be used</span>
1077                 set(gui.radio_handles.log,<span class="string">'Value'</span>,1);
1078         <span class="keyword">end</span>
1079 <span class="keyword">end</span>
1080 <span class="comment">% update GUI data</span>
1081 setappdata(figh,<span class="string">'gui'</span>,gui);
1082 
1083 <span class="comment">% call function to adapt the axes scaling</span>
1084 <a href="#_sub14" class="code" title="subfunction fv_setAxesScaling(figh)">fv_setAxesScaling</a>(figh);
1085 <span class="keyword">end</span>
1086 
1087 <span class="comment">%% subfunction to switch x-axis scaling log&lt;-&gt;lin</span>
1088 <a name="_sub14" href="#_subfunctions" class="code">function fv_setAxesScaling(figh)</a>
1089 gui = getappdata(figh,<span class="string">'gui'</span>);
1090 
1091 uselog = get(gui.radio_handles.log,<span class="string">'Value'</span>);
1092 <span class="keyword">switch</span> uselog
1093     <span class="keyword">case</span> 1
1094         log_t_ticks = logspace(-5,2,8);
1095         set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks);
1096     <span class="keyword">case</span> 0
1097         set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'lin'</span>,<span class="string">'XTickMode'</span>,<span class="string">'auto'</span>);
1098 <span class="keyword">end</span>
1099 
1100 <span class="keyword">end</span>
1101 
1102 <span class="comment">%% close function</span>
1103 <a name="_sub15" href="#_subfunctions" class="code">function fv_closeme(src,~)</a>
1104 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1105 <span class="comment">% try to close the sub GUI in a clean manner</span>
1106 <span class="keyword">try</span>
1107     <span class="comment">% NOTE: maybe needed at some later point</span>
1108     <span class="comment">%     gui = getappdata(figh,'gui');</span>
1109     <span class="comment">%     data = getappdata(gui.figh_nucleus,'data');</span>
1110     <span class="comment">%     % update NUCLEUSinv</span>
1111     <span class="comment">%     setappdata(gui.figh_nucleus,'data',data);</span>
1112     delete(figh);
1113 <span class="keyword">catch</span>
1114     <span class="comment">% if this is not working: just close it</span>
1115     delete(figh);
1116 <span class="keyword">end</span>
1117 
1118 <span class="keyword">end</span>
1119 
1120 <span class="comment">%------------- END OF CODE --------------</span>
1121 
1122 <span class="comment">%% License:</span>
1123 <span class="comment">% MIT License</span>
1124 <span class="comment">%</span>
1125 <span class="comment">% Copyright (c) 2024 Thomas Hiller</span>
1126 <span class="comment">%</span>
1127 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
1128 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
1129 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
1130 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
1131 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
1132 <span class="comment">% furnished to do so, subject to the following conditions:</span>
1133 <span class="comment">%</span>
1134 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
1135 <span class="comment">% copies or substantial portions of the Software.</span>
1136 <span class="comment">%</span>
1137 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
1138 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
1139 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
1140 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
1141 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
1142 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
1143 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>