<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Inv2DView</title>
  <meta name="keywords" content="Inv2DView">
  <meta name="description" content=" is an extra subGUI to calculate 2D inversion of T1-T2 data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- ../menu.html interface --><!-- menu.html subGUIs -->
<h1>Inv2DView
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong> is an extra subGUI to calculate 2D inversion of T1-T2 data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function Inv2DView(src,~) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">Inv2DView is an extra subGUI to calculate 2D inversion of T1-T2 data

 Syntax:
       Inv2DView

 Inputs:
       src - handle of the calling object

 Outputs:
       none

 Example:
       Inv2DView(src,~)

 Other m-files required:
       beautifyAxes
       clearAllAxes
       displayStatusText
       fitData2D
       imagescnan
       onListboxData
       onRadioGates
       updatePlotsSignal;
       updatePlotsDistribution;
       updateInfo;

 Subfunctions:
       findApproxTlgmAmplitude
       tv_closeme
       tv_estimateIRtype
       tv_getTLGM
       tv_onCheckDCM
       tv_onEditValue
       tv_onPopupIRType
       tv_onPopupT1Type
       tv_onPushRun
       tv_onPushSave
       tv_onPushView
       tv_onPushUpdate
       tv_onRadioLogLin
       tv_plotResults
       tv_plotRawData
       tv_prepareRawData
       tv_setAxesScaling

 MAT-files required:
       none

 See also: NUCLEUSinv
 Author: see AUTHORS.md
 email: see AUTHORS.md
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../nucleus/callbacks/listboxes/onListboxData.html" class="code" title="function onListboxData(src,~)">onListboxData</a>	 handles the calls from the context menu of the data</li><li><a href="../../../../nucleus/callbacks/menus/onMenuView.html" class="code" title="function onMenuView(src,~)">onMenuView</a>	 handles the view menu entries</li><li><a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>	 can be used to globally change the general appearance of axes</li><li><a href="../../../../nucleus/functions/interface/changeColorTheme.html" class="code" title="function changeColorTheme(fig_tag,th)">changeColorTheme</a>	 changes the color theme of the calling figure</li><li><a href="../../../../nucleus/functions/interface/clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>	 clears all axes of a given figure</li><li><a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>	 clears an individual axis</li><li><a href="../../../../nucleus/functions/interface/displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>	 shows status information either in the GUI or on the</li><li><a href="../../../../nucleus/functions/interface/fixVerticalTextAlignment.html" class="code" title="function fixVerticalTextAlignment(fig)">fixVerticalTextAlignment</a>	 fixes the vertical positioning of all text</li><li><a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>	 handles the minimization/maximization of all box-panels for</li><li><a href="../../../../nucleus/functions/interface/onFigureSizeChange.html" class="code" title="function onFigureSizeChange(fig,~)">onFigureSizeChange</a>	 fixes an ugly Matlab bug when resizing a box-panel</li><li><a href="../../../../nucleus/functions/inversion/applyGatesToSignal.html" class="code" title="function data = applyGatesToSignal(time,signal,varargin)">applyGatesToSignal</a>	 re-samples (gates) a NMR signal to speedup the</li><li><a href="../../../../nucleus/functions/inversion/fitData2D.html" class="code" title="function fitdata = fitData2D(data,parameter)">fitData2D</a>	 is a control routine that fits 2D NMR data;</li><li><a href="../../../../nucleus/functions/inversion/getFitErrors.html" class="code" title="function out = getFitErrors(s,sfit,noise,varargin)">getFitErrors</a>	 calculates all relevant fitting errors for the NMR inversion</li><li><a href="../../../../nucleus/functions/inversion/getTLogMean2D.html" class="code" title="function [TLGM,TMAX] = getTLogMean2D(T1,T2,f,varargin)">getTLogMean2D</a>	</li><li><a href="../../../../nucleus/functions/inversion/runLcurveDiscrete.html" class="code" title="function out = runLcurveDiscrete(lparam,iparam,gui)">runLcurveDiscrete</a>	</li><li><a href="../../../../nucleus/functions/inversion/runLcurveIterative.html" class="code" title="function out = runLcurveIterative(lparam,iparam,gui)">runLcurveIterative</a>	 performs an iterative L-curve calculation. This routine</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="../../../../nucleus/callbacks/menus/onMenuSubGUIs.html" class="code" title="function onMenuSubGUIs(src,~)">onMenuSubGUIs</a>	 handles the extra menu entries to open NUCLEUS sub GUIs</li><li><a href="../../../../nucleus/functions/interface/importMOD2D2INV.html" class="code" title="function importMOD2D2INV(src)">importMOD2D2INV</a>	 imports data directly from the NUCLEUSmod 2D GUI</li><li><a href="../../../../nucleus/functions/interface/importNMRdata.html" class="code" title="function importNMRdata(src)">importNMRdata</a>	 is the general import routine for NMR data</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function tv_onCheckLinkLambdas(src,~)</a></li><li><a href="#_sub2" class="code">function tv_onCheckLogGates(src,~)</a></li><li><a href="#_sub3" class="code">function tv_onEditValue(src,~)</a></li><li><a href="#_sub4" class="code">function tv_onPopupT1Type(src,~)</a></li><li><a href="#_sub5" class="code">function tv_onPopupIRType(src,~)</a></li><li><a href="#_sub6" class="code">function tv_onPopupRegType(src,~)</a></li><li><a href="#_sub7" class="code">function tv_onPushRun(src,~)</a></li><li><a href="#_sub8" class="code">function tv_onPush2DLCURVE(src,~)</a></li><li><a href="#_sub9" class="code">function [dat,param] = tv_prepareInvData(figh)</a></li><li><a href="#_sub10" class="code">function tv_onPushSave(src,~)</a></li><li><a href="#_sub11" class="code">function tv_onPushView(src,~)</a></li><li><a href="#_sub12" class="code">function tv_onPushUpdate(src,~)</a></li><li><a href="#_sub13" class="code">function tv_onRadioLogLin(src,~)</a></li><li><a href="#_sub14" class="code">function tv_onCheckDCM(src,~)</a></li><li><a href="#_sub15" class="code">function tv_onPopupCbar(src,~)</a></li><li><a href="#_sub16" class="code">function tv_setAxesScaling(figh)</a></li><li><a href="#_sub17" class="code">function tv_plotLCurveUpdate(figh,tmp_norm,method)</a></li><li><a href="#_sub18" class="code">function tv_plotResults(figh)</a></li><li><a href="#_sub19" class="code">function tv_plotRawData(figh)</a></li><li><a href="#_sub20" class="code">function tv_checkLSEparams(data)</a></li><li><a href="#_sub21" class="code">function tv_getTLGM(figh)</a></li><li><a href="#_sub22" class="code">function amp = findApproxTlgmAmplitude(t,f,TLGM)</a></li><li><a href="#_sub23" class="code">function tv_prepareRawData(figh)</a></li><li><a href="#_sub24" class="code">function tv_estimateIRtype(figh)</a></li><li><a href="#_sub25" class="code">function txt = localDcmFcn(~,event,ax)</a></li><li><a href="#_sub26" class="code">function tv_closeme(src,~)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function Inv2DView(src,~)</a>
0002 <span class="comment">%Inv2DView is an extra subGUI to calculate 2D inversion of T1-T2 data</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       Inv2DView</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       src - handle of the calling object</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Outputs:</span>
0011 <span class="comment">%       none</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Example:</span>
0014 <span class="comment">%       Inv2DView(src,~)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Other m-files required:</span>
0017 <span class="comment">%       beautifyAxes</span>
0018 <span class="comment">%       clearAllAxes</span>
0019 <span class="comment">%       displayStatusText</span>
0020 <span class="comment">%       fitData2D</span>
0021 <span class="comment">%       imagescnan</span>
0022 <span class="comment">%       onListboxData</span>
0023 <span class="comment">%       onRadioGates</span>
0024 <span class="comment">%       updatePlotsSignal;</span>
0025 <span class="comment">%       updatePlotsDistribution;</span>
0026 <span class="comment">%       updateInfo;</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% Subfunctions:</span>
0029 <span class="comment">%       findApproxTlgmAmplitude</span>
0030 <span class="comment">%       tv_closeme</span>
0031 <span class="comment">%       tv_estimateIRtype</span>
0032 <span class="comment">%       tv_getTLGM</span>
0033 <span class="comment">%       tv_onCheckDCM</span>
0034 <span class="comment">%       tv_onEditValue</span>
0035 <span class="comment">%       tv_onPopupIRType</span>
0036 <span class="comment">%       tv_onPopupT1Type</span>
0037 <span class="comment">%       tv_onPushRun</span>
0038 <span class="comment">%       tv_onPushSave</span>
0039 <span class="comment">%       tv_onPushView</span>
0040 <span class="comment">%       tv_onPushUpdate</span>
0041 <span class="comment">%       tv_onRadioLogLin</span>
0042 <span class="comment">%       tv_plotResults</span>
0043 <span class="comment">%       tv_plotRawData</span>
0044 <span class="comment">%       tv_prepareRawData</span>
0045 <span class="comment">%       tv_setAxesScaling</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% MAT-files required:</span>
0048 <span class="comment">%       none</span>
0049 <span class="comment">%</span>
0050 <span class="comment">% See also: NUCLEUSinv</span>
0051 <span class="comment">% Author: see AUTHORS.md</span>
0052 <span class="comment">% email: see AUTHORS.md</span>
0053 <span class="comment">% License: MIT License (at end)</span>
0054 
0055 <span class="comment">%------------- BEGIN CODE --------------</span>
0056 
0057 <span class="comment">%% get GUI handle and data</span>
0058 figh_nucleus = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0059 nucleus.data = getappdata(figh_nucleus,<span class="string">'data'</span>);
0060 nucleus.gui = getappdata(figh_nucleus,<span class="string">'gui'</span>);
0061 myui = nucleus.gui.myui;
0062 colors = myui.colors;
0063 
0064 <span class="comment">%% get GUI data from NUCLEUS</span>
0065 data = nucleus.data.inv2D;
0066 
0067 <span class="comment">% check if the figure is already open</span>
0068 fig_T1T2map = findobj(<span class="string">'Tag'</span>,<span class="string">'2DINV'</span>);
0069 <span class="comment">% if not, create it</span>
0070 <span class="keyword">if</span> isempty(fig_T1T2map)
0071     <span class="comment">% draw the figure on top of NUCLEUSinv</span>
0072     fig_T1T2map = figure(<span class="string">'Name'</span>,<span class="string">'NUCLEUSinv - 2D Inversion'</span>,<span class="keyword">...</span>
0073         <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'Resize'</span>,<span class="string">'on'</span>,<span class="string">'ToolBar'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0074         <span class="string">'Tag'</span>,<span class="string">'2DINV'</span>,<span class="string">'CloseRequestFcn'</span>,@<a href="#_sub26" class="code" title="subfunction tv_closeme(src,~)">tv_closeme</a>,<span class="keyword">...</span>
0075         <span class="string">'SizeChangedFcn'</span>,@<a href="../../../../nucleus/functions/interface/onFigureSizeChange.html" class="code" title="function onFigureSizeChange(fig,~)">onFigureSizeChange</a>,<span class="string">'MenuBar'</span>,<span class="string">'none'</span>);
0076     pos0 = get(figh_nucleus,<span class="string">'Position'</span>);
0077     cent(1) = (pos0(1)+pos0(3)/2);
0078     cent(2) = (pos0(2)+pos0(4)/2);
0079     posf = [cent(1)-pos0(3)/2.5 pos0(2)+22 pos0(3)/1.25 pos0(4)-22];
0080     <span class="comment">% posf = pos0;</span>
0081     set(fig_T1T2map,<span class="string">'Position'</span>,posf);
0082 
0083     gui.menu.view = uimenu(fig_T1T2map,<span class="string">'Label'</span>,<span class="string">'View'</span>);
0084     gui.menu.view_toolbar = uimenu(gui.menu.view,<span class="string">'Label'</span>,<span class="string">'Figure Toolbar'</span>,<span class="keyword">...</span>
0085         <span class="string">'Callback'</span>,@<a href="../../../../nucleus/callbacks/menus/onMenuView.html" class="code" title="function onMenuView(src,~)">onMenuView</a>);
0086 
0087     cpanel_w = 175;
0088 
0089     <span class="comment">% create the main layout</span>
0090     gui.main = uix.HBox(<span class="string">'Parent'</span>,fig_T1T2map,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0091         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,5,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0092     gui.left = uix.ScrollingPanel(<span class="string">'Parent'</span>,gui.main);
0093     gui.panels.main = uix.VBox(<span class="string">'Parent'</span>,gui.left,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0094         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,0); <span class="comment">% controls</span>
0095     gui.right = uix.VBox(<span class="string">'Parent'</span>,gui.main,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0096         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,0); <span class="comment">% plots</span>
0097 
0098     set(gui.main,<span class="string">'Widths'</span>,[350 -1 ]);
0099 
0100     <span class="comment">% waitbar indicating the loading of the GUI</span>
0101     steps = 6;
0102     hwb = waitbar(0,<span class="string">'loading ...'</span>,<span class="string">'Name'</span>,<span class="string">'T1T2 2DInv GUI initialization'</span>,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0103     set(hwb,<span class="string">'Units'</span>,<span class="string">'Pixel'</span>)
0104     posw = get(hwb,<span class="string">'Position'</span>);
0105     set(hwb,<span class="string">'Position'</span>,[posf(1)+posf(3)/2-posw(3)/2 posf(2)+posf(4)/2-posw(4)/2 posw(3:4)]);
0106     set(hwb,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0107 
0108     <span class="comment">%% --- properties panel ---</span>
0109     waitbar(1/steps,hwb,<span class="string">'loading GUI elements - properties'</span>);
0110     gui.panels.prop.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0111         <span class="string">'Title'</span>,<span class="string">'Properties'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0112         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0113         <span class="string">'TitleColor'</span>,colors.BoxINV,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0114     gui.panels.prop.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.prop.main,<span class="keyword">...</span>
0115         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0116 
0117     <span class="comment">% D coeff.</span>
0118     gui.panels.prop.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0119         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0120     gui.text_handles.diff = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox1,<span class="keyword">...</span>
0121         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0122         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0123         <span class="string">'String'</span>,[<span class="string">'Diffusion coeff. [10'</span>,char(hex2dec(<span class="string">'207B'</span>)),<span class="keyword">...</span>
0124         char(hex2dec(<span class="string">'2079'</span>)),<span class="string">' m'</span>,char(hex2dec(<span class="string">'00B2'</span>)),<span class="string">'/s]'</span>]);
0125     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox1);
0126     tstr = <span class="string">'Set diffusion coefficient.'</span>;
0127     gui.edit_handles.diff = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox1,<span class="keyword">...</span>
0128         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.prop.D*1e9),<span class="keyword">...</span>
0129         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'diff'</span>,<span class="keyword">...</span>
0130         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0131         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0132         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0133     set(gui.panels.prop.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0134 
0135     <span class="comment">% Gradient</span>
0136     gui.panels.prop.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0137         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0138     gui.text_handles.gradient = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox2,<span class="keyword">...</span>
0139         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0140         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0141         <span class="string">'String'</span>,&quot;Gradient [T/m]&quot;);
0142     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox2);
0143     tstr = <span class="string">'Set device gradient.'</span>;
0144     gui.edit_handles.gradient = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox2,<span class="keyword">...</span>
0145         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.G0),<span class="keyword">...</span>
0146         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'gradient'</span>,<span class="keyword">...</span>
0147         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0148         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0149         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0150     set(gui.panels.prop.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0151 
0152     <span class="comment">% echo time</span>
0153     gui.panels.prop.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0154         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0155     gui.text_handles.echo_time = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox3,<span class="keyword">...</span>
0156         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0157         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0158         <span class="string">'String'</span>,&quot;Echo time TE [µs]&quot;);
0159     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox3);
0160     tstr = <span class="string">'Set echo time tE.'</span>;
0161     gui.edit_handles.echo_time = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox3,<span class="keyword">...</span>
0162         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.te*1e6),<span class="keyword">...</span>
0163         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'echo_time'</span>,<span class="keyword">...</span>
0164         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0165         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0166         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0167         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0168     set(gui.panels.prop.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0169 
0170     <span class="comment">% first and last recovery time</span>
0171     gui.panels.prop.HBox4 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0172         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0173     gui.text_handles.firstT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox4,<span class="keyword">...</span>
0174         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0175         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0176         <span class="string">'String'</span>,&quot;T1 recov - first | last&quot;);
0177     tstr = <span class="string">'Set first / last T1 recovery time.'</span>;
0178     gui.edit_handles.firstT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox4,<span class="keyword">...</span>
0179         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.firstT1),<span class="keyword">...</span>
0180         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'firstT1'</span>,<span class="keyword">...</span>
0181         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0182         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0183         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0184     gui.edit_handles.lastT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox4,<span class="keyword">...</span>
0185         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.lastT1),<span class="keyword">...</span>
0186         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lastT1'</span>,<span class="keyword">...</span>
0187         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0188         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0189         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0190     set(gui.panels.prop.HBox4,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0191 
0192     <span class="comment">% first and last echo</span>
0193     gui.panels.prop.HBox5 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0194         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0195     gui.text_handles.first = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox5,<span class="keyword">...</span>
0196         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0197         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0198         <span class="string">'String'</span>,&quot;T2 echoes - first | last&quot;);
0199     tstr = <span class="string">'Set first / last echo of all T2 signals.'</span>;
0200     gui.edit_handles.firstT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox5,<span class="keyword">...</span>
0201         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.firstT2),<span class="keyword">...</span>
0202         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'firstT2'</span>,<span class="keyword">...</span>
0203         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0204         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0205         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0206     gui.edit_handles.lastT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox5,<span class="keyword">...</span>
0207         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.lastT2),<span class="keyword">...</span>
0208         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lastT2'</span>,<span class="keyword">...</span>
0209         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0210         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0211         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0212     set(gui.panels.prop.HBox5,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0213 
0214     <span class="comment">% signal gateing</span>
0215     gui.panels.prop.HBox6 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0216         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0217     gui.text_handles.gateing = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox6,<span class="keyword">...</span>
0218         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0219         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0220         <span class="string">'String'</span>,&quot;Log gating | #gates&quot;);
0221     tstr = <span class="string">'Activate / deactivate signal log gateing. Set number of gates.'</span>;
0222     gui.check_handles.gateing = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox6,<span class="keyword">...</span>
0223         <span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="string">'String'</span>,<span class="string">'on/off'</span>,<span class="string">'Value'</span>,0,<span class="keyword">...</span>
0224         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'gateing'</span>,<span class="keyword">...</span>
0225         <span class="string">'BackGroundColor'</span>,myui.colors.panelBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0226         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0227         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction tv_onCheckLogGates(src,~)">tv_onCheckLogGates</a>);
0228     gui.edit_handles.Ngates = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox6,<span class="keyword">...</span>
0229         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.Ngates),<span class="keyword">...</span>
0230         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'Ngates'</span>,<span class="keyword">...</span>
0231         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0232         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0233         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0234         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0235     set(gui.panels.prop.HBox6,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0236 
0237     <span class="comment">%% --- inversion panel ---</span>
0238     waitbar(2/steps,hwb,<span class="string">'loading GUI elements - 2D inversion'</span>);
0239     gui.panels.inv.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0240         <span class="string">'Title'</span>,<span class="string">'2D inversion settings'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0241         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0242         <span class="string">'TitleColor'</span>,colors.BoxINV,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0243     gui.panels.inv.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.inv.main,<span class="keyword">...</span>
0244         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0245 
0246     <span class="comment">% T1type</span>
0247     gui.panels.inv.HBox0 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0248         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0249     gui.text_handles.T1type = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox0,<span class="keyword">...</span>
0250         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0251         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0252         <span class="string">'String'</span>,<span class="string">'T1 type (SR / IR)'</span>);
0253     tstr = <span class="string">'Choose between Saturation and Inversion Recovery.'</span>;
0254     gui.popup_handles.T1type = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox0,<span class="keyword">...</span>
0255         <span class="string">'Style'</span>,<span class="string">'popup'</span>,<span class="string">'String'</span>,{<span class="string">'Saturation Recovery'</span>,<span class="string">'Inversion Recovery'</span>},<span class="keyword">...</span>
0256         <span class="string">'Value'</span>,data.inv.T1IRfac,<span class="string">'FontSize'</span>,myui.fontsize,<span class="keyword">...</span>
0257         <span class="string">'BackGroundColor'</span>,myui.colors.editBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0258         <span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="string">'Callback'</span>,@<a href="#_sub4" class="code" title="subfunction tv_onPopupT1Type(src,~)">tv_onPopupT1Type</a>);
0259     set(gui.panels.inv.HBox0,<span class="string">'Widths'</span>,[cpanel_w -1]);
0260 
0261     <span class="comment">% IR kernel type</span>
0262     gui.panels.inv.HBox01 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0263         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0264     gui.text_handles.IRtype = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox01,<span class="keyword">...</span>
0265         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0266         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0267         <span class="string">'String'</span>,<span class="string">'IR kernel type'</span>);
0268     tstr = <span class="string">'Choose IR kernel type.'</span>;
0269     gui.popup_handles.IRtype = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox01,<span class="keyword">...</span>
0270         <span class="string">'Style'</span>,<span class="string">'popup'</span>,<span class="string">'String'</span>,{<span class="string">'1-2exp(-t/T1)'</span>,<span class="string">'-exp(-t/T1)'</span>},<span class="keyword">...</span>
0271         <span class="string">'Value'</span>,1,<span class="string">'FontSize'</span>,myui.fontsize,<span class="keyword">...</span>
0272         <span class="string">'BackGroundColor'</span>,myui.colors.editBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0273         <span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="string">'Callback'</span>,@<a href="#_sub5" class="code" title="subfunction tv_onPopupIRType(src,~)">tv_onPopupIRType</a>);
0274     set(gui.panels.inv.HBox01,<span class="string">'Widths'</span>,[cpanel_w -1]);
0275 
0276     <span class="comment">% RTD T1</span>
0277     gui.panels.inv.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0278         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0279     gui.text_handles.rtdT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox1,<span class="keyword">...</span>
0280         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0281         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0282         <span class="string">'String'</span>,<span class="string">'RTD T1 [s] -  min | max | #'</span>);
0283     tstr = &quot;&quot;;
0284     gui.edit_handles.rtdT1min = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox1,<span class="keyword">...</span>
0285         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.inv.T1min),<span class="keyword">...</span>
0286         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1min'</span>,<span class="keyword">...</span>
0287         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0288         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0289         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0290     tstr = &quot;&quot;;
0291     gui.edit_handles.rtdT1max = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox1,<span class="keyword">...</span>
0292         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.inv.T1max),<span class="keyword">...</span>
0293         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1max'</span>,<span class="keyword">...</span>
0294         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0295         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0296         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0297     tstr = &quot;&quot;;
0298     gui.edit_handles.rtdT1N = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox1,<span class="keyword">...</span>
0299         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.inv.T1N),<span class="keyword">...</span>
0300         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1N'</span>,<span class="keyword">...</span>
0301         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0302         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0303         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0304     set(gui.panels.inv.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0305 
0306     <span class="comment">% RTD T2</span>
0307     gui.panels.inv.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0308         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0309     gui.text_handles.rtdT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox2,<span class="keyword">...</span>
0310         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0311         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0312         <span class="string">'String'</span>,<span class="string">'RTD T2 [s] - min | max | #'</span>);
0313     tstr = &quot;&quot;;
0314     gui.edit_handles.rtdT2min = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox2,<span class="keyword">...</span>
0315         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.inv.T2min),<span class="keyword">...</span>
0316         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2min'</span>,<span class="keyword">...</span>
0317         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0318         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0319         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0320     tstr = &quot;&quot;;
0321     gui.edit_handles.rtdT2max = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox2,<span class="keyword">...</span>
0322         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.inv.T2max),<span class="keyword">...</span>
0323         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2max'</span>,<span class="keyword">...</span>
0324         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0325         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0326         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0327     tstr = &quot;&quot;;
0328     gui.edit_handles.rtdT2N = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox2,<span class="keyword">...</span>
0329         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.inv.T2N),<span class="keyword">...</span>
0330         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2N'</span>,<span class="keyword">...</span>
0331         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0332         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0333         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0334     set(gui.panels.inv.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0335 
0336     <span class="comment">% regularization option</span>
0337     gui.panels.inv.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0338         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0339     gui.text_handles.RegType = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox3,<span class="keyword">...</span>
0340         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0341         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0342         <span class="string">'String'</span>,<span class="string">'Regularization'</span>);
0343     tstr = <span class="string">'Choose regularization option.'</span>;
0344     gui.popup_handles.RegType = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox3,<span class="keyword">...</span>
0345         <span class="string">'Style'</span>,<span class="string">'popup'</span>,<span class="string">'String'</span>,{<span class="string">'manual'</span>,<span class="string">'Tikhonov (SVD)'</span>,<span class="string">'TSVD (SVD)'</span>,<span class="string">'DSVD (SVD)'</span>,<span class="string">'Discrep. (SVD)'</span>},<span class="keyword">...</span>
0346         <span class="string">'Value'</span>,1,<span class="string">'FontSize'</span>,myui.fontsize,<span class="keyword">...</span>
0347         <span class="string">'BackGroundColor'</span>,myui.colors.editBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0348         <span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="string">'Callback'</span>,@<a href="#_sub6" class="code" title="subfunction tv_onPopupRegType(src,~)">tv_onPopupRegType</a>);
0349     set(gui.panels.inv.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1]);
0350 
0351     <span class="comment">% T1 lambda / order</span>
0352     gui.panels.inv.HBox4 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0353         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0354     gui.text_handles.lambdaT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox4,<span class="keyword">...</span>
0355         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0356         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0357         <span class="string">'String'</span>,<span class="string">'Lambda T1 | L-order'</span>);
0358     tstr = &quot;&quot;;
0359     gui.edit_handles.lambdaT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox4,<span class="keyword">...</span>
0360         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%f'</span>,data.inv.T1lambda),<span class="keyword">...</span>
0361         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT1'</span>,<span class="keyword">...</span>
0362         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0363         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0364         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0365     tstr = &quot;&quot;;
0366     gui.edit_handles.orderT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox4,<span class="keyword">...</span>
0367         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.inv.T1order),<span class="keyword">...</span>
0368         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'orderT1'</span>,<span class="keyword">...</span>
0369         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0370         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0371         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0372     set(gui.panels.inv.HBox4,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0373 
0374     <span class="comment">% T2 lambda / order</span>
0375     gui.panels.inv.HBox5 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0376         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0377     gui.text_handles.lambdaT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox5,<span class="keyword">...</span>
0378         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0379         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0380         <span class="string">'String'</span>,<span class="string">'Lambda T2 | L-order'</span>);
0381     tstr = &quot;&quot;;
0382     gui.edit_handles.lambdaT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox5,<span class="keyword">...</span>
0383         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%f'</span>,data.inv.T2lambda),<span class="keyword">...</span>
0384         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT2'</span>,<span class="keyword">...</span>
0385         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0386         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0387         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0388     tstr = &quot;&quot;;
0389     gui.edit_handles.orderT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox5,<span class="keyword">...</span>
0390         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.inv.T2order),<span class="keyword">...</span>
0391         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'orderT2'</span>,<span class="keyword">...</span>
0392         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0393         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0394         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0395     set(gui.panels.inv.HBox5,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0396 
0397     <span class="comment">% RUN button</span>
0398     gui.panels.inv.HBox6 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.inv.VBox,<span class="keyword">...</span>
0399         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0400     uix.Empty(<span class="string">'Parent'</span>,gui.panels.inv.HBox6);
0401     tstr = <span class="string">'RUN 2D inversion.'</span>;
0402     gui.push_handles.run_inv = uicontrol(<span class="string">'Parent'</span>,gui.panels.inv.HBox6,<span class="keyword">...</span>
0403         <span class="string">'String'</span>,<span class="string">'RUN 2D INV'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtd'</span>,<span class="keyword">...</span>
0404         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0405         <span class="string">'BackGroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction tv_onPushRun(src,~)">tv_onPushRun</a>);
0406     set(gui.panels.inv.HBox6,<span class="string">'Widths'</span>,[cpanel_w -1]);
0407 
0408     <span class="comment">%% --- L-curve panel ---</span>
0409     waitbar(3/steps,hwb,<span class="string">'loading GUI elements - regularisation panel'</span>);
0410     gui.panels.regu.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0411         <span class="string">'Title'</span>,<span class="string">'Regularisation - &quot;L-curve&quot;'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0412         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0413         <span class="string">'TitleColor'</span>,colors.BoxINV,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0414     gui.panels.regu.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.regu.main,<span class="keyword">...</span>
0415         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0416 
0417     <span class="comment">% link lambdas</span>
0418     gui.panels.regu.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.regu.VBox,<span class="keyword">...</span>
0419         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0420     gui.text_handles.linklambda = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox1,<span class="keyword">...</span>
0421         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0422         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0423         <span class="string">'String'</span>,&quot;Link Lambdas | factor&quot;);
0424     tstr = <span class="string">'Activate / deactivate lambda linking. Set factor x so that L1 = x*L2.'</span>;
0425     gui.check_handles.linking = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox1,<span class="keyword">...</span>
0426         <span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="string">'String'</span>,<span class="string">'on/off'</span>,<span class="string">'Value'</span>,0,<span class="keyword">...</span>
0427         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'linking'</span>,<span class="keyword">...</span>
0428         <span class="string">'BackGroundColor'</span>,myui.colors.panelBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0429         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0430         <span class="string">'Callback'</span>,@<a href="#_sub1" class="code" title="subfunction tv_onCheckLinkLambdas(src,~)">tv_onCheckLinkLambdas</a>);
0431     gui.edit_handles.lambdaFactor = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox1,<span class="keyword">...</span>
0432         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.regu.lambdaFactor),<span class="keyword">...</span>
0433         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaFactor'</span>,<span class="keyword">...</span>
0434         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0435         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0436         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0437         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0438     set(gui.panels.regu.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0439 
0440     <span class="comment">% lambda T1 - L-curve</span>
0441     gui.panels.regu.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.regu.VBox,<span class="keyword">...</span>
0442         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0443     gui.text_handles.lambdaT1min = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox2,<span class="keyword">...</span>
0444         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0445         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0446         <span class="string">'String'</span>,<span class="string">'Lambda T1 -  min | max | #'</span>);
0447     tstr = &quot;&quot;;
0448     gui.edit_handles.lambdaT1min = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox2,<span class="keyword">...</span>
0449         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%3.2f'</span>,data.regu.lambdaT1min),<span class="keyword">...</span>
0450         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT1min'</span>,<span class="keyword">...</span>
0451         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0452         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0453         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0454     tstr = &quot;&quot;;
0455     gui.edit_handles.lambdaT1max = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox2,<span class="keyword">...</span>
0456         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.regu.lambdaT1max),<span class="keyword">...</span>
0457         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT1max'</span>,<span class="keyword">...</span>
0458         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0459         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0460         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0461     tstr = &quot;&quot;;
0462     gui.edit_handles.lambdaT1N = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox2,<span class="keyword">...</span>
0463         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.regu.lambdaT1N),<span class="keyword">...</span>
0464         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT1N'</span>,<span class="keyword">...</span>
0465         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0466         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0467         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0468     set(gui.panels.regu.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0469 
0470     <span class="comment">% lambda T2 - L-curve</span>
0471     gui.panels.regu.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.regu.VBox,<span class="keyword">...</span>
0472         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0473     gui.text_handles.lambdaT2min = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox3,<span class="keyword">...</span>
0474         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0475         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0476         <span class="string">'String'</span>,<span class="string">'Lambda T2 -  min | max | #'</span>);
0477     tstr = &quot;&quot;;
0478     gui.edit_handles.lambdaT2min = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox3,<span class="keyword">...</span>
0479         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%3.2f'</span>,data.regu.lambdaT2min),<span class="keyword">...</span>
0480         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT2min'</span>,<span class="keyword">...</span>
0481         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0482         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0483         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0484     tstr = &quot;&quot;;
0485     gui.edit_handles.lambdaT2max = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox3,<span class="keyword">...</span>
0486         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.regu.lambdaT2max),<span class="keyword">...</span>
0487         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT2max'</span>,<span class="keyword">...</span>
0488         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0489         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0490         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0491     tstr = &quot;&quot;;
0492     gui.edit_handles.lambdaT2N = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox3,<span class="keyword">...</span>
0493         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.regu.lambdaT2N),<span class="keyword">...</span>
0494         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lambdaT2N'</span>,<span class="keyword">...</span>
0495         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0496         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0497         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0498     set(gui.panels.regu.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0499 
0500     <span class="comment">% RUN button</span>
0501     gui.panels.regu.HBox5 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.regu.VBox,<span class="keyword">...</span>
0502         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0503     gui.text_handles.calc2Dlcurve = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox5,<span class="keyword">...</span>
0504         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0505         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0506         <span class="string">'String'</span>,<span class="string">'EXPERIMENTAL FEATURE'</span>,<span class="string">'ForeGroundColor'</span>,<span class="string">'red'</span>);
0507     <span class="comment">% uix.Empty('Parent',gui.panels.regu.HBox5);</span>
0508     tstr = <span class="string">'Get 2D L-curve.'</span>;
0509     gui.push_handles.run_2dlcurve = uicontrol(<span class="string">'Parent'</span>,gui.panels.regu.HBox5,<span class="keyword">...</span>
0510         <span class="string">'String'</span>,<span class="string">'CALC 2D L-CURVE'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtd'</span>,<span class="keyword">...</span>
0511         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0512         <span class="string">'BackGroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Callback'</span>,@<a href="#_sub8" class="code" title="subfunction tv_onPush2DLCURVE(src,~)">tv_onPush2DLCURVE</a>);
0513     set(gui.panels.regu.HBox5,<span class="string">'Widths'</span>,[cpanel_w -1]);
0514 
0515     <span class="comment">%% --- information panel ---</span>
0516     waitbar(4/steps,hwb,<span class="string">'loading GUI elements - information panel'</span>);
0517     gui.panels.info.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0518         <span class="string">'Title'</span>,<span class="string">'Information'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="../../../../nucleus/functions/interface/minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0519         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0520         <span class="string">'TitleColor'</span>,colors.BoxINV,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0521     gui.panels.info.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.info.main,<span class="keyword">...</span>
0522         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0523 
0524     <span class="comment">% T1 range</span>
0525     gui.panels.info.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0526         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0527     gui.text_handles.rangeT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox1,<span class="keyword">...</span>
0528         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0529         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0530         <span class="string">'String'</span>,<span class="string">'T1 range - min [s] | max [s]'</span>);
0531     tstr = &quot;&quot;;
0532     gui.edit_handles.T1min = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox1,<span class="keyword">...</span>
0533         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.info.T1min),<span class="keyword">...</span>
0534         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1min'</span>,<span class="keyword">...</span>
0535         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0536         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0537         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0538     tstr = &quot;&quot;;
0539     gui.edit_handles.T1max = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox1,<span class="keyword">...</span>
0540         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.info.T1max),<span class="keyword">...</span>
0541         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1max'</span>,<span class="keyword">...</span>
0542         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0543         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0544         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0545     set(gui.panels.info.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0546 
0547     <span class="comment">% T2 range</span>
0548     gui.panels.info.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0549         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0550     gui.text_handles.rangeT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox2,<span class="keyword">...</span>
0551         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0552         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0553         <span class="string">'String'</span>,<span class="string">'T2 range - min [s] | max [s]'</span>);
0554     tstr = &quot;&quot;;
0555     gui.edit_handles.T2min = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox2,<span class="keyword">...</span>
0556         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.info.T2min),<span class="keyword">...</span>
0557         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2min'</span>,<span class="keyword">...</span>
0558         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0559         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0560         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0561     tstr = &quot;&quot;;
0562     gui.edit_handles.T2max = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox2,<span class="keyword">...</span>
0563         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.info.T2max),<span class="keyword">...</span>
0564         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2max'</span>,<span class="keyword">...</span>
0565         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0566         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0567         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction tv_onEditValue(src,~)">tv_onEditValue</a>);
0568     set(gui.panels.info.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0569 
0570     <span class="comment">% E0</span>
0571     gui.panels.info.HBox0 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0572         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0573     gui.text_handles.E0 = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox0,<span class="keyword">...</span>
0574         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0575         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0576         <span class="string">'String'</span>,<span class="string">'E0 [-]'</span>);
0577     uix.Empty(<span class="string">'Parent'</span>,gui.panels.info.HBox0);
0578     tstr = &quot;&quot;;
0579     gui.edit_handles.E0 = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox0,<span class="keyword">...</span>
0580         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.info.E0),<span class="keyword">...</span>
0581         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'E0'</span>,<span class="keyword">...</span>
0582         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0583         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0584         <span class="string">'Enable'</span>,<span class="string">'off'</span>);
0585     set(gui.panels.info.HBox0,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0586 
0587     <span class="comment">% TLGM</span>
0588     gui.panels.info.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0589         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0590     gui.text_handles.Tlgm = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox3,<span class="keyword">...</span>
0591         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0592         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0593         <span class="string">'String'</span>,<span class="string">'TLGM [s] (T1,T2)'</span>);
0594     tstr = &quot;&quot;;
0595     gui.edit_handles.T1tlgm = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox3,<span class="keyword">...</span>
0596         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.info.T1tlgm),<span class="keyword">...</span>
0597         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1tlgm'</span>,<span class="keyword">...</span>
0598         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0599         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0600         <span class="string">'Enable'</span>,<span class="string">'off'</span>);
0601     tstr = &quot;&quot;;
0602     gui.edit_handles.T2tlgm = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox3,<span class="keyword">...</span>
0603         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.info.T2tlgm),<span class="keyword">...</span>
0604         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2tlgm'</span>,<span class="keyword">...</span>
0605         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0606         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0607         <span class="string">'Enable'</span>,<span class="string">'off'</span>);
0608     set(gui.panels.info.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0609 
0610     <span class="comment">% TLGM ratio</span>
0611     gui.panels.info.HBox4 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0612         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0613     gui.text_handles.Tlgm_ratio = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox4,<span class="keyword">...</span>
0614         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0615         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0616         <span class="string">'String'</span>,<span class="string">'TLGM ratio T1/T2'</span>);
0617     uix.Empty(<span class="string">'Parent'</span>,gui.panels.info.HBox4);
0618     tstr = &quot;&quot;;
0619     gui.edit_handles.Tlgm_ratio = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox4,<span class="keyword">...</span>
0620         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.info.T1tlgm/data.info.T2tlgm),<span class="keyword">...</span>
0621         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'Tlgm_ratio'</span>,<span class="keyword">...</span>
0622         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0623         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0624         <span class="string">'Enable'</span>,<span class="string">'off'</span>);
0625     set(gui.panels.info.HBox4,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0626 
0627     <span class="comment">% Tmax</span>
0628     gui.panels.info.HBox5 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0629         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0630     gui.text_handles.Tmax = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox5,<span class="keyword">...</span>
0631         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0632         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0633         <span class="string">'String'</span>,<span class="string">'TMAX [s] (T1,T2)'</span>);
0634     tstr = &quot;&quot;;
0635     gui.edit_handles.T1tmax = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox5,<span class="keyword">...</span>
0636         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.info.T1tmax),<span class="keyword">...</span>
0637         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1tmax'</span>,<span class="keyword">...</span>
0638         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0639         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0640         <span class="string">'Enable'</span>,<span class="string">'off'</span>);
0641     tstr = &quot;&quot;;
0642     gui.edit_handles.T2tmax = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox5,<span class="keyword">...</span>
0643         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.info.T2tmax),<span class="keyword">...</span>
0644         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2tmax'</span>,<span class="keyword">...</span>
0645         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0646         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0647         <span class="string">'Enable'</span>,<span class="string">'off'</span>);
0648     set(gui.panels.info.HBox5,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0649 
0650     <span class="comment">% Tmax ratio</span>
0651     gui.panels.info.HBox6 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0652         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0653     gui.text_handles.Tmax_ratio = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox6,<span class="keyword">...</span>
0654         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0655         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0656         <span class="string">'String'</span>,<span class="string">'TMAX ratio T1/T2'</span>);
0657     uix.Empty(<span class="string">'Parent'</span>,gui.panels.info.HBox6);
0658     tstr = &quot;&quot;;
0659     gui.edit_handles.Tmax_ratio = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox6,<span class="keyword">...</span>
0660         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.info.T1tmax/data.info.T2tmax),<span class="keyword">...</span>
0661         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'Tmax_ratio'</span>,<span class="keyword">...</span>
0662         <span class="string">'BackGroundColor'</span>,colors.editBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0663         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0664         <span class="string">'Enable'</span>,<span class="string">'off'</span>);
0665     set(gui.panels.info.HBox6,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0666 
0667     <span class="comment">% log/lin axes</span>
0668     gui.panels.info.HBox7 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0669         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0670     gui.text_handles.loglin_axes = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox7,<span class="keyword">...</span>
0671         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0672         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0673         <span class="string">'String'</span>,<span class="string">'Echo time axes'</span>);
0674     tstr = &quot;&quot;;
0675     gui.radio_handles.log = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox7,<span class="keyword">...</span>
0676         <span class="string">'Style'</span>,<span class="string">'radiobutton'</span>,<span class="string">'String'</span>,<span class="string">'log'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'log'</span>,<span class="keyword">...</span>
0677         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0678         <span class="string">'BackGroundColor'</span>,myui.colors.panelBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0679         <span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Value'</span>,1,<span class="string">'Callback'</span>,@<a href="#_sub13" class="code" title="subfunction tv_onRadioLogLin(src,~)">tv_onRadioLogLin</a>);
0680     gui.radio_handles.lin = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox7,<span class="keyword">...</span>
0681         <span class="string">'Style'</span>,<span class="string">'radiobutton'</span>,<span class="string">'String'</span>,<span class="string">'lin'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lin'</span>,<span class="keyword">...</span>
0682         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0683         <span class="string">'BackGroundColor'</span>,myui.colors.panelBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0684         <span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Value'</span>,0,<span class="string">'Callback'</span>,@<a href="#_sub13" class="code" title="subfunction tv_onRadioLogLin(src,~)">tv_onRadioLogLin</a>);
0685     set(gui.panels.info.HBox7,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0686 
0687     <span class="comment">% DCM for 2D plot</span>
0688     gui.panels.info.HBox8 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0689         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0690     gui.text_handles.dcm = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox8,<span class="keyword">...</span>
0691         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0692         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0693         <span class="string">'String'</span>,<span class="string">'2D model data inspection'</span>);
0694     tstr = &quot;&quot;;
0695     gui.check_handles.dcm = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox8,<span class="keyword">...</span>
0696         <span class="string">'Style'</span>,<span class="string">'checkbox'</span>,<span class="string">'String'</span>,<span class="string">'activate'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'dcm'</span>,<span class="keyword">...</span>
0697         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0698         <span class="string">'BackGroundColor'</span>,myui.colors.panelBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0699         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="string">'Callback'</span>,@<a href="#_sub14" class="code" title="subfunction tv_onCheckDCM(src,~)">tv_onCheckDCM</a>);
0700     set(gui.panels.info.HBox8,<span class="string">'Widths'</span>,[cpanel_w -1]);
0701 
0702     <span class="comment">% 2D plot colorbar settings</span>
0703     gui.panels.info.HBox9 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.info.VBox,<span class="keyword">...</span>
0704         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0705     gui.text_handles.cbar = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox9,<span class="keyword">...</span>
0706         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0707         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'ForeGroundColor'</span>,colors.panelFG,<span class="keyword">...</span>
0708         <span class="string">'String'</span>,<span class="string">'2D model colorbar'</span>);
0709     tstr = &quot;colorbar position&quot;;
0710     gui.popup_handles.cbarpos = uicontrol(<span class="string">'Parent'</span>,gui.panels.info.HBox9,<span class="keyword">...</span>
0711         <span class="string">'Style'</span>,<span class="string">'popupmenu'</span>,<span class="string">'String'</span>,{<span class="string">'inside'</span>,<span class="string">'outside'</span>,<span class="string">'none'</span>},<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'pos'</span>,<span class="keyword">...</span>
0712         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0713         <span class="string">'BackGroundColor'</span>,myui.colors.editBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0714         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="string">'Callback'</span>,@<a href="#_sub15" class="code" title="subfunction tv_onPopupCbar(src,~)">tv_onPopupCbar</a>);
0715     set(gui.panels.info.HBox9,<span class="string">'Widths'</span>,[cpanel_w -1]);
0716 
0717     <span class="comment">% --- update MAIN GUI button ---</span>
0718     gui.panels.save.HBox1 = uix.VBox(<span class="string">'Parent'</span>,gui.panels.main,<span class="keyword">...</span>
0719         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,3);
0720     tstr = <span class="string">'UPDATE 2D inversion data in main NUCLEUSinv GUI.'</span>;
0721     gui.push_handles.update = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0722         <span class="string">'String'</span>,<span class="string">'UPDATE MAIN GUI'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'update'</span>,<span class="keyword">...</span>
0723         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0724         <span class="string">'BackGroundColor'</span>,myui.colors.editBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0725         <span class="string">'Callback'</span>,@<a href="#_sub12" class="code" title="subfunction tv_onPushUpdate(src,~)">tv_onPushUpdate</a>);
0726     tstr = <span class="string">'SAVE 2D inversion data to external file.'</span>;
0727     gui.push_handles.save = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0728         <span class="string">'String'</span>,<span class="string">'SAVE RESULT'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'save'</span>,<span class="keyword">...</span>
0729         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0730         <span class="string">'BackGroundColor'</span>,myui.colors.editBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0731         <span class="string">'Callback'</span>,@<a href="#_sub10" class="code" title="subfunction tv_onPushSave(src,~)">tv_onPushSave</a>);
0732     tstr = <span class="string">'Export current graphics view to Figure.'</span>;
0733     gui.push_handles.view = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0734         <span class="string">'String'</span>,<span class="string">'VIEW2FIG'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'view'</span>,<span class="keyword">...</span>
0735         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0736         <span class="string">'BackGroundColor'</span>,myui.colors.editBG,<span class="string">'ForeGroundColor'</span>,myui.colors.panelFG,<span class="keyword">...</span>
0737         <span class="string">'Callback'</span>,@<a href="#_sub11" class="code" title="subfunction tv_onPushView(src,~)">tv_onPushView</a>);
0738     <span class="comment">% set(gui.panels.save.HBox1,'Widths',[-1 -1]);</span>
0739 
0740     <span class="comment">% empty space at bottom of left side</span>
0741     uix.Empty(<span class="string">'Parent'</span>,gui.panels.main);
0742     <span class="comment">% adjust the heights of all left-column-panels</span>
0743     heights = [22 22 22 22 28 -1; 22+6*24+8*3 22+8*24+10*4 22+4*24+6*4 22+10*24+12*3 28*3 -1];
0744     <span class="comment">% panel header is always 22 high</span>
0745     set(gui.panels.main,<span class="string">'Heights'</span>,heights(2,:),<span class="keyword">...</span>
0746         <span class="string">'MinimumHeights'</span>,[22 22 22 22 28*3 0]);
0747     set(gui.left,<span class="string">'Heights'</span>,-1,<span class="string">'MinimumHeights'</span>,190+254+22+22+28*3);
0748 
0749     <span class="comment">% --- plot boxes ---</span>
0750     waitbar(5/steps,hwb,<span class="string">'loading GUI elements - graphics'</span>);
0751     gui.rightPanel = uix.TabPanel(<span class="string">'Parent'</span>,gui.right,<span class="keyword">...</span>
0752         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0753     <span class="comment">% -- tab1</span>
0754     gui.tab1 = uix.GridFlex(<span class="string">'Parent'</span>,gui.rightPanel,<span class="keyword">...</span>
0755         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,5);
0756 
0757     gui.pbox11 = uicontainer(<span class="string">'Parent'</span>,gui.tab1,<span class="keyword">...</span>
0758         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0759     gui.pbox13 = uicontainer(<span class="string">'Parent'</span>,gui.tab1,<span class="keyword">...</span>
0760         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0761 
0762     gui.pbox12 = uicontainer(<span class="string">'Parent'</span>,gui.tab1,<span class="keyword">...</span>
0763         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0764     gui.pbox14 = uicontainer(<span class="string">'Parent'</span>,gui.tab1,<span class="keyword">...</span>
0765         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0766 
0767     set(gui.tab1,<span class="string">'Widths'</span>,[-1 -1],<span class="string">'Heights'</span>,[-1 -1]);
0768 
0769     <span class="comment">% -- tab2</span>
0770     gui.tab2 = uix.GridFlex(<span class="string">'Parent'</span>,gui.rightPanel,<span class="keyword">...</span>
0771         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,5);
0772 
0773     gui.pbox21 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0774         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0775     gui.pbox22 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0776         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0777 
0778     gui.pbox23 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0779         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0780     gui.pbox24 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0781         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0782 
0783     set(gui.tab2,<span class="string">'Widths'</span>,[-6 -1],<span class="string">'Heights'</span>,[-1 -6]);
0784 
0785     <span class="comment">% -- tab3</span>
0786     gui.tab3 = uix.VBoxFlex(<span class="string">'Parent'</span>,gui.rightPanel,<span class="keyword">...</span>
0787         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,5);
0788     gui.pbox31 = uicontainer(<span class="string">'Parent'</span>,gui.tab3,<span class="keyword">...</span>
0789         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0790     gui.pbox32 = uicontainer(<span class="string">'Parent'</span>,gui.tab3,<span class="keyword">...</span>
0791         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0792     set(gui.tab3,<span class="string">'Heights'</span>,[-1 -2]);
0793 
0794     gui.rightPanel.TabTitles = {<span class="string">'DATA'</span>,<span class="string">'2D INV'</span>,<span class="string">'FITS'</span>};
0795     gui.rightPanel.TabWidth = 75;
0796     gui.rightPanel.TabEnables = {<span class="string">'on'</span>,<span class="string">'on'</span>,<span class="string">'on'</span>};
0797 
0798     <span class="comment">% -- plot axes --</span>
0799     gui.axes11 = axes(<span class="string">'Parent'</span>,gui.pbox11,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0800             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0801     gui.axes12 = axes(<span class="string">'Parent'</span>,gui.pbox12,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0802             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0803     gui.axes13 = axes(<span class="string">'Parent'</span>,gui.pbox13,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0804             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0805     gui.axes14 = axes(<span class="string">'Parent'</span>,gui.pbox14,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0806             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0807     gui.axes2 = axes(<span class="string">'Parent'</span>,gui.pbox22,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0808             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>,<span class="string">'Tag'</span>,<span class="string">'2D'</span>);
0809     gui.axes21 = axes(<span class="string">'Parent'</span>,gui.pbox21,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0810             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0811     gui.axes24 = axes(<span class="string">'Parent'</span>,gui.pbox24,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0812             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0813     gui.axes31 = axes(<span class="string">'Parent'</span>,gui.pbox31,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0814             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0815     gui.axes32 = axes(<span class="string">'Parent'</span>,gui.pbox32,<span class="string">'Color'</span>,colors.axisBG,<span class="keyword">...</span>
0816             <span class="string">'XColor'</span>,colors.axisFG,<span class="string">'YColor'</span>,colors.axisFG,<span class="string">'ZColor'</span>,colors.axisFG,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0817 
0818     <span class="comment">% create data curor mode for 2D inv plot inspection</span>
0819     waitbar(6/steps,hwb,<span class="string">'loading GUI elements - finalizing'</span>);
0820     gui.dcm = datacursormode(fig_T1T2map);
0821     gui.dcm.UpdateFcn = @(hObj,event,ax)<a href="#_sub25" class="code" title="subfunction txt = localDcmFcn(~,event,ax)">localDcmFcn</a>(hObj,event,gui.axes2);
0822     gui.dcm.Enable = <span class="string">'off'</span>;
0823 
0824     <span class="comment">% --- store main GUI settings ---</span>
0825     gui.myui = nucleus.gui.myui;
0826     gui.myui.heights = heights;
0827     datacmap = load(<span class="string">'colormap_rwb.mat'</span>);
0828     gui.myui.cmap_rwb = datacmap.rwb_cmap;
0829     gui.figh_nucleus = figh_nucleus;
0830 
0831     <span class="comment">% --- save gui data to GUI ---</span>
0832     setappdata(fig_T1T2map,<span class="string">'gui'</span>,gui);
0833     setappdata(fig_T1T2map,<span class="string">'data'</span>,data);
0834 
0835     <span class="comment">% minimize third panel at startup</span>
0836     tmp_h = gui.myui.heights(2,:);
0837     tmp_h(3) = gui.myui.heights(1,3);
0838     tmp_h(4) = gui.myui.heights(1,4);
0839     set(gui.panels.main,<span class="string">'Heights'</span>,tmp_h);
0840     set(gui.panels.regu.main,<span class="string">'Minimized'</span>,true);
0841     set(gui.panels.info.main,<span class="string">'Minimized'</span>,true);
0842 
0843     <a href="../../../../nucleus/functions/interface/fixVerticalTextAlignment.html" class="code" title="function fixVerticalTextAlignment(fig)">fixVerticalTextAlignment</a>(fig_T1T2map);
0844     <a href="../../../../nucleus/functions/interface/changeColorTheme.html" class="code" title="function changeColorTheme(fig_tag,th)">changeColorTheme</a>(<span class="string">'2DINV'</span>,myui.colors.theme);
0845     <span class="comment">% make GUI visible</span>
0846     delete(hwb);
0847     set(gui.main,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0848 <span class="keyword">else</span>
0849     <span class="comment">% if the figure is already open load the GUI data</span>
0850     data = getappdata(fig_T1T2map,<span class="string">'data'</span>);
0851     gui = getappdata(fig_T1T2map,<span class="string">'gui'</span>);
0852 <span class="keyword">end</span>
0853 
0854 <span class="comment">% import the current data from the main NUCLEUS GUI</span>
0855 data.results.T1T2map = nucleus.data.import.T1T2map;
0856 data.results.T1T2map.import = nucleus.data.import.NMR.data;
0857 
0858 <span class="comment">% check if there is already 2D inversion data in the main NUCLEUS GUI</span>
0859 <span class="keyword">if</span> isfield(nucleus.data,<span class="string">'results'</span>) &amp;&amp; isfield(nucleus.data.results,<span class="string">'inv2D'</span>)
0860     <span class="comment">% if it is there, then load the INVdata</span>
0861     nucleus.INVdata = getappdata(figh_nucleus,<span class="string">'INVdata'</span>);
0862     <span class="comment">% the 2D data is stored within the data struct of the merged T1 curve</span>
0863     data.results.inv2D = nucleus.INVdata{end}.results.inv2D;
0864     <span class="comment">% update new 2Dinv GUI data</span>
0865     setappdata(fig_T1T2map,<span class="string">'data'</span>,data);
0866     <span class="keyword">if</span> data.prop.useLogGates
0867         set(gui.check_handles.gateing,<span class="string">'Value'</span>,1);
0868         set(gui.edit_handles.Ngates,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0869     <span class="keyword">end</span>
0870     <span class="comment">% data = getappdata(fig_T1T2map,'data');</span>
0871     <span class="comment">% clear axes</span>
0872     <a href="../../../../nucleus/functions/interface/clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(fig_T1T2map);
0873     <span class="comment">% prepare raw data</span>
0874     <a href="#_sub23" class="code" title="subfunction tv_prepareRawData(figh)">tv_prepareRawData</a>(fig_T1T2map);
0875     <span class="comment">% plot the imported raw data</span>
0876     <a href="#_sub19" class="code" title="subfunction tv_plotRawData(figh)">tv_plotRawData</a>(fig_T1T2map);
0877     <a href="#_sub18" class="code" title="subfunction tv_plotResults(figh)">tv_plotResults</a>(fig_T1T2map);
0878 
0879     <span class="keyword">switch</span> data.inv.regtype
0880         <span class="keyword">case</span> <span class="string">'manual'</span>
0881             set(gui.popup_handles.RegType,<span class="string">'Value'</span>,1);
0882         <span class="keyword">case</span> <span class="string">'gcv_tikh'</span>
0883             set(gui.popup_handles.RegType,<span class="string">'Value'</span>,2);
0884         <span class="keyword">case</span> <span class="string">'gcv_trunc'</span>
0885             set(gui.popup_handles.RegType,<span class="string">'Value'</span>,3);
0886         <span class="keyword">case</span> <span class="string">'gcv_damp'</span>
0887             set(gui.popup_handles.RegType,<span class="string">'Value'</span>,4);
0888         <span class="keyword">case</span> <span class="string">'discrep'</span>
0889             set(gui.popup_handles.RegType,<span class="string">'Value'</span>,5);
0890     <span class="keyword">end</span>
0891     setappdata(fig_T1T2map,<span class="string">'gui'</span>,gui);
0892     <a href="#_sub6" class="code" title="subfunction tv_onPopupRegType(src,~)">tv_onPopupRegType</a>(gui.popup_handles.RegType);
0893 <span class="keyword">else</span>
0894     <span class="comment">% set the last recovery time entry</span>
0895     data.prop.lastT1 = numel(data.results.T1T2map.t_recov);
0896     set(gui.edit_handles.lastT1,<span class="string">'String'</span>,num2str(data.prop.lastT1));
0897     <span class="comment">% set the last echo entry</span>
0898     data.prop.lastT2 = data.results.T1T2map.t2N;
0899     set(gui.edit_handles.lastT2,<span class="string">'String'</span>,num2str(data.prop.lastT2));
0900     <span class="comment">% update new 2Dinv GUI data</span>
0901     setappdata(fig_T1T2map,<span class="string">'data'</span>,data);
0902     <span class="comment">% clear axes</span>
0903     <a href="../../../../nucleus/functions/interface/clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(fig_T1T2map);
0904     <span class="comment">% prepare raw data</span>
0905     <a href="#_sub23" class="code" title="subfunction tv_prepareRawData(figh)">tv_prepareRawData</a>(fig_T1T2map);
0906     <span class="comment">% plot the imported raw data</span>
0907     <a href="#_sub19" class="code" title="subfunction tv_plotRawData(figh)">tv_plotRawData</a>(fig_T1T2map);
0908 <span class="keyword">end</span>
0909 
0910 <a href="#_sub24" class="code" title="subfunction tv_estimateIRtype(figh)">tv_estimateIRtype</a>(fig_T1T2map);
0911 <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(fig_T1T2map);
0912 <span class="keyword">end</span>
0913 
0914 <span class="comment">%% subfunction to activate Lambda Linking</span>
0915 <a name="_sub1" href="#_subfunctions" class="code">function tv_onCheckLinkLambdas(src,~)</a>
0916 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0917 data = getappdata(figh,<span class="string">'data'</span>);
0918 gui = getappdata(figh,<span class="string">'gui'</span>);
0919 
0920 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
0921     <span class="keyword">case</span> 0 <span class="comment">% off</span>
0922         data.regu.linkLambdas = false;
0923         set(gui.edit_handles.lambdaFactor,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0924         set(gui.edit_handles.lambdaT1,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0925         set(gui.edit_handles.lambdaT1min,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0926         set(gui.edit_handles.lambdaT1max,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0927         set(gui.edit_handles.lambdaT1N,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0928     <span class="keyword">case</span> 1 <span class="comment">% on</span>
0929         data.regu.linkLambdas = true;
0930         set(gui.edit_handles.lambdaFactor,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0931         data.inv.T1lambda = data.regu.lambdaFactor * data.inv.T2lambda;
0932         set(gui.edit_handles.lambdaT1,<span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0933             <span class="string">'String'</span>,num2str(data.inv.T1lambda));
0934         set(gui.edit_handles.lambdaT1min,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0935         set(gui.edit_handles.lambdaT1max,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0936         set(gui.edit_handles.lambdaT1N,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0937 <span class="keyword">end</span>
0938 
0939 <span class="comment">% update GUI data</span>
0940 setappdata(figh,<span class="string">'data'</span>,data);
0941 <span class="keyword">end</span>
0942 
0943 <span class="comment">%% subfunction to activate Log gateing</span>
0944 <a name="_sub2" href="#_subfunctions" class="code">function tv_onCheckLogGates(src,~)</a>
0945 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0946 data = getappdata(figh,<span class="string">'data'</span>);
0947 gui = getappdata(figh,<span class="string">'gui'</span>);
0948 
0949 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
0950     <span class="keyword">case</span> 0 <span class="comment">% off</span>
0951         data.prop.useLogGates = false;
0952         set(gui.edit_handles.Ngates,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0953     <span class="keyword">case</span> 1 <span class="comment">% on</span>
0954         data.prop.useLogGates = true;
0955         set(gui.edit_handles.Ngates,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0956 <span class="keyword">end</span>
0957 
0958 <span class="comment">% update GUI data</span>
0959 setappdata(figh,<span class="string">'data'</span>,data);
0960 <a href="../../../../nucleus/functions/interface/clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(figh);
0961 <a href="#_sub23" class="code" title="subfunction tv_prepareRawData(figh)">tv_prepareRawData</a>(figh);
0962 data = getappdata(figh,<span class="string">'data'</span>);
0963 <a href="#_sub20" class="code" title="subfunction tv_checkLSEparams(data)">tv_checkLSEparams</a>(data);
0964 setappdata(figh,<span class="string">'data'</span>,data);
0965 <a href="#_sub19" class="code" title="subfunction tv_plotRawData(figh)">tv_plotRawData</a>(figh);
0966 <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
0967 <span class="keyword">end</span>
0968 
0969 <span class="comment">%% subfunction to update the edit fields</span>
0970 <a name="_sub3" href="#_subfunctions" class="code">function tv_onEditValue(src,~)</a>
0971 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0972 gui = getappdata(figh,<span class="string">'gui'</span>);
0973 data = getappdata(figh,<span class="string">'data'</span>);
0974 
0975 <span class="comment">% get the edit field value</span>
0976 val = str2double(get(src,<span class="string">'String'</span>));
0977 
0978 <span class="keyword">switch</span> get(src,<span class="string">'Tag'</span>)
0979     <span class="keyword">case</span> {<span class="string">'diff'</span>,<span class="string">'gradient'</span>,<span class="string">'echo_time'</span>}
0980         data.prop.D = str2double(get(gui.edit_handles.diff,<span class="string">'String'</span>))/1e9;
0981         data.prop.G0 = str2double(get(gui.edit_handles.gradient,<span class="string">'String'</span>));
0982         data.prop.te = str2double(get(gui.edit_handles.echo_time,<span class="string">'String'</span>))/1e6;
0983     <span class="keyword">case</span> {<span class="string">'firstT1'</span>,<span class="string">'lastT1'</span>}
0984         data.prop.firstT1 = str2double(get(gui.edit_handles.firstT1,<span class="string">'String'</span>));
0985         data.prop.lastT1 = str2double(get(gui.edit_handles.lastT1,<span class="string">'String'</span>));
0986         <span class="keyword">if</span> data.prop.firstT1 &lt; 1
0987             data.prop.firstT1 = 1;
0988             set(gui.edit_handles.firstT1,<span class="string">'String'</span>,data.prop.firstT1);
0989         <span class="keyword">end</span>
0990         <span class="keyword">if</span> data.prop.lastT1 == 0 || data.prop.lastT1 &gt; data.results.T1T2map.t1N
0991             data.prop.lastT1 = data.results.T1T2map.t1N;
0992             set(gui.edit_handles.lastT1,<span class="string">'String'</span>,data.prop.lastT1);
0993         <span class="keyword">end</span>
0994         <span class="comment">% update GUI data</span>
0995         setappdata(figh,<span class="string">'data'</span>,data);
0996         <a href="../../../../nucleus/functions/interface/clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(figh);
0997         <a href="#_sub23" class="code" title="subfunction tv_prepareRawData(figh)">tv_prepareRawData</a>(figh);
0998         data = getappdata(figh,<span class="string">'data'</span>);
0999         <a href="#_sub19" class="code" title="subfunction tv_plotRawData(figh)">tv_plotRawData</a>(figh);
1000         <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);    
1001     <span class="keyword">case</span> {<span class="string">'firstT2'</span>,<span class="string">'lastT2'</span>,<span class="string">'Ngates'</span>}
1002         data.prop.firstT2 = str2double(get(gui.edit_handles.firstT2,<span class="string">'String'</span>));
1003         data.prop.lastT2 = str2double(get(gui.edit_handles.lastT2,<span class="string">'String'</span>));
1004         <span class="keyword">if</span> data.prop.firstT2 &lt; 1
1005             data.prop.firstT2 = 1;
1006             set(gui.edit_handles.firstT2,<span class="string">'String'</span>,data.prop.firstT2);
1007         <span class="keyword">end</span>
1008         <span class="keyword">if</span> data.prop.lastT2 == 0 || data.prop.lastT2 &gt; data.results.T1T2map.t2N
1009             data.prop.lastT2 = data.results.T1T2map.t2N;
1010             set(gui.edit_handles.lastT2,<span class="string">'String'</span>,data.prop.lastT2);
1011         <span class="keyword">end</span>
1012         data.prop.Ngates = str2double(get(gui.edit_handles.Ngates,<span class="string">'String'</span>));
1013         <span class="comment">% update GUI data</span>
1014         setappdata(figh,<span class="string">'data'</span>,data);
1015         <a href="../../../../nucleus/functions/interface/clearAllAxes.html" class="code" title="function clearAllAxes(figh)">clearAllAxes</a>(figh);
1016         <a href="#_sub23" class="code" title="subfunction tv_prepareRawData(figh)">tv_prepareRawData</a>(figh);
1017         data = getappdata(figh,<span class="string">'data'</span>);
1018         <a href="#_sub19" class="code" title="subfunction tv_plotRawData(figh)">tv_plotRawData</a>(figh);
1019         <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
1020     <span class="keyword">case</span> {<span class="string">'rtdT1min'</span>,<span class="string">'rtdT1max'</span>,<span class="string">'rtdT1N'</span>}
1021         data.inv.T1min = str2double(get(gui.edit_handles.rtdT1min,<span class="string">'String'</span>));
1022         data.inv.T1max = str2double(get(gui.edit_handles.rtdT1max,<span class="string">'String'</span>));
1023         data.inv.T1N = str2double(get(gui.edit_handles.rtdT1N,<span class="string">'String'</span>));
1024         
1025         <span class="comment">% update corresponding info fields</span>
1026         data.info.T1min = data.inv.T1min;
1027         set(gui.edit_handles.T1min,<span class="string">'String'</span>,num2str(data.info.T1min));
1028         data.info.T1max = data.inv.T1max;
1029         set(gui.edit_handles.T1max,<span class="string">'String'</span>,num2str(data.info.T1max));
1030     <span class="keyword">case</span> {<span class="string">'rtdT2min'</span>,<span class="string">'rtdT2max'</span>,<span class="string">'rtdT2N'</span>}
1031         data.inv.T2min = str2double(get(gui.edit_handles.rtdT2min,<span class="string">'String'</span>));
1032         data.inv.T2max = str2double(get(gui.edit_handles.rtdT2max,<span class="string">'String'</span>));
1033         data.inv.T2N = str2double(get(gui.edit_handles.rtdT2N,<span class="string">'String'</span>));
1034         
1035         <span class="comment">% update corresponding info fields</span>
1036         data.info.T2min = data.inv.T2min;
1037         set(gui.edit_handles.T2min,<span class="string">'String'</span>,num2str(data.info.T2min));
1038         data.info.T2max = data.inv.T2max;
1039         set(gui.edit_handles.T2max,<span class="string">'String'</span>,num2str(data.info.T2max));
1040     <span class="keyword">case</span> <span class="string">'lambdaT1'</span>
1041         data.inv.T1lambda = str2double(get(src,<span class="string">'String'</span>));
1042     <span class="keyword">case</span> <span class="string">'orderT1'</span>
1043         set(gui.edit_handles.orderT2,<span class="string">'String'</span>,num2str(val));
1044         data.inv.T1order = str2double(get(src,<span class="string">'String'</span>));
1045         data.inv.T2order = str2double(get(gui.edit_handles.orderT2,<span class="string">'String'</span>));
1046     <span class="keyword">case</span> <span class="string">'lambdaT2'</span>
1047         data.inv.T2lambda = str2double(get(src,<span class="string">'String'</span>));
1048         <span class="keyword">if</span> data.regu.linkLambdas
1049             data.inv.T1lambda = data.regu.lambdaFactor * data.inv.T2lambda;
1050             set(gui.edit_handles.lambdaT1,<span class="string">'String'</span>,num2str(data.inv.T1lambda));
1051         <span class="keyword">end</span>
1052     <span class="keyword">case</span> <span class="string">'orderT2'</span>
1053         data.inv.T2order = str2double(get(src,<span class="string">'String'</span>));
1054     <span class="keyword">case</span> <span class="string">'lambdaFactor'</span>
1055         data.regu.lambdaFactor = str2double(get(src,<span class="string">'String'</span>));
1056         data.inv.T1lambda = data.regu.lambdaFactor * data.inv.T2lambda;
1057         set(gui.edit_handles.lambdaT1,<span class="string">'String'</span>,num2str(data.inv.T1lambda));
1058     <span class="keyword">case</span> {<span class="string">'lambdaT1min'</span>,<span class="string">'lambdaT1max'</span>,<span class="string">'lambdaT1N'</span>}
1059         data.regu.lambdaT1min = str2double(get(gui.edit_handles.lambdaT1min,<span class="string">'String'</span>));
1060         data.regu.lambdaT1max = str2double(get(gui.edit_handles.lambdaT1max,<span class="string">'String'</span>));
1061         data.regu.lambdaT1N = str2double(get(gui.edit_handles.lambdaT1N,<span class="string">'String'</span>));
1062     <span class="keyword">case</span> {<span class="string">'lambdaT2min'</span>,<span class="string">'lambdaT2max'</span>,<span class="string">'lambdaT2N'</span>}
1063         data.regu.lambdaT2min = str2double(get(gui.edit_handles.lambdaT2min,<span class="string">'String'</span>));
1064         data.regu.lambdaT2max = str2double(get(gui.edit_handles.lambdaT2max,<span class="string">'String'</span>));
1065         data.regu.lambdaT2N = str2double(get(gui.edit_handles.lambdaT2N,<span class="string">'String'</span>));
1066     <span class="keyword">case</span> {<span class="string">'T1min'</span>,<span class="string">'T1max'</span>,<span class="string">'T2min'</span>,<span class="string">'T2max'</span>}
1067         data.info.T1min = str2double(get(gui.edit_handles.T1min,<span class="string">'String'</span>));
1068         data.info.T1max = str2double(get(gui.edit_handles.T1max,<span class="string">'String'</span>));
1069         data.info.T2min = str2double(get(gui.edit_handles.T2min,<span class="string">'String'</span>));
1070         data.info.T2max = str2double(get(gui.edit_handles.T2max,<span class="string">'String'</span>));
1071         <span class="comment">% update GUI data</span>
1072         setappdata(figh,<span class="string">'data'</span>,data);
1073         <a href="#_sub21" class="code" title="subfunction tv_getTLGM(figh)">tv_getTLGM</a>(figh);
1074         data = getappdata(figh,<span class="string">'data'</span>);
1075         <a href="#_sub18" class="code" title="subfunction tv_plotResults(figh)">tv_plotResults</a>(figh);
1076         <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
1077 <span class="keyword">end</span>
1078 
1079 <span class="comment">% update GUI data</span>
1080 setappdata(figh,<span class="string">'data'</span>,data);
1081 <a href="#_sub20" class="code" title="subfunction tv_checkLSEparams(data)">tv_checkLSEparams</a>(data);
1082 <span class="comment">% in case an error occurred, reset the RUN buttons</span>
1083 set(gui.push_handles.run_inv,<span class="string">'String'</span>,<span class="string">'RUN 2D INV'</span>,<span class="keyword">...</span>
1084     <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction tv_onPushRun(src,~)">tv_onPushRun</a>);
1085 set(gui.push_handles.run_2dlcurve,<span class="string">'String'</span>,<span class="string">'CALC 2D L-CURVE'</span>,<span class="keyword">...</span>
1086     <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub8" class="code" title="subfunction tv_onPush2DLCURVE(src,~)">tv_onPush2DLCURVE</a>);
1087 setappdata(figh,<span class="string">'gui'</span>,gui);
1088 <span class="keyword">end</span>
1089 
1090 <span class="comment">%% subfunction to set the T1 type</span>
1091 <a name="_sub4" href="#_subfunctions" class="code">function tv_onPopupT1Type(src,~)</a>
1092 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1093 data = getappdata(figh,<span class="string">'data'</span>);
1094 gui = getappdata(figh,<span class="string">'gui'</span>);
1095 
1096 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
1097     <span class="keyword">case</span> 1 <span class="comment">% Saturation Recovery</span>
1098         data.inv.T1IRfac = 1;
1099         set(gui.popup_handles.IRtype,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1100     <span class="keyword">case</span> 2 <span class="comment">% Inversion Recovery</span>
1101         data.inv.T1IRfac = 2;
1102         set(gui.popup_handles.IRtype,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1103 <span class="keyword">end</span>
1104 
1105 <span class="comment">% update GUI data</span>
1106 setappdata(figh,<span class="string">'data'</span>,data);
1107 setappdata(figh,<span class="string">'gui'</span>,gui);
1108 <span class="keyword">end</span>
1109 
1110 <span class="comment">%% subfunction to set the IR type</span>
1111 <a name="_sub5" href="#_subfunctions" class="code">function tv_onPopupIRType(src,~)</a>
1112 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1113 data = getappdata(figh,<span class="string">'data'</span>);
1114 
1115 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
1116     <span class="keyword">case</span> 1 <span class="comment">% IR standard 1-2exp()</span>
1117         data.inv.IRtype = 1;
1118     <span class="keyword">case</span> 2 <span class="comment">% IR Hürlimann -exp()</span>
1119         data.inv.IRtype = 2;
1120 <span class="keyword">end</span>
1121 
1122 <span class="comment">% update GUI data</span>
1123 setappdata(figh,<span class="string">'data'</span>,data);
1124 <span class="keyword">end</span>
1125 
1126 <span class="comment">%% subfunction to set the regularization method</span>
1127 <a name="_sub6" href="#_subfunctions" class="code">function tv_onPopupRegType(src,~)</a>
1128 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1129 data = getappdata(figh,<span class="string">'data'</span>);
1130 gui = getappdata(figh,<span class="string">'gui'</span>);
1131 
1132 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
1133     <span class="keyword">case</span> 1 <span class="comment">% manual</span>
1134         data.inv.regtype = <span class="string">'manual'</span>;
1135         set(gui.check_handles.linking,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Value'</span>,0);
1136         set(gui.edit_handles.lambdaT1,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1137         set(gui.edit_handles.lambdaT2,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1138     <span class="keyword">case</span> 2 <span class="comment">% tikhonov</span>
1139         data.inv.regtype = <span class="string">'gcv_tikh'</span>;
1140         set(gui.check_handles.linking,<span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="string">'Value'</span>,0);
1141         set(gui.edit_handles.lambdaFactor,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1142         set(gui.edit_handles.lambdaT1,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1143         set(gui.edit_handles.lambdaT2,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1144     <span class="keyword">case</span> 3 <span class="comment">% tikhonov</span>
1145         data.inv.regtype = <span class="string">'gcv_trunc'</span>;
1146         set(gui.check_handles.linking,<span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="string">'Value'</span>,0);
1147         set(gui.edit_handles.lambdaFactor,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1148         set(gui.edit_handles.lambdaT1,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1149         set(gui.edit_handles.lambdaT2,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1150     <span class="keyword">case</span> 4 <span class="comment">% tikhonov</span>
1151         data.inv.regtype = <span class="string">'gcv_damp'</span>;
1152         set(gui.check_handles.linking,<span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="string">'Value'</span>,0);
1153         set(gui.edit_handles.lambdaFactor,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1154         set(gui.edit_handles.lambdaT1,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1155         set(gui.edit_handles.lambdaT2,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1156     <span class="keyword">case</span> 5 <span class="comment">% tikhonov</span>
1157         data.inv.regtype = <span class="string">'discrep'</span>;
1158         set(gui.check_handles.linking,<span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="string">'Value'</span>,0);
1159         set(gui.edit_handles.lambdaFactor,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1160         set(gui.edit_handles.lambdaT1,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1161         set(gui.edit_handles.lambdaT2,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1162 <span class="keyword">end</span>
1163 data.regu.linkLambdas = 0;
1164 
1165 <span class="comment">% activate / deactivate experimental 2d l-curve</span>
1166 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
1167     <span class="keyword">case</span> 1 <span class="comment">% manual</span>
1168         set(gui.edit_handles.lambdaT1min,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1169         set(gui.edit_handles.lambdaT1max,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1170         set(gui.edit_handles.lambdaT1N,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1171         set(gui.edit_handles.lambdaT2min,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1172         set(gui.edit_handles.lambdaT2max,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1173         set(gui.edit_handles.lambdaT2N,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1174         set(gui.push_handles.run_2dlcurve,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1175     <span class="keyword">otherwise</span>
1176         set(gui.edit_handles.lambdaT1min,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1177         set(gui.edit_handles.lambdaT1max,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1178         set(gui.edit_handles.lambdaT1N,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1179         set(gui.edit_handles.lambdaT2min,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1180         set(gui.edit_handles.lambdaT2max,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1181         set(gui.edit_handles.lambdaT2N,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1182         set(gui.push_handles.run_2dlcurve,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
1183 <span class="keyword">end</span>
1184 
1185 <span class="comment">% update GUI data</span>
1186 setappdata(figh,<span class="string">'data'</span>,data);
1187 setappdata(figh,<span class="string">'gui'</span>,gui);
1188 <a href="#_sub20" class="code" title="subfunction tv_checkLSEparams(data)">tv_checkLSEparams</a>(data);
1189 <span class="keyword">end</span>
1190 
1191 <span class="comment">%% subfunction to start a new 2D inversion</span>
1192 <a name="_sub7" href="#_subfunctions" class="code">function tv_onPushRun(src,~)</a>
1193 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1194 gui = getappdata(figh,<span class="string">'gui'</span>);
1195 data = getappdata(figh,<span class="string">'data'</span>);
1196 <span class="comment">% NUCLEUSinv data</span>
1197 guiN = getappdata(gui.figh_nucleus,<span class="string">'gui'</span>);
1198 dataN = getappdata(gui.figh_nucleus,<span class="string">'data'</span>);
1199 
1200 <span class="comment">% prepare all data for the inversion</span>
1201 [dat,param] = <a href="#_sub9" class="code" title="subfunction [dat,param] = tv_prepareInvData(figh)">tv_prepareInvData</a>(figh);
1202 param.EchoFlag = dataN.info.EchoFlag;
1203 
1204 <span class="comment">% status bar information</span>
1205 <span class="keyword">switch</span> dataN.info.solver
1206     <span class="keyword">case</span> <span class="string">'lsqlin'</span>
1207         infostring = <span class="string">'2D Inversion using ''Optimization Toolbox'' ... '</span>;
1208     <span class="keyword">case</span> <span class="string">'lsqnonneg'</span>
1209         infostring = <span class="string">'2D Inversion using ''lsqnonneg'' ... '</span>;
1210 <span class="keyword">end</span>
1211 <a href="../../../../nucleus/functions/interface/displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(guiN,infostring);
1212 
1213 <span class="comment">% disable the RUN button to indicate a running inversion</span>
1214 set(gui.push_handles.run_inv,<span class="string">'String'</span>,<span class="string">'RUNNING ...'</span>,<span class="keyword">...</span>
1215     <span class="string">'Enable'</span>,<span class="string">'off'</span>); pause(0.01);
1216 
1217 tic;
1218 <span class="comment">% call 2D inversion</span>
1219 inv2D = <a href="../../../../nucleus/functions/inversion/fitData2D.html" class="code" title="function fitdata = fitData2D(data,parameter)">fitData2D</a>(dat,param);
1220 runtime = toc;
1221 <a href="../../../../nucleus/functions/interface/displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(guiN,[infostring,<span class="string">'done | inversion took '</span>,<span class="keyword">...</span>
1222     sprintf(<span class="string">'%5.2f'</span>,runtime),<span class="string">' s'</span>]);
1223 
1224 <span class="comment">% enable the RUN button</span>
1225 set(gui.push_handles.run_inv,<span class="string">'String'</span>,<span class="string">'RUN 2D INV'</span>,<span class="keyword">...</span>
1226     <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction tv_onPushRun(src,~)">tv_onPushRun</a>);
1227 setappdata(figh,<span class="string">'gui'</span>,gui);
1228 
1229 <span class="comment">% save results</span>
1230 data.results.inv2D = inv2D;
1231 
1232 <span class="comment">% update new lambda in GUI</span>
1233 data.inv.T1lambda = inv2D.lambda_out(2); <span class="comment">% T1 is second dimension</span>
1234 data.inv.T2lambda = inv2D.lambda_out(1); <span class="comment">% T2 is first dimension</span>
1235 set(gui.edit_handles.lambdaT1,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,inv2D.lambda_out(2)));
1236 set(gui.edit_handles.lambdaT2,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,inv2D.lambda_out(1)));
1237 
1238 <span class="comment">% update data</span>
1239 setappdata(figh,<span class="string">'data'</span>,data);
1240 
1241 <span class="comment">% plot all 2D inversion data</span>
1242 <a href="#_sub21" class="code" title="subfunction tv_getTLGM(figh)">tv_getTLGM</a>(figh);
1243 <a href="#_sub18" class="code" title="subfunction tv_plotResults(figh)">tv_plotResults</a>(figh);
1244 <a href="../../../../nucleus/functions/interface/beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
1245 set(gui.check_handles.dcm,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1246 set(gui.popup_handles.cbarpos,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
1247 <span class="keyword">end</span>
1248 
1249 <span class="comment">%% subfunction to start a new 2D l-curve calculation</span>
1250 <a name="_sub8" href="#_subfunctions" class="code">function tv_onPush2DLCURVE(src,~)</a>
1251 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1252 gui = getappdata(figh,<span class="string">'gui'</span>);
1253 data = getappdata(figh,<span class="string">'data'</span>);
1254 <span class="comment">% NUCLEUSinv data</span>
1255 dataN = getappdata(gui.figh_nucleus,<span class="string">'data'</span>);
1256 guiN = getappdata(gui.figh_nucleus,<span class="string">'gui'</span>);
1257 
1258 set(gui.rightPanel,<span class="string">'Selection'</span>,1);
1259 <span class="comment">% clear the temporay axis</span>
1260 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes13);
1261 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes14);
1262 
1263 <span class="comment">% prepare all data for the inversion</span>
1264 [dat,param] = <a href="#_sub9" class="code" title="subfunction [dat,param] = tv_prepareInvData(figh)">tv_prepareInvData</a>(figh);
1265 param.EchoFlag = dataN.info.EchoFlag;
1266 
1267 <span class="comment">% status bar information</span>
1268 <span class="keyword">switch</span> dataN.info.solver
1269     <span class="keyword">case</span> <span class="string">'lsqlin'</span>
1270         infostring = <span class="string">'2D L-curve using ''Optimization Toolbox'' ... '</span>;
1271     <span class="keyword">case</span> <span class="string">'lsqnonneg'</span>
1272         infostring = <span class="string">'2D L-curve using ''lsqnonneg'' ... '</span>;
1273 <span class="keyword">end</span>
1274 <a href="../../../../nucleus/functions/interface/displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(guiN,infostring);
1275 
1276 <span class="comment">% disable the RUN button to indicate a running inversion</span>
1277 set(gui.push_handles.run_2dlcurve,<span class="string">'String'</span>,<span class="string">'RUNNING ...'</span>,<span class="keyword">...</span>
1278     <span class="string">'BackgroundColor'</span>,get(gui.push_handles.update,<span class="string">'BackgroundColor'</span>),<span class="keyword">...</span>
1279     <span class="string">'Enable'</span>,<span class="string">'off'</span>); pause(0.01);
1280 
1281 <span class="keyword">if</span> data.regu.linkLambdas
1282 
1283     tic;
1284     <span class="comment">% lambda link factor</span>
1285     lparam.lambdaFactor = data.regu.lambdaFactor;
1286     <span class="comment">% data</span>
1287     lparam.data = dat;
1288     <span class="comment">% fit function</span>
1289     lparam.func = @<a href="../../../../nucleus/functions/inversion/fitData2D.html" class="code" title="function fitdata = fitData2D(data,parameter)">fitData2D</a>;
1290     <span class="comment">% dimension</span>
1291     lparam.dim = 2;
1292     <span class="keyword">switch</span> dataN.info.LcurveMethod
1293         <span class="keyword">case</span> <span class="string">'iterative'</span>
1294             lparam.lambda_range = [data.regu.lambdaT2min data.regu.lambdaT2max];
1295             <span class="comment">% call L-curve function</span>
1296             lc = <a href="../../../../nucleus/functions/inversion/runLcurveIterative.html" class="code" title="function out = runLcurveIterative(lparam,iparam,gui)">runLcurveIterative</a>(lparam,param,guiN);
1297         <span class="keyword">case</span> <span class="string">'discrete'</span>
1298             lparam.lambda_range = logspace(log10(data.regu.lambdaT2min),<span class="keyword">...</span>
1299                 log10(data.regu.lambdaT2max),data.regu.lambdaT2N);
1300             <span class="comment">% call L-curve function</span>
1301             lc = <a href="../../../../nucleus/functions/inversion/runLcurveDiscrete.html" class="code" title="function out = runLcurveDiscrete(lparam,iparam,gui)">runLcurveDiscrete</a>(lparam,param,guiN);
1302     <span class="keyword">end</span>
1303     runtime = toc;
1304     <span class="comment">% output to command line</span>
1305     <a href="../../../../nucleus/functions/interface/displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(1,[infostring,<span class="string">'done | calculation took '</span>,<span class="keyword">...</span>
1306         sprintf(<span class="string">'%5.2f'</span>,runtime),<span class="string">' s'</span>]);
1307 
1308     <span class="comment">% enable the RUN button</span>
1309             set(gui.push_handles.run_2dlcurve,<span class="string">'String'</span>,<span class="string">'CALC 2D L-CURVE'</span>,<span class="keyword">...</span>
1310                 <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub8" class="code" title="subfunction tv_onPush2DLCURVE(src,~)">tv_onPush2DLCURVE</a>);
1311             setappdata(figh,<span class="string">'gui'</span>,gui);
1312 
1313     lamT2 = lc.lambda(lc.index);
1314     lamT1 = data.regu.lambdaFactor*lamT2;
1315 
1316     <span class="comment">% set the optimal lambdas in the GUI</span>
1317     set(gui.edit_handles.lambdaT1,<span class="string">'String'</span>,num2str(lamT1));
1318     set(gui.edit_handles.lambdaT2,<span class="string">'String'</span>,num2str(lamT2));
1319     data.inv.T1lambda = lamT1;
1320     data.inv.T2lambda = lamT2;
1321     
1322     <span class="comment">% opening the export figure</span>
1323     expfig = figure(<span class="string">'Color'</span>,gui.myui.colors.panelBG);
1324     ax1 = subplot(121,<span class="string">'Parent'</span>,expfig); ax2 = subplot(122,<span class="string">'Parent'</span>,expfig);
1325     hold(ax1,<span class="string">'on'</span>); hold(ax2,<span class="string">'on'</span>);
1326 
1327     xlims = [min(lc.RN)/2 max(lc.RN)*2];
1328     ylims = [min(lc.XN)/2 max(lc.XN)*2];
1329     loglog(lc.RN,lc.XN,<span class="string">'o-'</span>,<span class="string">'Parent'</span>,ax1);
1330     loglog(lc.RN(lc.index),lc.XN(lc.index),<span class="string">'r+'</span>,<span class="string">'Parent'</span>,ax1);
1331     set(ax1,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'XLim'</span>,xlims,<span class="string">'YLim'</span>,ylims);
1332     set(get(ax1,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'residual norm |Gm-d|_{2}'</span>);
1333     set(get(ax1,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'model norm |Lm|_{2}'</span>);
1334     set(get(ax1,<span class="string">'Title'</span>),<span class="string">'String'</span>,<span class="string">'L-curve'</span>);
1335 
1336     xlims = [min(lc.lambda)/2 max(lc.lambda)*2];
1337     ylims = [0 max(lc.RMS)*1.1];
1338     semilogx(lc.lambda,lc.RMS,<span class="string">'o-'</span>,<span class="string">'Parent'</span>,ax2);
1339     semilogx(lc.lambda(lc.index),lc.RMS(lc.index),<span class="string">'r+'</span>,<span class="string">'Parent'</span>,ax2);
1340     plot(xlims,[1 1],<span class="string">'k--'</span>,<span class="string">'Parent'</span>,ax2);
1341     set(ax2,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XLim'</span>,xlims,<span class="string">'YLim'</span>,ylims);
1342     set(get(ax2,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'regularization parameter \lambda'</span>);
1343     set(get(ax2,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'noise weighted error \chi^2'</span>);
1344     set(get(ax2,<span class="string">'Title'</span>),<span class="string">'String'</span>,[<span class="string">'\lambda_{T1} = '</span>,<span class="keyword">...</span>
1345         sprintf(<span class="string">'%3.2f'</span>,data.regu.lambdaFactor),<span class="string">'\lambda_{T2}'</span>]);
1346 
1347 <span class="keyword">else</span>
1348 
1349     T1lam_range = logspace(log10(data.regu.lambdaT1min),<span class="keyword">...</span>
1350         log10(data.regu.lambdaT1max),data.regu.lambdaT1N);
1351     T2lam_range = logspace(log10(data.regu.lambdaT2min),<span class="keyword">...</span>
1352         log10(data.regu.lambdaT2max),data.regu.lambdaT2N);
1353     [tmp.LL1,tmp.LL2] = meshgrid(T1lam_range,T2lam_range);
1354 
1355     tic;
1356     <span class="comment">% call 2D inversions</span>
1357     tmp.rnorm_2d = zeros(numel(T1lam_range),numel(T2lam_range));
1358     tmp.mnorm_2d = zeros(numel(T1lam_range),numel(T2lam_range));
1359     <span class="keyword">for</span> l1 = 1:numel(T1lam_range)
1360         <span class="keyword">for</span> l2 = 1:numel(T2lam_range)
1361             disp([<span class="string">'NUCLEUSinv 2D L-curve - lambda T1: '</span>,num2str(l1),<span class="string">'/'</span>,num2str(numel(T1lam_range)),<span class="keyword">...</span>
1362                 <span class="string">' lambda T2: '</span>,num2str(l2),<span class="string">'/'</span>,num2str(numel(T2lam_range))]);
1363             <span class="comment">% call inversion</span>
1364             param.lamT1 = T1lam_range(l1);
1365             param.lamT2 = T2lam_range(l2);
1366             inv2D_tmp = <a href="../../../../nucleus/functions/inversion/fitData2D.html" class="code" title="function fitdata = fitData2D(data,parameter)">fitData2D</a>(dat,param);
1367             <span class="comment">% save norms</span>
1368             tmp.rnorm_2d(l1,l2) = inv2D_tmp.rn;
1369             tmp.mnorm_2d(l1,l2) = inv2D_tmp.xn;
1370             <span class="comment">% plot update</span>
1371             <a href="#_sub17" class="code" title="subfunction tv_plotLCurveUpdate(figh,tmp_norm,method)">tv_plotLCurveUpdate</a>(figh,tmp,<span class="string">'update'</span>);
1372             pause(0.001);
1373         <span class="keyword">end</span>
1374     <span class="keyword">end</span>
1375     runtime = toc;
1376     <a href="#_sub17" class="code" title="subfunction tv_plotLCurveUpdate(figh,tmp_norm,method)">tv_plotLCurveUpdate</a>(figh,tmp,<span class="string">'final'</span>);
1377 
1378     <span class="comment">% output to command line</span>
1379     <a href="../../../../nucleus/functions/interface/displayStatusText.html" class="code" title="function displayStatusText(gui,string)">displayStatusText</a>(1,[infostring,<span class="string">'done | calculation took '</span>,<span class="keyword">...</span>
1380         sprintf(<span class="string">'%5.2f'</span>,runtime),<span class="string">' s'</span>]);
1381 
1382     <span class="comment">% enable the RUN button</span>
1383     set(gui.push_handles.run_2dlcurve,<span class="string">'String'</span>,<span class="string">'CALC 2D L-CURVE'</span>,<span class="keyword">...</span>
1384         <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub8" class="code" title="subfunction tv_onPush2DLCURVE(src,~)">tv_onPush2DLCURVE</a>);
1385     setappdata(figh,<span class="string">'gui'</span>,gui);
1386 
1387     <span class="comment">% get the &quot;optimal&quot; lambda combination - brute force</span>
1388     dd = tmp.rnorm_2d - min(tmp.rnorm_2d(:));
1389     mm = tmp.mnorm_2d - min(tmp.mnorm_2d(:));
1390     dd = dd./max(dd(:));
1391     mm = mm./max(mm(:));
1392     ss1 = dd + mm;
1393     ss2 = abs(dd - mm);
1394     mask1 = ss1 == min(ss1(:)); mask2 = ss2 == min(ss2(:));
1395     lamT1(1) = tmp.LL1(mask1'); lamT2(1) = tmp.LL2(mask1');
1396     lamT1(2) = tmp.LL1(mask2'); lamT2(2) = tmp.LL2(mask2');
1397 
1398     <span class="comment">% index = getLambdaFromLCurve(diag(tmp.rnorm_2d),diag(tmp.mnorm_2d),1);</span>
1399     <span class="comment">% index = getLambdaFromLCurve(diag(rr),diag(mm),1);</span>
1400     <span class="comment">% lamT1 = T2lam_range(index);</span>
1401     <span class="comment">% lamT2 = T2lam_range(index);</span>
1402     
1403     <span class="comment">% extent matrices for plotting</span>
1404     SS1 = [ss1(1,:);ss1];
1405     SS1 = [SS1(:,1) SS1];
1406     SS2 = [ss2(1,:);ss2];
1407     SS2 = [SS2(:,1) SS2];
1408 
1409     <span class="comment">% opening the export figure</span>
1410     expfig = figure(<span class="string">'Color'</span>,gui.myui.colors.panelBG);
1411     ax1 = subplot(221,<span class="string">'Parent'</span>,expfig); ax2 = subplot(222,<span class="string">'Parent'</span>,expfig);
1412     ax3 = subplot(223,<span class="string">'Parent'</span>,expfig); ax4 = subplot(224,<span class="string">'Parent'</span>,expfig);
1413     pos1 = get(ax1,<span class="string">'Position'</span>); pos2 = get(ax2,<span class="string">'Position'</span>);
1414     pos3 = get(ax3,<span class="string">'Position'</span>); pos4 = get(ax4,<span class="string">'Position'</span>);
1415     delete(ax1); delete(ax2);
1416     delete(ax3); delete(ax4);
1417     ax1 = copyobj(gui.axes13,expfig); ax2 = copyobj(gui.axes14,expfig);
1418     set(ax1,<span class="string">'Position'</span>,pos1); hold(ax1,<span class="string">'on'</span>); colorbar(ax1);
1419     set(ax2,<span class="string">'Position'</span>,pos2); hold(ax2,<span class="string">'on'</span>); colorbar(ax2);
1420     ax3 = copyobj(gui.axes13,expfig); set(ax3,<span class="string">'Position'</span>,pos3);
1421     ax4 = copyobj(gui.axes14,expfig); set(ax4,<span class="string">'Position'</span>,pos4);
1422     set(get(ax3,<span class="string">'Children'</span>),<span class="string">'CData'</span>,SS1'); hold(ax3,<span class="string">'on'</span>);
1423     set(get(ax4,<span class="string">'Children'</span>),<span class="string">'CData'</span>,SS2'); hold(ax4,<span class="string">'on'</span>);
1424 
1425     plot(lamT1(1),lamT2(1),<span class="string">'rx'</span>,<span class="string">'MarkerSize'</span>,8,<span class="string">'Parent'</span>,ax3);
1426     plot(lamT1(2),lamT2(2),<span class="string">'rx'</span>,<span class="string">'MarkerSize'</span>,8,<span class="string">'Parent'</span>,ax4);
1427     axis([ax1 ax2 ax3 ax4],<span class="string">'square'</span>);
1428     set(get(ax3,<span class="string">'Title'</span>),<span class="string">'String'</span>,<span class="string">'d + m'</span>);
1429     set(get(ax4,<span class="string">'Title'</span>),<span class="string">'String'</span>,<span class="string">'abs(d - m)'</span>);
1430     colorbar(ax3); colorbar(ax4);
1431 
1432     <span class="comment">% save results</span>
1433     data.results.lcurve.T1lam_range = T1lam_range;
1434     data.results.lcurve.T2lam_range = T2lam_range;
1435     data.results.lcurve.rnorm = tmp.rnorm_2d;
1436     data.results.lcurve.mnorm = tmp.mnorm_2d;
1437     data.results.lcurve.lamT1 = lamT1;
1438     data.results.lcurve.lamT2 = lamT2;
1439 
1440     <span class="comment">% set the optimal lambdas in the GUI</span>
1441     set(gui.edit_handles.lambdaT1,<span class="string">'String'</span>,num2str(min(lamT1)));
1442     set(gui.edit_handles.lambdaT2,<span class="string">'String'</span>,num2str(min(lamT2)));
1443     data.inv.T1lambda = min(lamT1);
1444     data.inv.T2lambda = min(lamT2);
1445 <span class="keyword">end</span>
1446 
1447 <span class="comment">% update data</span>
1448 setappdata(figh,<span class="string">'data'</span>,data);
1449 setappdata(figh,<span class="string">'gui'</span>,gui);
1450 
1451 <span class="comment">% call final inverion with optimal lambda</span>
1452 <a href="#_sub7" class="code" title="subfunction tv_onPushRun(src,~)">tv_onPushRun</a>(gui.push_handles.run_inv);
1453 <span class="keyword">end</span>
1454 
1455 <span class="comment">%% subfuntion to prepare inversion data</span>
1456 <a name="_sub9" href="#_subfunctions" class="code">function [dat,param] = tv_prepareInvData(figh)</a>
1457 gui = getappdata(figh,<span class="string">'gui'</span>);
1458 data = getappdata(figh,<span class="string">'data'</span>);
1459 <span class="comment">% NUCLEUSinv data</span>
1460 dataN = getappdata(gui.figh_nucleus,<span class="string">'data'</span>);
1461 <span class="comment">% local T1T2 data</span>
1462 T1T2map = data.results.T1T2map;
1463 
1464 <span class="comment">% prepare inversion parameter struct</span>
1465 param.T1T2 = <span class="string">'T1T2'</span>; <span class="comment">% T1-T2 2D inv</span>
1466 
1467 <span class="comment">% get system properties</span>
1468 param.D = data.prop.D;
1469 param.G0 = data.prop.G0;
1470 param.te = data.prop.te;
1471 
1472 <span class="comment">% IR/SR factor</span>
1473 param.T1IRfac = data.inv.T1IRfac;
1474 param.IRtype = data.inv.IRtype;
1475 
1476 <span class="comment">% get T1/T2 RTDs values</span>
1477 param.T1min = data.inv.T1min;
1478 param.T1max = data.inv.T1max;
1479 param.T1N = data.inv.T1N;
1480 param.T2min = data.inv.T2min;
1481 param.T2max = data.inv.T2max;
1482 param.T2N = data.inv.T2N;
1483 
1484 <span class="comment">% inversion/regularization settings</span>
1485 param.regMethod = data.inv.regtype;
1486 param.lamT1 = data.inv.T1lambda;
1487 param.lamT2 = data.inv.T2lambda;
1488 param.orderT1 = data.inv.T1order;
1489 param.orderT2 = data.inv.T2order;
1490 
1491 <span class="comment">% prepare data</span>
1492 dat = struct;
1493 <span class="keyword">for</span> n = 1:numel(T1T2map.t_recov)
1494     <span class="keyword">if</span> data.prop.useLogGates
1495         dat(n).t = T1T2map.t2_gate;
1496     <span class="keyword">else</span>
1497         dat(n).t = T1T2map.t2;
1498     <span class="keyword">end</span>
1499     dat(n).s = real(T1T2map.dcube(n,:))';
1500     dat(n).e = T1T2map.ecube(n,:)';
1501     dat(n).noise = T1T2map.noise(n);<span class="comment">%std(T1T2map.ecube(n,:));</span>
1502     dat(n).T1 = T1T2map.t_recov(n);
1503 <span class="keyword">end</span>
1504 <span class="comment">% global noise</span>
1505 param.noise = mean(T1T2map.noise);
1506 param.useLogGates = data.prop.useLogGates;
1507 
1508 <span class="comment">% take solver from main NUCLEUS GUI</span>
1509 param.solver = dataN.info.solver;
1510 <span class="keyword">switch</span> dataN.info.InvInfo
1511     <span class="keyword">case</span> <span class="string">'on'</span>
1512         param.info = <span class="string">'final'</span>;
1513     <span class="keyword">case</span> <span class="string">'off'</span>
1514         param.info = <span class="string">'off'</span>;
1515 <span class="keyword">end</span>
1516 
1517 <span class="keyword">end</span>
1518 
1519 <span class="comment">%% subfunction to export the 2D inversion data</span>
1520 <a name="_sub10" href="#_subfunctions" class="code">function tv_onPushSave(src,~)</a>
1521 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1522 <span class="comment">% local GUI data</span>
1523 uvgui = getappdata(figh,<span class="string">'gui'</span>);
1524 uvdata = getappdata(figh,<span class="string">'data'</span>);
1525 <span class="comment">% NUCLEUSinv data</span>
1526 data = getappdata(uvgui.figh_nucleus,<span class="string">'data'</span>);
1527 
1528 <span class="comment">% get data path to save inversion results</span>
1529 [sfile,spath] = uiputfile(<span class="string">'*.mat'</span>,<span class="string">'Select File for Save'</span>,<span class="keyword">...</span>
1530     fullfile(data.import.path,<span class="string">'2Dinvdata.mat'</span>));
1531 <span class="comment">% if user did not cancel, procceed</span>
1532 <span class="keyword">if</span> sfile &gt; 0
1533     invdata = uvdata;
1534     save(fullfile(spath,sfile),<span class="string">'invdata'</span>);
1535     disp(<span class="string">'2D Inverions data saved to: '</span>);
1536     disp(fullfile(spath,sfile));
1537 <span class="keyword">else</span>
1538     disp(<span class="string">'Save cancelled.'</span>);
1539 <span class="keyword">end</span>
1540 
1541 <span class="keyword">end</span>
1542 
1543 <span class="comment">%% subfunction to export the current view to a figure</span>
1544 <a name="_sub11" href="#_subfunctions" class="code">function tv_onPushView(src,~)</a>
1545 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1546 <span class="comment">% local GUI data</span>
1547 gui = getappdata(figh,<span class="string">'gui'</span>);
1548 
1549 <span class="comment">% opening the export figure</span>
1550 expfig = figure(<span class="string">'Color'</span>,gui.myui.colors.panelBG);
1551 
1552 <span class="comment">% create axes layout depending on view</span>
1553 <span class="keyword">switch</span> get(gui.rightPanel,<span class="string">'Selection'</span>)
1554     <span class="keyword">case</span> 1
1555         <span class="comment">% create layout</span>
1556         ax1 = subplot(2,2,1,<span class="string">'Parent'</span>,expfig);
1557         ax2 = subplot(2,2,2,<span class="string">'Parent'</span>,expfig);
1558         ax3 = subplot(2,2,3,<span class="string">'Parent'</span>,expfig);
1559         ax4 = subplot(2,2,4,<span class="string">'Parent'</span>,expfig);
1560         <span class="comment">% get positions</span>
1561         pos1 = get(ax1,<span class="string">'Position'</span>);
1562         pos2 = get(ax2,<span class="string">'Position'</span>);
1563         pos3 = get(ax3,<span class="string">'Position'</span>);
1564         pos4 = get(ax4,<span class="string">'Position'</span>);
1565         <span class="comment">% delete axes</span>
1566         delete(ax1);delete(ax2);delete(ax3);delete(ax4);
1567         <span class="comment">% copy GUI axes</span>
1568         ax1 = copyobj(gui.axes11,expfig);
1569         ax2 = copyobj(gui.axes12,expfig);
1570         ax3 = copyobj(gui.axes13,expfig);
1571         ax4 = copyobj(gui.axes14,expfig);
1572         <span class="comment">% adjust positions</span>
1573         set(ax1,<span class="string">'Position'</span>,pos1);
1574         set(ax2,<span class="string">'Position'</span>,pos2);
1575         set(ax3,<span class="string">'Position'</span>,pos3);
1576         set(ax4,<span class="string">'Position'</span>,pos4);
1577         <span class="comment">% set colorbars</span>
1578         colorbar(ax1,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
1579         colorbar(ax2,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
1580         colorbar(ax3,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
1581         colorbar(ax4,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
1582     <span class="keyword">case</span> 2
1583         <span class="comment">% create layout</span>
1584         ax1 = subplot(5,5,[1 2 3 4],<span class="string">'Parent'</span>,expfig);
1585         ax2 = subplot(5,5,[6:9 11:14 16:19 21:24],<span class="string">'Parent'</span>,expfig);
1586         ax3 = subplot(5,5,[10 15 20 25],<span class="string">'Parent'</span>,expfig);
1587         <span class="comment">% get positions</span>
1588         pos1 = get(ax1,<span class="string">'Position'</span>);
1589         pos2 = get(ax2,<span class="string">'Position'</span>);
1590         pos3 = get(ax3,<span class="string">'Position'</span>);
1591         <span class="comment">% delete axes</span>
1592         delete(ax1);delete(ax2);delete(ax3);
1593         <span class="comment">% copy GUI axes</span>
1594         ax1 = copyobj(gui.axes21,expfig);
1595         ax2 = copyobj(gui.axes2,expfig);
1596         ax3 = copyobj(gui.axes24,expfig);
1597         <span class="comment">% adjust positions</span>
1598         set(ax1,<span class="string">'Position'</span>,pos1);
1599         set(ax2,<span class="string">'Position'</span>,pos2);
1600         set(ax3,<span class="string">'Position'</span>,pos3);
1601     <span class="keyword">case</span> 3
1602         <span class="comment">% create layout</span>
1603         ax1 = subplot(7,1,[1 2],<span class="string">'Parent'</span>,expfig);
1604         ax2 = subplot(7,1,[4 5 6 7],<span class="string">'Parent'</span>,expfig);
1605         <span class="comment">% get positions</span>
1606         pos1 = get(ax1,<span class="string">'Position'</span>);
1607         pos2 = get(ax2,<span class="string">'Position'</span>);
1608         <span class="comment">% delete axes</span>
1609         delete(ax1);delete(ax2);
1610         <span class="comment">% copy GUI axes</span>
1611         ax1 = copyobj(gui.axes31,expfig);
1612         ax2 = copyobj(gui.axes32,expfig);
1613         <span class="comment">% adjust positions</span>
1614         set(ax1,<span class="string">'Position'</span>,pos1);
1615         set(ax2,<span class="string">'Position'</span>,pos2);
1616 <span class="keyword">end</span>
1617 
1618 <span class="keyword">end</span>
1619 
1620 <span class="comment">%% subfunction to update the main NUCLEUSinv GUI</span>
1621 <a name="_sub12" href="#_subfunctions" class="code">function tv_onPushUpdate(src,~)</a>
1622 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1623 <span class="comment">% local GUI data</span>
1624 uvgui = getappdata(figh,<span class="string">'gui'</span>);
1625 uvdata = getappdata(figh,<span class="string">'data'</span>);
1626 <span class="comment">% NUCLEUSinv data</span>
1627 gui = getappdata(uvgui.figh_nucleus,<span class="string">'gui'</span>);
1628 INVdata = getappdata(uvgui.figh_nucleus,<span class="string">'INVdata'</span>);
1629 data = getappdata(uvgui.figh_nucleus,<span class="string">'data'</span>);
1630 
1631 <span class="comment">% loop over all signals</span>
1632 E_inv = zeros(size(uvdata.results.T1T2map.t_recov));
1633 firstT1 = uvdata.prop.firstT1;
1634 lastT1 = uvdata.prop.lastT1;
1635 idT1 = firstT1:lastT1;
1636 <span class="keyword">for</span> id = 1:numel(INVdata)
1637     <span class="comment">% the standard INVdata struct</span>
1638     INVdata{id} = [];
1639     local_id = find(id==idT1);
1640 
1641     <span class="keyword">if</span> any(id==idT1) <span class="comment">% for all T2 signals not cut out</span>
1642         first = uvdata.prop.firstT2;
1643         last = uvdata.prop.lastT2;
1644         data.process.start = first;
1645         data.process.end = last;
1646 
1647         <span class="keyword">if</span> uvdata.prop.useLogGates
1648             data.process.gatetype = <span class="string">'log'</span>;
1649             data.process.isgated = true;
1650         <span class="keyword">else</span>
1651             data.process.gatetype = <span class="string">'raw'</span>;
1652             data.process.isgated = false;
1653         <span class="keyword">end</span>
1654 
1655         <span class="comment">% update 2Dinv GUI settings</span>
1656         data.inv2D.prop = uvdata.prop;
1657         data.inv2D.inv = uvdata.inv;
1658         data.inv2D.info = uvdata.info;
1659 
1660         <span class="comment">% create raw data struct</span>
1661         data.results.nmrraw.t = uvdata.results.T1T2map.import{id}.time(first:last);
1662         data.results.nmrraw.s = uvdata.results.T1T2map.import{id}.signal(first:last);
1663         data.results.nmrraw.phase = uvdata.results.T1T2map.import{id}.phase;
1664         data.results.nmrproc.T1T2 = <span class="string">'T2'</span>;
1665         data.results.nmrproc.T1IRfac = 1;
1666 
1667         <span class="comment">% create proc data struct</span>
1668         data.results.nmrproc.start = first;
1669         data.results.nmrproc.end = last;
1670 
1671         <span class="keyword">if</span> uvdata.prop.useLogGates
1672             data.results.nmrproc.gatetype = <span class="string">'log'</span>;
1673             data.results.nmrproc.isgated = true;
1674             data.results.nmrproc.t = uvdata.results.T1T2map.t2_gate(:);
1675             data.results.nmrproc.s = real(uvdata.results.T1T2map.dcube(local_id,:))';
1676             data.results.nmrproc.N = uvdata.results.T1T2map.t2_gateN(:);
1677 
1678             data.results.nmrproc.noise = uvdata.results.T1T2map.noise(local_id);
1679             data.results.nmrproc.e = uvdata.results.inv2D.data(local_id).e;
1680             data.results.nmrproc.W = diag(data.results.nmrproc.e);
1681             ErrWimag = imag(uvdata.results.T1T2map.dcube(local_id,:))./uvdata.results.inv2D.data(local_id).e;
1682             chi2 = sqrt(sum(sum(ErrWimag.^2)))/sqrt(numel(ErrWimag));
1683             data.results.nmrproc.imag_chi2 = chi2;
1684         <span class="keyword">else</span>
1685             data.results.nmrproc.gatetype = <span class="string">'raw'</span>;
1686             data.results.nmrproc.isgated = false;
1687             data.results.nmrproc.t = uvdata.results.T1T2map.import{id}.time(first:last);
1688             data.results.nmrproc.s = real(uvdata.results.T1T2map.import{id}.signal(first:last));
1689             data.results.nmrproc.N = ones(size(data.results.nmrproc.s));
1690 
1691             <span class="keyword">if</span> isfield(uvdata.results.T1T2map.import{id},<span class="string">'noise'</span>)
1692                 data.results.nmrproc.noise = uvdata.results.T1T2map.import{id}.noise;
1693             <span class="keyword">else</span>
1694                 range = floor(numel(data.results.nmrproc.s)/2):numel(data.results.nmrproc.s);
1695                 data.results.nmrproc.noise = std(imag(uvdata.results.T1T2map.import{id}.signal(range)));
1696             <span class="keyword">end</span>
1697             data.results.nmrproc.e = data.results.nmrproc.noise*ones(size(data.results.nmrproc.s));
1698             <span class="keyword">if</span> isfield(data.results.nmrproc,<span class="string">'W'</span>)
1699                 data.results.nmrproc = rmfield(data.results.nmrproc,<span class="string">'W'</span>);
1700             <span class="keyword">end</span>
1701             ErrWimag = imag(uvdata.results.T1T2map.import{id}.signal(first:last))./data.results.nmrproc.noise;
1702             chi2 = sqrt(sum(sum(ErrWimag.^2)))/sqrt(numel(ErrWimag));
1703             data.results.nmrproc.imag_chi2 = chi2;
1704         <span class="keyword">end</span>
1705 
1706         INVdata{id} = data;
1707         INVdata{id} = rmfield(INVdata{id},<span class="string">'import'</span>);
1708         INVdata{id} = rmfield(INVdata{id},<span class="string">'info'</span>);
1709         INVdata{id} = rmfield(INVdata{id},<span class="string">'calib'</span>);
1710         INVdata{id} = rmfield(INVdata{id},<span class="string">'pressure'</span>);
1711 
1712         <span class="comment">% now add a dummy &quot;invstd&quot; field</span>
1713         INVdata{id}.results.invstd.fit_t = uvdata.results.inv2D.data(local_id).t;
1714         INVdata{id}.results.invstd.fit_s = uvdata.results.inv2D.data(local_id).s_fit;
1715         E_inv(id,1) = uvdata.results.inv2D.data(local_id).s_fit(1);
1716         INVdata{id}.results.invstd.E0 = uvdata.results.inv2D.data(local_id).s_fit(1);
1717         INVdata{id}.results.invstd.ciE0 = NaN;
1718         INVdata{id}.results.invstd.resnorm = uvdata.results.inv2D.data(local_id).resnorm;
1719         INVdata{id}.results.invstd.residual = uvdata.results.inv2D.data(local_id).residual;
1720         INVdata{id}.results.invstd.chi2 = uvdata.results.inv2D.data(local_id).chi2;
1721         INVdata{id}.results.invstd.rms = uvdata.results.inv2D.data(local_id).rms;
1722 
1723         INVdata{id}.results.invstd.lambda_out = 1;
1724         INVdata{id}.results.invstd.xn = 0;
1725         INVdata{id}.results.invstd.rn = 0;
1726         INVdata{id}.results.invstd.invtype = data.invstd.invtype;
1727         INVdata{id}.results.invstd.invparams = NaN;
1728 
1729         INVdata{id}.results.inv2D = true;
1730 
1731         <span class="comment">% color the corresponding list entries in the main GUI</span>
1732         strL = get(gui.listbox_handles.signal,<span class="string">'String'</span>);
1733         str1 = strL{id};
1734         str2 = [<span class="string">'&lt;HTML&gt;&lt;BODY bgcolor=&quot;rgb('</span>,<span class="keyword">...</span>
1735             sprintf(<span class="string">'%d,%d,%d'</span>,gui.myui.colors.listINV.*255),<span class="string">')&quot;&gt;'</span>,str1,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;'</span>];
1736         strL{id} = str2;
1737         set(gui.listbox_handles.signal,<span class="string">'String'</span>,strL);
1738     <span class="keyword">end</span>
1739 
1740     <span class="keyword">if</span> id == numel(INVdata) <span class="comment">% for the merged T1 curve</span>
1741         <span class="comment">% data.process.start = 1;</span>
1742         <span class="comment">% data.process.end = numel(uvdata.results.T1T2map.import{id}.time);</span>
1743         data.process.start = firstT1;
1744         data.process.end = lastT1;
1745 
1746         data.process.gatetype = <span class="string">'raw'</span>;
1747         data.process.isgated = false;
1748 
1749         <span class="comment">% update 2Dinv GUI settings</span>
1750         data.inv2D.prop = uvdata.prop;
1751         data.inv2D.inv = uvdata.inv;
1752         data.inv2D.info = uvdata.info;
1753 
1754         <span class="comment">% create raw data struct</span>
1755         data.results.nmrraw.t = uvdata.results.T1T2map.import{id}.time(firstT1:lastT1);
1756         data.results.nmrraw.s = uvdata.results.T1T2map.import{id}.signal(firstT1:lastT1);
1757         data.results.nmrraw.noise = uvdata.results.T1T2map.import{id}.noise;
1758         data.results.nmrproc.T1T2 = <span class="string">'T1'</span>;
1759         data.results.nmrproc.T1IRfac = 2;
1760 
1761         <span class="comment">% create proc data struct</span>
1762         data.results.nmrproc.start = firstT1;
1763         data.results.nmrproc.end = lastT1;
1764 
1765         data.results.nmrproc.gatetype = <span class="string">'raw'</span>;
1766         data.results.nmrproc.isgated = false;
1767         data.results.nmrproc.t = uvdata.results.T1T2map.import{id}.time(data.results.nmrproc.start:data.results.nmrproc.end);
1768         data.results.nmrproc.s = real(uvdata.results.T1T2map.import{id}.signal(data.results.nmrproc.start:data.results.nmrproc.end));
1769         data.results.nmrproc.N = ones(size(data.results.nmrproc.s));
1770 
1771         <span class="keyword">if</span> isfield(uvdata.results.T1T2map.import{id},<span class="string">'noise'</span>)
1772             data.results.nmrproc.noise = uvdata.results.T1T2map.import{id}.noise;
1773         <span class="keyword">else</span>
1774             range = floor(numel(data.results.nmrproc.s)/2):numel(data.results.nmrproc.s);
1775             data.results.nmrproc.noise = std(imag(uvdata.results.T1T2map.import{id}.signal(range)));
1776         <span class="keyword">end</span>
1777         data.results.nmrproc.e = data.results.nmrproc.noise*ones(size(data.results.nmrproc.s));
1778         <span class="keyword">if</span> isfield(data.results.nmrproc,<span class="string">'W'</span>)
1779             data.results.nmrproc = rmfield(data.results.nmrproc,<span class="string">'W'</span>);
1780         <span class="keyword">end</span>
1781 
1782         INVdata{id} = data;
1783         INVdata{id} = rmfield(INVdata{id},<span class="string">'import'</span>);
1784         INVdata{id} = rmfield(INVdata{id},<span class="string">'info'</span>);
1785         INVdata{id} = rmfield(INVdata{id},<span class="string">'calib'</span>);
1786         INVdata{id} = rmfield(INVdata{id},<span class="string">'pressure'</span>);
1787 
1788         <span class="comment">% now add a dummy &quot;invstd&quot; field</span>
1789         E_inv = E_inv(firstT1:lastT1);
1790         INVdata{id}.results.invstd.fit_t = uvdata.results.T1T2map.t_recov;
1791         INVdata{id}.results.invstd.fit_s = E_inv;
1792         INVdata{id}.results.invstd.E0 = uvdata.results.inv2D.E0;
1793         INVdata{id}.results.invstd.ciE0 = NaN;
1794         out = <a href="../../../../nucleus/functions/inversion/getFitErrors.html" class="code" title="function out = getFitErrors(s,sfit,noise,varargin)">getFitErrors</a>(uvdata.results.T1T2map.E_raw(:,1),E_inv,data.results.nmrproc.noise);
1795         INVdata{id}.results.invstd.resnorm = out.resnorm;
1796         INVdata{id}.results.invstd.residual = out.residual;
1797         INVdata{id}.results.invstd.chi2 = out.chi2;
1798         INVdata{id}.results.invstd.rms = out.rms;
1799 
1800         INVdata{id}.results.invstd.lambda_out = 1;
1801         INVdata{id}.results.invstd.xn = 0;
1802         INVdata{id}.results.invstd.rn = 0;
1803         INVdata{id}.results.invstd.invtype = data.invstd.invtype;
1804         INVdata{id}.results.invstd.invparams = NaN;
1805 
1806         INVdata{id}.results.inv2D = uvdata.results.inv2D;
1807 
1808         <span class="comment">% color the corresponding list entries in the main GUI</span>
1809         strL = get(gui.listbox_handles.signal,<span class="string">'String'</span>);
1810         str1 = strL{id};
1811         str2 = [<span class="string">'&lt;HTML&gt;&lt;BODY bgcolor=&quot;rgb('</span>,<span class="keyword">...</span>
1812             sprintf(<span class="string">'%d,%d,%d'</span>,gui.myui.colors.listINV.*255),<span class="string">')&quot;&gt;'</span>,str1,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;'</span>];
1813         strL{id} = str2;
1814         set(gui.listbox_handles.signal,<span class="string">'String'</span>,strL);
1815     <span class="keyword">end</span>
1816 <span class="keyword">end</span>
1817 
1818 <span class="comment">% update GUI INVdata</span>
1819 setappdata(uvgui.figh_nucleus,<span class="string">'INVdata'</span>,INVdata);
1820 
1821 <span class="comment">% set focus on first signal</span>
1822 set(gui.listbox_handles.signal,<span class="string">'Value'</span>,1);
1823 <a href="../../../../nucleus/callbacks/listboxes/onListboxData.html" class="code" title="function onListboxData(src,~)">onListboxData</a>(gui.listbox_handles.signal);
1824 <span class="keyword">end</span>
1825 
1826 <span class="comment">%% subfunction to switch x-axis scaling</span>
1827 <a name="_sub13" href="#_subfunctions" class="code">function tv_onRadioLogLin(src,~)</a>
1828 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1829 gui = getappdata(figh,<span class="string">'gui'</span>);
1830 <span class="comment">% get tag of the radio menu</span>
1831 tag = get(src,<span class="string">'Tag'</span>);
1832 val = get(src,<span class="string">'Value'</span>);
1833 
1834 <span class="keyword">switch</span> tag
1835     <span class="keyword">case</span> <span class="string">'log'</span>
1836         <span class="keyword">switch</span> val
1837             <span class="keyword">case</span> 1 <span class="comment">% log should be used</span>
1838                 set(gui.radio_handles.lin,<span class="string">'Value'</span>,0);
1839             <span class="keyword">case</span> 0 <span class="comment">% lin should be used</span>
1840                 set(gui.radio_handles.lin,<span class="string">'Value'</span>,1);
1841         <span class="keyword">end</span>
1842     <span class="keyword">case</span> <span class="string">'lin'</span>
1843         <span class="keyword">switch</span> val
1844             <span class="keyword">case</span> 1 <span class="comment">% lin should be used</span>
1845                 set(gui.radio_handles.log,<span class="string">'Value'</span>,0);
1846             <span class="keyword">case</span> 0 <span class="comment">% log should be used</span>
1847                 set(gui.radio_handles.log,<span class="string">'Value'</span>,1);
1848         <span class="keyword">end</span>
1849 <span class="keyword">end</span>
1850 <span class="comment">% update GUI data</span>
1851 setappdata(figh,<span class="string">'gui'</span>,gui);
1852 
1853 <span class="comment">% call function to adapt the axes scaling</span>
1854 <a href="#_sub16" class="code" title="subfunction tv_setAxesScaling(figh)">tv_setAxesScaling</a>(figh);
1855 <span class="keyword">end</span>
1856 
1857 <span class="comment">%% subfunction to activate data tips on 2D plot</span>
1858 <a name="_sub14" href="#_subfunctions" class="code">function tv_onCheckDCM(src,~)</a>
1859 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1860 gui = getappdata(figh,<span class="string">'gui'</span>);
1861 <span class="comment">% get tag of the radio menu</span>
1862 val = get(src,<span class="string">'Value'</span>);
1863 
1864 <span class="keyword">switch</span> val
1865     <span class="keyword">case</span> 1 <span class="comment">% DCM on</span>
1866         gui.dcm.Enable = <span class="string">'on'</span>;
1867     <span class="keyword">case</span> 0 <span class="comment">% DCM off</span>
1868         gui.dcm.Enable = <span class="string">'off'</span>;
1869 <span class="keyword">end</span>
1870 
1871 <span class="comment">% update GUI data</span>
1872 setappdata(figh,<span class="string">'gui'</span>,gui);
1873 
1874 <span class="keyword">end</span>
1875 
1876 <span class="comment">%% subfunction to export the 2D inversion data</span>
1877 <a name="_sub15" href="#_subfunctions" class="code">function tv_onPopupCbar(src,~)</a>
1878 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1879 <a href="#_sub18" class="code" title="subfunction tv_plotResults(figh)">tv_plotResults</a>(figh)
1880 <span class="keyword">end</span>
1881 
1882 <span class="comment">%% subfunction to switch x-axis scaling log&lt;-&gt;lin</span>
1883 <a name="_sub16" href="#_subfunctions" class="code">function tv_setAxesScaling(figh)</a>
1884 gui = getappdata(figh,<span class="string">'gui'</span>);
1885 
1886 uselog = get(gui.radio_handles.log,<span class="string">'Value'</span>);
1887 <span class="keyword">switch</span> uselog
1888     <span class="keyword">case</span> 1
1889         set(gui.axes11,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
1890         set(gui.axes12,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
1891         set(gui.axes13,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
1892         set(gui.axes14,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
1893         log_t_ticks = logspace(-5,2,8);
1894         set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks);
1895     <span class="keyword">case</span> 0
1896         set(gui.axes11,<span class="string">'XScale'</span>,<span class="string">'lin'</span>);
1897         set(gui.axes12,<span class="string">'XScale'</span>,<span class="string">'lin'</span>);
1898         set(gui.axes13,<span class="string">'XScale'</span>,<span class="string">'lin'</span>);
1899         set(gui.axes14,<span class="string">'XScale'</span>,<span class="string">'lin'</span>);
1900         set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'lin'</span>,<span class="string">'XTickMode'</span>,<span class="string">'auto'</span>);
1901 <span class="keyword">end</span>
1902 
1903 <span class="keyword">end</span>
1904 
1905 <span class="comment">%% subfunction to update the plots during the 2D L-curve calculation</span>
1906 <a name="_sub17" href="#_subfunctions" class="code">function tv_plotLCurveUpdate(figh,tmp_norm,method)</a>
1907 gui = getappdata(figh,<span class="string">'gui'</span>);
1908 <span class="comment">% data = getappdata(figh,'data');</span>
1909 
1910 <span class="comment">% clear the temporay axis</span>
1911 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes13);
1912 
1913 L1 = tmp_norm.LL1;
1914 L2 = tmp_norm.LL2;
1915 
1916 <span class="comment">% extent matrices for plotting</span>
1917 LL1 = [min(L1(:))/1.5.*ones(size(L1,1),1) L1];
1918 LL1 = [LL1(1,:); LL1];
1919 LL2 = [min(L2(:))/1.5.*ones(1,size(L2,2)); L2];
1920 LL2 = [LL2(:,1) LL2];
1921 
1922 <span class="comment">% get the normdata</span>
1923 <span class="comment">% shift to zero</span>
1924 dd = tmp_norm.rnorm_2d - min(tmp_norm.rnorm_2d(:));
1925 mm = tmp_norm.mnorm_2d - min(tmp_norm.mnorm_2d(:));
1926 <span class="comment">% scale to one</span>
1927 dd = dd./max(dd(:));
1928 mm = mm./max(mm(:));
1929 <span class="comment">% add both norms</span>
1930 <span class="comment">% ss = dd + mm;</span>
1931 <span class="comment">% ss = abs(dd - mm);</span>
1932 <span class="comment">% ss(ss==0) = NaN;</span>
1933 <span class="keyword">switch</span> method
1934     <span class="keyword">case</span> <span class="string">'update'</span>
1935         dd(dd==0) = NaN;
1936         mm(mm==0) = NaN;
1937     <span class="keyword">otherwise</span>
1938         <span class="comment">% nada</span>
1939 <span class="keyword">end</span>
1940 <span class="comment">% extent matrices for plotting</span>
1941 dd1 = [dd(1,:);dd];
1942 dd1 = [dd1(:,1) dd1];
1943 mm1 = [mm(1,:);mm];
1944 mm1 = [mm1(:,1) mm1];
1945 <span class="comment">% imagescnan(tmp_norm.LL1,tmp_norm.LL2,ss','Parent',gui.axes13);</span>
1946 imagescnan(LL1,LL2,dd1',<span class="string">'Parent'</span>,gui.axes13);
1947 imagescnan(LL1,LL2,mm1',<span class="string">'Parent'</span>,gui.axes14);
1948 colormap(gui.axes14,<span class="string">'parula'</span>);
1949 set(get(gui.axes13,<span class="string">'Title'</span>),<span class="string">'String'</span>,<span class="string">'data norm'</span>);
1950 set(get(gui.axes13,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'\lambda T1'</span>);
1951 set(get(gui.axes13,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'\lambda T2'</span>);
1952 set(gui.axes13,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
1953 set(gui.axes13,<span class="string">'XLim'</span>,[min(LL1(:)) max(LL1(:))],<span class="string">'YLim'</span>,[min(LL2(:)) max(LL2(:))]);
1954 cb = colorbar(gui.axes13);
1955 set(cb,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
1956 set(get(gui.axes14,<span class="string">'Title'</span>),<span class="string">'String'</span>,<span class="string">'model norm'</span>);
1957 set(get(gui.axes14,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'\lambda T1'</span>);
1958 set(get(gui.axes14,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'\lambda T2'</span>);
1959 set(gui.axes14,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
1960 set(gui.axes14,<span class="string">'XLim'</span>,[min(LL1(:)) max(LL1(:))],<span class="string">'YLim'</span>,[min(LL2(:)) max(LL2(:))]);
1961 cb = colorbar(gui.axes14);
1962 set(cb,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
1963 
1964 <span class="keyword">end</span>
1965 
1966 <span class="comment">%% subfunction to update all plots</span>
1967 <a name="_sub18" href="#_subfunctions" class="code">function tv_plotResults(figh)</a>
1968 gui = getappdata(figh,<span class="string">'gui'</span>);
1969 data = getappdata(figh,<span class="string">'data'</span>);
1970 T1T2map = data.results.T1T2map;
1971 inv2D = data.results.inv2D;
1972 col = gui.myui.colors;
1973 
1974 <span class="comment">% clear axes</span>
1975 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes13);
1976 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes14);
1977 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes2);
1978 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes21);
1979 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes24);
1980 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes31);
1981 <a href="../../../../nucleus/functions/interface/clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes32);
1982 hold(gui.axes13,<span class="string">'on'</span>);
1983 hold(gui.axes14,<span class="string">'on'</span>);
1984 hold(gui.axes2,<span class="string">'on'</span>);
1985 hold(gui.axes21,<span class="string">'on'</span>);
1986 hold(gui.axes24,<span class="string">'on'</span>);
1987 hold(gui.axes31,<span class="string">'on'</span>);
1988 hold(gui.axes32,<span class="string">'on'</span>);
1989 
1990 <span class="comment">% get T1/T2 info range from GUI</span>
1991 T1_irange(1) = str2double(get(gui.edit_handles.T1min,<span class="string">'String'</span>));
1992 T1_irange(2) = str2double(get(gui.edit_handles.T1max,<span class="string">'String'</span>));
1993 T2_irange(1) = str2double(get(gui.edit_handles.T2min,<span class="string">'String'</span>));
1994 T2_irange(2) = str2double(get(gui.edit_handles.T2max,<span class="string">'String'</span>));
1995 
1996 <span class="comment">% create masks for plotting</span>
1997 [TX,TY] = meshgrid(data.results.inv2D.T2vec,data.results.inv2D.T1vec);
1998 mask1 = TY &gt;= T1_irange(1) &amp; TY &lt;= T1_irange(2);
1999 mask2 = TX &gt;= T2_irange(1) &amp; TX &lt;= T2_irange(2);
2000 
2001 <span class="comment">% define some axes settings</span>
2002 log_t_ticks = logspace(-5,2,8);
2003 t_recov_lims = [min(T1T2map.t_recov)/2 max(T1T2map.t_recov)*2];
2004 p_alpha = 0.8;
2005 
2006 <span class="keyword">if</span> data.prop.useLogGates
2007     t2 = T1T2map.t2_gate;
2008 <span class="keyword">else</span>
2009     t2 = T1T2map.t2;
2010 <span class="keyword">end</span>
2011 
2012 z_max = max(inv2D.f_2Dmap(:));
2013 <span class="comment">% tab 2 - 2D inversion model</span>
2014 [X,Y] = meshgrid(inv2D.T2vec,inv2D.T1vec);
2015 <span class="comment">% imagescnan(X,Y,inv2D.f_2Dmap,'Parent',gui.axes2);</span>
2016 sh = surf(X,Y,inv2D.f_2Dmap,<span class="string">'Parent'</span>,gui.axes2);
2017 sh.FaceColor = <span class="string">'flat'</span>;
2018 sh.EdgeColor = <span class="string">'none'</span>;
2019 plot3(inv2D.T2tlgm,inv2D.T1tlgm,z_max+1,<span class="string">'o'</span>,<span class="string">'Color'</span>,col.FIT,<span class="string">'Parent'</span>,gui.axes2);
2020 plot3(inv2D.T2tmax,inv2D.T1tmax,z_max+1,<span class="string">'+'</span>,<span class="string">'Color'</span>,col.FIT,<span class="string">'Parent'</span>,gui.axes2);
2021 plot3([1e-5 100],[1e-5 100],[z_max z_max],<span class="keyword">...</span>
2022     <span class="string">'--'</span>,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,gui.axes2);
2023 view(gui.axes2,[0 90]);
2024 set(gui.axes2,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks,<span class="keyword">...</span>
2025     <span class="string">'XLim'</span>,[min(inv2D.T2vec) max(inv2D.T2vec)]);
2026 set(gui.axes2,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks,<span class="keyword">...</span>
2027     <span class="string">'YLim'</span>,[min(inv2D.T1vec) max(inv2D.T1vec)],<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
2028 set(get(gui.axes2,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'relaxation time T2 [s]'</span>);
2029 set(get(gui.axes2,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'relaxation time T1 [s]'</span>);
2030 set(gui.axes2,<span class="string">'Layer'</span>,<span class="string">'top'</span>,<span class="string">'XGrid'</span>,<span class="string">'off'</span>,<span class="string">'YGrid'</span>,<span class="string">'off'</span>);
2031 <span class="comment">% colorbar</span>
2032 <span class="keyword">switch</span> get(gui.popup_handles.cbarpos,<span class="string">'Value'</span>)
2033     <span class="keyword">case</span> 1
2034         colorbar(gui.axes2,<span class="string">'Location'</span>,<span class="string">'East'</span>,<span class="string">'Color'</span>,<span class="string">'w'</span>);
2035     <span class="keyword">case</span> 2
2036         colorbar(gui.axes2,<span class="string">'Location'</span>,<span class="string">'EastOutSide'</span>,<span class="string">'Color'</span>,<span class="string">'k'</span>);
2037     <span class="keyword">otherwise</span>
2038         <span class="comment">% none</span>
2039 <span class="keyword">end</span>
2040 
2041 <span class="comment">% sum along each dimension to get both RTDs</span>
2042 mapcol = parula;
2043 Tmap = inv2D.f_2Dmap;
2044 Tmap(~mask1) = 0;
2045 Tmap(~mask2) = 0;
2046 T1rtd = sum(Tmap,2);
2047 T2rtd = sum(Tmap,1);
2048 <span class="comment">% find common maximum for y-axis setting</span>
2049 ymax = max([max(T1rtd) max(T2rtd)])*1.1;
2050 <span class="comment">% T1 RTD</span>
2051 plot(T1rtd,inv2D.T1vec,<span class="string">'Color'</span>,col.FIT,<span class="string">'Parent'</span>,gui.axes24);
2052 amp = <a href="#_sub22" class="code" title="subfunction amp = findApproxTlgmAmplitude(t,f,TLGM)">findApproxTlgmAmplitude</a>(inv2D.T1vec,T1rtd,inv2D.T1tlgm);
2053 plot([0 amp],[inv2D.T1tlgm inv2D.T1tlgm],<span class="string">'Color'</span>,col.FIT,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="keyword">...</span>
2054     <span class="string">'LineWidth'</span>,1,<span class="string">'DisplayName'</span>,<span class="string">'Tlgm'</span>,<span class="string">'Tag'</span>,<span class="string">'TLGM'</span>,<span class="string">'Parent'</span>,gui.axes24);
2055 plot(amp,inv2D.T1tlgm,<span class="string">'o'</span>,<span class="string">'Color'</span>,col.FIT,<span class="string">'LineWidth'</span>,2,<span class="string">'DisplayName'</span>,<span class="string">'Tlgm'</span>,<span class="keyword">...</span>
2056     <span class="string">'Tag'</span>,<span class="string">'TLGM'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'on'</span>,<span class="string">'Parent'</span>,gui.axes24);
2057 set(gui.axes24,<span class="string">'XScale'</span>,<span class="string">'lin'</span>,<span class="string">'XLim'</span>,[0 ymax]);
2058 set(gui.axes24,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YTickLabel'</span>,<span class="string">''</span>);
2059 <span class="keyword">if</span> T1_irange(1)&gt;inv2D.T1vec(1)
2060     xlims = get(gui.axes24,<span class="string">'XLim'</span>);
2061     <span class="comment">% draw a transparent patch</span>
2062     v = [xlims(1) inv2D.T1vec(1); xlims(2) inv2D.T1vec(1);
2063         xlims(2) T1_irange(1); xlims(1) T1_irange(1)];
2064     f = [1 2 3 4 1];
2065     patch(<span class="string">'Vertices'</span>,v,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,<span class="string">'w'</span>,<span class="string">'FaceAlpha'</span>,p_alpha,<span class="keyword">...</span>
2066         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes24);
2067     v2 = [inv2D.T2vec(1) inv2D.T1vec(1) z_max+1; inv2D.T2vec(end) inv2D.T1vec(1) z_max+1;
2068         inv2D.T2vec(end) T1_irange(1) z_max+1; inv2D.T2vec(1) T1_irange(1) z_max+1];
2069     patch(<span class="string">'Vertices'</span>,v2,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,mapcol(1,:),<span class="string">'FaceAlpha'</span>,1,<span class="keyword">...</span>
2070         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes2);
2071 <span class="keyword">end</span>
2072 <span class="keyword">if</span> T1_irange(2)&lt;inv2D.T1vec(end)
2073     xlims = get(gui.axes24,<span class="string">'XLim'</span>);
2074     <span class="comment">% draw a transparent patch</span>
2075     v = [xlims(1) inv2D.T1vec(end); xlims(2) inv2D.T1vec(end);
2076         xlims(2) T1_irange(2); xlims(1) T1_irange(2)];
2077     f = [1 2 3 4 1];
2078     patch(<span class="string">'Vertices'</span>,v,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,<span class="string">'w'</span>,<span class="string">'FaceAlpha'</span>,p_alpha,<span class="keyword">...</span>
2079         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes24);
2080     v2 = [inv2D.T2vec(1) inv2D.T1vec(end) z_max+1; inv2D.T2vec(end) inv2D.T1vec(end) z_max+1;
2081         inv2D.T2vec(end) T1_irange(2) z_max+1; inv2D.T2vec(1) T1_irange(2) z_max+1];
2082     patch(<span class="string">'Vertices'</span>,v2,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,mapcol(1,:),<span class="string">'FaceAlpha'</span>,1,<span class="keyword">...</span>
2083         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes2);
2084 <span class="keyword">end</span>
2085 
2086 <span class="comment">% T2 RTD</span>
2087 plot(inv2D.T2vec,T2rtd,<span class="string">'Color'</span>,col.FIT,<span class="string">'DisplayName'</span>,<span class="string">'RTD'</span>,<span class="string">'Parent'</span>,gui.axes21);
2088 amp = <a href="#_sub22" class="code" title="subfunction amp = findApproxTlgmAmplitude(t,f,TLGM)">findApproxTlgmAmplitude</a>(inv2D.T2vec,T2rtd,inv2D.T2tlgm);
2089 plot([inv2D.T2tlgm inv2D.T2tlgm],[0 amp],<span class="string">'Color'</span>,col.FIT,<span class="string">'LineStyle'</span>,<span class="string">'--'</span>,<span class="keyword">...</span>
2090     <span class="string">'LineWidth'</span>,1,<span class="string">'DisplayName'</span>,<span class="string">'Tlgm'</span>,<span class="string">'Tag'</span>,<span class="string">'TLGM'</span>,<span class="string">'Parent'</span>,gui.axes21);
2091 plot(inv2D.T2tlgm,amp,<span class="string">'o'</span>,<span class="string">'Color'</span>,col.FIT,<span class="string">'LineWidth'</span>,2,<span class="string">'DisplayName'</span>,<span class="string">'Tlgm'</span>,<span class="keyword">...</span>
2092     <span class="string">'Tag'</span>,<span class="string">'TLGM'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'on'</span>,<span class="string">'Parent'</span>,gui.axes21);
2093 set(gui.axes21,<span class="string">'YScale'</span>,<span class="string">'lin'</span>,<span class="string">'YLim'</span>,[0 ymax]);
2094 set(gui.axes21,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTickLabel'</span>,<span class="string">''</span>);
2095 <span class="keyword">if</span> T2_irange(1)&gt;inv2D.T2vec(1)
2096     ylims = get(gui.axes21,<span class="string">'YLim'</span>);
2097     <span class="comment">% draw a transparent patch</span>
2098     v = [inv2D.T2vec(1) ylims(1);inv2D.T2vec(1) ylims(2);
2099         T2_irange(1) ylims(2);T2_irange(1) ylims(1)];
2100     f = [1 2 3 4 1];
2101     patch(<span class="string">'Vertices'</span>,v,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,<span class="string">'w'</span>,<span class="string">'FaceAlpha'</span>,p_alpha,<span class="keyword">...</span>
2102         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes21);
2103     v2 = [inv2D.T2vec(1) inv2D.T1vec(1) z_max+1; inv2D.T2vec(1) inv2D.T1vec(end) z_max+1;
2104         T2_irange(1) inv2D.T1vec(end) z_max+1; T2_irange(1) inv2D.T1vec(1) z_max+1];
2105     patch(<span class="string">'Vertices'</span>,v2,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,mapcol(1,:),<span class="string">'FaceAlpha'</span>,1,<span class="keyword">...</span>
2106         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes2);
2107 <span class="keyword">end</span>
2108 <span class="keyword">if</span> T2_irange(2)&lt;inv2D.T2vec(end)
2109     ylims = get(gui.axes21,<span class="string">'YLim'</span>);
2110     <span class="comment">% draw a transparent patch</span>
2111     v = [inv2D.T2vec(end) ylims(1);inv2D.T2vec(end) ylims(2);
2112         T2_irange(2) ylims(2);T2_irange(2) ylims(1)];
2113     f = [1 2 3 4 1];
2114     patch(<span class="string">'Vertices'</span>,v,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,<span class="string">'w'</span>,<span class="string">'FaceAlpha'</span>,p_alpha,<span class="keyword">...</span>
2115         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes21);
2116     v2 = [inv2D.T2vec(end) inv2D.T1vec(1) z_max+1; inv2D.T2vec(end) inv2D.T1vec(end) z_max+1;
2117         T2_irange(2) inv2D.T1vec(end) z_max+1; T2_irange(2) inv2D.T1vec(1) z_max+1];
2118     patch(<span class="string">'Vertices'</span>,v2,<span class="string">'Faces'</span>,f,<span class="string">'FaceColor'</span>,mapcol(1,:),<span class="string">'FaceAlpha'</span>,1,<span class="keyword">...</span>
2119         <span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>,<span class="string">'Tag'</span>,<span class="string">'infolines'</span>,<span class="string">'Parent'</span>, gui.axes2);
2120 <span class="keyword">end</span>
2121 
2122 <span class="comment">% tab 1 - model response</span>
2123 data_inv = inv2D.data;
2124 E_fit_surf = zeros(numel(data_inv),numel(inv2D.data(1).t));
2125 Residual_surf = E_fit_surf;
2126 <span class="keyword">for</span> nn = 1:numel(data_inv)
2127     E_fit_surf(nn,:) = data_inv(nn).s_fit;
2128     Residual_surf(nn,:) = data_inv(nn).residual;
2129 <span class="keyword">end</span>
2130 [tx,ty] = meshgrid(t2,T1T2map.t_recov);
2131 <span class="comment">% data</span>
2132 imagescnan(tx,ty,E_fit_surf,<span class="string">'Parent'</span>,gui.axes13);
2133 view(gui.axes13,[0 90]);
2134 set(gui.axes13,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
2135 set(gui.axes13,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
2136 set(get(gui.axes13,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
2137 set(get(gui.axes13,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2138 set(get(gui.axes13,<span class="string">'Title'</span>),<span class="string">'String'</span>,<span class="string">'data pred'</span>,<span class="string">'Color'</span>,gui.myui.colors.axisFG);
2139 set(gui.axes13,<span class="string">'CLim'</span>,get(gui.axes11,<span class="string">'CLim'</span>));
2140 set(gui.axes13,<span class="string">'Layer'</span>,<span class="string">'top'</span>,<span class="string">'XGrid'</span>,<span class="string">'off'</span>,<span class="string">'YGrid'</span>,<span class="string">'off'</span>);
2141 cb = colorbar(gui.axes13);
2142 set(cb,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
2143 <span class="comment">% residual</span>
2144 <span class="keyword">if</span> sum(T1T2map.ecube) == 0
2145     <span class="comment">% data without noise (probably from modelling)</span>
2146     resW = Residual_surf;
2147 <span class="keyword">else</span>
2148     resW = Residual_surf./T1T2map.ecube;
2149 <span class="keyword">end</span>
2150 chi2 = sqrt(sum(sum(resW.^2)))/sqrt(numel(resW));
2151 imagescnan(tx,ty,resW,<span class="string">'Parent'</span>,gui.axes14);
2152 view(gui.axes14,[0 90]);
2153 set(gui.axes14,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
2154 set(gui.axes14,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
2155 set(get(gui.axes14,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
2156 set(get(gui.axes14,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2157 set(get(gui.axes14,<span class="string">'Title'</span>),<span class="string">'String'</span>,{<span class="string">'noise weighted residual'</span>,[<span class="string">'(RMS='</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.error_global.rms),<span class="keyword">...</span>
2158     <span class="string">' | X^2='</span>,sprintf(<span class="string">'%3.2f'</span>,chi2),<span class="string">')'</span>]},<span class="string">'Color'</span>,gui.myui.colors.axisFG);
2159 <span class="keyword">if</span> sum(T1T2map.ecube) == 0
2160      set(gui.axes14,<span class="string">'CLim'</span>,[mean(resW(:))-3*std(resW(:)) mean(resW(:))+3*std(resW(:))]);
2161 <span class="keyword">else</span>
2162     set(gui.axes14,<span class="string">'CLim'</span>,get(gui.axes12,<span class="string">'CLim'</span>));
2163 <span class="keyword">end</span>
2164 set(gui.axes14,<span class="string">'Layer'</span>,<span class="string">'top'</span>,<span class="string">'XGrid'</span>,<span class="string">'off'</span>,<span class="string">'YGrid'</span>,<span class="string">'off'</span>);
2165 colormap(gui.axes14,gui.myui.cmap_rwb);
2166 cb = colorbar(gui.axes14);
2167 set(cb,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
2168 
2169 <span class="comment">% prepare the data for the combined T1 curve</span>
2170 E_inv = zeros(size(T1T2map.t_recov));
2171 <span class="keyword">for</span> nn = 1:numel(data_inv)
2172     E_inv(nn) = data_inv(nn).s_fit(1);
2173     <span class="comment">% E_inv(nn,2) = std(T1T2map.data(nn).s);</span>
2174     <span class="comment">% plot individual T2 signals and fits</span>
2175     plot3(inv2D.data(nn).t,inv2D.data(nn).T1*ones(size(inv2D.data(nn).s)),<span class="keyword">...</span>
2176         inv2D.data(nn).s,<span class="string">'Color'</span>,col.RE,<span class="string">'DisplayName'</span>,<span class="string">'T2 signals'</span>,<span class="keyword">...</span>
2177         <span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,gui.axes32);
2178     plot3(data_inv(nn).t,data_inv(nn).T1*ones(size(data_inv(nn).s_fit)),data_inv(nn).s_fit,<span class="keyword">...</span>
2179         <span class="string">'Color'</span>,col.FIT,<span class="string">'DisplayName'</span>,<span class="string">'fits'</span>,<span class="string">'Parent'</span>,gui.axes32);
2180 <span class="keyword">end</span>
2181 view(gui.axes32,[30 20]);
2182 set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks);
2183 set(gui.axes32,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>,<span class="string">'YTick'</span>,log_t_ticks,<span class="string">'YLim'</span>,t_recov_lims);
2184 set(get(gui.axes32,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
2185 set(get(gui.axes32,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2186 set(get(gui.axes32,<span class="string">'ZLabel'</span>),<span class="string">'String'</span>,<span class="string">'amplitude [a.u.]'</span>);
2187 
2188 <span class="comment">% tab 3 - combined T1 curve and fit</span>
2189 plot(T1T2map.t_recov,T1T2map.E_raw(:,1),<span class="string">'o-'</span>,<span class="string">'Color'</span>,col.RE,<span class="keyword">...</span>
2190     <span class="string">'LineWidth'</span>,1,<span class="string">'DisplayName'</span>,<span class="string">'T1 curve'</span>,<span class="string">'Parent'</span>,gui.axes31);
2191 plot(T1T2map.t_recov,E_inv,<span class="string">'Color'</span>,col.FIT,<span class="string">'DisplayName'</span>,<span class="string">'fit'</span>,<span class="string">'Parent'</span>,gui.axes31);
2192 set(gui.axes31,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XLim'</span>,t_recov_lims);
2193 set(gui.axes31,<span class="string">'YScale'</span>,<span class="string">'lin'</span>);
2194 set(get(gui.axes31,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2195 set(get(gui.axes31,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'mean(E(1:x)) [a.u.]'</span>);
2196 lgh = legend(gui.axes31,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
2197 set(lgh,<span class="string">'EdgeColor'</span>,gui.myui.colors.axisFG,<span class="string">'TextColor'</span>,gui.myui.colors.axisFG);
2198 
2199 <span class="comment">% hold off all axes</span>
2200 hold(gui.axes13,<span class="string">'off'</span>);
2201 hold(gui.axes14,<span class="string">'off'</span>);
2202 hold(gui.axes2,<span class="string">'off'</span>);
2203 hold(gui.axes21,<span class="string">'off'</span>);
2204 hold(gui.axes24,<span class="string">'off'</span>);
2205 hold(gui.axes31,<span class="string">'off'</span>);
2206 hold(gui.axes32,<span class="string">'off'</span>);
2207 
2208 <span class="comment">% call function to adapt the axes scaling</span>
2209 <a href="#_sub16" class="code" title="subfunction tv_setAxesScaling(figh)">tv_setAxesScaling</a>(figh);
2210 <span class="keyword">end</span>
2211 
2212 <span class="comment">%%  subfunction to plot the raw data</span>
2213 <a name="_sub19" href="#_subfunctions" class="code">function tv_plotRawData(figh)</a>
2214 gui = getappdata(figh,<span class="string">'gui'</span>);
2215 data = getappdata(figh,<span class="string">'data'</span>);
2216 T1T2map = data.results.T1T2map;
2217 col = gui.myui.colors;
2218 hold(gui.axes31,<span class="string">'on'</span>);
2219 hold(gui.axes32,<span class="string">'on'</span>);
2220 
2221 <span class="comment">% ticks and limits</span>
2222 log_t_ticks = logspace(-5,2,8);
2223 t_recov_lims = [min(T1T2map.t_recov)/2 max(T1T2map.t_recov)*2];
2224 
2225 <span class="keyword">if</span> data.prop.useLogGates
2226     t2 = T1T2map.t2_gate;
2227 <span class="keyword">else</span>
2228     t2 = T1T2map.t2;
2229 <span class="keyword">end</span>
2230 
2231 <span class="comment">% plot the raw signals in the 3D axis</span>
2232 <span class="keyword">for</span> i = 1:numel(T1T2map.t_recov)
2233     <span class="comment">% plot the individual T2 signals into the 3D data cube</span>
2234     plot3(t2,T1T2map.t_recov(i)*ones(size(t2)),real(T1T2map.dcube(i,:)),<span class="keyword">...</span>
2235         <span class="string">'Color'</span>,col.RE,<span class="string">'DisplayName'</span>,<span class="string">'T2 signals'</span>,<span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,gui.axes32);
2236 <span class="keyword">end</span>
2237 
2238 <span class="comment">% tab 1 - surface plots</span>
2239 [tx,ty] = meshgrid(t2,T1T2map.t_recov);
2240 <span class="comment">% signal</span>
2241 imagescnan(tx,ty,real(T1T2map.dcube),<span class="string">'Parent'</span>,gui.axes11);
2242 view(gui.axes11,[0 90]);
2243 set(gui.axes11,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
2244 set(gui.axes11,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
2245 set(get(gui.axes11,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
2246 set(get(gui.axes11,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2247 set(get(gui.axes11,<span class="string">'Title'</span>),<span class="string">'String'</span>,<span class="string">'real(data obs)'</span>,<span class="string">'Color'</span>,gui.myui.colors.axisFG);
2248 set(gui.axes11,<span class="string">'Layer'</span>,<span class="string">'top'</span>,<span class="string">'XGrid'</span>,<span class="string">'off'</span>,<span class="string">'YGrid'</span>,<span class="string">'off'</span>);
2249 cb = colorbar(gui.axes11);
2250 set(cb,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
2251 
2252 <span class="comment">% noise</span>
2253 ErrWimag = imag(T1T2map.dcube)./T1T2map.ecube;
2254 chi2 = sqrt(sum(sum(ErrWimag.^2)))/sqrt(numel(ErrWimag));
2255 rms = mean(T1T2map.noise);
2256 imagescnan(tx,ty,ErrWimag,<span class="string">'Parent'</span>,gui.axes12);
2257 maxv = max(abs(ErrWimag(:)));
2258 view(gui.axes12,[0 90]);
2259 <span class="comment">% limits &amp; ticks</span>
2260 set(gui.axes12,<span class="string">'XScale'</span>,<span class="string">'log'</span>);
2261 set(gui.axes12,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
2262 set(get(gui.axes12,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
2263 set(get(gui.axes12,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2264 set(get(gui.axes12,<span class="string">'Title'</span>),<span class="string">'String'</span>,{<span class="string">'noise weighted imag(data obs)'</span>,[<span class="string">'(STD='</span>,sprintf(<span class="string">'%4.3f'</span>,rms),<span class="string">' | '</span>,<span class="keyword">...</span>
2265     <span class="string">'X^2='</span>,sprintf(<span class="string">'%3.2f'</span>,chi2),<span class="string">')'</span>]},<span class="string">'Color'</span>,gui.myui.colors.axisFG);
2266 set(gui.axes12,<span class="string">'Layer'</span>,<span class="string">'top'</span>,<span class="string">'XGrid'</span>,<span class="string">'off'</span>,<span class="string">'YGrid'</span>,<span class="string">'off'</span>);
2267 colormap(gui.axes12,gui.myui.cmap_rwb);
2268 <span class="keyword">if</span> isnan(maxv)
2269     maxv = 1;
2270 <span class="keyword">end</span>
2271 set(gui.axes12,<span class="string">'CLim'</span>,[-maxv maxv]);
2272 cb = colorbar(gui.axes12);
2273 set(cb,<span class="string">'Location'</span>,<span class="string">'EastOutside'</span>);
2274 
2275 <span class="comment">% tab 3 - combined T1 curve</span>
2276 plot(T1T2map.t_recov,T1T2map.E_raw(:,1),<span class="string">'o-'</span>,<span class="string">'Color'</span>,col.RE,<span class="keyword">...</span>
2277     <span class="string">'LineWidth'</span>,1,<span class="string">'DisplayName'</span>,<span class="string">'T1 curve'</span>,<span class="string">'Parent'</span>,gui.axes31);
2278 set(gui.axes31,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XLim'</span>,t_recov_lims);
2279 set(gui.axes31,<span class="string">'YScale'</span>,<span class="string">'lin'</span>);
2280 set(get(gui.axes31,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2281 set(get(gui.axes31,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'mean(E(1:x)) [a.u.]'</span>);
2282 lgh = legend(gui.axes31,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
2283 set(lgh,<span class="string">'EdgeColor'</span>,gui.myui.colors.axisFG,<span class="string">'TextColor'</span>,gui.myui.colors.axisFG);
2284 
2285 <span class="comment">% tab 3  - 2D data cube</span>
2286 view(gui.axes32,[30 20]);
2287 set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks);
2288 set(gui.axes32,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>,<span class="string">'YTick'</span>,log_t_ticks,<span class="string">'YLim'</span>,t_recov_lims);
2289 set(get(gui.axes32,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
2290 set(get(gui.axes32,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
2291 set(get(gui.axes32,<span class="string">'ZLabel'</span>),<span class="string">'String'</span>,<span class="string">'amplitude [a.u.]'</span>);
2292 hold(gui.axes32,<span class="string">'off'</span>);
2293 
2294 <span class="comment">% call function to adapt the axes scaling</span>
2295 <a href="#_sub16" class="code" title="subfunction tv_setAxesScaling(figh)">tv_setAxesScaling</a>(figh);
2296 <span class="keyword">end</span>
2297 
2298 <span class="comment">%% subfunction to check the LSE</span>
2299 <a name="_sub20" href="#_subfunctions" class="code">function tv_checkLSEparams(data)</a>
2300 
2301 <span class="keyword">if</span> ~contains(data.inv.regtype,<span class="string">'manual'</span>)
2302     <span class="comment">% sN = number of T2 signals</span>
2303     <span class="comment">% gN = number of gates/echoes</span>
2304     [sN,gN] = size(data.results.T1T2map.dcube);
2305     <span class="comment">% size of modelspace</span>
2306     T1N = data.inv.T1N;
2307     T2N = data.inv.T2N;
2308     <span class="comment">% check</span>
2309     <span class="keyword">if</span> sN*gN &lt; T1N*T2N
2310         helpdlg({<span class="string">'System is underdetermined:'</span>,<span class="keyword">...</span>
2311             <span class="string">'Increase number of gates or decrease model space.'</span>},<span class="keyword">...</span>
2312             <span class="string">'SVD warning'</span>);
2313     <span class="keyword">end</span>
2314 <span class="keyword">end</span>
2315 
2316 <span class="keyword">end</span>
2317 
2318 <span class="comment">%% subfunction to update all plots</span>
2319 <a name="_sub21" href="#_subfunctions" class="code">function tv_getTLGM(figh)</a>
2320 <span class="comment">% local GUI data</span>
2321 gui = getappdata(figh,<span class="string">'gui'</span>);
2322 data = getappdata(figh,<span class="string">'data'</span>);
2323 <span class="comment">% get 2D inversion data</span>
2324 inv2D = data.results.inv2D;
2325 
2326 <span class="comment">% get T1/T2 range from GUI</span>
2327 T1range(1) = data.info.T1min;
2328 T1range(2) = data.info.T1max;
2329 T2range(1) = data.info.T2min;
2330 T2range(2) = data.info.T2max;
2331 
2332 <span class="comment">% get TLGM and TMAX accounting for T1 and T2 ranges</span>
2333 [TLGM,TMAX] = <a href="../../../../nucleus/functions/inversion/getTLogMean2D.html" class="code" title="function [TLGM,TMAX] = getTLogMean2D(T1,T2,f,varargin)">getTLogMean2D</a>(inv2D.T1vec,inv2D.T2vec,inv2D.f_2Dmap,T1range,T2range);
2334 
2335 <span class="comment">% update results in data struct</span>
2336 inv2D.T1tlgm = TLGM(1);
2337 inv2D.T2tlgm = TLGM(2);
2338 inv2D.T1tmax = TMAX(1);
2339 inv2D.T2tmax = TMAX(2);
2340 
2341 <span class="comment">% update GUI data struct</span>
2342 data.info.E0 = inv2D.E0;
2343 data.info.T1tlgm = inv2D.T1tlgm;
2344 data.info.T2tlgm = inv2D.T2tlgm;
2345 data.info.T1tmax = inv2D.T1tmax;
2346 data.info.T2tmax = inv2D.T2tmax;
2347 
2348 <span class="comment">% update GUI elements</span>
2349 set(gui.edit_handles.E0,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.E0));
2350 set(gui.edit_handles.T1tlgm,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.T1tlgm));
2351 set(gui.edit_handles.T2tlgm,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.T2tlgm));
2352 set(gui.edit_handles.Tlgm_ratio,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.T1tlgm/inv2D.T2tlgm));
2353 set(gui.edit_handles.T1tmax,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.T1tmax));
2354 set(gui.edit_handles.T2tmax,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.T2tmax));
2355 set(gui.edit_handles.Tmax_ratio,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,inv2D.T1tmax/inv2D.T2tmax));
2356 
2357 <span class="comment">% update data</span>
2358 data.results.inv2D = inv2D;
2359 setappdata(figh,<span class="string">'data'</span>,data);
2360 <span class="keyword">end</span>
2361 
2362 <span class="comment">%% subfunction to find RTD amplitude</span>
2363 <a name="_sub22" href="#_subfunctions" class="code">function amp = findApproxTlgmAmplitude(t,f,TLGM)</a>
2364 
2365 <span class="keyword">if</span> isnan(TLGM)
2366     amp = NaN;
2367 <span class="keyword">else</span>
2368     index = find(abs(t-TLGM)==min(abs(t-TLGM)));
2369     <span class="keyword">if</span> index == 1 || index == numel(t)
2370         amp = f(index);
2371     <span class="keyword">else</span>
2372         amp = interp1(t(index-1:index+1),f(index-1:index+1),TLGM);
2373     <span class="keyword">end</span>
2374 <span class="keyword">end</span>
2375 
2376 <span class="keyword">end</span>
2377 
2378 <span class="comment">%%  subfunction to prepare the raw data</span>
2379 <a name="_sub23" href="#_subfunctions" class="code">function tv_prepareRawData(figh)</a>
2380 data = getappdata(figh,<span class="string">'data'</span>);
2381 T1T2map = data.results.T1T2map;
2382 
2383 <span class="comment">% select first and last T1 recov times</span>
2384 firstT1 = data.prop.firstT1;
2385 lastT1 = data.prop.lastT1;
2386 T1T2map.t_recov = T1T2map.import{end}.time(firstT1:lastT1);
2387 id_recov = firstT1:lastT1;
2388 
2389 <span class="comment">% select first and last T2 echo</span>
2390 firstN = data.prop.firstT2;
2391 lastN = data.prop.lastT2;
2392 T1T2map.t2 = T1T2map.import{1}.time(firstN:lastN);
2393 
2394 <span class="comment">% prepare the raw data</span>
2395 <span class="keyword">if</span> ~data.prop.useLogGates
2396     T1T2map.dcube = zeros(numel(T1T2map.t_recov),lastN-firstN+1);
2397     T1T2map.ecube = zeros(numel(T1T2map.t_recov),lastN-firstN+1);
2398 <span class="keyword">end</span>
2399 
2400 <span class="keyword">for</span> i = 1:numel(T1T2map.t_recov)
2401     id = id_recov(i);
2402     <span class="keyword">if</span> data.prop.useLogGates
2403         t_tmp = T1T2map.t2;
2404         s_tmp = real(T1T2map.import{id}.signal(firstN:lastN));
2405         si_tmp = imag(T1T2map.import{id}.signal(firstN:lastN));
2406         range = floor(numel(s_tmp)/2):numel(s_tmp);
2407         noise_tmp = std(si_tmp(range));
2408         tmp = <a href="../../../../nucleus/functions/inversion/applyGatesToSignal.html" class="code" title="function data = applyGatesToSignal(time,signal,varargin)">applyGatesToSignal</a>(t_tmp,s_tmp,<span class="string">'type'</span>,<span class="string">'logv2'</span>,<span class="string">'Ng'</span>,data.prop.Ngates);
2409         tmpi = <a href="../../../../nucleus/functions/inversion/applyGatesToSignal.html" class="code" title="function data = applyGatesToSignal(time,signal,varargin)">applyGatesToSignal</a>(t_tmp,si_tmp,<span class="string">'type'</span>,<span class="string">'logv2'</span>,<span class="string">'Ng'</span>,data.prop.Ngates);
2410         <span class="keyword">if</span> i == 1
2411             Ngates_tmp = size(tmp,1);
2412             T1T2map.dcube = zeros(numel(T1T2map.t_recov),Ngates_tmp);
2413             T1T2map.ecube = zeros(numel(T1T2map.t_recov),Ngates_tmp);
2414             T1T2map.t2_gate = tmp(:,1);
2415             T1T2map.t2_gateN = tmp(:,3);
2416         <span class="keyword">end</span>
2417         s_gate = complex(tmp(:,2),tmpi(:,2));
2418         N = tmp(:,3);
2419         e = noise_tmp ./ sqrt(N);
2420 
2421         T1T2map.dcube(i,:) = s_gate';
2422         T1T2map.ecube(i,:) = e';
2423         T1T2map.noise(i,1) = noise_tmp;
2424 
2425     <span class="keyword">else</span>
2426         T1T2map.dcube(i,:) = complex(real(T1T2map.import{id}.signal(firstN:lastN)),<span class="keyword">...</span>
2427             imag(T1T2map.import{id}.signal(firstN:lastN)));
2428         T1T2map.ecube(i,:) = std(imag(T1T2map.import{id}.signal(firstN:lastN))) .*<span class="keyword">...</span>
2429             ones(size(imag(T1T2map.import{id}.signal(firstN:lastN))));
2430         T1T2map.noise(i,1) = std(imag(T1T2map.dcube(i,:)));
2431     <span class="keyword">end</span>
2432 <span class="keyword">end</span>
2433 <span class="comment">%data.prop.Ngates = sNgates_tmp;</span>
2434 
2435 <span class="comment">% get merged T1 curve</span>
2436 T1T2map.E_raw = T1T2map.import{end}.signal(firstT1:lastT1);
2437 
2438 <span class="comment">% update the data</span>
2439 data.results.T1T2map = T1T2map;
2440 <span class="comment">% update GUI data</span>
2441 setappdata(figh,<span class="string">'data'</span>,data);
2442 <span class="keyword">end</span>
2443 
2444 <span class="comment">%% estimate IR type</span>
2445 <a name="_sub24" href="#_subfunctions" class="code">function tv_estimateIRtype(figh)</a>
2446 data = getappdata(figh,<span class="string">'data'</span>);
2447 gui = getappdata(figh,<span class="string">'gui'</span>);
2448 T1T2map = data.results.T1T2map;
2449 
2450 <span class="comment">% the T1 curve</span>
2451 E = T1T2map.E_raw;
2452 
2453 <span class="keyword">if</span> E(1) &gt; 0
2454     <span class="comment">% possibly SR</span>
2455     data.inv.IRtype = 1;
2456     data.inv.T1IRfac = 1;
2457     set(gui.popup_handles.T1type,<span class="string">'Value'</span>,1);
2458     set(gui.popup_handles.IRtype,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
2459 <span class="keyword">else</span>
2460     <span class="keyword">if</span> E(end) &lt; abs(E(1))*0.5
2461         <span class="comment">% possibly IR with kernel type 2 =&gt; -exp(t/T1)</span>
2462         data.inv.IRtype = 2;
2463         set(gui.popup_handles.T1type,<span class="string">'Value'</span>,2);
2464         set(gui.popup_handles.IRtype,<span class="string">'Value'</span>,2);
2465     <span class="keyword">else</span>
2466         <span class="comment">% possibly IR with kernel type 1 =&gt; 1-2exp(t/T1)</span>
2467         data.inv.IRtype = 1;
2468         data.inv.T1IRfac = 2;
2469         set(gui.popup_handles.T1type,<span class="string">'Value'</span>,2);
2470         set(gui.popup_handles.IRtype,<span class="string">'Value'</span>,1);
2471     <span class="keyword">end</span>
2472 <span class="keyword">end</span>
2473 
2474 <span class="comment">% update GUI data</span>
2475 setappdata(figh,<span class="string">'data'</span>,data);
2476 setappdata(figh,<span class="string">'gui'</span>,gui);
2477 <span class="keyword">end</span>
2478 
2479 <span class="comment">%% adjust the data tip on the 2D axes</span>
2480 <a name="_sub25" href="#_subfunctions" class="code">function txt = localDcmFcn(~,event,ax)</a>
2481 
2482 <span class="keyword">if</span> strcmp(get(ax,<span class="string">'Tag'</span>),<span class="string">'2D'</span>)
2483     <span class="comment">% find indices to closest x and y data values. This requires the</span>
2484     <span class="comment">% number of values in XData and YData to agree with CData size.</span>
2485     [~, xidx] = min(abs(event.Target.XData - event.Position(1)),[],2);
2486     [~, yidx] = min(abs(event.Target.YData - event.Position(2)),[],1);
2487     colorbarValue = event.Target.CData(yidx(1), xidx(1));
2488     <span class="comment">% colormapIdx = round((colorbarValue - ax.CLim(1))/(ax.CLim(2)-ax.CLim(1)) * (size(ax.Colormap,1)-1) +1);</span>
2489     txt = sprintf(<span class="string">'[T2,T1]: [%.2g, %.2g]\nValue: %.2g'</span>, <span class="keyword">...</span>
2490         event.Position(1:2), colorbarValue);
2491 <span class="keyword">end</span>
2492 
2493 <span class="keyword">end</span>
2494 
2495 <span class="comment">%% close function</span>
2496 <a name="_sub26" href="#_subfunctions" class="code">function tv_closeme(src,~)</a>
2497 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
2498 <span class="comment">% try to close the sub GUI in a clean manner</span>
2499 <span class="keyword">try</span>
2500     <span class="comment">% NOTE: maybe needed at some later point</span>
2501     <span class="comment">%     gui = getappdata(figh,'gui');</span>
2502     <span class="comment">%     data = getappdata(gui.figh_nucleus,'data');</span>
2503     <span class="comment">%     % update NUCLEUSinv</span>
2504     <span class="comment">%     setappdata(gui.figh_nucleus,'data',data);</span>
2505     delete(figh);
2506 <span class="keyword">catch</span>
2507     <span class="comment">% if this is not working: just close it</span>
2508     delete(figh);
2509 <span class="keyword">end</span>
2510 
2511 <span class="keyword">end</span>
2512 
2513 <span class="comment">%------------- END OF CODE --------------</span>
2514 
2515 <span class="comment">%% License:</span>
2516 <span class="comment">% MIT License</span>
2517 <span class="comment">%</span>
2518 <span class="comment">% Copyright (c) 2024 Thomas Hiller</span>
2519 <span class="comment">%</span>
2520 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
2521 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
2522 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
2523 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
2524 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
2525 <span class="comment">% furnished to do so, subject to the following conditions:</span>
2526 <span class="comment">%</span>
2527 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
2528 <span class="comment">% copies or substantial portions of the Software.</span>
2529 <span class="comment">%</span>
2530 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
2531 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
2532 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
2533 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
2534 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
2535 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
2536 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>