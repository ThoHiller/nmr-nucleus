<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Mod2DView</title>
  <meta name="keywords" content="Mod2DView">
  <meta name="description" content=" is an extra subGUI to calculate 2D forward T1-T2 data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- # nucleus --><!-- # functions --><!-- menu.html interface -->
<h1>Mod2DView
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong> is an extra subGUI to calculate 2D forward T1-T2 data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function Mod2DView(src,~) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">Mod2DView is an extra subGUI to calculate 2D forward T1-T2 data

 Syntax:
       Mod2DView

 Inputs:
       src - handle of the calling object

 Outputs:
       none

 Example:
       Mod2DView(src,~)

 Other m-files required:
       beautifyAxes
       clearAllAxes
       displayStatusText
       fitData2D_T1T2
       imagescnan

 Subfunctions:

 MAT-files required:
       none

 See also: NUCLEUSmod
 Author: see AUTHORS.md
 email: see AUTHORS.md
 License: MIT License (at end)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/callbacks/listboxes/onListboxData.html" class="code" title="function onListboxData(src,~)">onListboxData</a>	 handles the calls from the context menu of the data</li><li><a href="../../../nucleus/callbacks/menus/onMenuView.html" class="code" title="function onMenuView(src,~)">onMenuView</a>	 handles the view menu entries</li><li><a href="beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>	 can be used to globally change the general appearance of axes</li><li><a href="clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>	 clears an individual axis</li><li><a href="minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>	 handles the minimization/maximization of all box-panels for</li><li><a href="../../../nucleus/functions/inversion/createKernelMatrix2D.html" class="code" title="function [K,indices] = createKernelMatrix2D(dat,T1vec,T2vec,p)">createKernelMatrix2D</a>	 creates a Kernel matrix from signals time vectors "t"</li><li><a href="../../../nucleus/functions/inversion/getFitErrors.html" class="code" title="function out = getFitErrors(s,sfit,noise,varargin)">getFitErrors</a>	 calculates all relevant fitting errors for the NMR inversion</li><li><a href="../../../nucleus/functions/modeling/addNoiseToSignal.html" class="code" title="function [signalN,noise] = addNoiseToSignal(signal,mu,sigma)">addNoiseToSignal</a>	 adds noise with mean 'mu' and standard deviation 'sigma' to</li><li><a href="../../../nucleus/functions/modeling/getMultivariateGaussian.html" class="code" title="function pdf = getMultivariateGaussian(X,mu,sigma)">getMultivariateGaussian</a>	</li><li><a href="../../../nucleus/functions/modeling/getNMRTimeVector.html" class="code" title="function t = getNMRTimeVector(TE,TEunit,varargin)">getNMRTimeVector</a>	 Creates a NMR time vector depending on the given echo</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../nucleus/callbacks/menus/onMenuSubGUIs.html" class="code" title="function onMenuSubGUIs(src,~)">onMenuSubGUIs</a>	 handles the extra menu entries to open NUCLEUS sub GUIs</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function fv_onEditTable(src,~)</a></li><li><a href="#_sub2" class="code">function fv_onEditValue(src,~)</a></li><li><a href="#_sub3" class="code">function fv_onPopupT1Type(src,~)</a></li><li><a href="#_sub4" class="code">function fv_onPopupNoiseType(src,~)</a></li><li><a href="#_sub5" class="code">function fv_addNoise(figh)</a></li><li><a href="#_sub6" class="code">function fv_getModel(figh)</a></li><li><a href="#_sub7" class="code">function fv_getNMR(src,~)</a></li><li><a href="#_sub8" class="code">function fv_onPushSave(src,~)</a></li><li><a href="#_sub9" class="code">function fv_onPushView(src,~)</a></li><li><a href="#_sub10" class="code">function fv_onPushUpdate(src,~)</a></li><li><a href="#_sub11" class="code">function fv_plotSignals(figh)</a></li><li><a href="#_sub12" class="code">function fv_plotModel(figh)</a></li><li><a href="#_sub13" class="code">function fv_onRadioLogLin(src,~)</a></li><li><a href="#_sub14" class="code">function fv_setAxesScaling(figh)</a></li><li><a href="#_sub15" class="code">function fv_closeme(src,~)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function Mod2DView(src,~)</a>
0002 <span class="comment">%Mod2DView is an extra subGUI to calculate 2D forward T1-T2 data</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Syntax:</span>
0005 <span class="comment">%       Mod2DView</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%       src - handle of the calling object</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Outputs:</span>
0011 <span class="comment">%       none</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Example:</span>
0014 <span class="comment">%       Mod2DView(src,~)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% Other m-files required:</span>
0017 <span class="comment">%       beautifyAxes</span>
0018 <span class="comment">%       clearAllAxes</span>
0019 <span class="comment">%       displayStatusText</span>
0020 <span class="comment">%       fitData2D_T1T2</span>
0021 <span class="comment">%       imagescnan</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Subfunctions:</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% MAT-files required:</span>
0026 <span class="comment">%       none</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% See also: NUCLEUSmod</span>
0029 <span class="comment">% Author: see AUTHORS.md</span>
0030 <span class="comment">% email: see AUTHORS.md</span>
0031 <span class="comment">% License: MIT License (at end)</span>
0032 
0033 <span class="comment">%------------- BEGIN CODE --------------</span>
0034 
0035 <span class="comment">%% get GUI handle and data</span>
0036 figh_nucleus = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0037 nucleus.data = getappdata(figh_nucleus,<span class="string">'data'</span>);
0038 nucleus.gui = getappdata(figh_nucleus,<span class="string">'gui'</span>);
0039 myui = nucleus.gui.myui;
0040 colors = myui.colors;
0041 
0042 <span class="comment">%% get GUI data from NUCLEUS</span>
0043 data = nucleus.data.mod2D;
0044 
0045 <span class="comment">% check if the figure is already open</span>
0046 fig_2Dmod = findobj(<span class="string">'Tag'</span>,<span class="string">'2DMOD'</span>);
0047 <span class="comment">% if not, create it</span>
0048 <span class="keyword">if</span> isempty(fig_2Dmod)
0049     <span class="comment">% draw the figure on top of NUCLEUSinv</span>
0050     fig_2Dmod = figure(<span class="string">'Name'</span>,<span class="string">'NUCLEUSmod - 2D Modeling'</span>,<span class="keyword">...</span>
0051         <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>,<span class="string">'Resize'</span>,<span class="string">'on'</span>,<span class="string">'ToolBar'</span>,<span class="string">'none'</span>,<span class="keyword">...</span>
0052         <span class="string">'Tag'</span>,<span class="string">'2DMOD'</span>,<span class="string">'CloseRequestFcn'</span>,@<a href="#_sub15" class="code" title="subfunction fv_closeme(src,~)">fv_closeme</a>,<span class="keyword">...</span>
0053         <span class="string">'MenuBar'</span>,<span class="string">'none'</span>);
0054     pos0 = get(figh_nucleus,<span class="string">'Position'</span>);
0055     cent(1) = (pos0(1)+pos0(3)/2);
0056     cent(2) = (pos0(2)+pos0(4)/2);
0057     posf = [cent(1)-pos0(3)/2.5 pos0(2)+22 pos0(3)/1.25 pos0(4)-22];
0058     <span class="comment">% posf = pos0;</span>
0059     set(fig_2Dmod,<span class="string">'Position'</span>,posf);
0060 
0061     gui.menu.view = uimenu(fig_2Dmod,<span class="string">'Label'</span>,<span class="string">'View'</span>);
0062     gui.menu.view_toolbar = uimenu(gui.menu.view,<span class="string">'Label'</span>,<span class="string">'Figure Toolbar'</span>,<span class="keyword">...</span>
0063         <span class="string">'Callback'</span>,@<a href="../../../nucleus/callbacks/menus/onMenuView.html" class="code" title="function onMenuView(src,~)">onMenuView</a>);
0064 
0065     cpanel_w = 190;
0066 
0067     <span class="comment">% create the main layout</span>
0068     gui.main = uix.HBox(<span class="string">'Parent'</span>,fig_2Dmod,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0069         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,5,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0070     gui.left = uix.VBox(<span class="string">'Parent'</span>,gui.main,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0071         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,0); <span class="comment">% controls</span>
0072     gui.right = uix.VBox(<span class="string">'Parent'</span>,gui.main,<span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="keyword">...</span>
0073         <span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,0); <span class="comment">% plots</span>
0074 
0075     set(gui.main,<span class="string">'Widths'</span>,[400 -1 ]);
0076 
0077     <span class="comment">% waitbar indicating the loading of the GUI</span>
0078     steps = 4;
0079     hwb = waitbar(0,<span class="string">'loading ...'</span>,<span class="string">'Name'</span>,<span class="string">'2DMod GUI initialization'</span>,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
0080     set(hwb,<span class="string">'Units'</span>,<span class="string">'Pixel'</span>)
0081     posw = get(hwb,<span class="string">'Position'</span>);
0082     set(hwb,<span class="string">'Position'</span>,[posf(1)+posf(3)/2-posw(3)/2 posf(2)+posf(4)/2-posw(4)/2 posw(3:4)]);
0083     set(hwb,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0084 
0085     <span class="comment">% --- modelling panel ---</span>
0086     waitbar(1/steps,hwb,<span class="string">'loading GUI elements - 2D modelling'</span>);
0087     gui.panels.mod.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.left,<span class="keyword">...</span>
0088         <span class="string">'Title'</span>,<span class="string">'2D modelling settings'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0089         <span class="string">'TitleColor'</span>,colors.GEO,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0090     gui.panels.mod.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.mod.main,<span class="keyword">...</span>
0091         <span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0092 
0093     <span class="comment">% RTD T1</span>
0094     gui.panels.mod.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.mod.VBox,<span class="keyword">...</span>
0095         <span class="string">'Spacing'</span>,3);
0096     gui.text_handles.rtdT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0097         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0098         <span class="string">'String'</span>,<span class="string">'RTD T1 -  min [s] | max [s] | #'</span>);
0099     tstr = &quot;&quot;;
0100     gui.edit_handles.rtdT1min = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0101         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.mod.T1min),<span class="keyword">...</span>
0102         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1min'</span>,<span class="keyword">...</span>
0103         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0104         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0105     tstr = &quot;&quot;;
0106     gui.edit_handles.rtdT1max = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0107         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T1max),<span class="keyword">...</span>
0108         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1max'</span>,<span class="keyword">...</span>
0109         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0110         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0111     tstr = &quot;&quot;;
0112     gui.edit_handles.rtdT1N = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox1,<span class="keyword">...</span>
0113         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T1N),<span class="keyword">...</span>
0114         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT1N'</span>,<span class="keyword">...</span>
0115         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0116         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0117     set(gui.panels.mod.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0118 
0119     <span class="comment">% RTD T2</span>
0120     gui.panels.mod.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.mod.VBox,<span class="keyword">...</span>
0121         <span class="string">'Spacing'</span>,3);
0122     gui.text_handles.rtdT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0123         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0124         <span class="string">'String'</span>,<span class="string">'RTD T2 - min [s] | max [s] | #'</span>);
0125     tstr = &quot;&quot;;
0126     gui.edit_handles.rtdT2min = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0127         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.mod.T2min),<span class="keyword">...</span>
0128         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2min'</span>,<span class="keyword">...</span>
0129         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0130         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0131     tstr = &quot;&quot;;
0132     gui.edit_handles.rtdT2max = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0133         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T2max),<span class="keyword">...</span>
0134         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2max'</span>,<span class="keyword">...</span>
0135         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0136         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0137     tstr = &quot;&quot;;
0138     gui.edit_handles.rtdT2N = uicontrol(<span class="string">'Parent'</span>,gui.panels.mod.HBox2,<span class="keyword">...</span>
0139         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.mod.T2N),<span class="keyword">...</span>
0140         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'rtdT2N'</span>,<span class="keyword">...</span>
0141         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0142         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0143     set(gui.panels.mod.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0144 
0145     uix.Empty(<span class="string">'Parent'</span>,gui.panels.mod.VBox);
0146     <span class="comment">% table</span>
0147     gui.panels.mod.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.mod.VBox,<span class="keyword">...</span>
0148         <span class="string">'Spacing'</span>,3);
0149     m = data.mod.mu;
0150     s = data.mod.sigma;
0151     a = data.mod.amp;
0152     table = cell(1,1);
0153     <span class="keyword">for</span> i = 1:data.mod.Ndist
0154         table{i,1} = false;
0155         table{i,2} = m(i,1);
0156         table{i,3} = m(i,2);
0157         table{i,4} = s{i}(1,1);
0158         table{i,5} = s{i}(2,2);
0159         table{i,6} = s{i}(1,2);
0160         table{i,7} = s{i}(2,1);
0161         table{i,8} = a(i);
0162     <span class="keyword">end</span>
0163     table{1,1} = true;
0164     data.results.mod2D.table = table;
0165     gui.table_handles.mod = uitable(<span class="string">'Parent'</span>,gui.panels.mod.HBox3,<span class="keyword">...</span>
0166     <span class="string">'Data'</span>,table,<span class="keyword">...</span>
0167     <span class="string">'ColumnFormat'</span>,({<span class="string">'logical'</span> <span class="string">'short'</span> <span class="string">'short'</span> <span class="string">'bank'</span> <span class="string">'bank'</span> <span class="string">'bank'</span> <span class="string">'bank'</span> <span class="string">'bank'</span>}),<span class="keyword">...</span>
0168     <span class="string">'ColumnEditable'</span>,[true true true true true true true true],<span class="keyword">...</span>
0169     <span class="string">'ColumnWidth'</span>,{35 77 77 33 33 33 33 33},<span class="keyword">...</span>
0170     <span class="string">'RowName'</span>,<span class="string">'numbered'</span>,<span class="keyword">...</span>
0171     <span class="string">'ColumnName'</span>,{<span class="string">'use'</span> <span class="string">'mX'</span>,<span class="string">'mY'</span>,<span class="string">'xx'</span>,<span class="string">'yy'</span>,<span class="string">'xy'</span>,<span class="string">'yx'</span>,<span class="string">'A'</span>},<span class="keyword">...</span>
0172     <span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0173     <span class="string">'CellEditCallback'</span>,@<a href="#_sub1" class="code" title="subfunction fv_onEditTable(src,~)">fv_onEditTable</a>,<span class="keyword">...</span>
0174     <span class="string">'FontSize'</span>,myui.fontsize);
0175     
0176     <span class="comment">% UPDATE button</span>
0177     <span class="comment">% gui.panels.mod.HBox5 = uix.HBox('Parent',gui.panels.mod.VBox,...</span>
0178     <span class="comment">%     'Spacing',3);</span>
0179     <span class="comment">% uix.Empty('Parent',gui.panels.mod.HBox5);</span>
0180     <span class="comment">% tstr = 'Update model';</span>
0181     <span class="comment">% gui.push_handles.model = uicontrol('Parent',gui.panels.mod.HBox5,...</span>
0182     <span class="comment">%     'String','UPDATE MODEL','FontSize',myui.fontsize,'Tag','rtd',...</span>
0183     <span class="comment">%     'ToolTipString',tstr,'UserData',struct('Tooltipstr',tstr),...</span>
0184     <span class="comment">%     'BackGroundColor','g','Callback',@fv_getModel);</span>
0185     <span class="comment">% set(gui.panels.mod.HBox5,'Widths',[cpanel_w -1]);</span>
0186 
0187     <span class="comment">% adjust heights</span>
0188     set(gui.panels.mod.VBox,<span class="string">'Heights'</span>,[25 25 25 -1]);
0189 
0190     <span class="comment">%% --- properties panel ---</span>
0191     waitbar(2/steps,hwb,<span class="string">'loading GUI elements - properties'</span>);
0192     gui.panels.prop.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.left,<span class="keyword">...</span>
0193         <span class="string">'Title'</span>,<span class="string">'Properties'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0194         <span class="string">'TitleColor'</span>,colors.GEO,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0195     gui.panels.prop.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.prop.main,<span class="keyword">...</span>
0196         <span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0197 
0198     <span class="comment">% D coeff.</span>
0199     gui.panels.prop.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0200         <span class="string">'Spacing'</span>,3);
0201     gui.text_handles.diff = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox1,<span class="keyword">...</span>
0202         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0203         <span class="string">'String'</span>,[<span class="string">'Diffusion coeff. [10'</span>,char(hex2dec(<span class="string">'207B'</span>)),<span class="keyword">...</span>
0204         char(hex2dec(<span class="string">'2079'</span>)),<span class="string">' m'</span>,char(hex2dec(<span class="string">'00B2'</span>)),<span class="string">'/s]'</span>]);
0205     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox1);
0206     tstr = <span class="string">'Set diffusion coefficient.'</span>;
0207     gui.edit_handles.diff = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox1,<span class="keyword">...</span>
0208         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%4.3f'</span>,data.prop.D*1e9),<span class="keyword">...</span>
0209         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'diff'</span>,<span class="keyword">...</span>
0210         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0211         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0212     set(gui.panels.prop.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0213 
0214     <span class="comment">% Gradient</span>
0215     gui.panels.prop.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0216         <span class="string">'Spacing'</span>,3);
0217     gui.text_handles.gradient = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox2,<span class="keyword">...</span>
0218         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0219         <span class="string">'String'</span>,&quot;Gradient [T/m]&quot;);
0220     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox2);
0221     tstr = <span class="string">'Set device gradient.'</span>;
0222     gui.edit_handles.gradient = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox2,<span class="keyword">...</span>
0223         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.G0),<span class="keyword">...</span>
0224         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'gradient'</span>,<span class="keyword">...</span>
0225         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0226         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0227     set(gui.panels.prop.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0228 
0229     <span class="comment">% echo time</span>
0230     gui.panels.prop.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0231         <span class="string">'Spacing'</span>,3);
0232     gui.text_handles.echo_time = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox3,<span class="keyword">...</span>
0233         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0234         <span class="string">'String'</span>,&quot;Echo time tE [µs]&quot;);
0235     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox3);
0236     tstr = <span class="string">'Set echo time tE.'</span>;
0237     gui.edit_handles.echo_time = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox3,<span class="keyword">...</span>
0238         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T2te*1e6),<span class="keyword">...</span>
0239         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'echo_time'</span>,<span class="keyword">...</span>
0240         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0241         <span class="string">'Enable'</span>,<span class="string">'off'</span>,<span class="keyword">...</span>
0242         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0243     set(gui.panels.prop.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0244 
0245     <span class="comment">% Tbulk</span>
0246     gui.panels.prop.HBox4 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.prop.VBox,<span class="keyword">...</span>
0247         <span class="string">'Spacing'</span>,3);
0248     gui.text_handles.Tbulk = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox4,<span class="keyword">...</span>
0249         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0250         <span class="string">'String'</span>,&quot;Bulk relaxation [s]&quot;);
0251     uix.Empty(<span class="string">'Parent'</span>,gui.panels.prop.HBox4);
0252     tstr = <span class="string">'Set Tbulk value.'</span>;
0253     gui.edit_handles.Tbulk = uicontrol(<span class="string">'Parent'</span>,gui.panels.prop.HBox4,<span class="keyword">...</span>
0254         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.prop.Tbulk),<span class="keyword">...</span>
0255         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'Tbulk'</span>,<span class="keyword">...</span>
0256         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0257         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0258     set(gui.panels.prop.HBox4,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0259 
0260     <span class="comment">%% --- NMR signal panel ---</span>
0261     waitbar(3/steps,hwb,<span class="string">'loading GUI elements - Signal panel'</span>);
0262     gui.panels.nmr.main = uix.BoxPanel(<span class="string">'Parent'</span>,gui.left,<span class="keyword">...</span>
0263         <span class="string">'Title'</span>,<span class="string">'NMR signals'</span>,<span class="string">'MinimizeFcn'</span>,@<a href="minimizePanel.html" class="code" title="function minimizePanel(src,~)">minimizePanel</a>,<span class="keyword">...</span>
0264         <span class="string">'TitleColor'</span>,colors.NMR,<span class="string">'ForegroundColor'</span>,colors.BoxTitle);
0265     gui.panels.nmr.VBox = uix.VBox(<span class="string">'Parent'</span>,gui.panels.nmr.main,<span class="keyword">...</span>
0266         <span class="string">'Spacing'</span>,3,<span class="string">'Padding'</span>,3);
0267 
0268     <span class="comment">% T1type</span>
0269     gui.panels.nmr.HBox0 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0270         <span class="string">'Spacing'</span>,3);
0271     gui.text_handles.T1type = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox0,<span class="keyword">...</span>
0272         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0273         <span class="string">'String'</span>,<span class="string">'T1 type (SR / IR)'</span>);
0274     tstr = <span class="string">'Choose between Saturation and Inversion Recovery.'</span>;
0275     gui.popup_handles.T1type = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox0,<span class="keyword">...</span>
0276         <span class="string">'Style'</span>,<span class="string">'popup'</span>,<span class="string">'String'</span>,{<span class="string">'Saturation Recovery'</span>,<span class="string">'Inversion Recovery'</span>},<span class="keyword">...</span>
0277         <span class="string">'Value'</span>,data.nmr.T1IRfac,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0278         <span class="string">'Callback'</span>,@<a href="#_sub3" class="code" title="subfunction fv_onPopupT1Type(src,~)">fv_onPopupT1Type</a>);
0279     set(gui.panels.nmr.HBox0,<span class="string">'Widths'</span>,[cpanel_w -1]);
0280 
0281     <span class="comment">% T1 timings</span>
0282     gui.panels.nmr.HBox1 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0283         <span class="string">'Spacing'</span>,3);
0284     gui.text_handles.timeT1 = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0285         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0286         <span class="string">'String'</span>,<span class="string">'T1 recov -  min [s] | max [s] | #'</span>);
0287     tstr = &quot;&quot;;
0288     gui.edit_handles.T1trmin = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0289         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.4f'</span>,data.nmr.T1trmin),<span class="keyword">...</span>
0290         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1trmin'</span>,<span class="keyword">...</span>
0291         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0292         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0293     tstr = &quot;&quot;;
0294     gui.edit_handles.T1trmax = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0295         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T1trmax),<span class="keyword">...</span>
0296         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1trmax'</span>,<span class="keyword">...</span>
0297         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0298         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0299     tstr = &quot;&quot;;
0300     gui.edit_handles.T1trN = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox1,<span class="keyword">...</span>
0301         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T1trN),<span class="keyword">...</span>
0302         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T1trN'</span>,<span class="keyword">...</span>
0303         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0304         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0305     set(gui.panels.nmr.HBox1,<span class="string">'Widths'</span>,[cpanel_w -1 -1 -1]);
0306 
0307     <span class="comment">% T2 timings</span>
0308     gui.panels.nmr.HBox2 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0309         <span class="string">'Spacing'</span>,3);
0310     gui.text_handles.timeT2 = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox2,<span class="keyword">...</span>
0311         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0312         <span class="string">'String'</span>,<span class="string">'T2 echo time [µs] | # echos'</span>);
0313     tstr = &quot;&quot;;
0314     gui.edit_handles.T2te = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox2,<span class="keyword">...</span>
0315         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%5.2f'</span>,data.nmr.T2te*1e6),<span class="keyword">...</span>
0316         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2te'</span>,<span class="keyword">...</span>
0317         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0318         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0319     tstr = &quot;&quot;;
0320     gui.edit_handles.T2teN = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox2,<span class="keyword">...</span>
0321         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,sprintf(<span class="string">'%d'</span>,data.nmr.T2teN),<span class="keyword">...</span>
0322         <span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'T2teN'</span>,<span class="keyword">...</span>
0323         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0324         <span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0325     set(gui.panels.nmr.HBox2,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0326     
0327     <span class="comment">% noise</span>
0328     gui.panels.nmr.HBox3 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0329         <span class="string">'Spacing'</span>,3);
0330     gui.text_handles.noise = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox3,<span class="keyword">...</span>
0331         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0332         <span class="string">'String'</span>,<span class="string">'Noise settings'</span>);
0333     tstr = [<span class="string">'&lt;HTML&gt;NMR data noise method.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0334         <span class="string">'A noise level will be used globally for all NMR signals.&lt;br&gt;'</span>,<span class="keyword">...</span>
0335         <span class="string">'A signal-to-ratio will be used individually on every single NMR signal.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0336         <span class="string">'&lt;u&gt;Available options:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0337         <span class="string">'&lt;b&gt;noise level&lt;/b&gt; or &lt;b&gt;SNR&lt;/b&gt; &lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0338         <span class="string">'&lt;u&gt;Default value:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0339         <span class="string">'&lt;b&gt;noise level&lt;/b&gt; &lt;br&gt;'</span>];
0340     gui.popup_handles.noisetype = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox3,<span class="keyword">...</span>
0341         <span class="string">'Style'</span>,<span class="string">'popup'</span>,<span class="string">'String'</span>,{<span class="string">'noise level'</span>,<span class="string">'SNR'</span>},<span class="keyword">...</span>
0342         <span class="string">'Value'</span>,1,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0343         <span class="string">'Callback'</span>,@<a href="#_sub4" class="code" title="subfunction fv_onPopupNoiseType(src,~)">fv_onPopupNoiseType</a>);
0344     tstr = [<span class="string">'&lt;HTML&gt;NMR data noise.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0345         <span class="string">'&lt;u&gt;Hint:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0346         <span class="string">'You do not need to press RUN to add noise to the NMR signals.&lt;br&gt;'</span>,<span class="keyword">...</span>
0347         <span class="string">'The raw NMR signals are stored internally and the noise is&lt;br&gt;'</span>,<span class="keyword">...</span>
0348         <span class="string">'applied instantaneously.&lt;br&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0349         <span class="string">'&lt;u&gt;Default value:&lt;/u&gt;&lt;br&gt;'</span>,<span class="keyword">...</span>
0350         <span class="string">'&lt;b&gt;0&lt;/b&gt;&lt;br&gt;'</span>];
0351     gui.edit_handles.noise = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox3,<span class="keyword">...</span>
0352         <span class="string">'Style'</span>,<span class="string">'edit'</span>,<span class="string">'String'</span>,num2str(data.nmr.noise),<span class="string">'FontSize'</span>,myui.fontsize,<span class="keyword">...</span>
0353         <span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr,<span class="string">'defaults'</span>,[data.nmr.noise 1 1]),<span class="keyword">...</span>
0354         <span class="string">'Tag'</span>,<span class="string">'nmr_noise'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub2" class="code" title="subfunction fv_onEditValue(src,~)">fv_onEditValue</a>);
0355     set(gui.panels.nmr.HBox3,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0356 
0357     <span class="comment">% Calc button</span>
0358     gui.panels.nmr.HBox4 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0359         <span class="string">'Spacing'</span>,3);
0360     uix.Empty(<span class="string">'Parent'</span>,gui.panels.nmr.HBox4);
0361     tstr = <span class="string">'Get NMR signals'</span>;
0362     gui.push_handles.nmr = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox4,<span class="keyword">...</span>
0363         <span class="string">'String'</span>,<span class="string">'GET NMR SIGNALS'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'2dmod'</span>,<span class="keyword">...</span>
0364         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0365         <span class="string">'BackGroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction fv_getNMR(src,~)">fv_getNMR</a>);
0366     set(gui.panels.nmr.HBox4,<span class="string">'Widths'</span>,[cpanel_w -1]);
0367 
0368     <span class="comment">% log/lin axes</span>
0369     gui.panels.nmr.HBox5 = uix.HBox(<span class="string">'Parent'</span>,gui.panels.nmr.VBox,<span class="keyword">...</span>
0370         <span class="string">'Spacing'</span>,3);
0371     gui.text_handles.loglin_axes = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox5,<span class="keyword">...</span>
0372         <span class="string">'Style'</span>,<span class="string">'text'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'HorizontalAlignment'</span>,<span class="string">'center'</span>,<span class="keyword">...</span>
0373         <span class="string">'String'</span>,<span class="string">'Echo time axes'</span>);
0374     tstr = &quot;&quot;;
0375     gui.radio_handles.log = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox5,<span class="keyword">...</span>
0376         <span class="string">'Style'</span>,<span class="string">'radiobutton'</span>,<span class="string">'String'</span>,<span class="string">'log'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'log'</span>,<span class="keyword">...</span>
0377         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0378         <span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Value'</span>,1,<span class="string">'Callback'</span>,@<a href="#_sub13" class="code" title="subfunction fv_onRadioLogLin(src,~)">fv_onRadioLogLin</a>);
0379     gui.radio_handles.lin = uicontrol(<span class="string">'Parent'</span>,gui.panels.nmr.HBox5,<span class="keyword">...</span>
0380         <span class="string">'Style'</span>,<span class="string">'radiobutton'</span>,<span class="string">'String'</span>,<span class="string">'lin'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'lin'</span>,<span class="keyword">...</span>
0381         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0382         <span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Value'</span>,0,<span class="string">'Callback'</span>,@<a href="#_sub13" class="code" title="subfunction fv_onRadioLogLin(src,~)">fv_onRadioLogLin</a>);
0383     set(gui.panels.nmr.HBox5,<span class="string">'Widths'</span>,[cpanel_w -1 -1]);
0384 
0385     <span class="comment">%% --- update MAIN GUI button ---</span>
0386     gui.panels.save.HBox1 = uix.VBox(<span class="string">'Parent'</span>,gui.left,<span class="keyword">...</span>
0387         <span class="string">'Spacing'</span>,3);   
0388     tstr = <span class="string">'UPDATE 2D inversion data in main NUCLEUSinv GUI.'</span>;
0389     gui.push_handles.update = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0390         <span class="string">'String'</span>,<span class="string">'UPDATE MAIN GUI'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'update'</span>,<span class="keyword">...</span>
0391         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0392         <span class="string">'Callback'</span>,@<a href="#_sub10" class="code" title="subfunction fv_onPushUpdate(src,~)">fv_onPushUpdate</a>,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0393     tstr = <span class="string">'SAVE 2D inversion data to external file.'</span>;
0394     gui.push_handles.save = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0395         <span class="string">'String'</span>,<span class="string">'SAVE RESULT'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'save'</span>,<span class="keyword">...</span>
0396         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0397         <span class="string">'Callback'</span>,@<a href="#_sub8" class="code" title="subfunction fv_onPushSave(src,~)">fv_onPushSave</a>);
0398     tstr = <span class="string">'Export current graphics view to Figure.'</span>;
0399     gui.push_handles.view = uicontrol(<span class="string">'Parent'</span>,gui.panels.save.HBox1,<span class="keyword">...</span>
0400         <span class="string">'String'</span>,<span class="string">'VIEW2FIG'</span>,<span class="string">'FontSize'</span>,myui.fontsize,<span class="string">'Tag'</span>,<span class="string">'view'</span>,<span class="keyword">...</span>
0401         <span class="string">'ToolTipString'</span>,tstr,<span class="string">'UserData'</span>,struct(<span class="string">'Tooltipstr'</span>,tstr),<span class="keyword">...</span>
0402         <span class="string">'Callback'</span>,@<a href="#_sub9" class="code" title="subfunction fv_onPushView(src,~)">fv_onPushView</a>);
0403     <span class="comment">% set(gui.panels.save.HBox1,'Widths',[-1 -1]);</span>
0404 
0405     <span class="comment">% fix text vertical alignment</span>
0406     jh = findjobj(gui.text_handles.diff);
0407     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0408     jh = findjobj(gui.text_handles.gradient);
0409     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0410     jh = findjobj(gui.text_handles.echo_time);
0411     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0412     jh = findjobj(gui.text_handles.Tbulk);
0413     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0414 
0415     jh = findjobj(gui.text_handles.rtdT1);
0416     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0417     jh = findjobj(gui.text_handles.rtdT2);
0418     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0419     
0420     jh = findjobj(gui.text_handles.T1type);
0421     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0422     jh = findjobj(gui.text_handles.timeT1);
0423     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0424     jh = findjobj(gui.text_handles.timeT2);
0425     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0426     jh = findjobj(gui.text_handles.noise);
0427     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0428     jh = findjobj(gui.text_handles.loglin_axes);
0429     jh.setVerticalAlignment(javax.swing.JLabel.CENTER);
0430 
0431     <span class="comment">% empty space at bottom of left side</span>
0432     uix.Empty(<span class="string">'Parent'</span>,gui.left);
0433     <span class="comment">% adjust the heights of all left-column-panels</span>
0434     heights = [22 22 22 28 -1; 22+2*24+3*4+115 22+4*24+6*3 22+6*24+8*3 28*3 -1];
0435     <span class="comment">% panel header is always 22 high</span>
0436     set(gui.left,<span class="string">'Heights'</span>,heights(2,:),<span class="keyword">...</span>
0437         <span class="string">'MinimumHeights'</span>,[22 22 22 28 0]);
0438 
0439     <span class="comment">%% --- plot boxes ---</span>
0440     waitbar(4/steps,hwb,<span class="string">'loading GUI elements - graphics'</span>);
0441     gui.rightPanel = uix.TabPanel(<span class="string">'Parent'</span>,gui.right,<span class="keyword">...</span>
0442         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0443 
0444     <span class="comment">% -- tab2</span>
0445     gui.tab2 = uix.GridFlex(<span class="string">'Parent'</span>,gui.rightPanel,<span class="keyword">...</span>
0446         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,5,<span class="string">'Padding'</span>,5);
0447 
0448     gui.pbox21 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0449         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0450     gui.pbox22 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0451         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0452 
0453     gui.pbox23 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0454         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0455     gui.pbox24 = uicontainer(<span class="string">'Parent'</span>,gui.tab2,<span class="keyword">...</span>
0456         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0457 
0458     set(gui.tab2,<span class="string">'Widths'</span>,[-6 -1],<span class="string">'Heights'</span>,[-1 -6]);
0459 
0460     <span class="comment">% -- tab3</span>
0461     gui.tab3 = uix.VBoxFlex(<span class="string">'Parent'</span>,gui.rightPanel,<span class="keyword">...</span>
0462         <span class="string">'BackGroundColor'</span>,colors.panelBG,<span class="string">'Spacing'</span>,5);
0463     gui.pbox31 = uicontainer(<span class="string">'Parent'</span>,gui.tab3,<span class="keyword">...</span>
0464         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0465     gui.pbox32 = uicontainer(<span class="string">'Parent'</span>,gui.tab3,<span class="keyword">...</span>
0466         <span class="string">'BackGroundColor'</span>,colors.panelBG);
0467     set(gui.tab3,<span class="string">'Heights'</span>,[-1 -2]);
0468 
0469     gui.rightPanel.TabTitles = {<span class="string">'MODEL'</span>,<span class="string">'SIGNALS'</span>};
0470     gui.rightPanel.TabWidth = 75;
0471     gui.rightPanel.TabEnables = {<span class="string">'on'</span>,<span class="string">'on'</span>};
0472 
0473     <span class="comment">% -- plot axes --</span>
0474     gui.axes2 = axes(<span class="string">'Parent'</span>,gui.pbox22,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0475     gui.axes21 = axes(<span class="string">'Parent'</span>,gui.pbox21,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0476     gui.axes24 = axes(<span class="string">'Parent'</span>,gui.pbox24,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0477     gui.axes31 = axes(<span class="string">'Parent'</span>,gui.pbox31,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0478     gui.axes32 = axes(<span class="string">'Parent'</span>,gui.pbox32,<span class="string">'Box'</span>,<span class="string">'on'</span>);
0479 
0480     <span class="comment">% --- store main GUI settings ---</span>
0481     gui.myui = nucleus.gui.myui;
0482     gui.myui.heights = heights;
0483     gui.figh_nucleus = figh_nucleus;
0484 
0485     <span class="comment">% --- save gui data to GUI ---</span>
0486     setappdata(fig_2Dmod,<span class="string">'gui'</span>,gui);
0487     setappdata(fig_2Dmod,<span class="string">'data'</span>,data);
0488 
0489     <span class="comment">% make GUI visible</span>
0490     delete(hwb);
0491     set(gui.main,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
0492 <span class="keyword">else</span>
0493     <span class="comment">% if the figure is already open bring t to the front</span>
0494     figure(fig_2Dmod);
0495 <span class="keyword">end</span>
0496 
0497 <span class="comment">% trigger the model update pushbutton for the initial view</span>
0498 <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(fig_2Dmod);
0499 <a href="beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(fig_2Dmod);
0500 <span class="keyword">end</span>
0501 
0502 <span class="comment">%% subfunction to update the table entries</span>
0503 <a name="_sub1" href="#_subfunctions" class="code">function fv_onEditTable(src,~)</a>
0504 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0505 <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(figh)
0506 
0507 <span class="keyword">end</span>
0508 
0509 <span class="comment">%% subfunction to update the edit fields</span>
0510 <a name="_sub2" href="#_subfunctions" class="code">function fv_onEditValue(src,~)</a>
0511 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0512 gui = getappdata(figh,<span class="string">'gui'</span>);
0513 data = getappdata(figh,<span class="string">'data'</span>);
0514 
0515 <span class="keyword">switch</span> get(src,<span class="string">'Tag'</span>)
0516     <span class="keyword">case</span> {<span class="string">'diff'</span>,<span class="string">'gradient'</span>,<span class="string">'Tbulk'</span>}
0517         data.prop.D = str2double(get(gui.edit_handles.diff,<span class="string">'String'</span>))/1e9;
0518         data.prop.G0 = str2double(get(gui.edit_handles.gradient,<span class="string">'String'</span>));        
0519         data.prop.Tbulk = str2double(get(gui.edit_handles.Tbulk,<span class="string">'String'</span>));
0520     <span class="keyword">case</span> {<span class="string">'rtdT1min'</span>,<span class="string">'rtdT1max'</span>,<span class="string">'rtdT1N'</span>}
0521         data.mod.T1min = str2double(get(gui.edit_handles.rtdT1min,<span class="string">'String'</span>));
0522         data.mod.T1max = str2double(get(gui.edit_handles.rtdT1max,<span class="string">'String'</span>));
0523         data.mod.T1N = str2double(get(gui.edit_handles.rtdT1N,<span class="string">'String'</span>));
0524         setappdata(figh,<span class="string">'data'</span>,data);
0525         <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(gui.push_handles.model);
0526         data = getappdata(figh,<span class="string">'data'</span>);
0527     <span class="keyword">case</span> {<span class="string">'rtdT2min'</span>,<span class="string">'rtdT2max'</span>,<span class="string">'rtdT2N'</span>}
0528         data.mod.T2min = str2double(get(gui.edit_handles.rtdT2min,<span class="string">'String'</span>));
0529         data.mod.T2max = str2double(get(gui.edit_handles.rtdT2max,<span class="string">'String'</span>));
0530         data.mod.T2N = str2double(get(gui.edit_handles.rtdT2N,<span class="string">'String'</span>));
0531         setappdata(figh,<span class="string">'data'</span>,data);
0532         <a href="#_sub6" class="code" title="subfunction fv_getModel(figh)">fv_getModel</a>(gui.push_handles.model);
0533         data = getappdata(figh,<span class="string">'data'</span>);
0534      <span class="keyword">case</span> {<span class="string">'T1trmin'</span>,<span class="string">'T1trmax'</span>,<span class="string">'T1trN'</span>}
0535         data.nmr.T1trmin = str2double(get(gui.edit_handles.T1trmin,<span class="string">'String'</span>));
0536         data.nmr.T1trmax = str2double(get(gui.edit_handles.T1trmax,<span class="string">'String'</span>));
0537         data.nmr.T1trN = str2double(get(gui.edit_handles.T1trN,<span class="string">'String'</span>));
0538     <span class="keyword">case</span> {<span class="string">'T2te'</span>,<span class="string">'T2teN'</span>}
0539         data.nmr.T2te = str2double(get(gui.edit_handles.T2te,<span class="string">'String'</span>))/1e6;
0540         data.nmr.T2teN = str2double(get(gui.edit_handles.T2teN,<span class="string">'String'</span>));
0541 
0542         data.prop.te = data.nmr.T2te;
0543         set(gui.edit_handles.echo_time,<span class="string">'String'</span>,data.prop.te*1e6);
0544     <span class="keyword">case</span> {<span class="string">'nmr_noise'</span>}
0545         data.nmr.noise = str2double(get(gui.edit_handles.noise,<span class="string">'String'</span>));
0546         <span class="keyword">switch</span> data.nmr.noisetype
0547             <span class="keyword">case</span> <span class="string">'level'</span>
0548             <span class="keyword">case</span> <span class="string">'SNR'</span>
0549                 <span class="keyword">if</span> data.nmr.noise == 0
0550                     data.nmr.noise = Inf;
0551                     set(src,<span class="string">'String'</span>,num2str(data.nmr.noise));
0552                 <span class="keyword">end</span>
0553         <span class="keyword">end</span>
0554         setappdata(figh,<span class="string">'data'</span>,data);
0555         <span class="keyword">if</span> isfield(data.results.mod2D,<span class="string">'data'</span>)
0556             <a href="#_sub5" class="code" title="subfunction fv_addNoise(figh)">fv_addNoise</a>(figh)
0557             data = getappdata(figh,<span class="string">'data'</span>);
0558         <span class="keyword">end</span>        
0559 <span class="keyword">end</span>
0560 
0561 <span class="comment">% update GUI data</span>
0562 setappdata(figh,<span class="string">'data'</span>,data);
0563 <span class="keyword">end</span>
0564 
0565 <span class="comment">%% subfunction to set the T1 type</span>
0566 <a name="_sub3" href="#_subfunctions" class="code">function fv_onPopupT1Type(src,~)</a>
0567 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0568 data = getappdata(figh,<span class="string">'data'</span>);
0569 
0570 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
0571     <span class="keyword">case</span> 1 <span class="comment">% Saturation Recovery</span>
0572         data.nmr.T1IRfac = 1;
0573     <span class="keyword">case</span> 2 <span class="comment">% Inversion Recovery</span>
0574         data.nmr.T1IRfac = 2;
0575 <span class="keyword">end</span>
0576 
0577 <span class="comment">% update GUI data</span>
0578 setappdata(figh,<span class="string">'data'</span>,data);
0579 <span class="keyword">end</span>
0580 
0581 <span class="comment">%% subfunction to set the NMR data noise type</span>
0582 <a name="_sub4" href="#_subfunctions" class="code">function fv_onPopupNoiseType(src,~)</a>
0583 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0584 gui = getappdata(figh,<span class="string">'gui'</span>);
0585 data = getappdata(figh,<span class="string">'data'</span>);
0586 
0587 <span class="comment">% change settings accordingly</span>
0588 <span class="keyword">switch</span> get(src,<span class="string">'Value'</span>)
0589     <span class="keyword">case</span> 1 <span class="comment">% noise level</span>
0590         data.nmr.noisetype = <span class="string">'level'</span>;
0591         <span class="keyword">if</span> data.nmr.noise &gt; 0
0592             data.nmr.noise = 1/data.nmr.noise;
0593         <span class="keyword">end</span>        
0594     <span class="keyword">case</span> 2 <span class="comment">% signal-to-noise ratio (SNR)</span>
0595         data.nmr.noisetype = <span class="string">'SNR'</span>;
0596         <span class="keyword">if</span> data.nmr.noise == 0
0597             data.nmr.noise = inf;
0598         <span class="keyword">else</span>
0599             data.nmr.noise = 1/data.nmr.noise;
0600         <span class="keyword">end</span>        
0601 <span class="keyword">end</span>
0602 <span class="comment">% update the corresponding edit field</span>
0603 set(gui.edit_handles.noise,<span class="string">'String'</span>,num2str(data.nmr.noise));
0604 
0605 <span class="comment">% update GUI data</span>
0606 setappdata(figh,<span class="string">'data'</span>,data);
0607 <span class="comment">% update NMR data (if available)</span>
0608 <span class="keyword">if</span> isfield(data.results.mod2D,<span class="string">'data'</span>)
0609     <a href="#_sub5" class="code" title="subfunction fv_addNoise(figh)">fv_addNoise</a>(figh);
0610 <span class="keyword">end</span>
0611 
0612 <span class="keyword">end</span>
0613 
0614 <span class="comment">%% subfunction to set the T1 t&lt;pe</span>
0615 <a name="_sub5" href="#_subfunctions" class="code">function fv_addNoise(figh)</a>
0616 data = getappdata(figh,<span class="string">'data'</span>);
0617 mod2D = data.results.mod2D;
0618 
0619 <span class="comment">% first check what is the noise type</span>
0620 <span class="keyword">switch</span> data.nmr.noisetype
0621     <span class="keyword">case</span> <span class="string">'level'</span>
0622         noise = data.nmr.noise;
0623     <span class="keyword">case</span> <span class="string">'SNR'</span>
0624         SNR = data.nmr.noise;
0625         noise = 1./SNR;
0626 <span class="keyword">end</span>
0627 
0628 <span class="keyword">if</span> noise &gt; 0
0629     <span class="keyword">for</span> n = 1:numel(mod2D.data)
0630         mod2D.data(n).noise = noise;
0631         [re,im] = <a href="../../../nucleus/functions/modeling/addNoiseToSignal.html" class="code" title="function [signalN,noise] = addNoiseToSignal(signal,mu,sigma)">addNoiseToSignal</a>(mod2D.data(n).s_raw,0,noise);
0632         mod2D.data(n).s = complex(re,im);
0633     <span class="keyword">end</span>
0634 <span class="keyword">else</span>
0635     <span class="comment">% reset the NMR signals with the raw data (without noise)</span>
0636     <span class="keyword">for</span> n = 1:numel(mod2D.data)
0637         mod2D.data(n).noise = 0;
0638         mod2D.data(n).s = complex(mod2D.data(n).s_raw,zeros(size(mod2D.data(n).s_raw)));
0639     <span class="keyword">end</span>
0640 <span class="keyword">end</span>
0641 
0642 <span class="comment">% update the GUI data</span>
0643 data.results.mod2D = mod2D;
0644 setappdata(figh,<span class="string">'data'</span>,data);
0645 <span class="comment">% plot all signals</span>
0646 <a href="#_sub11" class="code" title="subfunction fv_plotSignals(figh)">fv_plotSignals</a>(figh);
0647 <a href="beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
0648 <span class="keyword">end</span>
0649 
0650 <span class="comment">%% subfunction to get the 2D model</span>
0651 <a name="_sub6" href="#_subfunctions" class="code">function fv_getModel(figh)</a>
0652 <span class="comment">% figh = ancestor(src,'figure','toplevel');</span>
0653 gui = getappdata(figh,<span class="string">'gui'</span>);
0654 data = getappdata(figh,<span class="string">'data'</span>);
0655 
0656 <span class="comment">% create model space from relaxation time T vectors</span>
0657 T1min = data.mod.T1min;
0658 T1max = data.mod.T1max;
0659 T1N = data.mod.T1N;
0660 T2min = data.mod.T2min;
0661 T2max = data.mod.T2max;
0662 T2N = data.mod.T2N;
0663 
0664 T1vec = logspace(log10(T1min),log10(T1max),T1N);
0665 T2vec = logspace(log10(T2min),log10(T2max),T2N);
0666 MOD = zeros(numel(T1vec),numel(T2vec));
0667 
0668 [X1,X2] = meshgrid(T2vec,T1vec);
0669 X = [X1(:) X2(:)];
0670 
0671 <span class="comment">% get table with model parameters</span>
0672 table = get(gui.table_handles.mod,<span class="string">'Data'</span>);
0673 data.results.mod2D.table = table;
0674 <span class="comment">% create distributions</span>
0675 <span class="keyword">for</span> nn = 1:size(table,1)
0676     <span class="keyword">if</span> table{nn,1}
0677         <span class="comment">% muX muY</span>
0678         mu = [table{nn,2} table{nn,3}];
0679         <span class="comment">% sigma = [xx xy; yx yy]</span>
0680         Sigma = [table{nn,4} table{nn,6}; table{nn,7} table{nn,5}];
0681         <span class="comment">% get multivariate distribution of linearized data</span>
0682         p = <a href="../../../nucleus/functions/modeling/getMultivariateGaussian.html" class="code" title="function pdf = getMultivariateGaussian(X,mu,sigma)">getMultivariateGaussian</a>(log10(X), log10(mu), Sigma);
0683         p = reshape(p,T1N,T2N);
0684         Amp = table{nn,8};
0685         MOD = MOD + Amp*p./max(p(:));
0686     <span class="keyword">end</span>
0687 <span class="keyword">end</span>
0688 
0689 <span class="keyword">if</span> any(isnan(MOD))
0690     MOD = ones(size(MOD));
0691 <span class="keyword">end</span>
0692 
0693 <span class="comment">% normalize to 1</span>
0694 MOD = MOD./sum(MOD(:));
0695 
0696 data.results.mod2D.T1vec = T1vec;
0697 data.results.mod2D.T2vec = T2vec;
0698 data.results.mod2D.MOD = MOD;
0699 <span class="comment">% update GUI data</span>
0700 setappdata(figh,<span class="string">'data'</span>,data);
0701 <span class="comment">% update plot</span>
0702 <a href="#_sub12" class="code" title="subfunction fv_plotModel(figh)">fv_plotModel</a>(figh);
0703 <a href="beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
0704 <span class="keyword">end</span>
0705 
0706 <span class="comment">%% subfunction to calculate the NMR signals</span>
0707 <a name="_sub7" href="#_subfunctions" class="code">function fv_getNMR(src,~)</a>
0708 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0709 gui = getappdata(figh,<span class="string">'gui'</span>);
0710 data = getappdata(figh,<span class="string">'data'</span>);
0711 mod2D = data.results.mod2D;
0712 
0713 <span class="comment">% prepare parameters</span>
0714 <span class="comment">% IR / SR factor</span>
0715 T1IRfac = data.nmr.T1IRfac;
0716 IRtype = data.nmr.IRtype;
0717 
0718 <span class="comment">% get system properties</span>
0719 D = data.prop.D;
0720 G0 = data.prop.G0;
0721 te = data.prop.te;
0722 Tbulk = data.prop.Tbulk;
0723 
0724 T1vec = mod2D.T1vec;
0725 T2vec = mod2D.T2vec;
0726 
0727 <span class="comment">% disable the RUN button to indicate a running inversion</span>
0728 set(gui.push_handles.nmr,<span class="string">'String'</span>,<span class="string">'RUNNING ...'</span>,<span class="keyword">...</span>
0729     <span class="string">'BackgroundColor'</span>,get(gui.push_handles.update,<span class="string">'BackgroundColor'</span>),<span class="keyword">...</span>
0730     <span class="string">'Enable'</span>,<span class="string">'off'</span>); pause(0.01);
0731 
0732 <span class="comment">% prepare data</span>
0733 <span class="comment">% T2 time vector</span>
0734 t2 = <a href="../../../nucleus/functions/modeling/getNMRTimeVector.html" class="code" title="function t = getNMRTimeVector(TE,TEunit,varargin)">getNMRTimeVector</a>(data.nmr.T2te,<span class="string">'s'</span>,<span class="string">'N'</span>,data.nmr.T2teN);
0735 T1 = logspace(log10(data.nmr.T1trmin),log10(data.nmr.T1trmax),data.nmr.T1trN);
0736 dat = struct;
0737 <span class="keyword">for</span> n = 1:numel(T1)
0738     dat(n).t = t2;
0739     dat(n).s = zeros(size(t2));
0740     dat(n).T1 = T1(n);
0741 <span class="keyword">end</span>
0742 
0743 <span class="comment">% create the Kernel matrix for inversion</span>
0744 p.G0 = G0;
0745 p.D = D;
0746 p.te = te;
0747 p.Tbulk = Tbulk;
0748 p.T1IRfac = T1IRfac;
0749 p.IRtype = IRtype;
0750 [K,indices] = <a href="../../../nucleus/functions/inversion/createKernelMatrix2D.html" class="code" title="function [K,indices] = createKernelMatrix2D(dat,T1vec,T2vec,p)">createKernelMatrix2D</a>(dat,T1vec,T2vec,p);
0751 
0752 MODvec = reshape(mod2D.MOD',size(mod2D.MOD,1)*size(mod2D.MOD,2),1);
0753 RESvec = K*MODvec;
0754 
0755 <span class="keyword">for</span> n = 1:numel(T1)
0756     dat(n).s = RESvec(indices.lin_1(n):indices.lin_end(n));
0757     dat(n).s_raw = RESvec(indices.lin_1(n):indices.lin_end(n));
0758 <span class="keyword">end</span>
0759 
0760 <span class="comment">% enable the RN button</span>
0761 set(gui.push_handles.nmr,<span class="string">'String'</span>,<span class="string">'GET NMR SIGNALS'</span>,<span class="keyword">...</span>
0762     <span class="string">'BackgroundColor'</span>,<span class="string">'g'</span>,<span class="string">'Enable'</span>,<span class="string">'on'</span>,<span class="string">'Callback'</span>,@<a href="#_sub7" class="code" title="subfunction fv_getNMR(src,~)">fv_getNMR</a>);
0763 setappdata(figh,<span class="string">'gui'</span>,gui);
0764 
0765 <span class="comment">% save results</span>
0766 data.results.mod2D.t2 = t2;
0767 data.results.mod2D.t_recov = T1;
0768 data.results.mod2D.data = dat;
0769 
0770 <span class="comment">% update data</span>
0771 setappdata(figh,<span class="string">'data'</span>,data);
0772 <a href="#_sub5" class="code" title="subfunction fv_addNoise(figh)">fv_addNoise</a>(figh)
0773 
0774 <span class="comment">% plot all signals</span>
0775 <a href="#_sub11" class="code" title="subfunction fv_plotSignals(figh)">fv_plotSignals</a>(figh);
0776 <a href="beautifyAxes.html" class="code" title="function beautifyAxes(figh)">beautifyAxes</a>(figh);
0777 gui.rightPanel.Selection = 2;
0778 <span class="keyword">end</span>
0779 
0780 <span class="comment">%% subfunction to export the 2D inversion data</span>
0781 <a name="_sub8" href="#_subfunctions" class="code">function fv_onPushSave(src,~)</a>
0782 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0783 <span class="comment">% local GUI data</span>
0784 data = getappdata(figh,<span class="string">'data'</span>);
0785 
0786 <span class="comment">% get data path to save inversion results</span>
0787 [sfile,spath] = uiputfile(<span class="string">'*.mat'</span>,<span class="string">'Select File for Save'</span>,<span class="keyword">...</span>
0788     fullfile(pwd,<span class="string">'2Dmoddata.mat'</span>));
0789 <span class="comment">% if user did not cancel, procceed</span>
0790 <span class="keyword">if</span> sfile &gt; 0
0791     moddata = data;
0792     save(fullfile(spath,sfile),<span class="string">'moddata'</span>);
0793     disp(<span class="string">'2D Modeling data saved to: '</span>);
0794     disp(fullfile(spath,sfile));
0795 <span class="keyword">else</span>
0796     disp(<span class="string">'Save cancelled.'</span>);
0797 <span class="keyword">end</span>
0798 
0799 <span class="keyword">end</span>
0800 
0801 <span class="comment">%% subfunction to export the current view to a figure</span>
0802 <a name="_sub9" href="#_subfunctions" class="code">function fv_onPushView(src,~)</a>
0803 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0804 <span class="comment">% local GUI data</span>
0805 gui = getappdata(figh,<span class="string">'gui'</span>);
0806 
0807 <span class="comment">% opening the export figure</span>
0808 expfig = figure(<span class="string">'Color'</span>,gui.myui.colors.panelBG);
0809 
0810 <span class="comment">% create axes layout depending on view</span>
0811 <span class="keyword">switch</span> get(gui.rightPanel,<span class="string">'Selection'</span>)
0812     <span class="keyword">case</span> 1
0813         <span class="comment">% create layout</span>
0814         ax1 = subplot(5,5,[1 2 3 4],<span class="string">'Parent'</span>,expfig);
0815         ax2 = subplot(5,5,[6:9 11:14 16:19 21:24],<span class="string">'Parent'</span>,expfig);
0816         ax3 = subplot(5,5,[10 15 20 25],<span class="string">'Parent'</span>,expfig);
0817         <span class="comment">% get positions</span>
0818         pos1 = get(ax1,<span class="string">'Position'</span>);
0819         pos2 = get(ax2,<span class="string">'Position'</span>);
0820         pos3 = get(ax3,<span class="string">'Position'</span>);
0821         <span class="comment">% delete axes</span>
0822         delete(ax1);delete(ax2);delete(ax3);
0823         <span class="comment">% copy GUI axes</span>
0824         ax1 = copyobj(gui.axes21,expfig);
0825         ax2 = copyobj(gui.axes2,expfig);
0826         ax3 = copyobj(gui.axes24,expfig);
0827         <span class="comment">% adjust positions</span>
0828         set(ax1,<span class="string">'Position'</span>,pos1);
0829         set(ax2,<span class="string">'Position'</span>,pos2);
0830         set(ax3,<span class="string">'Position'</span>,pos3);
0831     <span class="keyword">case</span> 2
0832         <span class="comment">% create layout</span>
0833         ax1 = subplot(7,1,[1 2],<span class="string">'Parent'</span>,expfig);
0834         ax2 = subplot(7,1,[4 5 6 7],<span class="string">'Parent'</span>,expfig);
0835         <span class="comment">% get positions</span>
0836         pos1 = get(ax1,<span class="string">'Position'</span>);
0837         pos2 = get(ax2,<span class="string">'Position'</span>);
0838         <span class="comment">% delete axes</span>
0839         delete(ax1);delete(ax2);
0840         <span class="comment">% copy GUI axes</span>
0841         ax1 = copyobj(gui.axes31,expfig);
0842         ax2 = copyobj(gui.axes32,expfig);
0843         <span class="comment">% adjust positions</span>
0844         set(ax1,<span class="string">'Position'</span>,pos1);
0845         set(ax2,<span class="string">'Position'</span>,pos2);
0846 <span class="keyword">end</span>
0847 
0848 <span class="keyword">end</span>
0849 
0850 <span class="comment">%% subfunction to update the main NUCLEUSinv GUI</span>
0851 <a name="_sub10" href="#_subfunctions" class="code">function fv_onPushUpdate(src,~)</a>
0852 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
0853 <span class="comment">% local GUI data</span>
0854 uvgui = getappdata(figh,<span class="string">'gui'</span>);
0855 uvdata = getappdata(figh,<span class="string">'data'</span>);
0856 <span class="comment">% NUCLEUSinv data</span>
0857 gui = getappdata(uvgui.figh_nucleus,<span class="string">'gui'</span>);
0858 INVdata = getappdata(uvgui.figh_nucleus,<span class="string">'INVdata'</span>);
0859 data = getappdata(uvgui.figh_nucleus,<span class="string">'data'</span>);
0860 
0861 <span class="comment">% loop over all signals</span>
0862 E_inv = zeros(size(uvdata.results.T1T2map.t_recov));
0863 <span class="keyword">for</span> id = 1:numel(INVdata)
0864     <span class="comment">% the standard INVdata struct</span>
0865     INVdata{id} = [];
0866     
0867     <span class="comment">% old, slow but consistent way</span>
0868     <span class="comment">% trigger the listbox entry</span>
0869     <span class="comment">% set(gui.listbox_handles.signal,'Value',id);</span>
0870     <span class="comment">% onListboxData(gui.listbox_handles.signal);</span>
0871     <span class="comment">% no gating</span>
0872     <span class="comment">% which radiobutton ('log', 'lin' or 'none')</span>
0873     <span class="comment">% onRadioGates(gui.radio_handles.process_gates_none);</span>
0874     <span class="comment">% get the fresh data</span>
0875     <span class="comment">% data = getappdata(uvgui.figh_nucleus,'data');</span>
0876     
0877     <span class="comment">% new, fast and hopefully consistent :-) way</span>
0878     data.process.start = 1;
0879     data.process.end = numel(uvdata.results.T1T2map.import{id}.time);
0880     data.process.gatetype = <span class="string">'raw'</span>;
0881     <span class="comment">% update 2Dinv GUI settings</span>
0882     data.inv2D.prop = uvdata.prop;
0883     data.inv2D.inv = uvdata.inv;
0884     data.inv2D.info = uvdata.info;
0885     <span class="comment">% create raw data struct</span>
0886     data.results.nmrraw.t = uvdata.results.T1T2map.import{id}.time;
0887     data.results.nmrraw.s = uvdata.results.T1T2map.import{id}.signal;
0888     <span class="keyword">if</span> id == numel(INVdata)
0889         data.results.nmrraw.noise = uvdata.results.T1T2map.import{id}.noise;
0890         data.results.nmrproc.T1T2 = <span class="string">'T1'</span>;
0891         data.results.nmrproc.T1IRfac = 2;
0892     <span class="keyword">else</span>
0893         data.results.nmrraw.phase = uvdata.results.T1T2map.import{id}.phase;
0894     <span class="keyword">end</span>
0895     <span class="comment">% create proc data struct</span>
0896     data.results.nmrproc.start = 1;
0897     data.results.nmrproc.end = numel(uvdata.results.T1T2map.import{id}.time);
0898     data.results.nmrproc.gatetype = <span class="string">'raw'</span>;
0899     data.results.nmrproc.t = uvdata.results.T1T2map.import{id}.time;
0900     data.results.nmrproc.s = real(uvdata.results.T1T2map.import{id}.signal);
0901     data.results.nmrproc.N = ones(size(data.results.nmrproc.s));
0902     <span class="keyword">if</span> isfield(uvdata.results.T1T2map.import{id},<span class="string">'noise'</span>)
0903         data.results.nmrproc.noise = uvdata.results.T1T2map.import{id}.noise;
0904     <span class="keyword">else</span>
0905         range = floor(numel(data.results.nmrproc.s)/2):numel(data.results.nmrproc.s);
0906         data.results.nmrproc.noise = std(imag(uvdata.results.T1T2map.import{id}.signal(range)));
0907     <span class="keyword">end</span>
0908     data.results.nmrproc.e = data.results.nmrproc.noise*ones(size(data.results.nmrproc.s));
0909     <span class="keyword">if</span> isfield(data.results.nmrproc,<span class="string">'W'</span>)
0910         data.results.nmrproc = rmfield(data.results.nmrproc,<span class="string">'W'</span>);
0911     <span class="keyword">end</span>
0912 
0913     <span class="comment">% and use it for the INVdata</span>
0914     INVdata{id} = data;
0915     INVdata{id} = rmfield(INVdata{id},<span class="string">'import'</span>);
0916     INVdata{id} = rmfield(INVdata{id},<span class="string">'info'</span>);
0917     INVdata{id} = rmfield(INVdata{id},<span class="string">'calib'</span>);
0918     INVdata{id} = rmfield(INVdata{id},<span class="string">'pressure'</span>);
0919 
0920     <span class="comment">% now add a dummy &quot;invstd&quot; field</span>
0921     <span class="keyword">if</span> id == numel(INVdata)
0922         <span class="comment">% for the final merged T1</span>
0923         INVdata{id}.results.invstd.fit_t = uvdata.results.T1T2map.t_recov;
0924         INVdata{id}.results.invstd.fit_s = E_inv;
0925         INVdata{id}.results.invstd.E0 = uvdata.results.inv2D.E0;
0926         INVdata{id}.results.invstd.ciE0 = NaN;
0927         out = <a href="../../../nucleus/functions/inversion/getFitErrors.html" class="code" title="function out = getFitErrors(s,sfit,noise,varargin)">getFitErrors</a>(uvdata.results.T1T2map.E_raw(:,1),E_inv,data.results.nmrproc.noise);
0928         INVdata{id}.results.invstd.resnorm = out.resnorm;
0929         INVdata{id}.results.invstd.residual = out.residual;
0930         INVdata{id}.results.invstd.chi2 = out.chi2;
0931         INVdata{id}.results.invstd.rms = out.rms;
0932     <span class="keyword">else</span>
0933         <span class="comment">% for the individual signals</span>
0934         INVdata{id}.results.invstd.fit_t = uvdata.results.inv2D.data(id).t;
0935         INVdata{id}.results.invstd.fit_s = uvdata.results.inv2D.data(id).s_fit;
0936         E_inv(id,1) = uvdata.results.inv2D.data(id).s_fit(1);
0937         INVdata{id}.results.invstd.E0 = uvdata.results.inv2D.data(id).s_fit(1);
0938         INVdata{id}.results.invstd.ciE0 = NaN;
0939         INVdata{id}.results.invstd.resnorm = uvdata.results.inv2D.data(id).resnorm;
0940         INVdata{id}.results.invstd.residual = uvdata.results.inv2D.data(id).residual;
0941         INVdata{id}.results.invstd.chi2 = uvdata.results.inv2D.data(id).chi2;
0942         INVdata{id}.results.invstd.rms = uvdata.results.inv2D.data(id).rms;
0943     <span class="keyword">end</span>
0944     INVdata{id}.results.invstd.lambda_out = 1;
0945     INVdata{id}.results.invstd.xn = 0;
0946     INVdata{id}.results.invstd.rn = 0;
0947     INVdata{id}.results.invstd.invtype = data.invstd.invtype;
0948     INVdata{id}.results.invstd.invparams = NaN;
0949     <span class="keyword">if</span> id == numel(INVdata)
0950         INVdata{id}.results.inv2D = uvdata.results.inv2D;
0951     <span class="keyword">else</span>
0952         INVdata{id}.results.inv2D = true;
0953     <span class="keyword">end</span>
0954 
0955     <span class="comment">% color the corresponding list entries in the main GUI</span>
0956     strL = get(gui.listbox_handles.signal,<span class="string">'String'</span>);
0957     str1 = strL{id};
0958     str2 = [<span class="string">'&lt;HTML&gt;&lt;BODY bgcolor=&quot;rgb('</span>,<span class="keyword">...</span>
0959         sprintf(<span class="string">'%d,%d,%d'</span>,gui.myui.colors.listINV.*255),<span class="string">')&quot;&gt;'</span>,str1,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;'</span>];
0960     strL{id} = str2;
0961     set(gui.listbox_handles.signal,<span class="string">'String'</span>,strL);
0962 <span class="keyword">end</span>
0963 
0964 <span class="comment">% update GUI INVdata</span>
0965 setappdata(uvgui.figh_nucleus,<span class="string">'INVdata'</span>,INVdata);
0966 
0967 <span class="comment">% set focus on first signal</span>
0968 set(gui.listbox_handles.signal,<span class="string">'Value'</span>,1);
0969 <a href="../../../nucleus/callbacks/listboxes/onListboxData.html" class="code" title="function onListboxData(src,~)">onListboxData</a>(gui.listbox_handles.signal);
0970 <span class="keyword">end</span>
0971 
0972 <span class="comment">%% subfunction to update all plots</span>
0973 <a name="_sub11" href="#_subfunctions" class="code">function fv_plotSignals(figh)</a>
0974 gui = getappdata(figh,<span class="string">'gui'</span>);
0975 data = getappdata(figh,<span class="string">'data'</span>);
0976 mod2D = data.results.mod2D;
0977 data_mod = mod2D.data;
0978 col = gui.myui.colors;
0979 
0980 <span class="comment">% clear axes</span>
0981 <a href="clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes31);
0982 <a href="clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes32);
0983 hold(gui.axes31,<span class="string">'on'</span>);
0984 hold(gui.axes32,<span class="string">'on'</span>);
0985 
0986 <span class="comment">% define some axes settings</span>
0987 log_t_ticks = logspace(-5,2,8);
0988 t_recov_lims = [min(mod2D.t_recov)/2 max(mod2D.t_recov)*2];
0989 
0990 <span class="comment">% prepare the data for the combined T1 curve</span>
0991 E_mod = zeros(size(mod2D.t_recov));
0992 <span class="keyword">for</span> nn = 1:numel(data_mod)
0993     E_mod(nn,1) = data_mod(nn).s(1);
0994     <span class="comment">% plot individual T2 signals and fits</span>
0995     plot3(data_mod(nn).t,data_mod(nn).T1*ones(size(data_mod(nn).s)),<span class="keyword">...</span>
0996         data_mod(nn).s,<span class="string">'Color'</span>,col.axisL,<span class="string">'DisplayName'</span>,<span class="string">'T2 signals'</span>,<span class="keyword">...</span>
0997         <span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,gui.axes32);
0998 <span class="keyword">end</span>
0999 view(gui.axes32,[30 20]);
1000 set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks);
1001 set(gui.axes32,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YDir'</span>,<span class="string">'normal'</span>,<span class="string">'YTick'</span>,log_t_ticks,<span class="string">'YLim'</span>,t_recov_lims);
1002 set(get(gui.axes32,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'time [s]'</span>);
1003 set(get(gui.axes32,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
1004 set(get(gui.axes32,<span class="string">'ZLabel'</span>),<span class="string">'String'</span>,<span class="string">'amplitude [a.u.]'</span>);
1005 <span class="comment">% fv_fixLabel3DAxes(gui.axes32)</span>
1006 
1007 <span class="comment">% tab 3 - combined T1 curve and fit</span>
1008 plot(mod2D.t_recov,E_mod(:,1),<span class="string">'o-'</span>,<span class="string">'Color'</span>,col.axisL,<span class="keyword">...</span>
1009     <span class="string">'LineWidth'</span>,1,<span class="string">'DisplayName'</span>,<span class="string">'T1 curve'</span>,<span class="string">'Parent'</span>,gui.axes31);
1010 set(gui.axes31,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XLim'</span>,t_recov_lims);
1011 set(gui.axes31,<span class="string">'YScale'</span>,<span class="string">'lin'</span>);
1012 set(get(gui.axes31,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'recovery time t_{rec} [s]'</span>);
1013 set(get(gui.axes31,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'mean(E(1:3)) [a.u.]'</span>);
1014 legend(gui.axes31,<span class="string">'Location'</span>,<span class="string">'SouthEast'</span>);
1015 
1016 <span class="comment">% hold off all axes</span>
1017 hold(gui.axes31,<span class="string">'off'</span>);
1018 hold(gui.axes32,<span class="string">'off'</span>);
1019 
1020 <span class="comment">% call function to adapt the axes scaling</span>
1021 <a href="#_sub14" class="code" title="subfunction fv_setAxesScaling(figh)">fv_setAxesScaling</a>(figh);
1022 <span class="keyword">end</span>
1023 
1024 <span class="comment">%%  subfunction to plot the raw data</span>
1025 <a name="_sub12" href="#_subfunctions" class="code">function fv_plotModel(figh)</a>
1026 gui = getappdata(figh,<span class="string">'gui'</span>);
1027 data = getappdata(figh,<span class="string">'data'</span>);
1028 col = gui.myui.colors;
1029 mod2D = data.results.mod2D;
1030 
1031 <a href="clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes2);
1032 <a href="clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes21);
1033 <a href="clearSingleAxis.html" class="code" title="function clearSingleAxis(axh)">clearSingleAxis</a>(gui.axes24);
1034 hold(gui.axes2,<span class="string">'on'</span>);
1035 hold(gui.axes21,<span class="string">'on'</span>);
1036 hold(gui.axes24,<span class="string">'on'</span>);
1037 
1038 log_t_ticks = logspace(-5,2,8);
1039 
1040 <span class="comment">% tab 2 - 2D inversion model</span>
1041 [X,Y] = meshgrid(mod2D.T2vec,mod2D.T1vec);
1042 imagescnan(X,Y,mod2D.MOD,<span class="string">'Parent'</span>,gui.axes2);
1043 plot([1e-5 100],[1e-5 100],<span class="keyword">...</span>
1044     <span class="string">'--'</span>,<span class="string">'Color'</span>,<span class="string">'w'</span>,<span class="string">'LineWidth'</span>,1,<span class="string">'Parent'</span>,gui.axes2);
1045 view(gui.axes2,[0 90]);
1046 set(gui.axes2,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks,<span class="keyword">...</span>
1047     <span class="string">'XLim'</span>,[min(mod2D.T2vec) max(mod2D.T2vec)]);
1048 set(gui.axes2,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks,<span class="keyword">...</span>
1049     <span class="string">'YLim'</span>,[min(mod2D.T1vec) max(mod2D.T1vec)],<span class="string">'YDir'</span>,<span class="string">'normal'</span>);
1050 set(get(gui.axes2,<span class="string">'XLabel'</span>),<span class="string">'String'</span>,<span class="string">'relaxation time T2 [s]'</span>);
1051 set(get(gui.axes2,<span class="string">'YLabel'</span>),<span class="string">'String'</span>,<span class="string">'relaxation time T1 [s]'</span>);
1052 set(gui.axes2,<span class="string">'Layer'</span>,<span class="string">'top'</span>,<span class="string">'XGrid'</span>,<span class="string">'off'</span>,<span class="string">'YGrid'</span>,<span class="string">'off'</span>);
1053 
1054 <span class="comment">% sum along each dimension to get both RTDs</span>
1055 T1rtd = sum(mod2D.MOD,2);
1056 T2rtd = sum(mod2D.MOD,1);
1057 <span class="comment">% find common maximum for y-axis setting</span>
1058 ymax = max([max(T1rtd) max(T2rtd)])*1.1;
1059 <span class="comment">% T1 RTD</span>
1060 plot(T1rtd,mod2D.T1vec,<span class="string">'Color'</span>,col.axisL,<span class="string">'Parent'</span>,gui.axes24);
1061 set(gui.axes24,<span class="string">'XScale'</span>,<span class="string">'lin'</span>,<span class="string">'XLim'</span>,[0 ymax]);
1062 set(gui.axes24,<span class="string">'YScale'</span>,<span class="string">'log'</span>,<span class="string">'YTickLabel'</span>,<span class="string">''</span>);
1063 
1064 <span class="comment">% T2 RTD</span>
1065 plot(mod2D.T2vec,T2rtd,<span class="string">'Color'</span>,col.axisL,<span class="string">'DisplayName'</span>,<span class="string">'RTD'</span>,<span class="string">'Parent'</span>,gui.axes21);
1066 set(gui.axes21,<span class="string">'YScale'</span>,<span class="string">'lin'</span>,<span class="string">'YLim'</span>,[0 ymax]);
1067 set(gui.axes21,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTickLabel'</span>,<span class="string">''</span>);
1068 
1069 hold(gui.axes2,<span class="string">'off'</span>);
1070 hold(gui.axes21,<span class="string">'off'</span>);
1071 hold(gui.axes24,<span class="string">'off'</span>);
1072 <span class="keyword">end</span>
1073 
1074 <span class="comment">%% subfunction zo switch x-axis scaling</span>
1075 <a name="_sub13" href="#_subfunctions" class="code">function fv_onRadioLogLin(src,~)</a>
1076 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1077 gui = getappdata(figh,<span class="string">'gui'</span>);
1078 <span class="comment">% get tag of the radio menu</span>
1079 tag = get(src,<span class="string">'Tag'</span>);
1080 val = get(src,<span class="string">'Value'</span>);
1081 
1082 <span class="keyword">switch</span> tag
1083     <span class="keyword">case</span> <span class="string">'log'</span>
1084         <span class="keyword">switch</span> val
1085             <span class="keyword">case</span> 1 <span class="comment">% log should be used</span>
1086                 set(gui.radio_handles.lin,<span class="string">'Value'</span>,0);
1087             <span class="keyword">case</span> 0 <span class="comment">% lin should be used</span>
1088                 set(gui.radio_handles.lin,<span class="string">'Value'</span>,1);
1089         <span class="keyword">end</span>
1090     <span class="keyword">case</span> <span class="string">'lin'</span>
1091         <span class="keyword">switch</span> val
1092             <span class="keyword">case</span> 1 <span class="comment">% lin should be used</span>
1093                 set(gui.radio_handles.log,<span class="string">'Value'</span>,0);
1094             <span class="keyword">case</span> 0 <span class="comment">% log should be used</span>
1095                 set(gui.radio_handles.log,<span class="string">'Value'</span>,1);
1096         <span class="keyword">end</span>
1097 <span class="keyword">end</span>
1098 <span class="comment">% update GUI data</span>
1099 setappdata(figh,<span class="string">'gui'</span>,gui);
1100 
1101 <span class="comment">% call function to adapt the axes scaling</span>
1102 <a href="#_sub14" class="code" title="subfunction fv_setAxesScaling(figh)">fv_setAxesScaling</a>(figh);
1103 <span class="keyword">end</span>
1104 
1105 <span class="comment">%% subfunction to switch x-axis scaling log&lt;-&gt;lin</span>
1106 <a name="_sub14" href="#_subfunctions" class="code">function fv_setAxesScaling(figh)</a>
1107 gui = getappdata(figh,<span class="string">'gui'</span>);
1108 
1109 uselog = get(gui.radio_handles.log,<span class="string">'Value'</span>);
1110 <span class="keyword">switch</span> uselog
1111     <span class="keyword">case</span> 1
1112         log_t_ticks = logspace(-5,2,8);
1113         set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'log'</span>,<span class="string">'XTick'</span>,log_t_ticks);
1114     <span class="keyword">case</span> 0
1115         set(gui.axes32,<span class="string">'XScale'</span>,<span class="string">'lin'</span>,<span class="string">'XTickMode'</span>,<span class="string">'auto'</span>);
1116 <span class="keyword">end</span>
1117 
1118 <span class="keyword">end</span>
1119 
1120 <span class="comment">%% close function</span>
1121 <a name="_sub15" href="#_subfunctions" class="code">function fv_closeme(src,~)</a>
1122 figh = ancestor(src,<span class="string">'figure'</span>,<span class="string">'toplevel'</span>);
1123 <span class="comment">% try to close the sub GUI in a clean manner</span>
1124 <span class="keyword">try</span>
1125     <span class="comment">% NOTE: maybe needed at some later point</span>
1126     <span class="comment">%     gui = getappdata(figh,'gui');</span>
1127     <span class="comment">%     data = getappdata(gui.figh_nucleus,'data');</span>
1128     <span class="comment">%     % update NUCLEUSinv</span>
1129     <span class="comment">%     setappdata(gui.figh_nucleus,'data',data);</span>
1130     delete(figh);
1131 <span class="keyword">catch</span>
1132     <span class="comment">% if this is not working: just close it</span>
1133     delete(figh);
1134 <span class="keyword">end</span>
1135 
1136 <span class="keyword">end</span>
1137 
1138 <span class="comment">%------------- END OF CODE --------------</span>
1139 
1140 <span class="comment">%% License:</span>
1141 <span class="comment">% MIT License</span>
1142 <span class="comment">%</span>
1143 <span class="comment">% Copyright (c) 2024 Thomas Hiller</span>
1144 <span class="comment">%</span>
1145 <span class="comment">% Permission is hereby granted, free of charge, to any person obtaining a copy</span>
1146 <span class="comment">% of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
1147 <span class="comment">% in the Software without restriction, including without limitation the rights</span>
1148 <span class="comment">% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
1149 <span class="comment">% copies of the Software, and to permit persons to whom the Software is</span>
1150 <span class="comment">% furnished to do so, subject to the following conditions:</span>
1151 <span class="comment">%</span>
1152 <span class="comment">% The above copyright notice and this permission notice shall be included in all</span>
1153 <span class="comment">% copies or substantial portions of the Software.</span>
1154 <span class="comment">%</span>
1155 <span class="comment">% THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
1156 <span class="comment">% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
1157 <span class="comment">% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
1158 <span class="comment">% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
1159 <span class="comment">% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
1160 <span class="comment">% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
1161 <span class="comment">% SOFTWARE.</span></pre></div>
<hr><address>Generated by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>